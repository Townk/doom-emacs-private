<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2021-05-22 Sat 06:31 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>The Doomed Configuration</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Thiago Alves">
<link rel="stylesheet" type="text/css" href="https://gongzhitaao.org/orgcss/org.css"/>
<style type="text/css">
@media all {
body {
font-size: 1.6rem;
line-height: 1.4em;
font-family: 'Cardo', serif;
color: #222
}
h1 {
font-size: 2.2em;
font-family: 'Cardo', serif;
}
.org-src-container {
padding: 0.3em 0.8em;
border-radius: 4px;
}
table caption {
font-size: 0.7em;
}
figcaption {
font-size: 0.7em;
}
label.org-src-name {
float: right;
position: absolute;
bottom: -0.7em;
right: 0.8em;
font-size: 0.5em;
}
.org-src-name, .org-src-name * {
color: #b3b3b3;
}
.listing-number {
visibility: hidden;
}
.src {
font-size: 0.7em;
line-height: 1.2em;
}
a code {
color:#3a5fcd;
}
div.note {
-moz-border-radius: 6px;
-webkit-border-radius: 6px;
background-color: #f0f7fb;
background-image: url(https://f1.madcapsoftware.com/blogImages/2017/08/css-box-icon-3.png);
background-position: 0.3em 0.8em;
background-repeat: no-repeat;
border: solid 1px #3498db;
border-radius: 4px;
overflow: hidden;
padding: 0 1em 0 2.2em;
}
div.warning {
-moz-border-radius: 6px;
-webkit-border-radius: 6px;
background-color: #fde6e5;
background-image: url(https://f1.madcapsoftware.com/blogImages/2017/08/css-box-icon-4.png);
background-position: 0.3em 0.8em;
background-repeat: no-repeat;
border: solid 1px #ce2a21;
border-radius: 4px;
overflow: hidden;
padding: 0 1em 0 2.2em;
}
div.outline-text-2>p:first-child:first-letter {
float: left;
font-size: 4em;
padding-right: 5px;
}
#table-of-contents {
font-size: 10pt;
position: fixed;
right: 3em;
top: 0em;
background: #2b2b2b;
color: #dcdccc;
-webkit-box-shadow: 0 0 4px #777777;
-moz-box-shadow: 0 0 4px #777777;
border-radius: 4px;
text-align: right;
/* ensure doesn't flow off the screen when expanded */
max-height: 80%;
overflow: auto;
z-index: 1000;
}
#table-of-contents h2 {
font-size: 10pt;
max-width: 8em;
font-weight: normal;
padding-left: 0.5em;
padding-left: 0.5em;
padding-top: 0.05em;
padding-bottom: 0.05em;
}
#table-of-contents #text-table-of-contents {
display: none;
text-align: left;
}
#table-of-contents:hover #text-table-of-contents {
display: block;
padding: 0.5em;
margin-top: 0em;
}
#table-of-contents {
color: black;
background: #FFF;
font-size: 80%;
padding: .5em;
margin: 1em -2em 1em 1em;
display: block;
}
#table-of-contents a {
color: #003333;
}
#table-of-contents a:hover {
color: #003333;
text-decoration: underline;
}
#table-of-contents h2 {
margin-top: 0;
margin-bottom: 0;
padding: 0;
border: none;
}
.org-rainbow-delimiters-depth-1 {
color: #c39900
}
.org-rainbow-delimiters-depth-2 {
color: #00bfff
}
.org-rainbow-delimiters-depth-3 {
color: #c39900
}
.org-rainbow-delimiters-depth-4 {
color: #00bfff
}
.org-rainbow-delimiters-depth-5 {
color: #c39900
}
.org-rainbow-delimiters-depth-6 {
color: #00bfff
}
.org-rainbow-delimiters-depth-7 {
color: #c39900
}
.org-rainbow-delimiters-depth-8 {
color: #00bfff
}
.org-rainbow-delimiters-depth-9 {
color: #c39900
}
}
@media screen {
#table-of-contents {
float: right;
border: 1px solid #CCC;
max-width: 50%;
overflow: auto;
}
}
</style>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<header>
<h1 class="title">The Doomed Configuration</h1>
<p class="subtitle">A detailed setup for Emacs using Doom Emacs configuration framework</p>
</header><nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org5cfd538">1. Prologue</a>
<ul>
<li><a href="#orgf949178">1.1. About this document</a></li>
<li><a href="#org24c4adc">1.2. About literate configuration</a></li>
<li><a href="#orgdb6616e">1.3. About Doom configuration style</a>
<ul>
<li><a href="#org9c3252f">1.3.1. Doom has its own package manager</a></li>
<li><a href="#orga6a9f87">1.3.2. Lazy load everything</a></li>
<li><a href="#org5bd6a6c">1.3.3. Configuration evaluation order</a></li>
<li><a href="#org06f156e">1.3.4. Use the <code>map!</code> macro to bind keys</a></li>
</ul>
</li>
<li><a href="#orgb8a4b69">1.4. Investigating issues</a></li>
<li><a href="#org716b7f6">1.5. Acknowledgments</a></li>
</ul>
</li>
<li><a href="#org438cd7a">2. Standard features</a>
<ul>
<li><a href="#orgc6fda1f">2.1. Requirements</a>
<ul>
<li><a href="#orgaa591b4">2.1.1. Modal editing</a></li>
<li><a href="#org8a89c90">2.1.2. Text Snippets</a></li>
<li><a href="#orga00f3c2">2.1.3. Inline completion</a></li>
<li><a href="#org99b2e4b">2.1.4. Automatic indentation</a></li>
<li><a href="#orgd510d0f">2.1.5. Smart backspace</a></li>
<li><a href="#org7cddafe">2.1.6. Balanced pairs</a></li>
<li><a href="#orgf9d98f8">2.1.7. Rich keybindings</a></li>
<li><a href="#org444c1ad">2.1.8. Useful line numbers</a></li>
<li><a href="#org3b00218">2.1.9. Auto-saving</a></li>
<li><a href="#org2c4297b">2.1.10. Persist frame position and geometry</a></li>
<li><a href="#org120bdb7">2.1.11. Remote editing</a></li>
</ul>
</li>
<li><a href="#org7a37f28">2.2. Emacs-only configurations</a>
<ul>
<li><a href="#orge9ccaa5">2.2.1. Identity</a></li>
<li><a href="#orgd510e4d">2.2.2. Dashboard</a></li>
<li><a href="#orgfa72edd">2.2.3. Key modifiers</a></li>
<li><a href="#org535b2f2">2.2.4. Training wheels</a></li>
<li><a href="#orgd20bd13">2.2.5. Emacs source code</a></li>
<li><a href="#org6c78b57">2.2.6. Line numbers</a></li>
<li><a href="#org8ea56b4">2.2.7. Indentation</a></li>
<li><a href="#org0924d31">2.2.8. Line wrapping</a></li>
<li><a href="#orgc491a3e">2.2.9. Scrolling</a></li>
<li><a href="#orgdf1427a">2.2.10. Repeatable commands</a></li>
</ul>
</li>
<li><a href="#org6d2e172">2.3. Modal editing</a></li>
<li><a href="#orgd871dbc">2.4. Text snippets</a></li>
<li><a href="#orgf306019">2.5. Inline completion</a></li>
<li><a href="#org9ba2515">2.6. Automatic indentation</a></li>
<li><a href="#org2cc7aa7">2.7. Smart backspace</a></li>
<li><a href="#orga192e61">2.8. Balanced pairs</a></li>
<li><a href="#org617a217">2.9. Rich keybindings</a></li>
<li><a href="#org5eef89d">2.10. Useful line numbers</a></li>
<li><a href="#org6852326">2.11. Auto-Saving</a></li>
<li><a href="#org759796e">2.12. Persist frame position and geometry</a></li>
<li><a href="#orge5e34f9">2.13. <span class="todo TODO">TODO</span> Remote editing</a></li>
</ul>
</li>
<li><a href="#orgbf2a653">3. Personal preferences</a>
<ul>
<li><a href="#org3d38504">3.1. Evil</a>
<ul>
<li><a href="#org10d1e74">3.1.1. Evil-MatchIt</a></li>
<li><a href="#orgf5fe906">3.1.2. Plus-Minus</a></li>
<li><a href="#orgb416a34">3.1.3. Evil-String-Inflection</a></li>
</ul>
</li>
<li><a href="#org5f335dc">3.2. Keybindings</a>
<ul>
<li><a href="#orgd770d21">3.2.1. Window navigation</a></li>
<li><a href="#org3bb0667">3.2.2. Vim defaults</a></li>
<li><a href="#org327ef8e">3.2.3. Personal shortcuts</a></li>
<li><a href="#org7706e21">3.2.4. Repeatable shortcuts</a></li>
</ul>
</li>
<li><a href="#org127970e">3.3. Appearances</a>
<ul>
<li><a href="#org3f5a855">3.3.1. Frame</a></li>
<li><a href="#org97423b1">3.3.2. Editor</a></li>
<li><a href="#orgf819a0c">3.3.3. Theme</a></li>
<li><a href="#orgc7e6151">3.3.4. Typography</a></li>
<li><a href="#org83993f0">3.3.5. Iconography</a></li>
</ul>
</li>
<li><a href="#org9995bc2">3.4. Editor Tabs</a>
<ul>
<li><a href="#org55ef10a">3.4.1. Tab actions</a></li>
<li><a href="#orgdddfd7d">3.4.2. Windows</a></li>
</ul>
</li>
<li><a href="#orge8728a6">3.5. Special modes</a>
<ul>
<li><a href="#org50ec441">3.5.1. Info mode</a></li>
<li><a href="#org4a8f0c9">3.5.2. Help mode and Man mode</a></li>
<li><a href="#org79a69eb">3.5.3. Rainbow mode</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgcbc3ef3">4. Temporary workarounds</a>
<ul>
<li><a href="#orga79a25d">4.1. <span class="todo TODO">TODO</span> Completion framework</a>
<ul>
<li><a href="#org3ba2789">4.1.1. Filtering and highlighting</a></li>
<li><a href="#org5de25a1">4.1.2. Sorting</a></li>
<li><a href="#orgb5798d9">4.1.3. Candidates annotations</a></li>
<li><a href="#org0b4e7e2">4.1.4. Completion UI</a></li>
<li><a href="#orge32579e">4.1.5. Contextual Menu</a></li>
<li><a href="#orgcf125ea">4.1.6. Extra commands</a></li>
<li><a href="#orgfd6f574">4.1.7. Change Doom's behavior</a></li>
</ul>
</li>
<li><a href="#org96b9ab2">4.2. <span class="todo TODO">TODO</span> Workspaces</a>
<ul>
<li><a href="#orgbb30c03">4.2.1. Display tab bar</a></li>
<li><a href="#orgf527d4c">4.2.2. Switch workspace</a></li>
<li><a href="#org5122b01">4.2.3. Switch to N<sup>th</sup> workspace</a></li>
<li><a href="#orgd7069e1">4.2.4. Switch to final workspace</a></li>
<li><a href="#orge919231">4.2.5. Switch to last used workspace</a></li>
<li><a href="#org2c02379">4.2.6. Previous and next workspace</a></li>
<li><a href="#org54d4b96">4.2.7. New workspace</a></li>
<li><a href="#orgd6c9adb">4.2.8. Rename workspace</a></li>
<li><a href="#org0ba7480">4.2.9. Delete this workspace</a></li>
<li><a href="#org9176834">4.2.10. Delete session</a></li>
<li><a href="#org1014d04">4.2.11. Delete session and quit</a></li>
<li><a href="#orge843bda">4.2.12. Save session to file</a></li>
<li><a href="#orge78de60">4.2.13. Load session from file</a></li>
<li><a href="#orgda6593a">4.2.14. Restore last session</a></li>
<li><a href="#org08d4809">4.2.15. Other shortcuts</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org7681d60">5. Writing&#xa0;&#xa0;&#xa0;<span class="tag"><span class="wip">wip</span></span></a>
<ul>
<li><a href="#orga95845a">5.1. <span class="todo TODO">TODO</span> Requirements</a></li>
<li><a href="#org12b940a">5.2. <span class="todo TODO">TODO</span> Common Org configurations</a></li>
<li><a href="#org9d10ad5">5.3. <span class="todo TODO">TODO</span> Prose writing</a>
<ul>
<li><a href="#org94575ad">5.3.1. Dictionary and writing helpers</a></li>
<li><a href="#org74eac19">5.3.2. Templates</a></li>
<li><a href="#orgf0ca6ce">5.3.3. Focus Writing</a></li>
<li><a href="#org1475e7a">5.3.4. Snippets</a></li>
</ul>
</li>
<li><a href="#orge7decc8">5.4. <span class="todo TODO">TODO</span> Reading or reviewing</a></li>
<li><a href="#org11bd62e">5.5. <span class="todo TODO">TODO</span> Publishing</a></li>
<li><a href="#orgba41b4c">5.6. <span class="todo TODO">TODO</span> Presenting</a></li>
<li><a href="#org6a3ffe9">5.7. <span class="todo TODO">TODO</span> Note Taking</a>
<ul>
<li><a href="#org7a9a2c0">5.7.1. Capturing</a></li>
<li><a href="#org09b0fba">5.7.2. Journal</a></li>
<li><a href="#orgf2fc836">5.7.3. Zettelkasten</a></li>
<li><a href="#org9994da6">5.7.4. Deft</a></li>
<li><a href="#org736c93d">5.7.5. Utilities</a></li>
</ul>
</li>
<li><a href="#orgdeb659d">5.8. <span class="todo TODO">TODO</span> Other modes</a>
<ul>
<li><a href="#orgcd4cd93">5.8.1. Markdown</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org088c01c">6. Development</a>
<ul>
<li><a href="#org558bf69">6.1. <span class="todo TODO">TODO</span> Requirements</a></li>
<li><a href="#orgc424ab5">6.2. <span class="todo TODO">TODO</span> Common configuration</a>
<ul>
<li><a href="#org9ddf3f5">6.2.1. Version control system</a></li>
<li><a href="#org0084c1c">6.2.2. Comments</a></li>
</ul>
</li>
<li><a href="#org3f398b5">6.3. <span class="todo TODO">TODO</span> Lisp</a></li>
<li><a href="#org30cf093">6.4. <span class="todo TODO">TODO</span> Shell script</a></li>
<li><a href="#orgee3843a">6.5. <span class="todo TODO">TODO</span> Python</a></li>
<li><a href="#org3940d90">6.6. <span class="todo TODO">TODO</span> Ansible</a></li>
<li><a href="#org546907a">6.7. <span class="todo TODO">TODO</span> Javascript/TypeScript</a></li>
<li><a href="#orga2ebf3f">6.8. <span class="todo TODO">TODO</span> C/C++</a></li>
<li><a href="#org126f802">6.9. <span class="todo TODO">TODO</span> Swift</a></li>
<li><a href="#org28c2d4c">6.10. <span class="todo TODO">TODO</span> Kotlin</a></li>
<li><a href="#org06417f0">6.11. <span class="todo TODO">TODO</span> Java</a></li>
</ul>
</li>
<li><a href="#org35dbadc">7. Non-editor features</a>
<ul>
<li><a href="#orge6474b6">7.1. <span class="todo TODO">TODO</span> Requirements</a></li>
<li><a href="#orgd0a6fff">7.2. <span class="todo TODO">TODO</span> File management</a></li>
<li><a href="#org0a39331">7.3. <span class="todo TODO">TODO</span> Project management</a></li>
<li><a href="#orgc1958bf">7.4. <span class="todo TODO">TODO</span> Terminal</a></li>
<li><a href="#org9672e4e">7.5. <span class="todo TODO">TODO</span> Emails</a></li>
<li><a href="#orge8d5a23">7.6. <span class="todo TODO">TODO</span> Calendars</a></li>
<li><a href="#org580a97a">7.7. <span class="todo TODO">TODO</span> Contacts</a></li>
<li><a href="#org0d1a606">7.8. <span class="todo TODO">TODO</span> Time Management</a></li>
</ul>
</li>
<li><a href="#org24a11f6">8. Appendix</a>
<ul>
<li><a href="#org2da8ba0">8.1. The <code>init.el</code> file</a></li>
</ul>
</li>
</ul>
</div>
</nav>

<div id="outline-container-org5cfd538" class="outline-2">
<h2 id="org5cfd538"><span class="section-number-2">1</span> Prologue</h2>
<div class="outline-text-2" id="text-1">
<p>
Hello there! Thanks for checking my Emacs configuration. I decided to go with a literate configuration to try to contribute back to the community.
</p>

<p>
This configuration uses <a href="https://github.com/hlissner/doom-emacs">Doom Emacs</a> configuration framework (from now on, referred as Doom) as its base, so, my suggestion to you is to get familiarized with it <b>before</b> diving deep into this document (a good starting point is the <a href="https://github.com/hlissner/doom-emacs/blob/develop/docs/getting_started.org">Getting Started</a> page on the official repository), there will be options, functions, and variables I will use without much explanation, because they're some sort of <i>common knowledge</i> in the Doom's community.
</p>

<p>
Also, when you install Doom for the first time, it creates the <code>config.el</code> and <code>packages.el</code> files for you, containing some useful doc-strings there. In this version of my configuration, I will try to include as much of those comments as possible in the form of <i>free text</i>, so I want you to remember that I didn't come up with those words, some folks much smarter than me did, so feel free to <a href="https://liberapay.com/hlissner">thank</a> the Doom's <a href="https://paypal.me/henriklissner">creator</a>.
</p>

<p>
For instance, a Doom installation without a previous private configuration creates the file <code>$DOOMDIR/config.el</code> with the following comments:
</p>

<div class="note" id="orge4c63f2">
<p>
In your journey configuring Emacs the way you want, you might need to use more functions then I'm using in this configuration. Here are some additional functions or macros that could help you configure Doom:
</p>

<ul class="org-ul">
<li><code>load!</code> for loading external <code>*.el</code> files relative to <code>$DOOMDIR/config.el</code>;</li>
<li><code>use-package!</code> for configuring packages;</li>
<li><code>after!</code> for running code after a package has loaded;</li>
<li><code>add-load-path!</code> for adding directories to the <code>load-path</code>, relative to <code>$DOOMDIR/config.el</code>. Emacs searches the <code>load-path</code> when you load packages with <code>require</code> or <code>use-package</code>;</li>
<li><code>map!</code> for binding new keys;</li>
</ul>

<p>
To get information about any of these functions or macros, move the cursor over the highlighted symbol at press '<code>K</code>' (non-evil users must press '<code>C-c g k</code>'). This will open documentation for it, including demos on how to use them.
</p>

<p>
You can also try '<code>gd</code>' (or '<code>C-c g d</code>') to jump to their definition and see their source code.
</p>

</div>
</div>

<div id="outline-container-orgf949178" class="outline-3">
<h3 id="orgf949178"><span class="section-number-3">1.1</span> About this document</h3>
<div class="outline-text-3" id="text-1-1">
<p>
The organization of my Emacs configuration tries to structure the design and build of a text editor tailored for my needs.
</p>

<p>
Some of these needs are technology related (e.g. programming languages, diagrams tooling, etc.), while others are aesthetic or productivity related.
</p>

<p>
I want to stress out to you, that ultimately, you are reading a personal opinion, and what works for me may or may not work for you.
</p>

<p>
I intend to start with features I consider common to any text editor, then, I'll go into some personal preferences still related to text editor in general. Once I'm done with the common features, I'll configure Emacs for writing prose. I decided to do all my prose writing using <a href="https://orgmode.org/">Org Mode</a> and will focus the configuration, at that point, to adjust Emacs and Org to fit my personal workflow.
</p>

<p>
After configuring Emacs for writing prose, my next focus is programming (which is what I do for work). I will setup <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/">Emacs Lisp</a>, <a href="https://www.javascript.com/">Javascript</a>/<a href="https://www.typescriptlang.org/">Typescript</a>, <a href="https://kotlinlang.org/">Kotlin</a>, <a href="https://www.python.org/">Python</a>, <a href="https://www.shellscript.sh/">Shell Script</a>, <a href="https://developer.apple.com/swift/">Swift</a>, <a href="https://golang.org/">Go</a>, <a href="https://www.rust-lang.org/">Rust</a>, and <a href="http://www.open-std.org/JTC1/SC22/WG14/">C</a>/<a href="http://www.open-std.org/JTC1/SC22/WG21/">C++</a>. Most likely not in this order and some of them in more details then others, but at a minimum, I want Emacs to open files of those languages without errors or wrong syntax highlight.
</p>

<p>
Overall, my intention is to configure Doom and core Emacs to get consistent keybindings and behaviors, so that when you learn to use one part of my configuration, you will feel comfortable on the other parts.
</p>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
Before you move on to the next section I must give you a disclaimer:
</p>

<p>
Although I'm using Emacs for about six years, I can't consider myself an expert. Was not until the beginning of 2021 that I decided to learn lisp properly, so you may find some code snippets here that are not considered optimal.
</p>

<p>
Also, do not trust me blindly. I try my best to verify the information I write by reading documentation and some times reaching out to the subject-matter expert of a feature, but for your own good, you should get in the habit of reading the documentation and manuals by yourself, there will be nothing that will build your knowledge better then this.
</p>
</div>
</div>

<div id="outline-container-org24c4adc" class="outline-3">
<h3 id="org24c4adc"><span class="section-number-3">1.2</span> About literate configuration</h3>
<div class="outline-text-3" id="text-1-2">
<p>
A long time ago I discovered <a href="http://literateprogramming.com">Literate Programming</a> when I first read an Emacs configuration using Org Mode. It was the <a href="https://pages.sachachua.com/.emacs.d/Sacha.html">Emacs configuration</a> of <a href="https://sachachua.com/blog/about/">Sacha Chua</a>, and it was a fantastic reading. I tried couple times to do the same with past configurations without much success.
</p>

<p>
I believe the mentality shift happened when I finally decided to read the original paper about <a href="http://literateprogramming.com/knuthweb.pdf">Literate Programming</a> by <a href="https://www-cs-faculty.stanford.edu/~knuth/">Donald E. Knuth</a>, and just like that, I wanted to practice Literate Programming on about everything I do.
</p>

<p>
Since this document is about a text editor configuration, I have to highlight couple differences between Mr. Knuth's Literate Programming and my Literate Configuration.
</p>

<p>
The core difference, is the fact that each piece of code in this document may not be a self contained snippet (although I will try my best to do so). When I find appropriate, I will split big block of code into multiples blocks separated by text used to explain the rational behind the snippet in question. So, if you're following this document and copying some snippets, make sure you include the <i>close parenthesis</i> that these split sections contain.
</p>
</div>
</div>

<div id="outline-container-orgdb6616e" class="outline-3">
<h3 id="orgdb6616e"><span class="section-number-3">1.3</span> About Doom configuration style</h3>
<div class="outline-text-3" id="text-1-3">
<p>
One of the major hurdles for new comers, is to understand how Doom configure Emacs based on one's private configuration, specially for modules or packages which Doom supports.
</p>

<p>
This section describes four aspects of Doom that I felt important to understand before I was able to properly configure it.
</p>
</div>

<div id="outline-container-org9c3252f" class="outline-4">
<h4 id="org9c3252f"><span class="section-number-4">1.3.1</span> Doom has its own package manager</h4>
<div class="outline-text-4" id="text-1-3-1">
<p>
Doom does not use <code>package.el</code>, it has its own package manager system and even though, it uses <code>use-package</code> and <code>straight.el</code> packages, it uses them as support tools for the package manager to work. This means that if you copy and paste a configuration showing how to use them into your <code>config.el</code>, most likely you will get some sort of error. So, keep this in mind when you blindly copy a snippet to your <code>config.el</code>.
</p>
</div>
</div>

<div id="outline-container-orga6a9f87" class="outline-4">
<h4 id="orga6a9f87"><span class="section-number-4">1.3.2</span> Lazy load everything</h4>
<div class="outline-text-4" id="text-1-3-2">
<p>
You should get used to use the options <code>:defer</code>, <code>:hook</code>, <code>:after</code>, <code>:mode</code>, and <code>:commands</code> from <code>use-package</code> (check the <a href="https://github.com/jwiegley/use-package">package documentation</a> for more details) when configuring any package with it. Not doing so, may cause the package to get loaded during the Emacs initialization, potentially slowing the start of Emacs.
</p>
</div>
</div>

<div id="outline-container-org5bd6a6c" class="outline-4">
<h4 id="org5bd6a6c"><span class="section-number-4">1.3.3</span> Configuration evaluation order</h4>
<div class="outline-text-4" id="text-1-3-3">
<p>
There are four potential loading <i>spots</i> for each configuration you want do tweak, and you must always decide which one is the best option to apply your particular case:
</p>

<dl class="org-dl">
<dt>Directly on <code>config.el</code></dt><dd>This is the most direct point of configuration. As Emacs evaluates the line of your configuration, it applies such configuration immediately. This is a good spot to configure variables the documentation states that <i>"it needs to get configured before the package gets loaded"</i>. On Doom's world, any directory or file variable should go to directly into your <code>config.el</code>;</dd>
<dt>Inside the <code>:init</code> section of <code>use-package</code></dt><dd>Depending on how a package gets configured, this is equivalent to configuring something directly on the <code>config.el</code>, but not always. If a package configuration uses the <code>:after</code> section from <code>use-package</code>, Emacs evaluate the code inside <code>:init</code> only <b>after</b> the resource stated on the option loads;</dd>
<dt>Inside the <code>:config</code> section of <code>use-package</code></dt><dd>This always execute after the given package gets loaded. You need to consider other instances of the call to <code>use-package</code> on the same package. The order in which they evaluate dictates who will overwrite a variable last;</dd>
<dt>Inside an <code>after!</code> or <code>with-eval-after-load</code> macro</dt><dd>Code here executes after the defined resource gets loaded, but also after all instances of <code>use-package</code> finish to run code from their <code>:config</code> section;</dd>
</dl>

<p>
If you have any question about where you should add your configuration, I suggest to follow the following rule of thumb:
</p>

<ul class="org-ul">
<li>If a package requires you to configure a variable before Emacs loads such package, set the variable directly on the <code>config.el</code>;</li>
<li>If you're configuring a package that Doom installs as part of a module, and it does not requires you to define the configuration before Emacs loads the package, use the <code>after!</code> macro;</li>
<li>If you're adding a new package to your configuration, configure it using the <code>use-package</code> macro. To know if you should use <code>use-package</code> just check if you had to add the package to your <code>packages.el</code> file. If you did, then use <code>use-package</code>.</li>
</ul>

<p>
For instance:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 1: </span>Standard configuration of a package on Doom</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-directory <span class="org-string">"~/org"</span>)

(<span class="org-keyword">after!</span> org
  (<span class="org-keyword">setq</span> org-startup-indented nil))
</pre>
</div>
</div>
</div>

<div id="outline-container-org06f156e" class="outline-4">
<h4 id="org06f156e"><span class="section-number-4">1.3.4</span> Use the <code>map!</code> macro to bind keys</h4>
<div class="outline-text-4" id="text-1-3-4">
<p>
Eventually, you will realize that <code>use-package</code> has a nice <code>:bind</code> option to it, and you may think that your configuration would be so much cleaner if you could have everything under a <code>use-package</code> call (been there, done that). Unfortunately, this is not a good idea, unless you're aware of all possible gotchas related to <code>leader</code> and <code>localleader</code>.
</p>

<p>
My recommendation to you is to always configure your keybindings using the <code>map!</code> macro. Check its documentation for more details (on Emacs press <code>SPC h f map! RET</code>).
</p>
</div>
</div>
</div>

<div id="outline-container-orgb8a4b69" class="outline-3">
<h3 id="orgb8a4b69"><span class="section-number-3">1.4</span> Investigating issues</h3>
<div class="outline-text-3" id="text-1-4">
<p>
If you, like me, try new things with your config until it breaks, is important that we have some tools to help us figure out what is going on. Regardless if you'll use this configuration <i>ipsis litteris</i>, or start yours from scratch, and copy the tidbits that may interest you. Before you start know these things:
</p>

<p>
To get a better sense of what is going on, start Emacs from terminal with the <code>--debug-init</code> flag:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 2: </span>Command to start emacs in debug mode</label><pre class="src src-shell">emacs --debug-init
</pre>
</div>

<p>
This will stop Emacs on the first error and print the stack trace for it. As of now, this might not useful beyond reporting bugs, nevertheless, it's important you keep it in your mind!
</p>

<p>
Another issue that may show up, is slowness, specially after adding packages. This is not uncommon since Emacs startup time is sensible to package loading.
</p>

<p>
What I recommend to do, is to install a package called <a href="https://github.com/kekeimiku/benchmark-init-el"><code>benchmark-init-el</code></a> that specializes on benchmarking (notice that I'm not using the <a href="https://github.com/dholm/benchmark-init-el">official repository</a> for <code>benchmark-init-el</code>, but a fork that fixed a bug when using it with Emacs 28+), and use it, when you have the need:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 3: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> benchmark-init
  <span class="org-builtin">:recipe</span> (<span class="org-builtin">:host</span> github
           <span class="org-builtin">:repo</span> <span class="org-string">"kekeimiku/benchmark-init-el"</span>))
</pre>
</div>

<p>
Check my <code>init.el</code> file on the <a href="#org24a11f6">Appendix</a>, to see how I hook up benchmarking to the <code>--debug-init</code> flag.
</p>

<p>
After starting Emacs with the <code>--debug-init</code> flag, you can check the call tree with the <code>M-x benchmark-init/show-durations-tree</code> command.
</p>
</div>
</div>

<div id="outline-container-org716b7f6" class="outline-3">
<h3 id="org716b7f6"><span class="section-number-3">1.5</span> Acknowledgments</h3>
<div class="outline-text-3" id="text-1-5">
<p>
Besides the already mentioned <a href="https://sachachua.com/blog/about/">Sacha Chua</a>, I would also like to thank Timothy (a.k.a. <a href="https://github.com/tecosaur">tecosaur</a>) for his wonderful literate config. I would be lying if I said <a href="https://www.gitmemory.com/tecosaur">tecosaur</a> was not one of the big reasons for me to give it a second try on my literate config, so thank you mate! Feel free to say that this configuration is a byproduct of yours.
</p>

<p>
I would also like to thank <a href="https://github.com/gongzhitaao">Zhitao Gong</a> for the amazing theme I'm using in this publication, it's called <a href="https://github.com/gongzhitaao/orgcss">OrgCSS</a> and you should definitely check it out. If you try <a href="https://github.com/gongzhitaao">Zhitao Gong</a>'s theme and it does not look like this, you can use my extra modification by adding the following on your Org preamble:
</p>

<div class="org-src-container">
<pre class="src src-org"><span class="org-org-meta-line">#+setupfile: <a href="https://raw.githubusercontent.com/Townk/doom-emacs-private/master/.github/support/org/html-export.setup">https://raw.githubusercontent.com/Townk/doom-emacs-private/master/.github/support/org/html-export.setup</a></span>
</pre>
</div>

<p>
Last, but not least, I like to give a shout to <a href="https://github.com/justinbondoc">Justin Bondoc</a> for his CSS tutorial on "<a href="https://www.madcapsoftware.com/blog/css-tip-creating-styled-boxes-notes-warnings-examples-tips/">Creating Styled Boxes for Notes, Warnings, Examples, and Tips</a>". You will notice that I not only got his CSS here, but also his icons for the note and warning boxes!
</p>

<p>
By the way, if you are reading this document online, there is a chance you might feel a familiarity with the typography used here. This is due to the fact I'm using the same font used by <a href="https://github.com/mickeynp">Mickey Petersen</a> on his amazing <a href="https://www.masteringemacs.org/">Mastering Emacs</a> site. So if you think this is a nice typography for reading online, again, I can't take credit for that either, check Mickey's site and maybe purchase a copy of his <a href="https://www.masteringemacs.org/order">book</a>.
</p>
</div>
</div>
</div>

<div id="outline-container-org438cd7a" class="outline-2">
<h2 id="org438cd7a"><span class="section-number-2">2</span> Standard features</h2>
<div class="outline-text-2" id="text-2">
<p>
Before jumping in the configuration itself, I like to describe what I'm trying to achieve on each section, so the reader don't feel lost. Also, by defining good requirements, this document may help someone else to achieve similar results with different editors. If you are among the crazies that besides liking my choices, decided to port this to other editor, drop me a line, and I'll be more than happy to link your document here.
</p>
</div>

<div id="outline-container-orgc6fda1f" class="outline-3">
<h3 id="orgc6fda1f"><span class="section-number-3">2.1</span> Requirements</h3>
<div class="outline-text-3" id="text-2-1">
<p>
This part of the document will deal with configurations and functionalities that I consider as essential on any text editor, from IDEs to editors like <a href="https://en.wikipedia.org/wiki/Microsoft_Notepad">Notepad</a>, even though they're not present in all of them.
</p>
</div>

<div id="outline-container-orgaa591b4" class="outline-4">
<h4 id="orgaa591b4"><span class="section-number-4">2.1.1</span> Modal editing</h4>
<div class="outline-text-4" id="text-2-1-1">
<p>
I need to come clean to the reader about my past experiences with text editors. I'm a <i>die-hard</i> Vim user, even though I'm not using Vim for some tim now. Nevertheless, I personally believe that modal editing is far superior way to use a text editor than any other alternative, and that is why I consider <i>modal editing</i>, a feature that any text editor should have.
</p>
</div>
</div>

<div id="outline-container-org8a89c90" class="outline-4">
<h4 id="org8a89c90"><span class="section-number-4">2.1.2</span> Text Snippets</h4>
<div class="outline-text-4" id="text-2-1-2">
<p>
Although I'm not an avid user of snippets, I believe they're a fundamental part of modern editors. Without them, I have to resort to some book keeping method to save interesting coding snippets. So, I consider snippets a base requirement for my editor.
</p>
</div>
</div>

<div id="outline-container-orga00f3c2" class="outline-4">
<h4 id="orga00f3c2"><span class="section-number-4">2.1.3</span> Inline completion</h4>
<div class="outline-text-4" id="text-2-1-3">
<p>
Also know as <i>intellisence</i>, or <i>code complete</i> in other editors and IDEs, <i>at-point completion</i> are those popups that show up when you type, with possible completions for what you're doing. My editor should also offer such feature, but it must play well with modal editing (if I leave the <i>Insert Mode</i> the popup should close), and snippets (snippet expansion keywords have precedence over skipping to the next line with the <code>&lt;TAB&gt;</code> key).
</p>
</div>
</div>

<div id="outline-container-org99b2e4b" class="outline-4">
<h4 id="org99b2e4b"><span class="section-number-4">2.1.4</span> Automatic indentation</h4>
<div class="outline-text-4" id="text-2-1-4">
<p>
Here I'm not talking about indent after pressing '<code>RET</code>'. I'm talking about re-indenting the file as I change it. On the Emacs world, this is also known as <i>electric indent</i>.
</p>

<p>
I understand that in some occasions this process may slow down the editor, so I will define here that I want the whole indentation to change when I change the total number of lines on the file.
</p>
</div>
</div>

<div id="outline-container-orgd510d0f" class="outline-4">
<h4 id="orgd510d0f"><span class="section-number-4">2.1.5</span> Smart backspace</h4>
<div class="outline-text-4" id="text-2-1-5">
<p>
When I'm editing a file (usually a source code), in some scenarios, the editor helps me out by inserting text that I want. One example of this is the closing pair character. If I type a ' <code>"</code> ', Doom will add a second one after my cursor. In most of the scenarios, to revert what just happened, I press <code>&lt;BACKSPACE&gt;</code>, and I get the same state I was before pressing the key that generated the completion.
</p>

<p>
But there is one case where this does not happen, which is when Doom adds a paired new line when I press <code>&lt;ENTER&gt;</code> after open a pair. The net effect of this completion, is to have the cursor on the next line, indented correctly. But when I immediately press <code>&lt;BACKSPACE&gt;</code>, Doom deletes the indentation and that's it.
</p>

<p>
This requirement, is to make sure the <code>&lt;BACKSPACE&gt;</code> key behaves in the same way when we use it after a completion.
</p>
</div>
</div>

<div id="outline-container-org7cddafe" class="outline-4">
<h4 id="org7cddafe"><span class="section-number-4">2.1.6</span> Balanced pairs</h4>
<div class="outline-text-4" id="text-2-1-6">
<p>
The common behavior you might see on text editors is to complete a character pair as you type. For instance, if you type an open parenthesis, the editor would insert the closing one automatically, and if you press the closing parenthesis, the editor would simply move the cursor to the right of the already inserted close parenthesis character.
</p>

<p>
My requirement is to my editor to keep any of these character pairs balanced. If I try to delete a line with a closing pair character that would make the pairs of such character unbalanced, the editor would delete the line content, but would leave the closing character for the pair, preventing the file from getting on an unbalanced state.
</p>
</div>
</div>

<div id="outline-container-orgf9d98f8" class="outline-4">
<h4 id="orgf9d98f8"><span class="section-number-4">2.1.7</span> Rich keybindings</h4>
<div class="outline-text-4" id="text-2-1-7">
<p>
Any half-decent text editor these days supports an infinite plethora of shortcuts. What I believe an editor should support to be ahead of the game, is the ability to bind <b>any</b> editor action to a key, and to offer to the user some sort of guidance while one uses the editor.
</p>

<p>
For instance, if you configure your editor to search for files when you press '<code>SPC f f</code>', when you press '<code>SPC f</code>' and wait, I want the editor to display all the possible options for you to complete your key sequence.
</p>
</div>
</div>

<div id="outline-container-org444c1ad" class="outline-4">
<h4 id="org444c1ad"><span class="section-number-4">2.1.8</span> Useful line numbers</h4>
<div class="outline-text-4" id="text-2-1-8">
<p>
I like the text editor to show me line numbers when they mater, and when they do, I like to get the most of them. This requirement is to make sure that line numbers are aware of the modal editing, so when I'm on <i>normal mode</i> with line numbers visible, the editor should show me lines as relative numbers, and when I'm editing the file (in <i>insert mode</i>), the line numbers should be absolute.
</p>
</div>
</div>

<div id="outline-container-org3b00218" class="outline-4">
<h4 id="org3b00218"><span class="section-number-4">2.1.9</span> Auto-saving</h4>
<div class="outline-text-4" id="text-2-1-9">
<p>
I want to stop saving my files. Any editor has substantial number of undo actions, and Doom even allow me to save the undo history across sessions. Because of that, I want my editor to save files I'm editing from time to time and on special events like switching to a different app, or a different buffer.
</p>
</div>
</div>

<div id="outline-container-org2c4297b" class="outline-4">
<h4 id="org2c4297b"><span class="section-number-4">2.1.10</span> Persist frame position and geometry</h4>
<div class="outline-text-4" id="text-2-1-10">
<p>
I move my editor all around my desktop, and I resize it just as much, do I'm not particular to any specific size or position it should be, but if I turn it off, the next time I decide to open it, I expect it to be in the same place, and with the same size I defined on the last time I've open it.
</p>
</div>
</div>

<div id="outline-container-org120bdb7" class="outline-4">
<h4 id="org120bdb7"><span class="section-number-4">2.1.11</span> Remote editing</h4>
<div class="outline-text-4" id="text-2-1-11">
<p>
I want my text editor to edit remote files seamlessly, and by remote, I mean not in the same Operating System where the editor is running. This also include containers like Docker.
</p>

<p>
I also want my text editor to allow me to start this remote editing by picking a server and a remote path, so it can create a remote <i>project</i> for me to explore.
</p>
</div>
</div>
</div>

<div id="outline-container-org7a37f28" class="outline-3">
<h3 id="org7a37f28"><span class="section-number-3">2.2</span> Emacs-only configurations</h3>
<div class="outline-text-3" id="text-2-2">
<p>
This section will cover some changes I like to do on the Emacs (or Doom) default behavior, and some required settings to make sure Emacs have all the information it needs to function properly.
</p>
</div>

<div id="outline-container-orge9ccaa5" class="outline-4">
<h4 id="orge9ccaa5"><span class="section-number-4">2.2.1</span> Identity</h4>
<div class="outline-text-4" id="text-2-2-1">
<p>
It's important we let Emacs know who we are, and also, according to Doom's comments on the sample <code>config.el</code> available upon installation, some functionality uses this identification (e.g. GPG configuration, email clients, file templates and snippets).
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 4: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> user-full-name <span class="org-string">"Thiago Alves"</span>
      user-mail-address <span class="org-string">"thiago@rapinialves.com"</span>)
</pre>
</div>

<p>
I also like to have a variable holding the value of my email's host name:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 5: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">user-domain</span> (cadr (split-string user-mail-address <span class="org-string">"@"</span>))
  <span class="org-doc">"Holds the user's personal domain. By default, this variable is</span>
<span class="org-doc">  the `</span><span class="org-doc"><span class="org-constant">user-email-address</span></span><span class="org-doc">' host."</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd510e4d" class="outline-4">
<h4 id="orgd510e4d"><span class="section-number-4">2.2.2</span> Dashboard</h4>
<div class="outline-text-4" id="text-2-2-2">
<p>
Doom Emacs offers a lightweight dashboard, that serves as the landing page for Emacs.
</p>

<p>
I really like the idea of a dashboard and I like even more what Doom offers, but, the ASCII art for its logo is not something I'm affectionate with.
</p>

<p>
In order to replace the ASCII art with something more pleasant and thematic, I like to add a small picture on the dashboard:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 6: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> +doom-dashboard-banner-dir (expand-file-name <span class="org-string">"assets"</span> doom-private-dir)
      +doom-dashboard-banner-file <span class="org-string">"doom.png"</span>
      +doom-dashboard-banner-padding '(0 . 4))
</pre>
</div>

<p>
I love the style of this image so much, that it is, besides my dashboard image, my Emacs icon as well. The author of this beauty is <a href="https://github.com/eccentric-j/doom-icon">Jay Zawrotny</a>, feel free to send him an accolade!
</p>

<div class="org-center">

<figure id="orgdd42a29">
<img src="./assets/doom.png" alt="doom.png">

<figcaption><span class="figure-number">Figure 1: </span>My favorite contender for a Doom Emacs logo</figcaption>
</figure>
</div>
</div>
</div>

<div id="outline-container-orgfa72edd" class="outline-4">
<h4 id="orgfa72edd"><span class="section-number-4">2.2.3</span> Key modifiers</h4>
<div class="outline-text-4" id="text-2-2-3">
<p>
Since I use a Mac as my primary computer, I need to adjust its control keys to match a good set of control keys on Emacs:
</p>

<table id="org9fbe3cf">
<caption class="t-bottom"><span class="table-number">Table 1:</span> macOS key mappings</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">macOS Key</th>
<th scope="col" class="org-left">Emacs Key</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">⌘ (<code>cmd</code>)</td>
<td class="org-left"><code>'super</code></td>
</tr>

<tr>
<td class="org-left">⌃ (<code>ctrl</code>)</td>
<td class="org-left"><code>'control</code></td>
</tr>

<tr>
<td class="org-left">⌥ (<code>option</code>)</td>
<td class="org-left"><code>'meta</code></td>
</tr>
</tbody>
</table>

<p>
Emacs expose three variables to allow you to make these adjustments:
</p>

<ul class="org-ul">
<li><code>mac-command-modifier</code></li>
<li><code>mac-control-modifier</code></li>
<li><code>mac-option-modifier</code></li>
</ul>

<p>
To adjust this values according to table <a href="#org9fbe3cf">1</a>, set each one of them to the symbol described on the column <code>Emacs Key</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 7: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> mac-command-modifier 'super
      mac-control-modifier 'control
      mac-option-modifier  'meta)
</pre>
</div>
</div>
</div>

<div id="outline-container-org535b2f2" class="outline-4">
<h4 id="org535b2f2"><span class="section-number-4">2.2.4</span> Training wheels</h4>
<div class="outline-text-4" id="text-2-2-4">
<p>
By default, Emacs prevent you from executing certain <i>dangerous</i> commands inadvertently. While I understand and sympathize with the need of such feature, I personally prefer to turn it off.
</p>

<p>
To change this option, set the variable <code>disabled-command-function</code> to <code>nil</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 8: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> disabled-command-function nil)
</pre>
</div>

<p>
On Emacs, you can set variables when open files, we call those <a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Specifying-File-Variables.html">File Variables</a>. There are occasions I want to execute some arbitrary code when I open a file. To do that, I would add a file variable called <code>eval</code>, and pass my arbitrary code to it. As you can imagine, this is a dangerous features, so I have to give you the standard disclaimer:
</p>

<div class="warning" id="org31cd2ef">
<p>
The next configuration can lead to Emacs executing malicious code upon opening a file. By allowing Emacs to enable local <code>eval</code> you gain some nice ways to configure Emacs per file, on the cost of a high risk of vulnerability, so&#x2026; think a little bit about how do you indiscriminately open files on your editor before enabling this one.
</p>

</div>

<p>
To enable Emacs to use <code>eval</code> as a file variable, set the variable <code>enable-local-eval</code> to a non-<code>nil</code> value:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 9: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> enable-local-eval t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd20bd13" class="outline-4">
<h4 id="orgd20bd13"><span class="section-number-4">2.2.5</span> Emacs source code</h4>
<div class="outline-text-4" id="text-2-2-5">
<p>
Emacs documentation system is fantastic! It allows you to inspect any value, binding or function on the fly, and it displays the source code for of any callable together with its documentation.
</p>

<p>
For some of the Emacs functions, such source code is a <i>C</i> function from its core code, and by default, Emacs does not knows where to look for its own source code.
</p>

<p>
To help Emacs to find its own source code, first clone it from the Emacs <a href="https://git.savannah.gnu.org/git/emacs.git">repository</a>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 10: </span>Commands to clone Emacs to local directory</label><pre class="src src-shell">mkdir -p ~/workplace/vendor/gnu
<span class="org-builtin">cd</span> ~/workplace/vendor/gnu
git clone https://git.savannah.gnu.org/git/emacs.git
</pre>
</div>

<p>
Then, set the variable <code>source-directory</code> to the cloned repository's path:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 11: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> source-directory (concat (getenv <span class="org-string">"HOME"</span>) <span class="org-string">"/workplace/vendor/gnu/emacs"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org6c78b57" class="outline-4">
<h4 id="org6c78b57"><span class="section-number-4">2.2.6</span> Line numbers</h4>
<div class="outline-text-4" id="text-2-2-6">
<p>
I like to have line numbers displayed on the side of any source code I edit, but I don't like them everywhere (e.g. during prose writing), so I always make them turned off by default, and let the appropriate modes to set them on when they needed it:
</p>

<p>
To disable line numbers by default, set the variable <code>display-line-numbers-type</code> to <code>nil</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 12: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq-default</span> display-line-numbers-type nil)
</pre>
</div>

<p>
Notice I used the function <code>setq-default</code> here. It tells Emacs that if a buffer uses a local version of it, it always starts with the given value.
</p>

<p>
When Emacs is showing line numbers, it do so on the window's left <i>gutter</i>. To save some screen space, Emacs only reserves only the necessary space on its gutter, to display the biggest visible line number. I believe this behavior disrupts the user experience when I scroll from line 99 to 100 and back. The visual effect is the editor screen moving right and left as I scroll.
</p>

<p>
It would be incredible inefficient to read the entire file just to check what is the biggest line number, so we can instruct Emacs do the second best thing: to only grow the gutter's size, and never shrink it.
</p>

<p>
To have such configuration, set the variable <code>display-line-numbers-grow-only</code> to a non-<code>nil</code> value:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 13: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq-default</span> display-line-numbers-grow-only t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org8ea56b4" class="outline-4">
<h4 id="org8ea56b4"><span class="section-number-4">2.2.7</span> Indentation</h4>
<div class="outline-text-4" id="text-2-2-7">
<p>
On this section, I will ask the reader to disagree on disagree, and set aside the almost religious subject of tabs versus spaces.
</p>

<p>
I prefer to always indent my files with <code>4</code> spaces with some rare exceptions for certain languages. To make Emacs use <code>4</code> spaces to indent by default, set the variable <code>tab-width</code> to <code>4</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 14: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq-default</span> tab-width 4)
</pre>
</div>

<p>
And to force emacs to always use spaces instead of tabs, set the <code>indent-tabs-mode</code> variable to <code>nil</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 15: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq-default</span> indent-tabs-mode nil)
</pre>
</div>
</div>
</div>

<div id="outline-container-org0924d31" class="outline-4">
<h4 id="org0924d31"><span class="section-number-4">2.2.8</span> Line wrapping</h4>
<div class="outline-text-4" id="text-2-2-8">
<p>
Until the writing of this document, I had the opinion that <i>soft wrap</i> was evil, and it had no place on any editor. Since then, I learned to appreciate <i>soft wrap</i> for prose, and later in this document, you will see all the other setup around <i>soft wrap</i> and have an idea why I was so against it.
</p>

<p>
To prevent Emacs from wrapping your text as it goes over the size of thee screen, set the variable <code>truncate-lines</code> to a non-<code>nil</code> value:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 16: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq-default</span> truncate-lines t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc491a3e" class="outline-4">
<h4 id="orgc491a3e"><span class="section-number-4">2.2.9</span> Scrolling</h4>
<div class="outline-text-4" id="text-2-2-9">
<p>
One of my biggest gripes over Emacs is how it handles scrolling. Besides the slowness, the entire behavior is just bonkers. For me, the logical way to deal with scrolling, is to move the screen only when we move the cursor outside of it, and the editor should only move the screen by the value of current line number minus bottom line when user is going <i>down</i> the text.
</p>

<p>
To make Emacs not jump then necessary when cursor goes outside the screen, set the <code>scroll-conservatively</code> to a big number (bigger then the number of lines your display can show):
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 17: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> scroll-margin 3
      scroll-conservatively most-positive-fixnum
      scroll-up-aggressively 0.001
      scroll-down-aggressively 0.001)
</pre>
</div>

<p>
By default, Emacs will move the cursor with the text as you scroll, but only until the edge of the screen. When the cursor reaches the edge, it will stay there as you keep scrolling. This behavior presents an anti-pattern for usability. When I decide to scroll my buffer with the mouse wheel, I'm generally looking at the screen, around the area where the cursor is. If the cursor moves up or down from its position, my eyes lose track of it, and I will assume, it stayed with its original position as I scroll. If I decide to get back writing, my expectation is to just start typing, because the cursor should be on its previous position, but if I do this, I will start typing on the wrong part of the text.
</p>

<p>
After some lookup, I believe Emacs does not support such feature yet, so I decided to go with the best alternative for usability, which is to not move the cursor from its screen position at all. This way, my eyes will keep track of its position as I scroll, and I won't have any surprises as I type.
</p>

<p>
To prevent Emacs from moving the cursor up to the edge of the screen, set the variable <code>scroll-preserve-screen-position</code> to a non-<code>nil</code> value, and if you want this behavior to be the same for horizontal and vertical scroll, set it to a non-<code>nil</code> and non-<code>t</code> value:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 18: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> scroll-preserve-screen-position 'always)
</pre>
</div>

<p>
To fine tune my scroll, I like to have a bit of room between my cursor and the edge of the screen when I navigate the buffer using the keyboard.
</p>

<p>
To add a margin on your cursor as it gets on the edge of the screen, set the variable <code>scroll-margin</code> to the number of lines you want to always keep visible:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 19: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> scroll-margin 2)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdf1427a" class="outline-4">
<h4 id="orgdf1427a"><span class="section-number-4">2.2.10</span> Repeatable commands</h4>
<div class="outline-text-4" id="text-2-2-10">
<p>
There is a new feature available since Emacs 28 that allow you to define a <i>repeatable map</i> for actions that take more than one key stroke to perform, and you want to repeat them with only the last keystroke in sequence.
</p>

<p>
For instance, on Doom, to increase the value of number, you need to use the key binding <code>g +</code>. If you want to increase the same number multiple times, you would have to type the same sequence multiple times (ignore the repeat command associated with the <code>.</code> key for didactic reasons).
</p>

<p>
I want to press <code>g +</code>, and then multiple key strokes of <code>+</code> to increase the number multiple times, and the <code>repeat-mode</code> is the new feature that allows me to do that.
</p>

<p>
In order to use it, you have to define a keymap for the <i>repeatable keys</i>, and associate that keymap to the command that will start the repeat. This is an example on how to accomplish that:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 20: </span><code>repeat-mode</code> example for increment or rotate function</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">my-inc-or-rotate-repeat-map</span>
  (<span class="org-keyword">let</span> ((map (make-sparse-keymap)))
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Standard keys:</span>
    (define-key map <span class="org-string">"="</span> 'my-inc-or-rotate-at-point)
    (define-key map <span class="org-string">"-"</span> 'my-dec-or-rotate-at-point)
    map)
  <span class="org-doc">"Keymap to repeat window resizing commands.  Used in `</span><span class="org-doc"><span class="org-constant">repeat-mode</span></span><span class="org-doc">'."</span>)

(put 'my-inc-or-rotate-at-point 'repeat-map 'my-inc-or-rotate-repeat-map)
(put 'my-dec-or-rotate-at-point 'repeat-map 'my-inc-or-rotate-repeat-map)
</pre>
</div>

<p>
This is not bad, but with Lisp we can do better than that! The next macro helps with this process:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 21: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defmacro</span> <span class="org-function-name">my-repeat-map!</span> (map-name keys-alist <span class="org-type">&amp;optional</span> docstring)
  <span class="org-doc">"A helper macro to create keymaps for repeatable actions.</span>

<span class="org-doc">MAP-NAME is the variable name for the sparse keymap created, and KEYS-ALIST, is</span>
<span class="org-doc">an association list of functions to keys, where each function is called after</span>
<span class="org-doc">the associated key is pressed after the repeatable action is triggered."</span>
  `(<span class="org-keyword">defvar</span> ,map-name
     (<span class="org-keyword">let</span> ((map (make-sparse-keymap)))
       (<span class="org-keyword">dolist</span> (cmd ,keys-alist)
         (define-key map (cdr cmd) (car cmd))
         (put (car cmd) 'repeat-map ',map-name))
       map)
     ,docstring))
</pre>
</div>

<p>
You can find the previous example using the new macro on section <a href="#orgf5fe906">3.1.2</a>.
</p>

<p>
In order to be able to use <code>repeat-mode</code> everywhere, I will turn it on after Emacs initializes:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 22: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(add-hook 'after-init-hook 'repeat-mode)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6d2e172" class="outline-3">
<h3 id="org6d2e172"><span class="section-number-3">2.3</span> Modal editing</h3>
<div class="outline-text-3" id="text-2-3">
<p>
As I mentioned on section <a href="#orgaa591b4">2.1.1</a>, I do consider <i>Modal Editing</i> far superior then other methods. The main reason is the separation of states while editing a text. At some level, we all do modal editing, but the keybindings style popularized by Vim goes a step forward and <i>formalize</i> these states.
</p>

<p>
I decided to use Doom as the base of my configuration because it has good reasonable defaults, and its author is also an ex-<i>Vimer</i> like me, so he tailored this distribution with a Vim user in mind.
</p>

<p>
On Emacs, the package responsible to provide Vim inside Emacs is <a href="https://github.com/emacs-evil/evil">Evil</a>, and from all Vim plugins for other editors that I use, Evil is by far the best. So much that compare it with other Vim plugins is do injustice to Evil developers. More often than not, we call Evil the Vim inside Emacs.
</p>

<p>
In this section, I will go through configurations and other packages related directly to Evil, so if you don't use Evil or modal editing, feel free to skip this one.
</p>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
If you're new to Vim, when you learn about the modes, on of the first <i>it's weird</i> feelings you'll have is when you are in <i>Normal Mode</i>, then, you decide to go into <i>Insert Mode</i> by pressing <code>i</code>, but right after that, you change your mind and press <code>&lt;ESC&gt;</code>&#x2026; What just happened? you didn't act on anything, you didn't press any movement key, still, the cursor moved one character to the left!
</p>

<p>
Well, I have to tell you that this behavior is not a bug, is just how we should expect the change of modes to be.
</p>

<p>
I said <i>should</i>, because I disliked this behavior since I first used Vim. I never understood the rationale behind it and I always tried to fix it in my configurations. The good news is, Evil developers added an option to do just that.
</p>

<p>
To fix the moving back the cursor annoyance, set the variable <code>evil-move-cursor-back</code> to <code>nil</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 23: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> evil-move-cursor-back nil)
</pre>
</div>

<p>
After this configuration, one might realize that going to <i>Insert Mode</i> using <code>a</code> and pressing <code>&lt;ESC&gt;</code> has the opposite effect of moving the cursor to the right. In this case, at least for me, this is an acceptable behavior since the user explicitly requested to go to <i>Insert Mode</i> <b>after</b> the current character, is reasonable the editor to move your cursor to the next position.
</p>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
On the same lines of <i>moving back the cursor</i>, there is another <i>expected</i> behavior of Vim that I don't get it, the infamous <i>overwriting your clipboard with the contents of a selection that you just paste on top of it</i> (I couldn't find a better way to refer to this behavior).
</p>

<p>
I'm sure that, at some point, this behavior made sense for a lot of developers, but in my personal opinion, if you are pasting the clipboard on top of a selected text, is highly unlikely that you want to use the contents of such selection right after pasting something on top of it. I believe the natural behavior of developers these days, is to consider the selected text you just paste on top of it, as gone.
</p>

<p>
And just like with the previous annoyance, Evil also offers an option to change this behavior. If you want to <b>not</b> copy the content of a selection you just paste something on top of it, set the variable <code>evil-kill-on-visual-paste</code> to <code>nil</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 24: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> evil-kill-on-visual-paste nil)
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
Because Evil tries to stay faithful to Vim, it does not force Emacs objects into Vim's lingo. One of these examples is the visual selection. Emacs has something called <i>regions</i> that serves, also, to the purpose of selecting text, but in reality, the Vim's visual selection and Emacs' regions, are not the same thing.
</p>

<p>
However, Evil is an Emacs package, and it also tries to integrate with existent packages and features, and it offers a configuration that makes Evil visual selection, to expand the Emacs selection region when we select something. The net effect of this, is that we can use the terms selection and region interchangeability for all practical purposes.
</p>

<p>
If you want Evil to synchronize its visual selection with the Emacs region, set the variable <code>evil-visual-region-expanded</code> to a non-<code>nil</code> value:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 25: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> evil-visual-region-expanded t)
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
Evil defines the priority of its highlight in a way that Emacs displays the visual selection overlays bellow search highlights. As of today I can't figure out why this is the case. One workflow pretty common is to search the name of a variable, select its prefix, and search for the rest of the variable. With the default configuration, you can't see what you're selecting until your selections is bigger than the search term.
</p>

<p>
Unfortunately, Evil hard-code the <a href="https://github.com/emacs-evil/evil/blob/master/evil-states.el#L624">visual</a> <a href="https://github.com/emacs-evil/evil/blob/master/evil-states.el#L731">priority</a> value to 99 for visual selection, which is smaller then the other hard-coded values for the <a href="https://github.com/emacs-evil/evil/blob/master/evil-search.el#L666">search</a> <a href="https://github.com/emacs-evil/evil/blob/master/evil-search.el#L868">highlight</a> overlays, and this was already reported to Evil on issue <a href="https://github.com/emacs-evil/evil/issues/1089">#1089</a> on GitHub.
</p>

<p>
To fix this, we have to advise <code>evil-visual-highlight</code> and <code>evil-visual-highlight-block</code> to bump the overlay priority after these functions execute:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 26: </span>autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-evil-visual-highlight-a (<span class="org-type">&amp;rest</span> _)
  <span class="org-doc">"Make the visual overlay have higher priority than the search highlight."</span>
  <span class="org-builtin">:after</span> '(evil-visual-highlight evil-visual-highlight-block)
  (<span class="org-keyword">when</span> evil-visual-overlay
    (overlay-put evil-visual-overlay 'priority 1010))
  (<span class="org-keyword">when</span> evil-visual-block-overlays
    (<span class="org-keyword">dolist</span> (overlay evil-visual-block-overlays)
        (overlay-put overlay 'priority 1010))))
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
Vim (therefore also Evil) has this notion of a grammar to execute actions on text:
</p>

<div class="org-src-container">
<pre class="src src-text">{operation}{operator}{target object}
</pre>
</div>

<p>
Where <i>operation</i> is the command you're executing, operator can be <i>i</i> (inside) or <i>a</i> (also), and the <i>target object</i> can be any of the targets defined Evil (e.g. <i>s</i> for <i>sentence</i>, <i>p</i> for <i>paragraph</i>, <i>[</i> for <i>square brackets content</i>, etc. ).
</p>

<p>
One of these target object is <i>w</i> for <i>word</i> and in my experience, the meaning of <i>"word"</i> varies according to context. Let me explain&#x2026;
</p>

<p>
If you're editing a text file for blog, the meaning of <i>"word"</i> is most likely the same meaning of the English dictionary, but if you're editing a <i>Lisp</i> code, a word probably include more characters then the conventional <i>"word"</i> (e.g. while <i>"foo"</i> is a word in any context, <i>"foo-bar"</i> is a word, probably only when you're editing a Lisp file).
</p>

<p>
A quick trick to make Evil understand the meaning of <i>"word"</i> as I just described, is to create an alias for the function <code>forward-evil-symbol</code>, and name it <code>forward-evil-word</code>. This way, we override the normal function to act as if it is the <code>forward-evil-symbol</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 27: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defalias</span> #'forward-evil-word #'forward-evil-symbol)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd871dbc" class="outline-3">
<h3 id="orgd871dbc"><span class="section-number-3">2.4</span> Text snippets</h3>
<div class="outline-text-3" id="text-2-4">
<p>
Snippets (also known as Live Templates on certain platforms), are tidbits of text that one can include on the editing text by typing a keyword and pressing a shortcut key (usually <code>TAB</code>) with the cursor right after the keyword.
</p>

<p>
Doom Emacs offers basic configuration for the package <i><a href="https://github.com/joaotavora/yasnippet">Yasnippet</a></i>, which is the most used snippet system on Emacs.
</p>

<p>
Most snippet frameworks available across editors (including <i>Yasnippet</i>) offer the ability to edit some placeholders on the snippet so one can have a single snippet and use it on different scenarios. For instance:
</p>

<p>
Let's assume I'm a Java developer, and as such, one of the most common scenarios is for me to create a class, more or less like this:
</p>

<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">MyClassName</span> {
    <span class="org-keyword">public</span> <span class="org-function-name">MyClass</span>() {
    }
}
</pre>
</div>

<p>
I could make this text as a snippet, and I would have to replace <code>MyClassName</code> with whatever name I want, but I could go a step further and make my snippet something like this:
</p>

<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> ${1:MyClassName} {
    <span class="org-keyword">public</span> $1() {
        $0
    }
}
</pre>
</div>

<p>
Now, when I expand this snippet, I have the chance to type the name of the class right after expanding it, press <code>TAB</code> again, and get my cursor inside the public constructor.
</p>

<p>
For instance, first I type the snippet keyword (the <code>|</code> character represents the cursor, and <code>[]</code> represents a selected placeholder):
</p>

<div class="org-src-container">
<pre class="src src-java">myclass|
</pre>
</div>

<p>
As soon as I press <code>TAB</code>, the snippet expansion happens:
</p>

<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> [|MyClassName] {
    <span class="org-keyword">public</span> <span class="org-function-name">MyClassName</span>() {

    }
}
</pre>
</div>

<p>
If I type a different name for the class, the constructor will mirror that change:
</p>

<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">AwesomeClass</span>| {
    <span class="org-keyword">public</span> <span class="org-function-name">AwesomeClass</span>() {

    }
}
</pre>
</div>

<p>
And as soon as I press <code>TAB</code> again, the cursor moves to inside the constructor:
</p>

<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">AwesomeClass</span> {
    <span class="org-keyword">public</span> <span class="org-function-name">AwesomeClass</span>() {
        |
    }
}
</pre>
</div>

<p>
Another functionality provided by the snippet framework, is the ability to delete a placeholder that does not make sense on the current context. As an example, lets augment our previous snippet with the ability to type arguments on the constructor:
</p>

<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> ${1:MyClassName} {
    <span class="org-keyword">public</span> $1(${2:args}) {
        $0
    }
}
</pre>
</div>

<p>
Now, after renaming the class, if I press <code>TAB</code>, I have the chance to type anything as an argument tot the constructor:
</p>

<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">AwesomeClass</span> {
    <span class="org-keyword">public</span> <span class="org-type">AwesomeClass</span>([|args]) {

    }
}
</pre>
</div>

<p>
If I press <code>TAB</code> without typing anything, I would move the cursor to inside the constructor, but would have the word <code>args</code> as a parameter definition (which, in Java, is not a valid declaration):
</p>

<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">AwesomeClass</span> {
    <span class="org-keyword">public</span> <span class="org-function-name">AwesomeClass</span>(<span class="org-type">args</span>) {   <span class="org-comment-delimiter">// </span><span class="org-comment">&lt;-- Compile error</span>
        |
    }
}
</pre>
</div>

<p>
What we want to do here, is to delete the placeholder and move to the next position, and end up with the same result as before:
</p>

<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">AwesomeClass</span> {
    <span class="org-keyword">public</span> <span class="org-function-name">AwesomeClass</span>() {
        |
    }
}
</pre>
</div>

<p>
By default, we can achieve this by pressing <code>DEL</code> instead of <code>TAB</code>. In general, this behavior is pretty good, except when you're typing on a MacBook laptop keyboard. MacBook keyboards don't have the key <code>DEL</code> on them, and to get a <code>DEL</code>, I have to use a combination of two keys.
</p>

<p>
For this reason, I want to make sure that the same behavior I have with <code>DEL</code>, I also have with <code>BACKSPACE</code>.
</p>

<p>
The following function, is an adaptation of the Doom's own <code>+snippets/delete-forward-char-or-field</code> function, but doing the reverse of it.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 28: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-snippets-delete-backward-char-or-field</span> (<span class="org-type">&amp;optional</span> field)
  <span class="org-doc">"Delete backward, or skip the current field if it's empty.</span>

<span class="org-doc">Prevents Yas from interfering with backspace deletion."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((field (<span class="org-keyword">or</span> field (<span class="org-keyword">and</span> (overlayp yas--active-field-overlay)
                              (overlay-buffer yas--active-field-overlay)
                              (overlay-get yas--active-field-overlay 'yas--field)))))
    (<span class="org-keyword">cond</span> ((not (yas--field-p field))
           (call-interactively #'delete-backward-char))
          ((<span class="org-keyword">and</span> (not (yas--field-modified-p field))
                (eq (point) (marker-position (yas--field-start field))))
           (yas--skip-and-clear field)
           (yas-next-field 1))
          ((eq (point) (marker-position (yas--field-start field))) nil)
          ((call-interactively #'delete-backward-char)))))
</pre>
</div>

<p>
With the function defined, I can simply add it to a key bind to start using it. Notice on the following code, that I also map <code>⌘-RET</code> to allow me to end the snippet completion and accept all the default values (I'm trying to make <code>⌘-RET</code> a standard keymap that means <i>finish and accept</i>):
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 29: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:after</span> yasnippet

      (<span class="org-builtin">:leader</span> <span class="org-builtin">:prefix</span> (<span class="org-string">"h"</span> . <span class="org-string">"help"</span>)
       <span class="org-builtin">:desc</span> <span class="org-string">"Show snippets"</span> <span class="org-builtin">:n</span> <span class="org-string">"y"</span> #'yas-describe-tables)

      (<span class="org-builtin">:map</span> yas-keymap
       <span class="org-builtin">:g</span> [backspace] #'my-snippets-delete-backward-char-or-field
       <span class="org-builtin">:g</span> [deletechar] #'+snippets/delete-forward-char-or-field
       <span class="org-builtin">:g</span> [s-return] #'yas-exit-snippet))
</pre>
</div>

<p>
The last configuration for snippets is to guarantee the <code>yas-describe-tables</code> shows up on the right side of the screen:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 30: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(set-popup-rule! <span class="org-string">"^\\*YASnippet Tables\\*"</span>
  <span class="org-builtin">:slot</span> 2   <span class="org-builtin">:vslot</span> -1     <span class="org-builtin">:side</span> 'right   <span class="org-builtin">:width</span> 104 <span class="org-builtin">:height</span> 0.4
  <span class="org-builtin">:select</span> t <span class="org-builtin">:modeline</span> nil <span class="org-builtin">:autosave</span> nil  <span class="org-builtin">:ttl</span> 0     <span class="org-builtin">:quit</span> t)
</pre>
</div>

<p>
Throughout this document, you will find helpful snippets I like to define for certain features. I decided to spread the snippets across different features because I want to indicate to the reader to consider the snippet in question as an integral part of the configuration at hand.
</p>
</div>
</div>

<div id="outline-container-orgf306019" class="outline-3">
<h3 id="orgf306019"><span class="section-number-3">2.5</span> Inline completion</h3>
<div class="outline-text-3" id="text-2-5">
<p>
What I call inline completion, is also known as intellisense, code completion, or in the Vim world, omni completion. It's a useful tool to help the user type less and more correctly while editing source code.
</p>

<p>
Years ago, there was two main packages that provided such feature on Emacs:
</p>

<ul class="org-ul">
<li><a href="https://github.com/auto-complete/auto-complete">auto-complete</a></li>
<li><a href="https://github.com/company-mode/company-mode">company-mode</a></li>
</ul>

<p>
On the time I'm writing this part of my document, <a href="https://github.com/auto-complete/auto-complete">auto-complete</a> is searching for a new maintainer, and I barely read any mention of it on the mainstream media.
</p>

<p>
Since I've been using <a href="https://github.com/company-mode/company-mode">company-mode</a> for the most part of my Emacs experience, I will stick with it on my new configuration.
</p>

<p>
One of the best features I like on <a href="https://github.com/company-mode/company-mode">company-mode</a>, is its architecture design, where the author decided to modularize the package, allowing other packages to integrate with it where they actually mater. For instance, if my package offers a major mode to edit files from the <i>Foo</i> language, I can create a <code>foo-company-backend</code> to integrate it on the Company ecosystem, or if my package provides a new cool way to display inline completions, I can create a <i>company frontend</i> to make such integration
</p>

<p>
For the most part, Doom does a pretty good job configuring <a href="https://github.com/company-mode/company-mode"><code>company-mode</code></a> to my liking, I just need to adjust some small behaviors and keymaps.
</p>

<p>
One of the most prominent differences on my configuration is the fact that I don't like to let <a href="https://github.com/company-mode/company-mode"><code>company-mode</code></a> to show its popup automatically. It is a nice feature, but with certain backends, it can slow down the edit experience (I'm looking at you <a href="https://github.com/company-mode/company-mode/blob/master/company-ispell.el"><code>company-ispell</code></a>). For that reasons (and also because I rather the experience of <a href="https://github.com/ervandew/supertab"><code>supertab</code></a> on Vim's world), I decided to not <i>auto-display</i> Company's popup.
</p>

<p>
In order to display the completion on my configuration, one has to press <code>TAB</code> after type couple characters of the word, or type a "<code>.</code>" character after a keyword on programming modes that support it.
</p>

<p>
Such behavior is so wildly used that Company offers a helper function (<code>company-indent-or-complete-common</code>) to help the user to handle <i>inserting a "<code>\t</code>" character</i> versus displaying the completion. That is all and good, but unfortunately, as seen on section <a href="#orgd871dbc">2.4</a>, I have a third function for the <code>TAB</code> key.
</p>

<p>
In order to help me handle my three cases for <code>TAB</code> I need to create small wrapper function to add the <code>yasnippet</code> check before handling completion to Company:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 31: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-company-indent-or-complete-common</span> (arg)
  <span class="org-doc">"Tab key action for current point.</span>

<span class="org-doc">This function tries to insert a tab character, trigger a snippet or complete a</span>
<span class="org-doc">word with company.</span>

<span class="org-doc">The order for this selection is:</span>

<span class="org-doc">- Org table</span>
<span class="org-doc">- Yasnippet</span>
<span class="org-doc">- Indent region</span>
<span class="org-doc">- Indent line</span>
<span class="org-doc">- Indent org-mode line</span>
<span class="org-doc">- Indent org-mode headline</span>
<span class="org-doc">- Indent org-mode item from a list</span>
<span class="org-doc">- Indent markdown-mode line</span>
<span class="org-doc">- Indent rst-mode line</span>
<span class="org-doc">- Complete with company</span>

<span class="org-doc">The action selection happens in this order and stops as soon as the first action</span>
<span class="org-doc">works."</span>
  (<span class="org-keyword">interactive</span> <span class="org-string">"P"</span>)
  (<span class="org-keyword">if</span> (org-table-p)
      (orgtbl-tab arg)
    (<span class="org-keyword">if</span> (<span class="org-keyword">or</span> (not yas-minor-mode)
            (null (yas-expand)))
        (<span class="org-keyword">cond</span> ((use-region-p) (indent-region (region-beginning) (region-end)))
              (t (<span class="org-keyword">let</span> ((old-point (point))
                       (old-tick (buffer-chars-modified-tick))
                       (tab-always-indent t))
                   (indent-for-tab-command arg)
                   (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> (eq old-point (point))
                              (eq old-tick (buffer-chars-modified-tick)))
                     (<span class="org-keyword">unless</span> (<span class="org-keyword">pcase</span> major-mode
                               ('org-mode (<span class="org-keyword">or</span> (org-indent-line)
                                              (org-cycle-level)
                                              (org-cycle-item-indentation)))
                               ('markdown-mode (markdown-indent-line))
                               ('rst-mode (rst-indent-line nil))
                               (_ nil))
                       (company-complete-common))))))
      (company-abort))))
</pre>
</div>

<p>
This function incorporates the source code of <code>company-indent-or-complete-common</code> to allow me to handle special cases like in Org mode when I want to indent a list item or headline. It first tries to expand the previous word on a snippet. If it can't, it falls back to the altered Company function, where it also tries to do an Org indent, or a Markdown indent, or a reStructuredText before settling on <code>company-complete-common</code>.
</p>

<p>
But what if I'm already displaying the Company popup, but I want to expand what I just typed into a snippet? The previous function can't help us, because it does not handle navigating the completion options with <code>TAB</code>. For such behavior, I need another function that I should run instead of the previous one if I have Company's popup opened:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 32: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-completion-yasnippet-or-completion</span> ()
  <span class="org-doc">"Tab key action when company popup is visible.</span>

<span class="org-doc">This function tries to expand a snippet, complete a common prefix on a company</span>
<span class="org-doc">completion, or move the company selction to the next item."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> (<span class="org-keyword">or</span> (not yas-minor-mode)
          (null (yas-expand)))
      (company-complete-common-or-cycle)
    (company-abort)))
</pre>
</div>

<p>
Notice that the only difference between <code>my-company-indent-or-complete-common</code> and <code>my-completion-yasnippet-or-completion</code> is that I call <code>company-indent-or-complete-common</code> on the former, and <code>company-complete-common-or-cycle</code> on the later.
</p>

<p>
Another deviation from the standard that I like, is how the <code>RET</code> should work with Company.
</p>

<p>
For me, there are two scenarios that can happen if one presses <code>RET</code> while the Company popup is visible:
</p>

<ol class="org-ol">
<li>The user meant to insert a "<code>\n</code>" character on the document;</li>
<li>The user intended to select the selected completion option;</li>
</ol>

<p>
The way to distinguish between these two scenarios, is to check if Company already have a selection stored at <code>company-selection</code>. If it does have, the <code>RET</code> should represent a <code>company-complete-selection</code>, otherwise, the <code>RET</code> should close the Company popup, and insert a "<code>\n</code>" character on the document. I created the next function to manage these behavior:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 33: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-completion-complete-selection-or-return</span> ()
  <span class="org-doc">"Return key action when company popup is visible.</span>

<span class="org-doc">This function will select current company item if user already selected one, or</span>
<span class="org-doc">insert a new line character."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> company-selection
      (company-complete-selection)
    (company-abort)
    (execute-kbd-macro (read-kbd-macro <span class="org-string">"&lt;return&gt;"</span>))))
</pre>
</div>

<p>
Notice also, that I didn't use <code>insert</code> when a <code>RET</code> means to <i>add a new line</i>. This decision is to allow Emacs to trigger any function or hook tied to the <code>RET</code> key.
</p>

<p>
With all auxiliary functions created, I just need to setup Company according to my needs:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 34: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> company
  (<span class="org-keyword">setq</span> company-idle-delay nil)
  (<span class="org-keyword">setq</span> tab-always-indent 'complete)
  (<span class="org-keyword">setq</span> company-minimum-prefix-length 2)
  (<span class="org-keyword">setq</span> company-show-numbers t)
  (<span class="org-keyword">setq</span> company-box-doc-enable nil)
  (<span class="org-keyword">setq</span> company-frontends (delq 'company-pseudo-tooltip-frontend company-frontends))

  (add-hook 'evil-normal-state-entry-hook #'company-abort))
</pre>
</div>

<p>
One configuration that worth mention why I choose it is to set <code>company-box-doc-enable</code> to <code>nil</code>. I did this, not because I don't like the documentation as another child frame, is the fact that if I do show it, I can't move my popup completion without aborting Company.
</p>

<p>
Last, I need to setup the proper keymaps for the package:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 35: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:after</span> company
      (<span class="org-builtin">:map</span> global-map
       <span class="org-builtin">:i</span> [tab] #'my-company-indent-or-complete-common)
      (<span class="org-builtin">:map</span> company-active-map
       <span class="org-builtin">:g</span> [tab] #'my-completion-yasnippet-or-completion
       <span class="org-builtin">:g</span> [backtab] #'company-select-previous
       <span class="org-builtin">:g</span> [down] #'company-select-next
       <span class="org-builtin">:g</span> [up] #'company-select-previous
       <span class="org-builtin">:g</span> [return] #'my-completion-complete-selection-or-return
       <span class="org-builtin">:g</span> <span class="org-string">"C-S-j"</span> #'company-next-page
       <span class="org-builtin">:g</span> <span class="org-string">"C-S-k"</span> #'company-previous-page
       <span class="org-builtin">:g</span> <span class="org-string">"C-/"</span> #'company-show-doc-buffer))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9ba2515" class="outline-3">
<h3 id="org9ba2515"><span class="section-number-3">2.6</span> Automatic indentation</h3>
<div class="outline-text-3" id="text-2-6">
<p>
I appreciate the fact that majority of editor these days can keep the indentation of the previous line, and some of them, are even capable of adding indentation where is necessary. Although this is a good start, I want my editor to do more. When I add braces around a code, or when I make a one-line statement, a multi-line one, I want the editor to reformat my file to properly intent it.
</p>

<p>
Emacs offers a mode called <code>electric-indent-mode</code> where the ultimate goal, is to achieve exactly what I described, but unfortunately, the current state of the mode is falling short of it.
</p>

<p>
The solution I found, is an external package called <a href="https://github.com/Malabarba/aggressive-indent-mode"><code>aggressive-indent</code></a> that re-indent the entire file on every change.
</p>

<p>
It is a bit too aggressive, but so far is working just fine for me, so let's add it to our packages:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 36: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> aggressive-indent)
</pre>
</div>

<p>
A point to note is where to use this package. I need it on <code>prog-mode</code>, but due to some particularities of certain languages (did someone said Python here?), I need to specify the set of languages I want to support aggressive indent. The reader can check the list of supported language on the following code snippet:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 37: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> aggressive-indent
  <span class="org-builtin">:hook</span> ((emacs-lisp-mode
          c-mode
          cpp-mode
          rust-mode
          go-mode
          java-mode
          kotlin-mode
          shell-mode
          javascript-mode
          typescript-mode) <span class="org-warning">. aggressive-indent-mode))</span>
</pre>
</div>

<p>
The reason to not include Python on this list, is the fact that Python uses indentation as block delimiter, and the package does not know how where a block ends and a new starts, causing re-indentation to pretty much break the code.
</p>
</div>
</div>

<div id="outline-container-org2cc7aa7" class="outline-3">
<h3 id="org2cc7aa7"><span class="section-number-3">2.7</span> Smart backspace</h3>
<div class="outline-text-3" id="text-2-7">
<p>
As part of my day job, I had to do a lot of Android development, and inevitably I used <a href="https://www.jetbrains.com/">JetBrains</a>
IDE <a href="https://www.jetbrains.com/idea/">IntelliJ IDEA</a>. I bring this up not to chastise who uses or to complain about it. In face, IntelliJ the best IDE for Java and Kotlin out there. It has some features that are so good, that I want to implement on any text editor I use. One of these features is what I call <i>Smart Backspace</i>.
</p>

<p>
On both, Doom and IntelliJ, when you type an open pair, the editor completes with the closing one:
</p>

<div class="org-src-container">
<pre class="src src-kotlin">fun foo() {|}
</pre>
</div>

<p>
Also on both, when you press <code>&lt;ENTER&gt;</code>, the editor position the cursor on a newly inserted line, on using the correct indentation, and it also inserts a '<code>\n</code>' character after cursor. The result of these actions would be like this:
</p>

<div class="org-src-container">
<pre class="src src-kotlin">fun foo() {
    |
}
</pre>
</div>

<p>
The difference between both editors happens when you press <code>&lt;BACKSPACE&gt;</code> at this point. While in Doom, this operation would result in:
</p>

<div class="org-src-container">
<pre class="src src-kotlin">fun foo() {
|
}
</pre>
</div>

<p>
On IntelliJ, it results in:
</p>

<div class="org-src-container">
<pre class="src src-kotlin">fun foo() {|}
</pre>
</div>

<p>
But what happened here?
</p>

<p>
IntelliJ was able to figure out that, since I was on the indent column of the line <b>and</b> I haven't typed anything after the auto-pair, when I pressed <code>&lt;BACKSPACE&gt;</code>, my intention was to get back to the state I was before pressing <code>&lt;ENTER&gt;</code>, therefore the name I gave to this feature: <i>Smart backspace</i>.
</p>

<p>
To achieve the same result with Doom, we have to add a function advice to delete advice Doom adds to Emacs (the <code>+default--delete-backward-char-a</code> advice is what is responsible to balance the blank characters you enter after a pair completion).
</p>

<p>
Our advice function checks if our cursor is position on the expected position to revert the <code>&lt;ENTER&gt;</code> pressed between the two pairs. If it is, we remove all the characters before the cursor on the current line. This will put the cursor on a position that Doom's advice function can remove the two new line characters around the cursor, putting the buffer on the same state we were before we pressed <code>&lt;ENTER&gt;</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 38: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-super-backward-delete-a (<span class="org-type">&amp;rest</span> _)
  <span class="org-doc">"Special function to super-delete things.</span>

<span class="org-doc">If the line content before cursor contains only blank characters, this function</span>
<span class="org-doc">will delete all the blank characters, and then, join with the previous line. I</span>
<span class="org-doc">there is any non-blank character before cursor, this function will delete the</span>
<span class="org-doc">entire line, but keep the correct indentation on it."</span>
  <span class="org-builtin">:before</span> '+default--delete-backward-char-a
  (<span class="org-keyword">let*</span> ((line-pos (- (point) (point-at-bol)))
         (prev-indent (<span class="org-keyword">save-excursion</span>
                        (forward-line -1)
                        (current-indentation)))
         (prev-line-bol (point-at-bol 0))
         (next-line-eol (point-at-eol 2))
         (smart-bs-p (<span class="org-keyword">or</span> (<span class="org-keyword">save-excursion</span>
                           (<span class="org-keyword">and</span> (re-search-backward <span class="org-string">"{[ \t]*\n[ \t]*"</span> prev-line-bol t)
                                (re-search-forward <span class="org-string">"[ \t]*\n[ \t]*}"</span> next-line-eol t)))
                         (<span class="org-keyword">save-excursion</span>
                           (<span class="org-keyword">and</span> (re-search-backward <span class="org-string">"\\[[ \t]*\n[ \t]*"</span> prev-line-bol t)
                                (re-search-forward <span class="org-string">"[ \t]*\n[ \t]*\\]"</span> next-line-eol t)))
                         (<span class="org-keyword">save-excursion</span>
                           (<span class="org-keyword">and</span> (re-search-backward <span class="org-string">"([ \t]*\n[ \t]*"</span> prev-line-bol t)
                                (re-search-forward <span class="org-string">"[ \t]*\n[ \t]*)"</span> next-line-eol t))))))
    (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> smart-bs-p
               (&lt;= line-pos (+ prev-indent standard-indent)))
      (delete-char (- line-pos)))))
</pre>
</div>

<p>
Adding this advice as an <i>autoload</i> function on our configuration is all we need to get the functionality working. When Doom loads the <code>smartparens</code> on the default module, it replaces the Emacs <code>delete-backward-char</code> function with its <code>+default--delete-backward-char-a</code> advice, which will load our function, which, in turn, installs itself as a <code>:before</code> advice on Doom's function.
</p>
</div>
</div>

<div id="outline-container-orga192e61" class="outline-3">
<h3 id="orga192e61"><span class="section-number-3">2.8</span> Balanced pairs</h3>
<div class="outline-text-3" id="text-2-8">
<p>
In most editors (as far as editors go, I only saw Emacs allowing balanced pairs), there is no balanced pair protection. If you remove a line where a closing character is, without removing its open pair, your buffer becomes unbalanced.
</p>

<p>
Emacs has some packages that help you keep the balance on pair characters, even if you try to remove a line containing just one of the pairs.
</p>

<p>
Among the packages I checked, the two top two contenders for me are <a href="https://github.com/noctuid/lispyville"><code>lispville</code></a> and <a href="https://github.com/Fuco1/smartparens"><code>smartparens</code></a>  + (<a href="https://github.com/luxbock/evil-cleverparens"><code>evil-cleverparens</code></a> or <a href="https://github.com/expez/evil-smartparens"><code>evil-smartparens</code></a>).
</p>

<p>
From the two, <code>lispville</code> seams to be the most maintained, but it depends on <code>lispy</code> and even though you can use it just for the balance protection, it requires much more code and effort to do it right, so my choice is <code>smartparens</code> + <code>evil-cleverparens</code>. I tried <code>evil-smartparens</code> before, and it is not as polished as <code>evil-cleverparens</code>.
</p>

<p>
To install them, make sure <code>smartparens</code> is enable in your <code>init.el</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 39: </span>$DOOMDIR/init.el</label><pre class="src src-emacs-lisp"><span class="org-builtin">:config</span>
(default
    +bindings
    +smartparens)
</pre>
</div>

<p>
And <code>evil-cleverparens</code> is on the <code>packages.el</code> file as well:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 40: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> evil-cleverparens)
</pre>
</div>

<p>
These changes will make Doom download them into its local cache when you run <code>doom sync</code>.
</p>

<p>
Before I configure these packages, I would like to explain why I turn on balance protection only on Emacs modes deriving from <code>prog-mode</code>.
</p>

<p>
The simplest explanation is that you don't really need pair balance protection in any other place then you coding buffers. I did some informal experiments on this area, and found that pair protection turned on when you write prose is magnitudes more annoying then useful, so I will stick with protection only in <code>prog-mode</code>.
</p>

<p>
To make Emacs turn <code>smartparens</code> and related packages correctly, make sure that you turn on <code>evil-cleverparens-mode</code> on the <code>smartparens-enabled-hook</code>, and only enable the strict mode when editing a <code>prog-mode</code> buffer:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 41: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> smartparens
  <span class="org-builtin">:init</span> (add-hook 'smartparens-strict-mode-hook #'evil-cleverparens-mode)
  <span class="org-builtin">:hook</span> ((prog-mode . smartparens-strict-mode)))
</pre>
</div>

<p>
Doom will turn on <code>smartparens</code> appropriately, so we don't need to hook anything else to get this feature working, but there is one more configuration that I like to have on, all the time. It is the ability of Emacs to highlight the <i>other pair</i> when the cursor is on top of a character pair.
</p>

<p>
To do so, enable the <code>show-smartparens-global-mode</code> after enabling <code>smartparens</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 42: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> smartparens
  (show-smartparens-global-mode 1))
</pre>
</div>
</div>
</div>

<div id="outline-container-org617a217" class="outline-3">
<h3 id="org617a217"><span class="section-number-3">2.9</span> Rich keybindings</h3>
<div class="outline-text-3" id="text-2-9">
<p>
The good thing about this feature is that Emacs already covers almost all of my <a href="#orgf9d98f8">requirements</a> for free, and doom ships with a package that covers the rest of it (<code>which-key</code>). What I need to do here, is to tweak <code>which-key</code> to <i>look</i> and <i>feel</i> like I want it.
</p>

<p>
One aspect of which key that bothered me is not so much a <code>which-key</code> thing, and more an Emacs thing in general. This aspect is how popup windows show and hide. When Emacs shows one on the bottom of the screen, it shifts the window I'm working on upwards, and although this came to be the expected behavior, it disrupt my flow, specially if the time I take to finish a shortcut sequence is couple milliseconds more then the <code>which-key</code> timeout.
</p>

<p>
To remediate this situation, I found this package called  <a href="https://github.com/yanghaoxie/which-key-posframe"><code>which-key-posframe</code></a> that display the shortcut hints on a child frame. With a configuration or two, I believe this package can deliver what I want.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 43: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> which-key-posframe)
</pre>
</div>

<p>
The main adjustments I want to do, is to make sure the child frame <i>width</i> is big enough to fit the biggest description I can have.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 44: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> which-key-posframe
  <span class="org-builtin">:hook</span> (which-key-mode . which-key-posframe-mode)
  <span class="org-builtin">:custom</span>
  (which-key-posframe-poshandler 'my-posframe-poshandler-frame-right-middle)
  (which-key-posframe-parameters '((min-width . 44))))
</pre>
</div>

<p>
And respect the border color for popups:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 45: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(custom-set-faces!
  `(which-key-posframe-border <span class="org-builtin">:background</span> <span class="org-string">"#000000"</span>)
  `(which-key-posframe <span class="org-builtin">:background</span> <span class="org-string">"#21242b"</span>))
</pre>
</div>

<p>
I need also to set the <code>which-key-posframe-poshandler</code> variable, to allow a special behavior regarding positioning the child frame on the screen.
</p>

<p>
This special behavior is simply to most of the times, show the shortcut hints on the right side of the frame, but if I invoke an Embark action, I want the shortcut hints child frame to show up right besides the cursor point.
</p>

<p>
To achieve this behavior, I'll define a <code>nil</code> placeholder variable that I can set to <code>t</code> when invoking Embark.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 46: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defvar</span> <span class="org-variable-name">my-which-key-on-embark</span> nil)
</pre>
</div>

<p>
Which such variable created, I can define my function to place the frame where I want it:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 47: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-posframe-poshandler-frame-right-middle</span> (info)
  <span class="org-doc">"Posframe's position handler.</span>

<span class="org-doc">Get a position which let posframe stay vertically centralized onto current</span>
<span class="org-doc">frame's right site. Checkk the docstring of `</span><span class="org-doc"><span class="org-constant">posframe-show</span></span><span class="org-doc">' for more information</span>
<span class="org-doc">about the INFO structure."</span>
  (<span class="org-keyword">if</span> my-which-key-on-embark
      (posframe-poshandler-point-bottom-left-corner info)
    (<span class="org-keyword">let*</span> ((frame-width (plist-get info <span class="org-builtin">:parent-frame-width</span>))
           (frame-height (plist-get info <span class="org-builtin">:parent-frame-height</span>))
           (posframe-width (plist-get info <span class="org-builtin">:posframe-width</span>))
           (posframe-height (plist-get info <span class="org-builtin">:posframe-height</span>)))
      (cons (- frame-width posframe-width (line-pixel-height))
            (/ (- frame-height posframe-height) 2)))))
</pre>
</div>

<p>
In order to connect <code>embark</code> to <code>which-key</code>, I need to advice the function I defined to invoke <code>which-key</code> when I invoke <code>embark</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 48: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-embark-which-key-action-wrapper (orig-fun <span class="org-type">&amp;rest</span> args)
  <span class="org-doc">"Wrap ORIGIN-FUN on a let bind to indicate this is an Embark call.</span>

<span class="org-doc">It passes ARGS to ORIGIN-FUN without altering them. "</span>
  <span class="org-builtin">:around</span> 'my-embark-which-key-action-indicator
  (<span class="org-keyword">let</span> ((my-which-key-on-embark t))
    (apply orig-fun args)))
</pre>
</div>

<p>
With the <code>which-key-posframe</code> configured, I just need to do some minor adjustments on the <code>which-key</code> package to make it display the hints on a single column with a single description occupying up to 40 characters of such column:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 49: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> which-key
  (<span class="org-keyword">setq</span> which-key-allow-multiple-replacements t)
  (<span class="org-keyword">setq</span> which-key-min-display-lines 10)
  (<span class="org-keyword">setq</span> which-key-max-display-columns 1)
  (<span class="org-keyword">setq</span> which-key-add-column-padding 2)
  (<span class="org-keyword">setq</span> which-key-max-description-length 40))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5eef89d" class="outline-3">
<h3 id="org5eef89d"><span class="section-number-3">2.10</span> Useful line numbers</h3>
<div class="outline-text-3" id="text-2-10">
<p>
A long time ago, I read on some Vim mailing list, an opinion on how line numbers should behave on different editing modes (if you know who is the original author of such idea, please let me know so I can give credit where credit is due). Since on normal mode is pretty useful to know the line count from the cursor until some target text, it makes more sense to have the <code>relative number</code> shown on the gutter, but when I'm editing the buffer, is nice to have a sense of size by looking to the line numbers.
</p>

<p>
So, I can describe this behavior as follows:
</p>

<ul class="org-ul">
<li>When on normal mode, show relative line numbers;</li>
<li>When on insert mode, show absolute line numbers;</li>
</ul>

<p>
To achieve this, I need a function that turns the <i>absolute</i> line number when line numbers are visible:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 50: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-line-number-absolute-h</span> ()
  <span class="org-doc">"If line numbers are visible, set the current line number type to `</span><span class="org-doc"><span class="org-constant">absolute.</span></span><span class="org-doc">'"</span>
  (<span class="org-keyword">if</span> display-line-numbers
      (<span class="org-keyword">setq</span> display-line-numbers t)))
</pre>
</div>

<p>
And another function to put the line numbers on <i>relative mode</i> (but again, only if line numbers are visible):
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 51: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-line-number-visual-h</span> ()
  <span class="org-doc">"If line numbers are visible, set the current line number type to `</span><span class="org-doc"><span class="org-constant">visual</span></span><span class="org-doc">'"</span>
  (<span class="org-keyword">if</span> display-line-numbers
      (<span class="org-keyword">setq</span> display-line-numbers 'visual)))
</pre>
</div>

<p>
With those functions created, after loading Evil, I can hook them to a mode switch:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 52: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> evil
  (<span class="org-keyword">add-hook!</span> '(evil-emacs-state-entry-hook
               evil-insert-state-entry-hook) <span class="org-warning">'my-line-number-absolute-h)</span>
  (<span class="org-keyword">add-hook!</span> '(evil-emacs-state-exit-hook
               evil-insert-state-exit-hook) <span class="org-warning">'my-line-number-visual-h))</span>
</pre>
</div>

<p>
To finalize, I want to make line numbers visible on any programming mode:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 53: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> evil
  (<span class="org-keyword">setq-hook!</span> 'prog-mode-hook display-line-numbers-type 'visual))
</pre>
</div>
</div>
</div>

<div id="outline-container-org6852326" class="outline-3">
<h3 id="org6852326"><span class="section-number-3">2.11</span> Auto-Saving</h3>
<div class="outline-text-3" id="text-2-11">
<p>
First of all, since I'm going to save my work constantly, I don't want Emacs to ask me if it should really exit, or if it should kill outstanding processes while doing it. For me, if I'm telling Emacs to quit, I want it to do it, regardless its state, but I don't want to lose any content of my current work. So, the first thing I'm going to do, is to disable questions when I'm quitting Emacs:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 54: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> confirm-kill-emacs nil
      confirm-kill-processes nil)
</pre>
</div>

<p>
Emacs allows you to define some <i>advices</i> to any function you want. This allows you to hook some code when the user, or the system calls such functions. On the case of aggressive auto-save, I want Emacs to save any content when I try to close the buffer associated with the content, of if I'm trying to quit Emacs. To do so, I'll create an <i>autoload</i> advice to perform such work:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 55: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-save-all-buffers-a (<span class="org-type">&amp;rest</span> _)
  <span class="org-doc">"Advice to run `</span><span class="org-doc"><span class="org-constant">save-some-buffers</span></span><span class="org-doc">' before a function.</span>

<span class="org-doc">This is a part of the full auto-save feature."</span>
  <span class="org-builtin">:before</span> (list #'save-buffers-kill-emacs #'my-tabs-close-buffer-tab)
  (save-some-buffers t t))
</pre>
</div>

<p>
And to wrap up this configuration, I enable the auto-save mode:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 56: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(auto-save-visited-mode 1)
</pre>
</div>

<p>
Call the same advice as a normal function when Emacs executes the auto-save hook:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 57: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">add-hook!</span> 'auto-save-hook #'my-save-all-buffers-a)
</pre>
</div>

<p>
And add the advice function to the <code>after-focus-change-function</code> as well, just to make sure Emacs save any outstanding buffer as soon as possible if it loses focus:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 58: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">add-function</span> <span class="org-builtin">:after</span> after-focus-change-function #'my-save-all-buffers-a)
</pre>
</div>

<p>
This aggressive auto-save will work as expected, but it will crate a side effect with my literate configuration. Since Doom tangles the Org file every time we save it, the aggressive auto-save will make this tangle happen more often than we want.
</p>

<p>
Doom documentation offers a partial solution to this problem asking us to remove the auto-tangle function from the save hook, so let's do it:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 59: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(remove-hook 'org-mode-hook #'+literate-enable-recompile-h)
</pre>
</div>

<p>
Another core behavior that does not play well with my aggressive auto-save configuration is how Doom configures <code>ws-butler</code>. While I understand the rational behind the choice of always remove blank spaces regardless the cursor position.
</p>

<p>
To adjust that, let's make <code>ws-butler</code> behave how I expect it:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 60: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> ws-butler
  (<span class="org-keyword">setq</span> ws-butler-keep-whitespace-before-point t))
</pre>
</div>
</div>
</div>

<div id="outline-container-org759796e" class="outline-3">
<h3 id="org759796e"><span class="section-number-3">2.12</span> Persist frame position and geometry</h3>
<div class="outline-text-3" id="text-2-12">
<p>
Before I start tackling my own requirement, let's make Emacs <i>remember</i> its window size and position between launches.
</p>

<p>
First, I like to define an auto loaded function to hook into the emacs kill process to save frame dimensions. The reason to get an auto load function, is to allow Emacs to <b>not</b> load it until it really needs it, which would be when I'm quitting Emacs.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 61: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-save-frame-dimensions-h</span> ()
  <span class="org-doc">"Caches the current frame dimensions and position."</span>
  (<span class="org-keyword">if-let</span> ((main-frame (car-safe (visible-frame-list))))
      (doom-store-put 'last-frame-size
                      (list (frame-position main-frame)
                            (frame-width main-frame)
                            (frame-height main-frame)
                            (frame-parameter main-frame 'fullscreen)))))
</pre>
</div>

<p>
Then, I like to have the analog function to call when we create a frame:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 62: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-restore-frame-dimensions-h</span> ()
  <span class="org-doc">"Restore frame dimensions and position from `</span><span class="org-doc"><span class="org-constant">my-save-frame-dimensions-h</span></span><span class="org-doc">'."</span>
  (<span class="org-keyword">if-let</span> (dims (doom-store-get 'last-frame-size <span class="org-string">"default"</span>))
      (<span class="org-keyword">cl-destructuring-bind</span> ((left . top) width height fullscreen) dims
        (<span class="org-keyword">setq</span> initial-frame-alist
              (append initial-frame-alist
                      `((left . ,left)
                        (top . ,top)
                        (width . ,width)
                        (height . ,height)
                        (fullscreen . ,fullscreen)))))
    (add-to-list 'default-frame-alist '(height . 40))
    (add-to-list 'default-frame-alist '(width . 140))))
</pre>
</div>

<p>
With the function defined, I just need to connect them to the correct hooks:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 63: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(add-hook 'kill-emacs-hook #'my-save-frame-dimensions-h)
(my-restore-frame-dimensions-h)
</pre>
</div>
</div>
</div>

<div id="outline-container-orge5e34f9" class="outline-3">
<h3 id="orge5e34f9"><span class="section-number-3">2.13</span> <span class="todo TODO">TODO</span> Remote editing</h3>
<div class="outline-text-3" id="text-2-13">
<p>
TBD (still need to figure out the best way to address this).
</p>
</div>
</div>
</div>

<div id="outline-container-orgbf2a653" class="outline-2">
<h2 id="orgbf2a653"><span class="section-number-2">3</span> Personal preferences</h2>
<div class="outline-text-2" id="text-3">
<p>
This section will show the reader, some of the small changes I decided to implement on Doom related to Evil, my personal keybindings, my choice of appearance, and other personal configurations. All in all, is pretty safe to skip this section if you intend to implement your own customization.
</p>
</div>

<div id="outline-container-org3d38504" class="outline-3">
<h3 id="org3d38504"><span class="section-number-3">3.1</span> Evil</h3>
<div class="outline-text-3" id="text-3-1">
<p>
For most of it, Doom integration of Evil is pretty amazing, I found just one package I don't use (or don't want to use at all), two configurations that I want to do some adjustments, and three packages missing.
</p>

<p>
The package I don't use is <code>evil-escape</code>, and its purpose, is to allow one to type <code>j k</code> fast enough on insert mode to force moving from insert mode to normal mode.
</p>

<p>
If you're used to this feature, good for you, but I was never able to adjust my muscle memory to it, so I rather disable it on <code>packages.el</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 64: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> evil-escape <span class="org-builtin">:disable</span> t)
</pre>
</div>

<p>
The first Evil configuration I want to adjust to my liking is on <code>evil-goggles</code>. I understand Henrik (Doom's creator) has a good rational on why he setup <code>evil-goggles</code> the way it is, but I like the original design where <b>all</b> changes get the highlight treatment.
</p>

<p>
Also, I use <code>evil-cleverparens</code>, and its editing operations are not configured on <code>evil-goggles</code>, so, in order to make it work for me I have to do two things:
</p>

<ol class="org-ol">
<li>Re-enable the change feedback disabled by default on Doom;</li>
<li>Add all <code>evil-cleverparens</code> commands to the <code>evil-goggles--commands</code> to allow <code>evil-goggles</code> to handle changes from those commands as well.</li>
</ol>

<p>
I can perform those changes using <code>use-package</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 65: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> evil-goggles
  <span class="org-builtin">:hook</span> (doom-first-input . evil-goggles-mode)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setq</span> evil-goggles-duration 0.15
        evil-goggles-enable-delete t
        evil-goggles-enable-change t)

  (<span class="org-keyword">pushnew!</span> evil-goggles--commands
            '(evil-cp-delete
              <span class="org-builtin">:face</span> evil-goggles-delete-face
              <span class="org-builtin">:switch</span> evil-goggles-enable-delete
              <span class="org-builtin">:advice</span> evil-goggles--generic-blocking-advice)
            '(evil-cp-delete-line
              <span class="org-builtin">:face</span> evil-goggles-delete-face
              <span class="org-builtin">:switch</span> evil-goggles-enable-delete
              <span class="org-builtin">:advice</span> evil-goggles--delete-line-advice)
            '(evil-cp-delete-sexp
              <span class="org-builtin">:face</span> evil-goggles-delete-face
              <span class="org-builtin">:switch</span> evil-goggles-enable-delete
              <span class="org-builtin">:advice</span> evil-goggles--generic-blocking-advice)
            '(evil-cp-delete-enclosing
              <span class="org-builtin">:face</span> evil-goggles-delete-face
              <span class="org-builtin">:switch</span> evil-goggles-enable-delete
              <span class="org-builtin">:advice</span> evil-goggles--generic-blocking-advice)
            '(evil-cp-yank
              <span class="org-builtin">:face</span> evil-goggles-yank-face
              <span class="org-builtin">:switch</span> evil-goggles-enable-yank
              <span class="org-builtin">:advice</span> evil-goggles--generic-async-advice)
            '(evil-cp-yank-line
              <span class="org-builtin">:face</span> evil-goggles-yank-face
              <span class="org-builtin">:switch</span> evil-goggles-enable-yank
              <span class="org-builtin">:advice</span> evil-goggles--generic-async-advice)
            '(evil-cp-yank-sexp
              <span class="org-builtin">:face</span> evil-goggles-yank-face
              <span class="org-builtin">:switch</span> evil-goggles-enable-yank
              <span class="org-builtin">:advice</span> evil-goggles--generic-async-advice)
            '(evil-cp-yank-enclosing
              <span class="org-builtin">:face</span> evil-goggles-yank-face
              <span class="org-builtin">:switch</span> evil-goggles-enable-yank
              <span class="org-builtin">:advice</span> evil-goggles--generic-async-advice)
            '(evil-cp-change
              <span class="org-builtin">:face</span> evil-goggles-change-face
              <span class="org-builtin">:switch</span> evil-goggles-enable-change
              <span class="org-builtin">:advice</span> evil-goggles--generic-blocking-advice)
            '(evil-cp-change-line
              <span class="org-builtin">:face</span> evil-goggles-change-face
              <span class="org-builtin">:switch</span> evil-goggles-enable-change
              <span class="org-builtin">:advice</span> evil-goggles--generic-blocking-advice)
            '(evil-cp-change-sexp
              <span class="org-builtin">:face</span> evil-goggles-change-face
              <span class="org-builtin">:switch</span> evil-goggles-enable-change
              <span class="org-builtin">:advice</span> evil-goggles--generic-blocking-advice)
            '(evil-cp-change-enclosing
              <span class="org-builtin">:face</span> evil-goggles-change-face
              <span class="org-builtin">:switch</span> evil-goggles-enable-change
              <span class="org-builtin">:advice</span> evil-goggles--generic-blocking-advice)
            '(evil-paste-after
              <span class="org-builtin">:face</span> evil-goggles-paste-face
              <span class="org-builtin">:switch</span> evil-goggles-enable-paste
              <span class="org-builtin">:advice</span> evil-goggles--paste-advice
              <span class="org-builtin">:after</span> t)
            '(evil-cp-copy-paste-form
              <span class="org-builtin">:face</span> evil-goggles-paste-face
              <span class="org-builtin">:switch</span> evil-goggles-enable-paste
              <span class="org-builtin">:advice</span> evil-goggles--paste-advice
              <span class="org-builtin">:after</span> t)))
</pre>
</div>

<p>
After this I can sneak a quick modification to allow <code>evil-goggles</code> to use the same faces used on <code>diff</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 66: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> evil-goggles
  (evil-goggles-use-diff-refine-faces))
</pre>
</div>

<p>
The second configuration is regarding centralizing the cursor after search jumps. I find myself pretty uncomfortable after I press <code>n</code> following a search term, and I figured it out that what makes me uncomfortable is the fact the cursor is on the bottom of the screen, and I have almost no visibility of the text after it.
</p>

<p>
To fix this, I will add an advice after the Evil search function used to perform those jumps, to recenter the cursor on the window:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 67: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-center-after-jump-a (<span class="org-type">&amp;rest</span> _)
  <span class="org-builtin">:after</span> 'evil-ex-search
  (evil-scroll-line-to-center nil))
</pre>
</div>

<p>
And to make this behavior more consistent throughout the editor, I will add the same function used to advise <code>'evil-ex-search</code> as a hook to the <code>evil-jumps-post-jump-hook</code> hook:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 68: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> evil
  (add-hook 'evil-jumps-post-jump-hook #'my-center-after-jump-a))
</pre>
</div>

<p>
And finally, for the packages I'm missing, they are:
</p>

<ul class="org-ul">
<li><code>evil-matchit</code></li>
<li><code>plus-minus</code></li>
<li><code>evil-string-inflection</code></li>
</ul>
</div>

<div id="outline-container-org10d1e74" class="outline-4">
<h4 id="org10d1e74"><span class="section-number-4">3.1.1</span> Evil-MatchIt</h4>
<div class="outline-text-4" id="text-3-1-1">
<p>
In all fairness, <code>matchit</code> (the one originally from Vim) is also disabled by default, but it provides such useful feature that I can't understand why it is not part of the standard Vim/Evil.
</p>

<p>
To the reader not familiar with this plugin, let me give a brief overview of it. You probably know that pressing the key <code>%</code> on a pair character (e.g. <code>(</code>, <code>)</code>, <code>[</code>, <code>]</code>, etc.), makes the cursor jump to the other pair.
</p>

<p>
The <code>matchit</code> plugin, extends this functionality to other types of pairs, like XML/HTML tags, language control flows like <code>if</code>, <code>else</code>, and <code>endif</code>, and others. So, as I said, a pretty useful plugin!
</p>

<p>
Since <a href="https://github.com/redguardtoo/evil-matchit"><code>evil-matchit</code></a> is not distributed with Doom, I need to bring its package in:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 69: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> evil-matchit)
</pre>
</div>

<p>
Then, need to make sure to enable the plugin itself. In order to not slow the Emacs startup, I will enable it after I load the first file into a buffer:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 70: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> evil-matchit
  <span class="org-builtin">:hook</span> (doom-first-file . global-evil-matchit-mode)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> evilmi-quote-chars (string-to-list <span class="org-string">"'\"/"</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf5fe906" class="outline-4">
<h4 id="orgf5fe906"><span class="section-number-4">3.1.2</span> Plus-Minus</h4>
<div class="outline-text-4" id="text-3-1-2">
<p>
<a href="https://github.com/peterwu/plus-minus"><code>plus-minus</code></a> is a package that provides the functionality to increase or decrease a number value at point. On Vim, the key bindings for these actions are <code>C-a</code> and <code>C-x</code> respectively.
</p>

<p>
I spend too much time thinking that I should preserve the <code>C-x</code> keybinding for Emacs' sake, and I learn to use a command or two that uses it, but the reality is that I don't really need it, so I will give it a try on rebinding this key to its original Vim purpose, but instead of using <code>evil-numbers</code> (which Doom provides as a core package), I'll try a brand new package called <code>plus-minus</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 71: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> evil-numbers <span class="org-builtin">:disable</span> t)

(<span class="org-keyword">package!</span> plus-minus
  <span class="org-builtin">:recipe</span> (<span class="org-builtin">:host</span> github
           <span class="org-builtin">:repo</span> <span class="org-string">"peterwu/plus-minus"</span>))
</pre>
</div>

<p>
Since this package provides the correct <code>autoloads</code> on it, I can simply configure it to get deferred until I actually need it:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 72: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> plus-minus <span class="org-builtin">:defer</span> t)
</pre>
</div>

<p>
Before defining the keybindings for this I would like to have an extra behavior when I try to increase or decrease a number at point. I would like to rotate the text at point with the same keybinding if the <i>thing at point</i> is not a number.
</p>

<p>
Doom ships with the <code>rotate-text</code> package by default, but I need couple helper functions to define which package should handle the key press:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 73: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-inc-or-rotate-at-point</span> (arg)
  <span class="org-doc">"Try to rotate or increase the text at point.</span>

<span class="org-doc">If the thing under cursor is not rotated, tries to increase the number at</span>
<span class="org-doc">`</span><span class="org-doc"><span class="org-constant">point</span></span><span class="org-doc">' or the first number from `</span><span class="org-doc"><span class="org-constant">point</span></span><span class="org-doc">' to `</span><span class="org-doc"><span class="org-constant">point-at-eol</span></span><span class="org-doc">'.</span>

<span class="org-doc">When called with ARG (by using the universal prefix key) the search for a number</span>
<span class="org-doc">happens from `</span><span class="org-doc"><span class="org-constant">point</span></span><span class="org-doc">' to `</span><span class="org-doc"><span class="org-constant">point-at-bol</span></span><span class="org-doc">'."</span>
  (<span class="org-keyword">interactive</span> <span class="org-string">"p"</span>)
  (<span class="org-keyword">if</span> (thing-at-point 'number)
      (<span class="org-keyword">if</span> current-prefix-arg (+/-:backward+) (+/-:forward+))
    (<span class="org-keyword">condition-case</span> nil
        (rotate-text arg)
      ('error (<span class="org-keyword">if</span> current-prefix-arg (+/-:backward+) (+/-:forward+))))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 74: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-dec-or-rotate-at-point</span> (arg)
  <span class="org-doc">"Try to rotate or decrease the text at point.</span>

<span class="org-doc">If the thing under cursor is not rotated, tries to decrease the number at</span>
<span class="org-doc">`</span><span class="org-doc"><span class="org-constant">point</span></span><span class="org-doc">' or the first number from `</span><span class="org-doc"><span class="org-constant">point</span></span><span class="org-doc">' to `</span><span class="org-doc"><span class="org-constant">point-at-eol</span></span><span class="org-doc">'.</span>

<span class="org-doc">When called with ARG (by using the universal prefix key) the search for a number</span>
<span class="org-doc">happens from `</span><span class="org-doc"><span class="org-constant">point</span></span><span class="org-doc">' to `</span><span class="org-doc"><span class="org-constant">point-at-bol</span></span><span class="org-doc">'."</span>
  (<span class="org-keyword">interactive</span> <span class="org-string">"p"</span>)
  (<span class="org-keyword">if</span> (thing-at-point 'number)
      (<span class="org-keyword">if</span> current-prefix-arg (+/-:backward- 1) (+/-:forward- 1))
    (<span class="org-keyword">condition-case</span> nil
        (rotate-text arg)
      ('error (<span class="org-keyword">if</span> current-prefix-arg (+/-:backward- 1) (+/-:forward- 1))))))
</pre>
</div>

<p>
And I also like to define some extra words for rotation:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 75: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> rotate-text
  (add-to-list 'rotate-text-words '(<span class="org-string">"yes"</span> <span class="org-string">"no"</span>))
  (add-to-list 'rotate-text-words '(<span class="org-string">"allow"</span> <span class="org-string">"deny"</span>))
  (add-to-list 'rotate-text-words '(<span class="org-string">"allowed"</span> <span class="org-string">"denyed"</span>)))
</pre>
</div>

<p>
With all in place, we just need to define the keybindings:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 76: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map!
  <span class="org-builtin">:n</span> <span class="org-string">"C-a"</span> #'my-inc-or-rotate-at-point
  <span class="org-builtin">:n</span> <span class="org-string">"C-x"</span> #'my-dec-or-rotate-at-point
  (<span class="org-builtin">:prefix</span> <span class="org-string">"g"</span>
    <span class="org-builtin">:desc</span> <span class="org-string">"Inc sequence"</span> <span class="org-builtin">:v</span> <span class="org-string">"="</span> #'+/-:block+
    <span class="org-builtin">:desc</span> <span class="org-string">"Dec sequence"</span> <span class="org-builtin">:v</span> <span class="org-string">"-"</span> #'+/-:block-
    <span class="org-builtin">:desc</span> <span class="org-string">"Inc sequence"</span> <span class="org-builtin">:n</span> <span class="org-string">"="</span> #'my-inc-or-rotate-at-point
    <span class="org-builtin">:desc</span> <span class="org-string">"Dec sequence"</span> <span class="org-builtin">:v</span> <span class="org-string">"-"</span> #'my-dec-or-rotate-at-point))
</pre>
</div>

<p>
In order to allow me to repeat the last increase or decrease, I will define a <i>repeatable map</i> for my custom increase and decrease functions:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 77: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(my-repeat-map! my-inc-or-rotate-repeat-map
                '((my-inc-or-rotate-at-point . <span class="org-string">"="</span>)
                  (my-dec-or-rotate-at-point . <span class="org-string">"-"</span>))
                <span class="org-string">"Keymap to repeat the last number increase or decrease."</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb416a34" class="outline-4">
<h4 id="orgb416a34"><span class="section-number-4">3.1.3</span> Evil-String-Inflection</h4>
<div class="outline-text-4" id="text-3-1-3">
<p>
I've been on situations where I realized that I used <i>camelCase</i> for all my variables, where the standard coding style of the language, request to use <i>snake<sub>case</sub></i> style. There are packages available, that allow you to cycle through all case styles on a given word.
</p>

<p>
I found the <a href="https://github.com/akicho8/string-inflection"><code>string-inflection</code></a> package to be one of the best available. There is the package <a href="https://github.com/ninrod/evil-string-inflection"><code>evil-string-inflection</code> </a>to integrate with Evil but it turns out to not work as expected, so I will have to configure Evil integration myself. Let's start with the package itself:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 78: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> string-inflection)
</pre>
</div>

<p>
As with the <code>matchit</code> package, I'll defer its loading until we need it, but different from <code>matchit</code>, I have to defer it using an alternative approach. I will make the package load on the first invocation of one of its main commands:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 79: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> string-inflection
  <span class="org-builtin">:commands</span> (string-inflection-all-cycle
             string-inflection-toggle
             string-inflection-camelcase
             string-inflection-lower-camelcase
             string-inflection-kebab-case
             string-inflection-underscore
             string-inflection-capital-underscore
             string-inflection-upcase))
</pre>
</div>

<p>
I want to have a rich set of mappings for this package, so I will add one key for each inflection plus a toggle and a cycle:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 80: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:leader</span> <span class="org-builtin">:prefix</span> (<span class="org-string">"g~"</span> . <span class="org-string">"string inflection"</span>)
      <span class="org-builtin">:desc</span> <span class="org-string">"cycle"</span> <span class="org-string">"~"</span> #'string-inflection-all-cycle
      <span class="org-builtin">:desc</span> <span class="org-string">"toggle"</span> <span class="org-string">"t"</span> #'string-inflection-toggle
      <span class="org-builtin">:desc</span> <span class="org-string">"CamelCase"</span> <span class="org-string">"c"</span> #'string-inflection-camelcase
      <span class="org-builtin">:desc</span> <span class="org-string">"downCase"</span> <span class="org-string">"d"</span> #'string-inflection-lower-camelcase
      <span class="org-builtin">:desc</span> <span class="org-string">"kebab-case"</span> <span class="org-string">"k"</span> #'string-inflection-kebab-case
      <span class="org-builtin">:desc</span> <span class="org-string">"under_score"</span> <span class="org-string">"_"</span> #'string-inflection-underscore
      <span class="org-builtin">:desc</span> <span class="org-string">"Upper_Score"</span> <span class="org-string">"u"</span> #'string-inflection-capital-underscore
      <span class="org-builtin">:desc</span> <span class="org-string">"UP_CASE"</span> <span class="org-string">"U"</span> #'string-inflection-upcase)
</pre>
</div>

<p>
In order to create a nicer workflow, I want to access the previous shortcuts by pressing the same key after the initial inflection. For instance, I want to press <code>SPC g ~</code> to start the inflection, and keep pressing just <code>~</code> to cycle through all of the other inflections.
</p>

<p>
To achieve this behavior I will use the <code>my-repeat-map!</code> macro introduced on the section <a href="#orgdf1427a">2.2.10</a>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 81: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(my-repeat-map! my-string-inflection-repeat-map
                '((string-inflection-all-cycle . <span class="org-string">"~"</span>)
                  (string-inflection-toggle . <span class="org-string">"t"</span>)
                  (string-inflection-camelcase . <span class="org-string">"c"</span>)
                  (string-inflection-lower-camelcase . <span class="org-string">"d"</span>)
                  (string-inflection-kebab-case . <span class="org-string">"k"</span>)
                  (string-inflection-underscore . <span class="org-string">"_"</span>)
                  (string-inflection-capital-underscore . <span class="org-string">"u"</span>)
                  (string-inflection-upcase . <span class="org-string">"U"</span>))
                <span class="org-string">"Keymap to repease the last string inflection."</span>)
</pre>
</div>

<p>
To make <code>string-inflection</code> to work nice with Evil, I will create an <i>Evil operator</i> to allow me to change the string inflection of a target text object:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 82: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> evil
  (evil-define-operator my-evil-operator-string-inflection (beg end _type)
    <span class="org-string">"Define a new evil operator that cicles underscore -&gt; UPCASE -&gt; CamelCase."</span>
    <span class="org-builtin">:move-point</span> nil
    (<span class="org-keyword">interactive</span> <span class="org-string">"&lt;R&gt;"</span>)
    (string-inflection-all-cycle)
    (<span class="org-keyword">setq</span> evil-repeat-info (list [?g ?~])))

  (define-key evil-normal-state-map (kbd <span class="org-string">"g~"</span>) 'my-evil-operator-string-inflection))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5f335dc" class="outline-3">
<h3 id="org5f335dc"><span class="section-number-3">3.2</span> Keybindings</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Since I decided to write this configuration, I also decided to try to use the standard Doom key bindings as much as possible, and for the most part of it, I'm not having as much problem as I expected. There are three main areas where I still like to define my own bindings.
</p>
</div>

<div id="outline-container-orgd770d21" class="outline-4">
<h4 id="orgd770d21"><span class="section-number-4">3.2.1</span> Window navigation</h4>
<div class="outline-text-4" id="text-3-2-1">
<p>
A while ago, I configured Vim to move the cursor from one window to another using the standard movements keys (<code>h</code>, <code>j</code>, <code>k</code>, and <code>l</code>) while keeping <code>Ctrl</code> pressed. I got so used to these shortcuts, that I can't live without it anymore.
</p>

<p>
The good news is that, on most cases, there is no conflict between features I use and these shortcuts, and on the cases that a conflict exists, there are reasonable options to workaround these limitations.
</p>

<p>
The first step to achieve a global is to clean the target keys from any keymap that might bind them to a command:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 83: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map!
 (<span class="org-builtin">:after</span> outline
  (<span class="org-builtin">:map</span> outline-mode-map
   <span class="org-builtin">:gn</span> <span class="org-string">"C-h"</span> nil
   <span class="org-builtin">:gn</span> <span class="org-string">"C-j"</span> nil
   <span class="org-builtin">:gn</span> <span class="org-string">"C-k"</span> nil
   <span class="org-builtin">:gn</span> <span class="org-string">"C-l"</span> nil)))
</pre>
</div>

<p>
After that, I can bind these keys to the target window movements to the proper window commands:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 84: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map!
  <span class="org-builtin">:gn</span> <span class="org-string">"C-h"</span> #'evil-window-left
  <span class="org-builtin">:gn</span> <span class="org-string">"C-j"</span> #'evil-window-down
  <span class="org-builtin">:gn</span> <span class="org-string">"C-k"</span> #'evil-window-up
  <span class="org-builtin">:gn</span> <span class="org-string">"C-l"</span> #'evil-window-right)
</pre>
</div>

<p>
Some other modes don't play nice with this particular key bindings I choose, and I have to adjust them accordingly. This is the case of the <code>Info-mode</code>, where <code>C-j</code> and <code>C-k</code> are the keys to navigate forward and backwards on nodes. The solution for me is to bind those commands to other keys, and configure the proper window navigation:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 85: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:after</span> info
      <span class="org-builtin">:map</span> Info-mode-map
      <span class="org-builtin">:gn</span> <span class="org-string">"s-k"</span> #'Info-backward-node
      <span class="org-builtin">:gn</span> <span class="org-string">"s-j"</span> #'Info-forward-node
      <span class="org-builtin">:gn</span> <span class="org-string">"C-k"</span> #'evil-window-up
      <span class="org-builtin">:gn</span> <span class="org-string">"C-j"</span> #'evil-window-down)
</pre>
</div>
</div>
</div>

<div id="outline-container-org3bb0667" class="outline-4">
<h4 id="org3bb0667"><span class="section-number-4">3.2.2</span> Vim defaults</h4>
<div class="outline-text-4" id="text-3-2-2">
<p>
Here I need to make yet another disclaimer to the reader: I know what I'm about to write is a pet peeve, and most likely most Doom users won't even understand this, but&#x2026;
</p>

<p>
On Doom, there are these keymaps bound to <code>&lt;leader&gt; w ...</code>, that should match Vim's <code>&lt;C-w&gt; &lt;C-...&gt;</code>. Since the <i>leader shortcuts</i> are more ergonomic for me, I got used to them quickly. The problem I have, is the difference between <code>&lt;C-w&gt; &lt;C-o&gt;</code> and <code>&lt;leader&gt; w o</code>!
</p>

<p>
To not lose a Doom-only keymap, instead of simply rebinding <code>&lt;leader&gt; w o</code> to the <i>correct</i> command, I'll <i>move</i> <code>doom/window-enlargen</code> to a different keymap (<code>&lt;leader&gt; w z</code> to represent <i>zoom window</i>), and assign the <i>correct</i> command to the <i>correct</i> keymap:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 86: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:leader</span> <span class="org-builtin">:prefix</span> (<span class="org-string">"w"</span> . <span class="org-string">"window"</span>)
      <span class="org-builtin">:desc</span> <span class="org-string">"Enlarge window"</span>         <span class="org-builtin">:n</span> <span class="org-string">"z"</span> #'doom/window-enlargen
      <span class="org-builtin">:desc</span> <span class="org-string">"Select window"</span>          <span class="org-builtin">:n</span> <span class="org-string">"o"</span> #'delete-other-windows)
</pre>
</div>
</div>
</div>

<div id="outline-container-org327ef8e" class="outline-4">
<h4 id="org327ef8e"><span class="section-number-4">3.2.3</span> Personal shortcuts</h4>
<div class="outline-text-4" id="text-3-2-3">
<p>
Key bindings in this section are purely personal choice. Feel free to give them a try if you want, but if you're used to Doom Emacs already, my suggestion is to skip this section.
</p>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
The first keymap group I like to add custom shortcuts is the multiple cursors. When I first heard about multiple cursors, was on a demo of the <a href="https://macromates.com/">TextMate</a> editor. I got so impressed by it that this feature was one of the first things I would search on an editor. Fast forwarding to January 2008, I was watching yet another demo of a brand new editor, when the person showing off the features, demonstrated the multiple cursors. This editor was <a href="https://www.sublimetext.com">Sublime Text</a>, and I couldn't resist the chance to give it a try. For reasons of the brain (at least my brain), the shortcuts defined to manipulate multiple cursors got engraved in my memory, and recently, I decide to stop fighting against it and embrace! So these are the shortcuts (which might be different from the current shortcuts in Sublime) that I got <i>used to</i>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 87: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map!
 <span class="org-builtin">:gn</span> <span class="org-string">"s-d"</span> #'evil-mc-make-and-goto-next-match
 <span class="org-builtin">:gn</span> <span class="org-string">"s-u"</span> #'evil-mc-skip-and-goto-prev-cursor
 <span class="org-builtin">:gn</span> <span class="org-string">"s-n"</span> #'evil-mc-skip-and-goto-next-match
 <span class="org-builtin">:gn</span> <span class="org-string">"s-g"</span> #'evil-mc-make-all-cursors
 <span class="org-builtin">:gn</span> <span class="org-string">"C-M-k"</span> #'evil-mc-make-cursor-move-prev-line
 <span class="org-builtin">:gn</span> <span class="org-string">"C-M-j"</span> #'evil-mc-make-cursor-move-next-line)
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
Another <i>nice to have</i> binding I got used to, is to move blocks of text up and down, using <code>j</code> and <code>k</code>, plus the <code>Meta</code> (a.k.a. <code>Alt</code>, <code>option</code>, or  <code>⌥</code>):
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 88: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:nvi</span> <span class="org-string">"M-j"</span> #'drag-stuff-down
      <span class="org-builtin">:nvi</span> <span class="org-string">"M-k"</span> #'drag-stuff-up)
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
Something that I really like but usually forget to use is the ability to insert a new line while on <i>insert mode,</i> above or bellow the current line, regardless where the cursor is. To use it, I would simply press <code>&lt;ENTER&gt;</code> with <code>&lt;SUPER&gt;</code> (a.k.a. <code>cmd</code> or <code>⌘</code>) to insert a line bellow, or <code>&lt;ENTER&gt;</code> plus <code>&lt;SHIFT&gt;</code> and <code>&lt;SUPER&gt;</code> for a line above:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 89: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:i</span> [s-return]   #'+default/newline-below
      <span class="org-builtin">:i</span> [s-S-return] #'+default/newline-above
      (<span class="org-builtin">:when</span> IS-MAC
         <span class="org-builtin">:gn</span> <span class="org-string">"s-RET"</span>        nil
         <span class="org-builtin">:gn</span> [s-return]     nil
         <span class="org-builtin">:gn</span> <span class="org-string">"S-s-RET"</span>      nil
         <span class="org-builtin">:gn</span> [S-s-return]   nil))
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
Doom Emacs, offer a shortcut to bring back the last dismissed popup, which is what I want to do on the majority of the cases. But some times, I want to bring back a specific popup buffer to the front, and I like to have a dedicated prefix key to handle this scenario.
</p>

<p>
For now, I set a shortcut for the <code>*Messages*</code>, and the <code>*Backtrace*</code> buffers, but more popup buffer might get added here in the future:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 90: </span>config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:leader</span> <span class="org-builtin">:prefix</span> (<span class="org-string">"v"</span> . <span class="org-string">"view"</span>)
      <span class="org-builtin">:desc</span> <span class="org-string">"View Messages"</span> <span class="org-builtin">:n</span> <span class="org-string">"m"</span> #'(lambda ()
                                       (<span class="org-keyword">interactive</span>)
                                       (pop-to-buffer <span class="org-string">"*Messages*"</span>)
                                        (goto-char (point-max)))
      <span class="org-builtin">:desc</span> <span class="org-string">"View Backtrace"</span> <span class="org-builtin">:n</span> <span class="org-string">"e"</span> #'(lambda ()
                                        (<span class="org-keyword">interactive</span>)
                                        (pop-to-buffer <span class="org-string">"*Backtrace*"</span>)))
</pre>
</div>

<p>
As you can see, I also like to <i>scroll to the bottom</i> of the buffer when opening messages. The rational behind it is the fact that if I want to quick loo into the <code>*Messages*</code> buffer, is most likely to check the latest messages there.
</p>

<p>
Also for the <code>*Messages*</code> buffer, I like to be able to press <code>q</code> to quit as well. Unfortunately this is not defined by default:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 91: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:map</span> messages-buffer-mode-map
      <span class="org-builtin">:n</span> <span class="org-string">"q"</span> #'delete-window)
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
One binding I feel is missing on Doom, is the ability to evaluate any sexp on <b>any</b> mode, like a <i>global</i> <code>eval-last-sexp</code>. Gladly, it's easy enough to create my own:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 92: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:prefix</span> <span class="org-string">"g"</span>
      <span class="org-builtin">:desc</span> <span class="org-string">"Eval last sexp"</span> <span class="org-builtin">:n</span> <span class="org-string">")"</span> #'eval-last-sexp)
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
I don't remember when this shortcut entered my life, but some time ago I got used to use <code>s-RET</code> to <i>confirm operations</i> like sending emails and messages. In order to try to replicate this behavior I will start setting it to the <code>with-editor-mode-map</code> together with the analog cancel operation with <code>s-ESC</code> shortcut:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 93: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:map</span> with-editor-mode-map
      <span class="org-builtin">:in</span> [s-return] #'with-editor-finish
      <span class="org-builtin">:in</span> [s-escape] #'with-editor-cancel)
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
Doom ships with the <i>Rainbow Mode</i> package, which is a package that colorizes strings that represent colors. Usually there is no need to enable this mode globally because the colorization might get in the way of legibility, but on the cases where it is useful (e.g. editing CSS or Android XML files), it is <b>really</b> useful.
</p>

<p>
Because of this, I want to set this mode as a toggable shortcut:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 94: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:leader</span> <span class="org-builtin">:prefix</span> (<span class="org-string">"t"</span> . <span class="org-string">"toggle"</span>)
      <span class="org-builtin">:desc</span> <span class="org-string">"Rainbow mode"</span> <span class="org-builtin">:mvn</span> <span class="org-string">"R"</span> #'rainbow-mode)
</pre>
</div>
</div>
</div>

<div id="outline-container-org7706e21" class="outline-4">
<h4 id="org7706e21"><span class="section-number-4">3.2.4</span> Repeatable shortcuts</h4>
<div class="outline-text-4" id="text-3-2-4">
<p>
Due to the nature of modal edit, some shortcuts need more than one key press to activate. This is usually fine until we try an action designed to repeat (e.g. side scroll and window resizing). This section will use the <code>my-repeat-map!</code> macro defined on the <a href="#orgdf1427a">2.2.10</a> sections to make these actions more ergonomic.
</p>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
The first candidate for a repeatable pattern is window resizing. On Vim (and also Evil) for instance, the key binding to increase height is <code>C-w +</code>. Doom makes this a little bit better by making all key bindings from <code>C-w</code> accessible with the prefix <code>SPC w</code>, but still, adjusting the size of a window with multiple key strokes like this, is a bad experience.
</p>

<p>
We can make the window resizing commands safe to repeat, which would allow us to repeat the last resizing with the <code>.</code> repeat operator. The problem with this approach, is the fact that we can <i>change directions</i> when repeating the resize. For instance, if we are increasing the height of a window and we press the <code>.</code> couple more times we wanted, to decrease its size, we would have to start over with the decrease command and pay attention to not get it wrong this time.
</p>

<p>
To avoid this issue, I will define a <i>repeatable map</i> for resizing, and because this is a separate map from the normal window map, I can add couple extra keys there to make the operation even smoother, for instance, we can increase the window height with <code>+</code> or with the <code>=</code> key
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 95: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(my-repeat-map! my-window-resize-repeat-map
                '((evil-window-increase-height . <span class="org-string">"+"</span>)
                  (evil-window-increase-height . <span class="org-string">"="</span>)
                  (evil-window-decrease-height . <span class="org-string">"-"</span>)
                  (evil-window-decrease-height . <span class="org-string">"_"</span>)
                  (evil-window-increase-width . <span class="org-string">"&gt;"</span>)
                  (evil-window-decrease-width . <span class="org-string">"&lt;"</span>))
                <span class="org-string">"Repeatable map for window resizing"</span>)
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
Sometimes you're editing a buffer on a window that requires you to scroll to the right and left to read its content. You can achieve that by pressing <code>z l</code> to scroll to the right, and <code>z h</code> to scroll to the left. While this is ok, besides enabling to repeat this motion with just an <code>l</code> or an <code>h</code> after the initial scroll, I also want to jump longer distances (the default is to move one character on each <code>z l</code> or <code>z h</code> shortcuts). To jump more than one character, I need to create a wrapper function that passes a bigger number to the <code>evil-scroll-column-right</code> or <code>evil-scroll-column-left</code> functions:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 96: </span>autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-big-scroll-column-right</span> ()
  <span class="org-doc">"Wrapper for the `</span><span class="org-doc"><span class="org-constant">evil-scroll-column-right</span></span><span class="org-doc">' that passes 10 as the jump size."</span>
  (<span class="org-keyword">interactive</span>)
  (evil-scroll-column-right 10))

<span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-big-scroll-column-left</span> ()
  <span class="org-doc">"Wrapper for the `</span><span class="org-doc"><span class="org-constant">evil-scroll-column-left</span></span><span class="org-doc">' that passes 10 as the jump size."</span>
  (<span class="org-keyword">interactive</span>)
  (evil-scroll-column-left 10))
</pre>
</div>

<p>
And with those helper functions I can define the proper <i>repeatable map</i> for side scrolling:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 97: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(my-repeat-map! my-side-scrolling-repeat-map
                '((evil-scroll-column-right . <span class="org-string">"l"</span>)
                  (my-big-scroll-column-right . <span class="org-string">"L"</span>)
                  (evil-scroll-column-left . <span class="org-string">"h"</span>)
                  (my-big-scroll-column-left . <span class="org-string">"H"</span>))
                <span class="org-string">"Repeatable map to scroll the buffer left or right."</span>)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org127970e" class="outline-3">
<h3 id="org127970e"><span class="section-number-3">3.3</span> Appearances</h3>
<div class="outline-text-3" id="text-3-3">
<p>
As far as I understand, there is a share of Emacs users that value Emacs functionalities over its looks, and I would like to write something targeted for those users.
</p>

<p>
You are awesome! I can't imagine how liberating it would feel if my brain did not obsessed about my editor's appearance, so, stay strong folks! The breakthroughs on technology happens more often by the desired of people like you then people like me.
</p>

<p>
With that out of the way, I need to explain to the reader my personal position on this subject. As a person with <a href="https://en.wikipedia.org/wiki/Attention_deficit_hyperactivity_disorder">ADHD</a> and <a href="https://en.wikipedia.org/wiki/Obsessive%E2%80%93compulsive_disorder">OCD</a>.
</p>

<p>
Looks mater. There is not much else to say, but if you need a bit more let me say this: When your brain is constantly searching for dopamine, and is incapable to retain it for much longer, every tinny rewarding counts towards the goal to keep my focus on one subject. If my work environment is pleasing to look, there is a lower chance my brain gets distracted by the scene outside the window. If I open my editor and get the feeling of <i>"oh yeah"</i>, than my brain will look forward to use the same tool again, or as I saw on this <a href="https://twitter.com/ADHDelaide/status/1326412306079682560">tweet</a> a while ago, and reproduce it here for you:
</p>

<blockquote>
<p>
❝ Having <b>ADHD</b> is basically finding new ways to trick your brain into doing the stuff you want it to do, until you die. ❞
─ <b>@ADHDelaide</b>
</p>
</blockquote>

<p>
Nevertheless, keep in mind that taste, is a personal thing. What I consider to be beautiful, might look horrendous to the reader, and that is OK.
</p>

<p>
So, if you're happy with the look and feel of your editor, feel free to skip this entire section.
</p>
</div>

<div id="outline-container-org3f5a855" class="outline-4">
<h4 id="org3f5a855"><span class="section-number-4">3.3.1</span> Frame</h4>
<div class="outline-text-4" id="text-3-3-1">
<p>
The Emacs frame is the container for my small world, and although I intend to do most of my things within Emacs, I still want it to look like it belongs to its environment (macOS in my case), and there are couple things I like to change to make it more macOS.
</p>

<p>
The first one is to remove the text from the title bar. On macOS, the application name is present on the system menu, so there is no reason to keep any text on the title bar:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 98: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> frame-title-format nil
      ns-use-proxy-icon nil)
</pre>
</div>

<p>
And the second one, is to make the title bar to have the same color as the background of my selected theme:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 99: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(add-to-list 'default-frame-alist '(ns-transparent-titlebar . t))
</pre>
</div>
</div>
</div>

<div id="outline-container-org97423b1" class="outline-4">
<h4 id="org97423b1"><span class="section-number-4">3.3.2</span> Editor</h4>
<div class="outline-text-4" id="text-3-3-2">
<p>
The first thing to do to help with my editor appearance, is to store the current line height in a variable. This way, other adjustments can use this value without worrying about different font sizes:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 100: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">my-line-pixel-height</span> (line-pixel-height)
  <span class="org-doc">"Line height in pixels.</span>

<span class="org-doc">Used to avoid getting the wrong line height when `</span><span class="org-doc"><span class="org-constant">text-scale-mode</span></span><span class="org-doc">' is active."</span>)
</pre>
</div>

<p>
One editor visual I like to have while I'm coding, is the <code>fill-column-indicator</code>. Unfortunately I discovered that on macOS, the default <code>fill-column-indicator</code> face, can't render Unicode characters properly. The workaround here is to make this particular face to use a font that can render them:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 101: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(set-face-attribute 'fill-column-indicator nil
                    <span class="org-builtin">:font</span> <span class="org-string">"Arial Unicode MS"</span>
                    <span class="org-builtin">:height</span> 140
                    <span class="org-builtin">:foreground</span> (doom-color 'base3 256))
</pre>
</div>

<p>
Using <i>Arial Unicode MS</i> allow me to use the "<code>┊</code>" character to decorate my <code>prog-mode</code> buffers. After setting this up, I need to adjust the <code>fill-column</code> value to the column I want (while is usually 100),  and make the column indicator use the correct Unicode character (which is <code>0x9482</code>):
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 102: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq-default</span> fill-column 100
              display-fill-column-indicator-column 100
              display-fill-column-indicator-character 9482)
</pre>
</div>

<p>
After this configuration I want to make sure the column indicator is off by default:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 103: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(global-hl-line-mode -1)
</pre>
</div>

<p>
And enabled on all <code>prog-mode</code> buffers:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 104: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(add-hook 'prog-mode-hook 'display-fill-column-indicator-mode)
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
As with column indicator, there is another visual that I consider crucial for programming, but a bit annoying when writing prose: The current line highlight.
</p>

<p>
I can't imagine coding without it, but when I'm writing, it becomes more a distraction then an aid.
</p>

<p>
On Doom, to make sure current line highlight gets disabled, you need to remove its global mode from the <code>doom-first-buffer-hook</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 105: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(remove-hook 'doom-first-buffer-hook 'global-hl-line-mode)
</pre>
</div>

<p>
Then, I can add the mode to all <code>prog-mode</code> buffers with another hook:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 106: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(add-hook 'prog-mode-hook 'hl-line-mode)
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
Another extra for the editor visuals is rendering the character <code>^L</code>, which represents a page break (more precisely, the <i>form feed</i> character).
</p>

<p>
The page break character is consider a <i>space</i> or <i>empty</i> character, which allows one to add it on a coding file without breaking the build for such file.
</p>

<p>
There are a couple packages that achieve this goal but I set on the <a href="https://github.com/purcell/page-break-lines"><code>page-break-lines</code></a> from <a href="https://github.com/purcell">Steve Purcell</a> because he chose to implement this feature using glyph composition instead of <i>font-lock</i>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 107: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> page-break-lines)
</pre>
</div>

<p>
There is just one configuration I prefer to change over the defaults, which is the size of thee horizontal line. I like the horizontal like to stop at the <code>fill-column</code> column, which gives this nice <i>box feeling</i> to the code.
</p>

<p>
Besides this change, I only enable the mode on <code>prog-mode</code> buffers, and I like to define a shortcut key to jump to the next or previous page break:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 108: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> page-break-lines
  <span class="org-builtin">:hook</span> ((prog-mode . page-break-lines-mode))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> page-break-lines-max-width fill-column)

  (map! <span class="org-builtin">:prefix</span> <span class="org-string">"g"</span>
        <span class="org-builtin">:desc</span> <span class="org-string">"Prev page break"</span> <span class="org-builtin">:nv</span> <span class="org-string">"["</span> #'backward-page
        <span class="org-builtin">:desc</span> <span class="org-string">"Next page break"</span> <span class="org-builtin">:nv</span> <span class="org-string">"]"</span> #'forward-page))
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
Since the time when widescreen monitors became the standard, when it comes to split windows in two, I prefer horizontal splits (one window aside of the other). In order to tell Emacs that I prefer horizontal splits, I have to set the width split threshold to a small number to add weight on Emacs' decision of which orientation to split:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 109: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> split-width-threshold 40)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf819a0c" class="outline-4">
<h4 id="orgf819a0c"><span class="section-number-4">3.3.3</span> Theme</h4>
<div class="outline-text-4" id="text-3-3-3">
<p>
I believe this section to be the most volatile section on this text. Since I got interested on cool old esoteric editors, I'm on an endless search for the Holy Grail of themes. So far I got fond of Tomorrow Night and I use it for the most part of the last 5 years. Recently I got annoyed by some color choices of the theme (the background and line highlight are a bit odd in my opinion), so I kept looking.
</p>

<p>
I decided to give <i>Doom-One</i> a try, and so far I'm enjoying. I will admit that the purple-ish feeling of the palette is not my style, but overall, I'm not finding a bed choice.
</p>

<p>
So, to make <i>Doom-One</i> the default theme, set the variable <code>doom-theme</code> to the symbol <code>'doom-one</code> to let Doom know what is the theme it should load:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 110: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> doom-theme 'doom-one)
</pre>
</div>

<p>
And because I like visual cues on my editor, I will turn on the ability to display <b>bold</b> and <i>italic</i> faces for the theme:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 111: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> doom-themes-enable-bold t
      doom-themes-enable-italic t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc7e6151" class="outline-4">
<h4 id="orgc7e6151"><span class="section-number-4">3.3.4</span> Typography</h4>
<div class="outline-text-4" id="text-3-3-4">
<p>
This section requires an important disclaimer to the reader. In majority of the cases, one should not <i>need</i> to customize their fonts the way I'm doing it. Doom Emacs has a system to configure the editor fonts, and one should prefer to use such systems instead of this particular configuration.
</p>

<p>
Doom exposes five (optional) variables for controlling fonts:
</p>

<dl class="org-dl">
<dt><code>doom-font</code></dt><dd>The global font used by Emacs;</dd>
<dt><code>doom-big-font</code></dt><dd>Used for <code>doom-big-font-mode</code>, which you can use for presentations or streaming;</dd>
<dt><code>doom-variable-pitch-font</code></dt><dd>Font used for prose text (if you configure such modes to accept variable pitch fonts);</dd>
<dt><code>doom-serif-font</code></dt><dd>The default font to use for the fixed-pitch-serif face;</dd>
<dt><code>doom-unicode-font</code></dt><dd>Fallback font for Unicode glyphs;</dd>
</dl>

<p>
They all accept either a font-spec, a font string (e.g. "Input Mono-12"), or a <code>xlfd</code> font string. You generally only need <code>doom-font</code> and <code>doom-variable-pitch-font</code>, but I like to set <code>doom-big-font</code> as well, to make sure any time I switch to a presentation mode, it still feels like I have the same editor, but with a bigger font.
</p>

<p>
With that out of the way, I need to explain what is, and why my <i>typography</i> configuration exists.
</p>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
In the past years, I've got involved in some projects where I worked directly with the UX team on visual identity tasks. One of the first thing I got used to do, is to define the typography of the project. But what is typography? According to the wikipedia:
</p>

<blockquote>
<p>
<b>Typography</b> is the art and technique of arranging type to make written language legible, readable and appealing when displayed.
</p>
</blockquote>

<p>
In the case of my configuration, I can define typography as a set of rules regarding displayed text that I want to use regardless the mode Emacs is in. Or simply put:
</p>

<p>
Text in my editor must be consistent, and look good.
</p>

<p>
To achieve this, I have to define said rules, and create a mechanism that will help me get the editor to behave the way I want. The one exception are the colors used on text elements. I want to let this particular trait to the theme I'm using.
</p>

<p>
The first rule to define is the simplest one: which fonts to use throughout the editor.
</p>

<p>
Currently, I narrowed my selection to these 3 fonts:
</p>

<dl class="org-dl">
<dt><a href="https://github.com/iaolo/iA-Fonts">iA Writer Mono</a></dt><dd>Used as my default monospaced font. The actual font I'm using is the <a href="https://www.nerdfonts.com/">Nerd Fonts</a> version, known as <i>"iMWritingMonoS Nerd Font"</i> due to its support for the <code>all-the-icons</code> package;</dd>
<dt><a href="https://github.com/iaolo/iA-Fonts">iA Writer Quattro</a></dt><dd>Used as my default font for prose writing. For this font in particular, I can't use the Nerd Fonts version, nor the version distributed through <a href="https://brew.sh/">Homebrew</a>. These versions, use the static version of the font that does not support different weights. For my configuration I use the <a href="https://github.com/iaolo/iA-Fonts/tree/master/iA%20Writer%20Quattro/Variable">Veriable</a> version of the font;</dd>
<dt><a href="https://github.com/googlefonts/roboto">Roboto</a></dt><dd>Used on UI elements like the project drawer, tab names, and tooltips;</dd>
</dl>

<p>
To install the <a href="https://github.com/iaolo/iA-Fonts">iA Writer Mono</a> and the <a href="https://github.com/googlefonts/roboto">Roboto</a>, one can use <a href="https://brew.sh/">Homebrew</a> on macOS:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 112: </span>Commands to install fonts with Homebrew</label><pre class="src src-shell">brew tap homebrew/cask-fonts
brew install --cask font-roboto font-im-writing-nerd-font
</pre>
</div>

<p>
But for the <a href="https://github.com/iaolo/iA-Fonts">iA Writer Quattro</a> you have to use to install it manually because the version offered by Homebrew is the static version of the font, which does not come with all the weights available. The correct font to install here is the <i>variable</i> type.
</p>

<p>
To install the correct font, first download it using <code>curl</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 113: </span>Commands to download the iA Writer font</label><pre class="src src-shell"><span class="org-builtin">cd</span> ~/Downloads &amp;&amp; {
 curl -O <span class="org-string">'https://github.com/iaolo/iA-Fonts/raw/master/iA%20Writer%20Quattro/Variable/iAWriterQuattroV.ttf'</span>
 curl -O <span class="org-string">'https://github.com/iaolo/iA-Fonts/raw/master/iA%20Writer%20Quattro/Variable/iAWriterQuattroV-Italic.ttf'</span>
 <span class="org-builtin">cd</span> -
}
</pre>
</div>

<p>
Then, run the following AppleScript to perform the installation:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 114: </span>Apple Script used to install iA Writer fonts</label><pre class="src src-shell">osascript &lt;&lt;<span class="org-string">'END'</span>
<span class="org-sh-heredoc">  set theDownloadsFolder to get path to Downloads folder</span>
<span class="org-sh-heredoc">  tell application "Finder"</span>
<span class="org-sh-heredoc">    set allFonts to every file of theDownloadsFolder whose name starts with "iAWriterQuattroV"</span>
<span class="org-sh-heredoc">  end tell</span>

<span class="org-sh-heredoc">  repeat with theFont in allFonts</span>
<span class="org-sh-heredoc">    tell application "Finder"</span>
<span class="org-sh-heredoc">        open theFont</span>
<span class="org-sh-heredoc">    end tell</span>

<span class="org-sh-heredoc">    tell application "Font Book"</span>
<span class="org-sh-heredoc">        activate</span>
<span class="org-sh-heredoc">        set theFontWindow to the first window</span>
<span class="org-sh-heredoc">    end tell</span>

<span class="org-sh-heredoc">    tell application "System Events"</span>
<span class="org-sh-heredoc">        tell process "Font Book"</span>
<span class="org-sh-heredoc">            tell window 1</span>
<span class="org-sh-heredoc">                tell group 1</span>
<span class="org-sh-heredoc">                    click button "Install Font"</span>
<span class="org-sh-heredoc">                end tell</span>
<span class="org-sh-heredoc">            end tell</span>
<span class="org-sh-heredoc">        end tell</span>
<span class="org-sh-heredoc">    end tell</span>
<span class="org-sh-heredoc">  end repeat</span>
<span class="org-sh-heredoc">END</span>
</pre>
</div>

<p>
The rest of the rules are more subjective, and in all honesty, the methodology I used to decide which slant, and weight to use to each one of the text elements is non existent. I simply tried, checked how it looked, and asked myself, <i>"Is this a nice looking element?"</i>. If the answer was yes, I kept the configuration.
</p>

<p>
For the size, I started with the headline level 1 and configure it to be as big as it could be without looking disproportional to the text. Then, I reduced the size for the next level gradually until I get to the 8<sup>th</sup> one, guaranteeing that it would not be smaller than the normal font size.
</p>

<p>
In practice, this means:
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-right">

<col  class="org-right">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Headline Level</th>
<th scope="col" class="org-right">Proportional size</th>
<th scope="col" class="org-right">Multiplier</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Level 1</td>
<td class="org-right">100%</td>
<td class="org-right">2.0</td>
</tr>

<tr>
<td class="org-left">Level 2</td>
<td class="org-right">80%</td>
<td class="org-right">1.8</td>
</tr>

<tr>
<td class="org-left">Level 3</td>
<td class="org-right">60%</td>
<td class="org-right">1.6</td>
</tr>

<tr>
<td class="org-left">Level 4</td>
<td class="org-right">40%</td>
<td class="org-right">1.4</td>
</tr>

<tr>
<td class="org-left">Level 5</td>
<td class="org-right">30%</td>
<td class="org-right">1.3</td>
</tr>

<tr>
<td class="org-left">Level 6</td>
<td class="org-right">20%</td>
<td class="org-right">1.2</td>
</tr>

<tr>
<td class="org-left">Level 7</td>
<td class="org-right">10%</td>
<td class="org-right">1.1</td>
</tr>

<tr>
<td class="org-left">Level 8</td>
<td class="org-right">0%</td>
<td class="org-right">1.0</td>
</tr>
</tbody>
</table>

<p>
To make my typography rules easy to refer to, I create one face for each rule as follows:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 115: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defface</span> <span class="org-variable-name">my-default-mono</span> `((t <span class="org-builtin">:font</span> ,(font-spec <span class="org-builtin">:family</span> <span class="org-string">"iMWritingMonoS Nerd Font"</span>
                                                <span class="org-builtin">:size</span> 16)))
  <span class="org-doc">"Default monospaced font used on majority of the buffers."</span>
  <span class="org-builtin">:group</span> 'my-typography)

(<span class="org-keyword">defface</span> <span class="org-variable-name">my-big-face-mono</span> `((t <span class="org-builtin">:font</span> ,(font-spec <span class="org-builtin">:family</span> <span class="org-string">"iMWritingMonoS Nerd Font"</span>
                                                 <span class="org-builtin">:size</span> 26)))
  <span class="org-doc">"Monospaced font used on presentation mode."</span>
  <span class="org-builtin">:group</span> 'my-typography)

(<span class="org-keyword">defface</span> <span class="org-variable-name">my-default-ui</span> `((t <span class="org-builtin">:font</span> ,(font-spec <span class="org-builtin">:family</span> <span class="org-string">"Roboto"</span>
                                              <span class="org-builtin">:size</span> 16)))
  <span class="org-doc">"Extra face used on UI elements."</span>
  <span class="org-builtin">:group</span> 'my-typography)

(<span class="org-keyword">defface</span> <span class="org-variable-name">my-ui-window-header</span> `((t <span class="org-builtin">:inherit</span> my-default-ui
                                  <span class="org-builtin">:height</span> 0.8))
  <span class="org-doc">"Face used on decorative buffer headers."</span>
  <span class="org-builtin">:group</span> 'my-typography)

(<span class="org-keyword">defface</span> <span class="org-variable-name">my-default-prose</span> `((t <span class="org-builtin">:font</span> ,(font-spec <span class="org-builtin">:family</span> <span class="org-string">"iA Writer Quattro V"</span>
                                                 <span class="org-builtin">:size</span> 18)))
  <span class="org-doc">"Default variable pitch font used on prose writing."</span>
  <span class="org-builtin">:group</span> 'my-typography)

(<span class="org-keyword">defface</span> <span class="org-variable-name">my-document-title</span> `((t <span class="org-builtin">:inherit</span> my-default-prose
                                <span class="org-builtin">:height</span> 2.4
                                <span class="org-builtin">:weight</span> light
                                <span class="org-builtin">:slant</span> normal))
  <span class="org-doc">"Face used for document titles."</span>
  <span class="org-builtin">:group</span> 'my-typography)

(<span class="org-keyword">defface</span> <span class="org-variable-name">my-headline-1</span> `((t <span class="org-builtin">:inherit</span> my-default-prose
                            <span class="org-builtin">:height</span> 2.0
                            <span class="org-builtin">:weight</span> semi-light
                            <span class="org-builtin">:slant</span> normal))
  <span class="org-doc">"Face used for headlines of level 1."</span>
  <span class="org-builtin">:group</span> 'my-typography)

(<span class="org-keyword">defface</span> <span class="org-variable-name">my-headline-2</span> `((t <span class="org-builtin">:inherit</span> my-default-prose
                            <span class="org-builtin">:height</span> 1.8
                            <span class="org-builtin">:weight</span> semi-light
                            <span class="org-builtin">:slant</span> italic))
  <span class="org-doc">"Face used for headlines of level 1."</span>
  <span class="org-builtin">:group</span> 'my-typography)

(<span class="org-keyword">defface</span> <span class="org-variable-name">my-headline-3</span> `((t <span class="org-builtin">:inherit</span> my-default-prose
                            <span class="org-builtin">:height</span> 1.6
                            <span class="org-builtin">:weight</span> semi-light
                            <span class="org-builtin">:slant</span> normal))
  <span class="org-doc">"Face used for headlines of level 1."</span>
  <span class="org-builtin">:group</span> 'my-typography)

(<span class="org-keyword">defface</span> <span class="org-variable-name">my-headline-4</span> `((t <span class="org-builtin">:inherit</span> my-default-prose
                            <span class="org-builtin">:height</span> 1.4
                            <span class="org-builtin">:weight</span> semi-light
                            <span class="org-builtin">:slant</span> italic))
  <span class="org-doc">"Face used for headlines of level 1."</span>
  <span class="org-builtin">:group</span> 'my-typography)

(<span class="org-keyword">defface</span> <span class="org-variable-name">my-headline-5</span> `((t <span class="org-builtin">:inherit</span> my-default-prose
                            <span class="org-builtin">:height</span> 1.3
                            <span class="org-builtin">:weight</span> bold
                            <span class="org-builtin">:slant</span> normal))
  <span class="org-doc">"Face used for headlines of level 1."</span>
  <span class="org-builtin">:group</span> 'my-typography)

(<span class="org-keyword">defface</span> <span class="org-variable-name">my-headline-6</span> `((t <span class="org-builtin">:inherit</span> my-default-prose
                            <span class="org-builtin">:height</span> 1.2
                            <span class="org-builtin">:weight</span> bold
                            <span class="org-builtin">:slant</span> italic))
  <span class="org-doc">"Face used for headlines of level 1."</span>
  <span class="org-builtin">:group</span> 'my-typography)

(<span class="org-keyword">defface</span> <span class="org-variable-name">my-headline-7</span> `((t <span class="org-builtin">:inherit</span> my-default-prose
                            <span class="org-builtin">:height</span> 1.1
                            <span class="org-builtin">:weight</span> bold
                            <span class="org-builtin">:slant</span> normal))
  <span class="org-doc">"Face used for headlines of level 1."</span>
  <span class="org-builtin">:group</span> 'my-typography)

(<span class="org-keyword">defface</span> <span class="org-variable-name">my-headline-8</span> `((t <span class="org-builtin">:inherit</span> my-default-prose
                            <span class="org-builtin">:height</span> 1.0
                            <span class="org-builtin">:weight</span> bold
                            <span class="org-builtin">:slant</span> italic))
  <span class="org-doc">"Face used for headlines of level 1."</span>
  <span class="org-builtin">:group</span> 'my-typography)

(<span class="org-keyword">defface</span> <span class="org-variable-name">my-uri-face</span> `((t <span class="org-builtin">:inherit</span> link))
  <span class="org-doc">"Face used to display URIs."</span>
  <span class="org-builtin">:group</span> 'my-typography)
</pre>
</div>

<p>
The goal is to customize the fonts I want to have follow one of these rules by resetting all its values to <code>'unspecified</code> and inheriting one of my typography faces.
</p>

<p>
To help the tedious task of resetting a face, I want to have a helper function that will do the work for me:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 116: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defsubst</span> <span class="org-function-name">my-typography-reset</span> (<span class="org-type">&amp;rest</span> faces)
  <span class="org-doc">"Mark all face attributes from each face on FACES as `</span><span class="org-doc"><span class="org-constant">unspecified</span></span><span class="org-doc">'."</span>
  (custom-set-faces!
            `(,faces
              <span class="org-builtin">:family</span> unspecified
              <span class="org-builtin">:foundry</span> unspecified
              <span class="org-builtin">:width</span> unspecified
              <span class="org-builtin">:height</span> unspecified
              <span class="org-builtin">:weight</span> unspecified
              <span class="org-builtin">:slant</span> unspecified
              <span class="org-builtin">:underline</span> unspecified
              <span class="org-builtin">:overline</span> unspecified
              <span class="org-builtin">:strike-through</span> unspecified
              <span class="org-builtin">:box</span> unspecified
              <span class="org-builtin">:stipple</span> unspecified
              <span class="org-builtin">:font</span> unspecified
              <span class="org-builtin">:fontset</span> unspecified
              <span class="org-builtin">:extend</span> unspecified)))
</pre>
</div>

<p>
The astute reader might ask: <i>"Why not have this function do the whole work of resetting the font and assign an inheritance?"</i>
</p>

<p>
Unfortunately at this point, the answer is not clear. When I tried to implement the <i>one-shot</i> function, the target face would not get the inheritance value, and fonts were all messed up.
</p>

<p>
By splitting the process into cleaning and then setting, Emacs seams to behave as expected.
</p>

<div class="note" id="org3897e8f">
<p>
If you know what is going on here, please let me know. I'll be more than happy to learn and credit you for that!
</p>

</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
To start the configuration, per-se, I will get the Doom's font system configured accordingly to my typography:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 117: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> doom-font (face-attribute 'my-default-mono <span class="org-builtin">:font</span>)
      doom-big-font (face-attribute 'my-big-face-mono <span class="org-builtin">:font</span>)
      doom-variable-pitch-font (face-attribute 'my-default-prose <span class="org-builtin">:font</span>))
</pre>
</div>

<p>
It would be great if Doom could accept a <i>face</i> as the value for these variables, but unfortunately, it does not. Until this change, I have to live with this anonymous face that copy the <code>font</code> attribute from my typography face.
</p>

<p>
The next step is to make sure the base faces used on the editor match my base typography. The process to do so is the same I will use throughout this document whenever I find a mode that I need to adjust to match the defined typography.
</p>

<p>
I first clean up all styles except color on the faces I want to configure, in this case the faces are <code>fixed-pitch</code> and <code>variable-pitch</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 118: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(my-typography-reset 'fixed-pitch 'variable-pitch)
</pre>
</div>

<p>
Then I set each face inheritance to the correct typography face:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 119: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(custom-set-faces!
  '(fixed-pitch <span class="org-builtin">:inherit</span> my-default-mono)
  '(variable-pitch <span class="org-builtin">:inherit</span> my-default-prose))
</pre>
</div>

<p>
At his point, Emacs have <code>'default</code>, <code>'fixed-pitch</code>, and <code>'variable-pitch</code> faces matching my selection of fonts. This is, probably, a major part on the typography configuration. The rest of my setup, are individual packages, which I will configure once they show up in this document.
</p>

<p>
To close out the typography section, I like to enable font smoothing on macOS. To do so, simply set <code>ns-use-thin-smoothing</code> to <code>t</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 120: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> ns-use-thin-smoothing t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org83993f0" class="outline-4">
<h4 id="org83993f0"><span class="section-number-4">3.3.5</span> Iconography</h4>
<div class="outline-text-4" id="text-3-3-5">
<p>
Doom offers the <code>all-the-icons</code> package, which allow one to insert Unicode glyphs on buffers. That is a great start, but the problem I see here is how inconsistent the size of these icons are.
</p>

<p>
The idea for this section is to create a list of curated icons, adjusted to occupy exactly 2 ASCII characters on the buffer. This allows for a better alignment of text when we use an Icon.
</p>

<p>
I will create an <i>Association List</i> to store symbols associated with an adjusted icon:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 121: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-supported-icons</span>
  (list 'assign       (all-the-icons-material <span class="org-string">"assignment_ind"</span>          <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.17)
        'bug          (all-the-icons-material <span class="org-string">"bug_report"</span>              <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.17)
        'busy         (all-the-icons-material <span class="org-string">"event_busy"</span>              <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.17)
        'calendar     (all-the-icons-octicon  <span class="org-string">"calendar"</span>                <span class="org-builtin">:height</span> 1.05 <span class="org-builtin">:v-adjust</span> 0.0)
        'checked      (all-the-icons-material <span class="org-string">"check_box"</span>               <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.17)
        'checklist    (all-the-icons-octicon  <span class="org-string">"checklist"</span>               <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> 0.1)
        'contact-add  (all-the-icons-material <span class="org-string">"person_add"</span>              <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.17)
        'error        (all-the-icons-material <span class="org-string">"error_outline"</span>           <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.17)
        'globe        (all-the-icons-faicon   <span class="org-string">"globe"</span>                   <span class="org-builtin">:height</span> 1.15 <span class="org-builtin">:v-adjust</span> -0.05)
        'help         (all-the-icons-material <span class="org-string">"live_help"</span>               <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.22)
        'history      (all-the-icons-material <span class="org-string">"history"</span>                 <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.17)
        'idea         (all-the-icons-material <span class="org-string">"lightbulb_outline"</span>       <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.17)
        'inbox        (all-the-icons-material <span class="org-string">"inbox"</span>                   <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.15)
        'journal      (all-the-icons-material <span class="org-string">"book"</span>                    <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.15)
        'list         (all-the-icons-faicon   <span class="org-string">"list"</span>                    <span class="org-builtin">:height</span> 0.93 <span class="org-builtin">:v-adjust</span> -0.05)
        'loop         (all-the-icons-material <span class="org-string">"loop"</span>                    <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.17)
        'meeting      (all-the-icons-material <span class="org-string">"date_range"</span>              <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.15)
        'new          (all-the-icons-material <span class="org-string">"new_releases"</span>            <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.17)
        'notes        (all-the-icons-material <span class="org-string">"library_books"</span>           <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.1)
        'pause        (all-the-icons-material <span class="org-string">"pause_circle_outline"</span>    <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.17)
        'postit       (all-the-icons-faicon   <span class="org-string">"sticky-note"</span>             <span class="org-builtin">:height</span> 1.15 <span class="org-builtin">:v-adjust</span> 0.05)
        'project      (all-the-icons-octicon  <span class="org-string">"briefcase"</span>               <span class="org-builtin">:height</span> 1.05 <span class="org-builtin">:v-adjust</span> 0.05)
        'review       (all-the-icons-material <span class="org-string">"rate_review"</span>             <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.15)
        'semi-checked (all-the-icons-material <span class="org-string">"indeterminate_check_box"</span> <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.17)
        'snooze       (all-the-icons-material <span class="org-string">"snooze"</span>                  <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.17)
        'stop         (all-the-icons-octicon  <span class="org-string">"stop"</span>                    <span class="org-builtin">:height</span> 1.05 <span class="org-builtin">:v-adjust</span> -0.05)
        'timer        (all-the-icons-material <span class="org-string">"timer"</span>                   <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.15)
        'unchecked    (all-the-icons-material <span class="org-string">"check_box_outline_blank"</span> <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.17)
        'visibility   (all-the-icons-material <span class="org-string">"visibility"</span>              <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.17)
        'wait         (all-the-icons-material <span class="org-string">"hourglass_empty"</span>         <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.17))
  <span class="org-doc">"Property list with all supported icons from my configuration."</span>)
</pre>
</div>

<p>
In order to allow other parts of this configuration to leverage the curated icons, I'll create a predicate function to  check if a given symbol has an icon associated with it:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 122: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-supported-icons-p</span> (icon)
  <span class="org-doc">"Return t if the symbol given on ICON, is one associated with supported icon."</span>
  (<span class="org-keyword">and</span> (boundp 'my-supported-icons)
       (listp my-supported-icons)
       (plist-member my-supported-icons icon)))
</pre>
</div>

<p>
I want to also create a thin-wrapper around the <code>plist-get</code> to retrieve the icon string for a given symbol:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 123: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-raw-icon</span> (icon)
  <span class="org-doc">"This function returns the requested ICON as if you're calling the</span>
<span class="org-doc">`</span><span class="org-doc"><span class="org-constant">all-the-icons-</span></span><span class="org-doc">'* functions directly.</span>

<span class="org-doc">Icons supported by this function were all optimized to use exactly 2 characters</span>
<span class="org-doc">of space when used with the font and size defined in the main configuration.</span>

<span class="org-doc">Check th documentation of `</span><span class="org-doc"><span class="org-constant">my-supported-icons</span></span><span class="org-doc">' to see the list of supported</span>
<span class="org-doc">icons."</span>
  (plist-get my-supported-icons icon))
</pre>
</div>

<p>
And to finalize my icons configuration, I need to expose a function where one (me in this case) will call it to get a curated icon with a given color (this is the only function in this section that a user should call to get an icon).
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 124: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-icon</span> (icon <span class="org-type">&amp;optional</span> color)
  <span class="org-doc">"This function returns the requested ICON as a 2-characters string,</span>
<span class="org-doc">propertized to display the associated icon from the `</span><span class="org-doc"><span class="org-constant">all-the-icons</span></span><span class="org-doc">' package. It</span>
<span class="org-doc">uses the COLOR arg to 'paint' the icon.</span>

<span class="org-doc">Check documentation of the function `</span><span class="org-doc"><span class="org-constant">my-raw-icon</span></span><span class="org-doc">' for a list of supported</span>
<span class="org-doc">icons."</span>
  (<span class="org-keyword">cond</span> ((eq color 'raw) (my-raw-icon icon))
        (color (propertize <span class="org-string">"--"</span>
                   'face `(<span class="org-builtin">:foreground</span> ,color)
                   'display (my-raw-icon icon)))
        (t (propertize <span class="org-string">"--"</span>
                   'face `(<span class="org-builtin">:foreground</span> ,(face-attribute 'default <span class="org-builtin">:foreground</span>))
                   'display (my-raw-icon icon)))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9995bc2" class="outline-3">
<h3 id="org9995bc2"><span class="section-number-3">3.4</span> Editor Tabs</h3>
<div class="outline-text-3" id="text-3-4">
<p>
I've been all over the place regarding the use of tabs on editors. I use to think they were useless, since all files on my editor were buffers, not tabs. I though that using tabs as a sort of layout manager was a great idea, because I would have the visual cue of <i>workspaces</i> I had configured.
</p>

<p>
Recently, I spent time thinking about this and I changed my mind regarding tabs. First of all, I believe the common knowledge that one tab represents one file, is too ingrained into our collective minds by all other software that use them (web browsers, IDEs, file managers, etc.). This causes a weird feeling when I look to the tabs and they do not represent opened files. Also, as I work on my editor, I lose track of files opened without tabs.
</p>

<p>
For some Emacs users, all these arguments are silly because they are too used to the way Emacs works. But I believe that this argument should be the other way around. Because of the way Emacs developers decided to use the tab paradigm inside the editor, Emacs users accepted and got used to it.
</p>

<p>
But, as if to point out things I'm arguing for, there are way too many packages that say they <i>fix the Emacs window system</i> on GitHub these days.
</p>

<p>
On 2020, I read a blog post from <a href="https://andreyorst.gitlab.io/">Andrey Listopadov</a> about his desire to have <a href="https://andreyorst.gitlab.io/posts/2020-05-07-making-emacs-tabs-work-like-in-atom/">Emacs tabs behaving more like tabs on Atom</a>. The post itself is a really good read, but I would like to reproduce here Andrey's description of how he believes the tab behavior should be:
</p>

<blockquote>
<p>
In Emacs, however, we can’t close tab via close button, because it will cycle buffers, so instead we can switch to second policy of killing buffer instead. But it will not work either, because it will not kill the window, and it will kill buffer in all windows. So how do we fix this?
</p>

<p>
First let’s establish some logical rules:
</p>

<ul class="org-ul">
<li>Buffer can exist without a tab, but tab can not exist without a buffer,</li>
<li>If tab was closed buffer should be killed only if there are no tabs for this buffer left,</li>
<li>If tab was closed and there are no more tabs in the window, window should be killed.</li>
</ul>

<p>
These three rules are basically how tabs work in modern editors.
</p>
</blockquote>

<p>
The configuration you're reading here is almost a copy from Andrey's posts (there is a sequel to the aforementioned post called <a href="https://andreyorst.gitlab.io/posts/2020-05-10-making-emacs-tabs-look-like-in-atom/">Making Emacs tabs look like in Atom</a>, that I also copy snippets in order fully configure tabs here.) with minor modifications to adjust it to my code style.
</p>

<p>
The way to achieve this configuration, is to define a set of <code>tab-line</code> variables and let Emacs do its thing.
</p>

<p>
My tab configuration uses dynamic values in almost all of it, but there are two constants that I have to decide beforehand: <code>tab-line-tab-min-width</code> and <code>tab-line-tab-max-width</code>.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 125: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defconst</span> <span class="org-variable-name">tab-line-tab-min-width</span> 20
  <span class="org-doc">"Minimum width of a tab in characters."</span>)

(<span class="org-keyword">defconst</span> <span class="org-variable-name">tab-line-tab-max-width</span> 70
  <span class="org-doc">"Maximum width of a tab in characters."</span>)
</pre>
</div>

<p>
It might look an exaggeration to use the values I chose, but since I will use a variable pitch face to draw the tabs, these numbers become more realistic.
</p>

<p>
So let's configure the faces used on my tabs:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 126: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-tabs--setup-faces-h</span> ()
  <span class="org-doc">"Configure the `</span><span class="org-doc"><span class="org-constant">tab-line-mode</span></span><span class="org-doc">' user interface."</span>
  (<span class="org-keyword">let*</span> ((base (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> (facep 'solaire-default-face)
                        (not (eq (face-attribute 'solaire-default-face <span class="org-builtin">:background</span>) 'unspecified)))
                   (face-attribute 'default <span class="org-builtin">:background</span>)
                 (face-attribute 'mode-line <span class="org-builtin">:background</span>)))
         (bg (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> (facep 'solaire-default-face)
                      (not (eq (face-attribute 'solaire-default-face <span class="org-builtin">:background</span>) 'unspecified)))
                 (face-attribute 'solaire-default-face <span class="org-builtin">:background</span>)
               (face-attribute 'default <span class="org-builtin">:background</span>)))
         (fg (face-attribute 'default <span class="org-builtin">:foreground</span>))
         (dark-fg (face-attribute 'shadow <span class="org-builtin">:foreground</span>))
         (overline (face-attribute 'highlight <span class="org-builtin">:background</span>))
         (box-width (/ my-line-pixel-height 2))
         (box-base (<span class="org-keyword">when</span> (&gt; box-width 0) (list <span class="org-builtin">:line-width</span> box-width <span class="org-builtin">:color</span> base)))
         (box-bg (<span class="org-keyword">when</span> (&gt; box-width 0) (list <span class="org-builtin">:line-width</span> box-width <span class="org-builtin">:color</span> bg))))
    (set-face-attribute 'tab-line nil
                        <span class="org-builtin">:background</span> base
                        <span class="org-builtin">:foreground</span> dark-fg
                        <span class="org-builtin">:overline</span> base
                        <span class="org-builtin">:inherit</span> 'my-default-ui
                        <span class="org-builtin">:box</span> box-base)
    (set-face-attribute 'tab-line-tab nil
                        <span class="org-builtin">:foreground</span> dark-fg
                        <span class="org-builtin">:background</span> bg
                        <span class="org-builtin">:inherit</span> 'my-default-ui
                        <span class="org-builtin">:box</span> box-bg)
    (set-face-attribute 'tab-line-tab-inactive nil
                        <span class="org-builtin">:foreground</span> dark-fg
                        <span class="org-builtin">:background</span> base
                        <span class="org-builtin">:inherit</span> 'my-default-ui
                        <span class="org-builtin">:box</span> box-base)
    (set-face-attribute 'tab-line-tab-current nil
                        <span class="org-builtin">:foreground</span> fg
                        <span class="org-builtin">:background</span> bg
                        <span class="org-builtin">:inherit</span> 'my-default-ui
                        <span class="org-builtin">:overline</span> overline
                        <span class="org-builtin">:box</span> box-bg)
    (set-face-attribute 'tab-line-highlight nil
                        <span class="org-builtin">:foreground</span> fg
                        <span class="org-builtin">:background</span> nil
                        <span class="org-builtin">:inherit</span> 'tab-line-tab
                        <span class="org-builtin">:overline</span> overline
                        <span class="org-builtin">:box</span> box-bg)
    (set-face-attribute 'tab-line-close-highlight nil
                        <span class="org-builtin">:foreground</span> overline
                        <span class="org-builtin">:overline</span> overline
                        <span class="org-builtin">:background</span> nil
                        <span class="org-builtin">:inherit</span> 'tab-line-tab
                        <span class="org-builtin">:box</span> box-bg)))
</pre>
</div>

<p>
And I need to make sure I call this function after Doom loads the editor's theme:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 127: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(add-hook 'doom-load-theme-hook #'my-tabs--setup-faces-h)
</pre>
</div>

<p>
To configure the look and feel of <i>non-tab</i> elements of the <code>tab-line</code>, I need to set the <code>tab-line-right-button</code>, <code>tab-line-left-button</code>, <code>tab-line-new-button-show</code>, and <code>tab-line-separator</code> variables:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 128: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> tab-line
  (<span class="org-keyword">setq</span> tab-line-right-button (propertize (<span class="org-keyword">if</span> (char-displayable-p ?&#9656;) <span class="org-string">" &#9656; "</span> <span class="org-string">" &gt; "</span>)
                                          'keymap tab-line-right-map
                                          'mouse-face 'tab-line-highlight
                                          'help-echo <span class="org-string">"Click to scroll right"</span>)
        tab-line-left-button (propertize (<span class="org-keyword">if</span> (char-displayable-p ?&#9666;) <span class="org-string">" &#9666; "</span> <span class="org-string">" &lt; "</span>)
                                         'keymap tab-line-left-map
                                         'mouse-face 'tab-line-highlight
                                         'help-echo <span class="org-string">"Click to scroll left"</span>)
        tab-line-new-button-show nil
        tab-line-separator <span class="org-string">""</span>))
</pre>
</div>

<p>
And to configure the tab itself, I need to set the <code>tab-line-close-button-show</code>, <code>tab-line-close-button</code>, and the <code>tab-line-tab-name-function</code> variables:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 129: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> tab-line
  (<span class="org-keyword">setq</span> tab-line-close-button-show t
        tab-line-close-button (propertize (format <span class="org-string">"%s "</span> (all-the-icons-material <span class="org-string">"close"</span>))
                                          'keymap tab-line-tab-close-map
                                          'mouse-face 'tab-line-close-highlight
                                          'face 'tab-line-tab-curent
                                          'help-echo <span class="org-string">"Click to close tab"</span>)
        tab-line-tab-name-function #'my-tabs-name-buffer))
</pre>
</div>

<p>
While the <code>tab-line-close-button-show</code> and the <code>tab-line-close-button</code> variables control the appearance of the tab close button, the <code>tab-line-tab-name-function</code> is responsible for everything else on the tab. The <code>my-tabs-name-buffer</code> function will return a string representing the tab name for each tab, and is also this function's responsibility to return the normalized tab size in form of blank spaces:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 130: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-tabs-name-buffer</span> (buffer <span class="org-type">&amp;rest</span> _buffers)
  <span class="org-doc">"Create name for tab with padding and truncation.</span>

<span class="org-doc">If buffer name is shorter than `</span><span class="org-doc"><span class="org-constant">tab-line-tab-max-width</span></span><span class="org-doc">' it gets centered with</span>
<span class="org-doc">spaces, otherwise it gets truncated, to preserve equal width for all tabs. This</span>
<span class="org-doc">function also tries to fit as many tabs in window as possible, so if there are</span>
<span class="org-doc">no room for tabs with maximum width, it calculates new width for each tab and</span>
<span class="org-doc">truncates text if needed. You can set the minimal width with</span>
<span class="org-doc">`</span><span class="org-doc"><span class="org-constant">tab-line-tab-min-width</span></span><span class="org-doc">' variable."</span>
  (<span class="org-keyword">with-current-buffer</span> buffer
    (<span class="org-keyword">let*</span> ((window-width (window-width (get-buffer-window)))
           (close-button-size (<span class="org-keyword">if</span> tab-line-close-button-show
                                  (length (substring-no-properties tab-line-close-button))
                                0))
           (tab-amount (length (funcall tab-line-tabs-function)))
           (window-max-tab-width (/ window-width tab-amount))
           (tab-width (- (<span class="org-keyword">cond</span> ((&gt;= window-max-tab-width tab-line-tab-max-width)
                                tab-line-tab-max-width)
                               ((&lt; window-max-tab-width tab-line-tab-min-width)
                                tab-line-tab-min-width)
                               (t window-max-tab-width))
                         close-button-size))
           (buffer-name (string-trim (buffer-name)))
           (name-width (length buffer-name)))
      (<span class="org-keyword">if</span> (&gt;= name-width (- tab-width 3))
          (concat  <span class="org-string">" "</span> (truncate-string-to-width buffer-name (- tab-width 3)) <span class="org-string">"&#8230; "</span>)
        (<span class="org-keyword">let*</span> ((padding (make-string (/ (- tab-width name-width) 2) ?\s))
               (buffer-name (concat padding buffer-name))
               (name-width (length buffer-name)))
          (concat buffer-name (make-string (- tab-width name-width) ?\s)))))))
</pre>
</div>

<p>
The reader might have noticed I use the size of the list returned by the function <code>tab-line-tabs-function</code> to calculate single tab size, and as you imagine, the function symbol used in this variable is responsible to return a list of tabs on the current window, so I will also use such function to filter some unwanted buffers on the tab bar. The function docstring, explains these exceptional cases in a bit more detail:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 131: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-tabs-mode-persp-window</span> ()
  <span class="org-doc">"Return a list of buffer tabs of the current window.</span>

<span class="org-doc">This function take in account the active perspective (or workspace) so it does</span>
<span class="org-doc">not display tabs from other perspectives on the current one.</span>

<span class="org-doc">There are 4 types of buffer that this function handles:</span>

<span class="org-doc">1. Real buffers</span>

<span class="org-doc">   These buffers are the normal buffers that have a tab associated with them. To</span>
<span class="org-doc">   be a real buffer, the function `</span><span class="org-doc"><span class="org-constant">doom-real-buffer-p</span></span><span class="org-doc">' must return t for the</span>
<span class="org-doc">   buffer.</span>

<span class="org-doc">2. Popup buffers (or non-real buffers)</span>

<span class="org-doc">   These are the inverse of real buffers.</span>

<span class="org-doc">3. Org capture buffers</span>

<span class="org-doc">   These buffers are the ones created to perform the `</span><span class="org-doc"><span class="org-constant">org-capture</span></span><span class="org-doc">'. Such buffers</span>
<span class="org-doc">   should never have a tab associated with them.</span>

<span class="org-doc">4. Dired buffers</span>

<span class="org-doc">   These are real buffers that should never exist in more than one per window.</span>
<span class="org-doc">   When jumping from one Dired buffer to another, Emacs creates one buffer per</span>
<span class="org-doc">   directory, but the tab bar should not display any other then the current</span>
<span class="org-doc">   buffer."</span>
  (<span class="org-keyword">let</span> ((win-buffs (tab-line-tabs-window-buffers))
        (last-dired-buf (seq-find 'doom-dired-buffer-p (buffer-list (selected-frame)))))
    (reverse (seq-filter (<span class="org-keyword">lambda</span> (buf)
                           (<span class="org-keyword">let</span> ((buf-name (buffer-name buf)))
                             (<span class="org-keyword">and</span> (member buf win-buffs)
                                  (doom-real-buffer-p buf)
                                  (not (string-prefix-p buf-name <span class="org-string">"CAPTURE-"</span>))
                                  (<span class="org-keyword">or</span> (not (doom-dired-buffer-p buf))
                                      (eq buf last-dired-buf)))))
                         (funcall tab-line-tabs-buffer-list-function)))))
</pre>
</div>

<p>
And as with the <code>tab-line-tabs-function</code>, the <code>tab-line-tabs-buffer-list-function</code> holds a symbol of a function that returns all buffers to consider during <code>tab-line-tabs-function</code> execution, and I should set them to their proper functions, unfortunately the <code>persp-current-buffers</code> (which is the function we need to call), is a macro, and according to the Emacs <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Calling-Functions.html">documentation</a>, we can't pass macros to <code>funcall</code> or <code>apply</code>.
</p>

<p>
To workaround this problem, I will create an alias function to call the same functions the <code>persp-current-buffers</code> macro do:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 132: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defalias</span> '<span class="org-function-name">my-persp-current-buffers</span>
  (<span class="org-keyword">lambda</span> ()
    (<span class="org-keyword">when</span> (fboundp 'persp-buffers)
      (persp-buffers (persp-curr))))
  <span class="org-doc">"Wrapper for the `</span><span class="org-doc"><span class="org-constant">persp-current-buffers</span></span><span class="org-doc">' macro."</span>)
</pre>
</div>

<p>
Now we can properly define the two variables we need to make <code>tab-line</code> find the tab buffers:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 133: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> tab-line
  (<span class="org-keyword">setq</span> tab-line-tabs-function #'my-tabs-mode-persp-window
        tab-line-tabs-buffer-list-function #'my-persp-current-buffers))
</pre>
</div>

<p>
The last variable to configure is the <code>tab-line-exclude-modes</code>. This variable holds a list of modes that will not have <code>tab-line-mode</code> enabled on them, even when <code>global-tab-line-mode</code> gets enabled:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 134: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> tab-line
  (<span class="org-keyword">setq</span> tab-line-exclude-modes '(+doom-dashboard-mode
                                 cfw:calendar-mode
                                 Info-mode
                                 calendar-mode
                                 ediff-mode
                                 eshell-mode
                                 help-mode
                                 helpful-mode
                                 imenu-list-major-mode
                                 lexic-mode
                                 process-menu-mode
                                 Man-mode
                                 WoMan-mode
                                 term-mode
                                 treemacs-mode
                                 vterm-mode
                                 wordnut-mode
                                 reb-mode)))
</pre>
</div>

<p>
Even with the <code>tab-line-exclude-modes</code> list, some <i>non-real</i> buffers get displayed. I need to create an extra function to help me get rid of the <code>tab-line</code> when I load such buffers:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 135: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-tabs-hide-tab-line-maybe-h</span> ()
  <span class="org-doc">"Disable `</span><span class="org-doc"><span class="org-constant">tab-line-mode</span></span><span class="org-doc">' for non-real buffers.</span>

<span class="org-doc">For a definition of what is a non-real buffer, check the documentation of</span>
<span class="org-doc">`</span><span class="org-doc"><span class="org-constant">doom-real-buffer-p</span></span><span class="org-doc">'."</span>
  (<span class="org-keyword">when</span> (not (doom-real-buffer-p (current-buffer)))
    (tab-line-mode -1)))
</pre>
</div>

<p>
With the helper function defined, I need to make sure I call it when I switch buffers. The reason for that is that I could explicitly request to load a <i>non-real</i> buffer, which would create the <code>tab-line</code> on such buffer:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 136: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(add-hook 'doom-switch-buffer-hook #'my-tabs-hide-tab-line-maybe-h)
</pre>
</div>

<p>
Also, when Emacs calls the <code>window-configuration-change-hook</code> hooks, I need to clean all <code>tab-line</code> cache to make sure Emacs will re-consider all the proper buffers when re-displaying it:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 137: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(add-hook 'window-configuration-change-hook #'my-tabs--drop-caches-h)
</pre>
</div>

<p>
The implementation of <code>my-tabs--drop-caches-h</code> simply <i>nullify</i> the value of the <code>tab-line-cache</code> window parameter for all windows:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 138: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-tabs--drop-caches-h</span> ()
  <span class="org-doc">"Drops `</span><span class="org-doc"><span class="org-constant">tab-line</span></span><span class="org-doc">' cache in every window."</span>
  (<span class="org-keyword">dolist</span> (window (window-list))
    (set-window-parameter window 'tab-line-cache nil)))
</pre>
</div>

<p>
With all that in place, we can make sure the <code>tab-line</code> gets loaded when Emacs start:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 139: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> tab-line
  <span class="org-builtin">:when</span> window-system
  <span class="org-builtin">:hook</span> ((after-init . global-tab-line-mode)))
</pre>
</div>
</div>

<div id="outline-container-org55ef10a" class="outline-4">
<h4 id="org55ef10a"><span class="section-number-4">3.4.1</span> Tab actions</h4>
<div class="outline-text-4" id="text-3-4-1">
<p>
There are two main actions that I need to address here: selection and closing.
</p>

<p>
I would like to start talking about the later. Unfortunately, the Emacs implementation of <code>tab-line-close-tab</code> does not leave room to customize its behavior the way I want it. Instead, I will implement my own version (more like "I'll copy Andrey's version and change it a bit"):
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 140: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-tabs-close-buffer-tab</span> (buffer-or-name <span class="org-type">&amp;optional</span> window)
  (<span class="org-keyword">let</span> ((buffer (get-buffer buffer-or-name))
        (window (<span class="org-keyword">or</span> window (get-buffer-window))))
    (<span class="org-keyword">if</span> window
        (<span class="org-keyword">with-selected-window</span> window
          (<span class="org-keyword">let</span> ((tab-list (my-tabs-mode-persp-window))
                (buffer-list (flatten-list
                              (seq-reduce (<span class="org-keyword">lambda</span> (list window)
                                            (select-window window t)
                                            (cons (my-tabs-mode-persp-window) list))
                                          (window-list) nil))))
            (select-window window)
            (<span class="org-keyword">if</span> (&gt; (seq-count (<span class="org-keyword">lambda</span> (b) (eq b buffer)) buffer-list) 1)
                (<span class="org-keyword">progn</span>
                  (<span class="org-keyword">if</span> (eq buffer (current-buffer))
                      (bury-buffer)
                    (set-window-prev-buffers window (assq-delete-all buffer (window-prev-buffers)))
                    (set-window-next-buffers window (delq buffer (window-next-buffers))))
                  (<span class="org-keyword">unless</span> (cdr tab-list)
                    (<span class="org-keyword">ignore-errors</span> (delete-window window))))
              (<span class="org-keyword">and</span> (kill-buffer buffer)
                   (<span class="org-keyword">unless</span> (cdr tab-list)
                     (<span class="org-keyword">ignore-errors</span> (delete-window window)))))))
      (<span class="org-keyword">if</span> (persp-buffer-in-other-p buffer)
          (persp-remove-buffer buffer)
        (kill-buffer buffer)))))
</pre>
</div>

<p>
With the function implemented, I need to override the original one with it using an advice:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 141: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-tabs-close-tab-a (<span class="org-type">&amp;optional</span> mouse-event)
  <span class="org-doc">"Close the selected tab.</span>

<span class="org-doc">If buffer on tab is present in another window, close the tab by using</span>
<span class="org-doc">`</span><span class="org-doc"><span class="org-constant">bury-buffer</span></span><span class="org-doc">' function. If buffer on tab is unique to all existing windows, kill</span>
<span class="org-doc">the buffer with `</span><span class="org-doc"><span class="org-constant">kill-buffer</span></span><span class="org-doc">' function. Lastly, if no tabs left in the window,</span>
<span class="org-doc">it will delete it with `</span><span class="org-doc"><span class="org-constant">delete-window</span></span><span class="org-doc">' function."</span>
  <span class="org-builtin">:override</span> 'tab-line-close-tab
  (<span class="org-keyword">let*</span> ((posnp (<span class="org-keyword">and</span> mouse-event (event-start mouse-event)))
         (window (<span class="org-keyword">and</span> posnp (posn-window posnp)))
         (buffer (<span class="org-keyword">or</span> (<span class="org-keyword">and</span> posnp (get-pos-property 1 'tab (car (posn-string posnp))))
                     (current-buffer)))
         (window (<span class="org-keyword">or</span> window (get-buffer-window buffer))))
    (my-tabs-close-buffer-tab buffer window)
    (force-mode-line-update)))
</pre>
</div>

<p>
Now, any code calling the <code>tab-line-close-tab</code> will use the algorithm defined in this section.
</p>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
The next and final action to handle is actually a group of actions related to <i>switching between tabs</i>.
</p>

<p>
The first step to configure tab switching, is to create a function that allows me to switch to any tab, by passing a tab to it. The only special thing about this function is that you can pass a buffer or an association list representing a tab. Other than that, this function behaves much like the <code>switch-to-buffer</code> one:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 142: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-tab-line-switch-to-tab</span> (tab)
  <span class="org-doc">"Switch to the buffer associated with TAB."</span>
  (<span class="org-keyword">let</span> ((buffer (<span class="org-keyword">if</span> (bufferp tab) tab (cdr (assq 'buffer tab)))))
    (<span class="org-keyword">when</span> (bufferp buffer)
        (switch-to-buffer buffer))))
</pre>
</div>

<p>
Next, I need a way to select a tab by its position of the displayed tabs:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 143: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-tab-line-switch-to</span> (pos)
  <span class="org-doc">"Switch to the tab on position POS.</span>

<span class="org-doc">If POS is negative, access the tab on the reverse order.</span>

<span class="org-doc">If POS is bigger than the number of tabs, return nil. The same is valid for</span>
<span class="org-doc">negative numbers, so if POS is negative and its absolute value minus 1 is bigger</span>
<span class="org-doc">than the number of tabs, return nil."</span>
  (<span class="org-keyword">let*</span> ((tabs (funcall tab-line-tabs-function))
         (tabs (<span class="org-keyword">if</span> (&lt; pos 0) (reverse tabs) tabs))
         (pos (<span class="org-keyword">if</span> (&lt; pos 0) (1- (- pos)) pos))
         (tab (nth pos tabs)))
    (<span class="org-keyword">unless</span> (my-tab-line-switch-to-tab tab)
      (<span class="org-warning">user-error</span> <span class="org-string">"There is no tab on position %s"</span> (1+ pos)))))
</pre>
</div>

<p>
And a helper function to select the last tab on the list:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 144: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-tab-line-switch-to-final</span> ()
  <span class="org-doc">"Switch to the last tab."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((tab (car (last (funcall tab-line-tabs-function)))))
    (<span class="org-keyword">unless</span> (my-tab-line-switch-to-tab tab)
      (<span class="org-warning">user-error</span> <span class="org-string">"Tab line is not visible to go to the last tab"</span>))))
</pre>
</div>

<p>
These functions should be enough to allow me to switch tabs on any way I defined here. To get a good set of key bindings, I need to create aliases for calling <code>my-tab-line-switch-to</code> from 1 to 9:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 145: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">dotimes</span> (i 9)
  (<span class="org-keyword">defalias</span> (intern (format <span class="org-string">"my-tab-line-switch-to-%d"</span> i))
    (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>) (my-tab-line-switch-to i))
    (format
     <span class="org-string">"Thin wrapper around `</span><span class="org-string"><span class="org-constant">+workspace/switch-to</span></span><span class="org-string">' function where we pass #%d as the INDEX parameter."</span>
     (1+ i))))
</pre>
</div>

<p>
And my keymap for all these functions should allow me to switch tabs using <code>Cmd</code> plus a number from <code>1</code> to <code>9</code>. The <code>Cmd-0</code> shortcut will call the <code>my-tab-line-switch-to-final</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 146: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:after</span> tab-line
      <span class="org-builtin">:ne</span> <span class="org-string">"s-1"</span> #'my-tab-line-switch-to-0
      <span class="org-builtin">:ne</span> <span class="org-string">"s-2"</span> #'my-tab-line-switch-to-1
      <span class="org-builtin">:ne</span> <span class="org-string">"s-3"</span> #'my-tab-line-switch-to-2
      <span class="org-builtin">:ne</span> <span class="org-string">"s-4"</span> #'my-tab-line-switch-to-3
      <span class="org-builtin">:ne</span> <span class="org-string">"s-5"</span> #'my-tab-line-switch-to-4
      <span class="org-builtin">:ne</span> <span class="org-string">"s-6"</span> #'my-tab-line-switch-to-5
      <span class="org-builtin">:ne</span> <span class="org-string">"s-7"</span> #'my-tab-line-switch-to-6
      <span class="org-builtin">:ne</span> <span class="org-string">"s-8"</span> #'my-tab-line-switch-to-7
      <span class="org-builtin">:ne</span> <span class="org-string">"s-9"</span> #'my-tab-line-switch-to-8
      <span class="org-builtin">:ne</span> <span class="org-string">"s-0"</span> #'my-tab-line-switch-to-final

      (<span class="org-builtin">:prefix</span> <span class="org-string">"g"</span>
       <span class="org-builtin">:desc</span> <span class="org-string">"Go to tab on the right"</span> <span class="org-builtin">:n</span> <span class="org-string">"t"</span> #'tab-line-switch-to-next-tab
       <span class="org-builtin">:desc</span> <span class="org-string">"Go to tab on the left"</span>  <span class="org-builtin">:n</span> <span class="org-string">"T"</span> #'tab-line-switch-to-prev-tab))
</pre>
</div>

<p>
One final configuration I need to do is to make sure Emacs selects the correct tab when I click on it with the mouse:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 147: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-tabs-select-tab-a (<span class="org-type">&amp;optional</span> e)
  <span class="org-doc">"Advice to select the buffer window of a tab when clicking on the tab."</span>
  <span class="org-builtin">:after</span> 'tab-line-select-tab
  (select-window (posn-window (event-start e))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdddfd7d" class="outline-4">
<h4 id="orgdddfd7d"><span class="section-number-4">3.4.2</span> Windows</h4>
<div class="outline-text-4" id="text-3-4-2">
<p>
It's impossible to get the tab configuration right without adjusting the Emacs window behavior.
</p>

<p>
The main behavior I want to guarantee, is that Emacs should close a window if there are no buffers left on the list of previous buffers:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 148: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-close-window-when-kill-buffer-h</span> (<span class="org-type">&amp;optional</span> buffer-or-name)
  (<span class="org-keyword">let*</span> ((buf (get-buffer (<span class="org-keyword">or</span> buffer-or-name (current-buffer))))
         (win (get-buffer-window buf)))
    (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> win (my-window-single-buffer-p win))
      (delete-window win))))
</pre>
</div>

<p>
Because this function needs to know if there are no buffer lefts on the list of buffers associated with the window, I will implement a helper function for that:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 149: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defsubst</span> <span class="org-function-name">my-window-single-buffer-p</span> (<span class="org-type">&amp;optional</span> win)
  (<span class="org-keyword">let</span> ((win (<span class="org-keyword">or</span> win (selected-window))))
    (<span class="org-keyword">or</span> (window-dedicated-p win)
        (not (<span class="org-keyword">or</span> (window-next-buffers win)
                 (window-prev-buffers win))))))
</pre>
</div>

<p>
Now I just need to make sure Emacs calls the <code>my-close-window-when-kill-buffer-h</code> function when I kill a buffer:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 150: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(add-hook 'kill-buffer-hook 'my-close-window-when-kill-buffer-h)
</pre>
</div>

<p>
These covers most of the closing behavior regarding windows. The one exception is the <code>kill-current-buffer</code> that needs to not switch buffers as we kill the current buffer. I will implement this behavior as a <i>before</i> advice to the <code>kill-current-buffer</code> function:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 151: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-close-window-when-no-buffer-a (<span class="org-type">&amp;rest</span> _)
  <span class="org-builtin">:before-until</span> #'kill-current-buffer
  (my-save-all-buffers-a)
  (<span class="org-keyword">let</span> ((buf (current-buffer))
        (tabs (my-tabs-mode-persp-window)))
    (<span class="org-keyword">cond</span>
     ((window-dedicated-p) (delete-window) t)
     ((eq buf (doom-fallback-buffer)) (message <span class="org-string">"Can't kill the fallback buffer."</span>) t)
     ((doom-real-buffer-p buf)
      (<span class="org-keyword">let</span> ((doom-inhibit-switch-buffer-hooks-original doom-inhibit-switch-buffer-hooks)
            (inhibit-redisplay t)
            buffer-list-update-hook)
        (<span class="org-keyword">if</span> (memq buf tabs)
            (<span class="org-keyword">progn</span>
              (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> (doom-real-buffer-p buf)
                         (buffer-file-name buf)
                         (buffer-modified-p buf)
                         (not (y-or-n-p (format <span class="org-string">"Buffer %s has unsaved changes; kill it anyway?"</span> buf))))
                (<span class="org-warning">user-error</span> <span class="org-string">"Aborted"</span>))
              (tab-line-close-tab))
          (<span class="org-keyword">with-current-buffer</span> buf
            (restore-buffer-modified-p nil))
          (kill-buffer buf))
        (<span class="org-keyword">setq</span> doom-inhibit-switch-buffer-hooks doom-inhibit-switch-buffer-hooks-original))
      (run-hooks 'buffer-list-update-hook)
      t))))
</pre>
</div>

<p>
To finish the window changes, I need to make sure Doom does not switch to the fallback buffer (a.k.a. the Dashboard buffer) when there are no more buffers left on the window:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 152: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(advice-remove 'kill-current-buffer #'doom--switch-to-fallback-buffer-maybe-a)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge8728a6" class="outline-3">
<h3 id="orge8728a6"><span class="section-number-3">3.5</span> Special modes</h3>
<div class="outline-text-3" id="text-3-5">
<p>
The configuration in this section, belongs to some modes that I use all over the place or that are not big enough to justify their own section in this document.
</p>

<p>
In practice, most of the configurations here are about the mode's appearance, and where they show their content.
</p>
</div>

<div id="outline-container-org50ec441" class="outline-4">
<h4 id="org50ec441"><span class="section-number-4">3.5.1</span> Info mode</h4>
<div class="outline-text-4" id="text-3-5-1">
<p>
The Info mode is where all user manuals exist. Up to now, I'm not used to read and search through the manuals, but I feel this is a habit I must acquire.
</p>

<p>
First I need to make the manuals to <i>look</i> nicer (if you're rolling your eyes right now, have a remembering read into the section <a href="#org127970e">3.3</a>).
</p>

<p>
Although this is not a radical change, there are two font lock additions I want to do. The first is a symbol to represent the <i>menu</i> for the current info page, and the second is to replace the <code>*</code> character as the list item markup, by the character I will use on all other modes that deal with lists:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 153: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> info
  (font-lock-add-keywords
   'Info-mode
   `((<span class="org-string">"^</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">\\*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"> "</span>
      (0 (<span class="org-keyword">prog1</span> () (compose-region (match-beginning 1) (match-end 1) <span class="org-string">"&#8226;"</span>))))
     (<span class="org-string">"^[\t ]*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">\\*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"> Menu</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">:</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span>
      (0 (<span class="org-keyword">prog1</span> ()
           (compose-region (match-beginning 1) (match-end 1) <span class="org-string">"&#9776;"</span>)
           (put-text-property (match-beginning 2) (match-end 2) 'invisible t)
           )))) <span class="org-warning">t))</span>
</pre>
</div>

<p>
There is a package called <a href="https://www.emacswiki.org/emacs/InfoPlus"><code>info+.el</code></a>, available through the Emacs Wiki, that fontify the <code>Info-mode</code> buffer to make it look nicer.
</p>

<p>
Unfortunately the latest changes introduced in March broke the package on Emacs 27 and 28, so in order to still have the nice feature it provides with a version that still works on my Emacs, I need to <i>pin</i> the package to the version that still works:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 154: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> info-plus <span class="org-builtin">:pin</span> <span class="org-string">"5ecd4c1e3f1384bffb386e61a8e3788652e55c25"</span>)
</pre>
</div>

<p>
Due to the nature of this package, we need to load it only when we need to fontify the buffer:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 155: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> info-plus <span class="org-builtin">:commands</span> Info-toggle-fontify-all)
</pre>
</div>

<p>
But when this actually happens? The best place to add this, is the hook <code>Info-selection-hook</code>. First I need to define a function that will configure the mode when any info page gets selected:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 156: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-info--fontify-info-h</span> ()
  <span class="org-doc">"Hook called to fontify the Info buffer.</span>

<span class="org-doc">This function lexically bind some configuration for the `</span><span class="org-doc"><span class="org-constant">into-plus</span></span><span class="org-doc">' package,</span>
<span class="org-doc">and call the `</span><span class="org-doc"><span class="org-constant">Info-toggle-fontify-all</span></span><span class="org-doc">' to perform the fontification work.</span>

<span class="org-doc">Notice we need to update the font lock overlays after this call to guarantee</span>
<span class="org-doc">the fontification didn't remove any important overlay."</span>
  (<span class="org-keyword">let</span> ((Info-fontify-angle-bracketed-flag nil)
        (Info-fontify-bookmarked-xrefs-flag nil)
        (Info-fontify-emphasis-flag nil)
        (Info-fontify-glossary-words nil)
        (Info-fontify-isolated-quote-flag nil)
        (Info-fontify-quotations nil)
        (Info-fontify-reference-items-flag nil)
        (Info-fontify-visited-nodes nil))
    (call-interactively 'Info-toggle-fontify-all)
    (font-lock-update)))
</pre>
</div>

<p>
Then, I can hook it to the <code>Info-selection-hook</code> hook:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 157: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">add-hook!</span> Info-selection #'my-info--fontify-info-h)
</pre>
</div>

<p>
The next step is to make sure the <code>Info-mode</code> respects the typography I defined earlier. First we clean up any outstanding setup to the faces that need to get adjusted:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 158: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(my-typography-reset (<span class="org-keyword">cl-loop</span> for i from 1 to 4 collect (intern (format <span class="org-string">"info-title-%d"</span> i))))
(my-typography-reset 'info-menu-header)
</pre>
</div>

<p>
And then, we modify all the faces to match my particular configuration:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 159: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(custom-set-faces!
  '(info-title-1 <span class="org-builtin">:inherit</span> outline-1 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  '(info-title-2 <span class="org-builtin">:inherit</span> outline-2 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  '(info-title-3 <span class="org-builtin">:inherit</span> outline-3 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  '(info-title-4 <span class="org-builtin">:inherit</span> outline-4 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  '(info-menu-header <span class="org-builtin">:inherit</span> outline-5 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  `(info-quoted-name <span class="org-builtin">:inherit</span> font-lock-constant-face)
  `(info-isolated-quote <span class="org-builtin">:inherit</span> info-quoted-name)
  `(info-isolated-backquote <span class="org-builtin">:inherit</span> info-quoted-name)
  `(info-glossary-word <span class="org-builtin">:foreground</span> ,(doom-color 'type 256)
                       <span class="org-builtin">:background</span> ,(doom-darken 'type 0.7)
                       <span class="org-builtin">:box</span> (<span class="org-builtin">:line-width</span> (4 . 1) <span class="org-builtin">:color</span> ,(doom-darken 'type 0.7) <span class="org-builtin">:style</span> nil)
                       <span class="org-builtin">:inherit</span> fixed-pitch)
  `(link-visited <span class="org-builtin">:foreground</span> ,(doom-color 'violet 256))
  `(info-double-quoted-name <span class="org-builtin">:inherit</span> font-lock-string-face)
  `(info-string <span class="org-builtin">:inherit</span> font-lock-string-face)
  `(info-header-node <span class="org-builtin">:height</span> 160
                     <span class="org-builtin">:inherit</span> info-node)
  `(info-header-xref <span class="org-builtin">:height</span> 160
                     <span class="org-builtin">:inherit</span> info-xref))
</pre>
</div>

<p>
There are two remaining configurations. The first one is to make the <code>Info-mode</code> buffer to match how it gets displayed on the editor. I will use <code>writeroom</code> to make the buffer centralized on the window, and will turn on <code>variable-pitch-mode</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 160: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-info-buffer-config-h</span> ()
  (<span class="org-keyword">setq</span> writeroom-width 75)
  (<span class="org-keyword">let</span> ((+zen-text-scale 0))
    (+zen/toggle))
  (variable-pitch-mode 1)
  (visual-line-mode 1))
</pre>
</div>

<p>
With the function that will configure my buffer in place, I need to hook it to the mode initialization:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 161: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">add-hook!</span> Info-mode #'my-info-buffer-config-h)
</pre>
</div>

<p>
The last configuration for the <code>Info-mode</code> is <b>where</b> its buffer gets displayed. For me, it should show up on the right side of my screen. I can achieve that with a popup rule for the buffer:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 162: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(set-popup-rule! <span class="org-string">"^\\*info\\*$"</span>
  <span class="org-builtin">:slot</span> 2   <span class="org-builtin">:vslot</span> -1     <span class="org-builtin">:side</span> 'right  <span class="org-builtin">:width</span> 85 <span class="org-builtin">:height</span> 0.4
  <span class="org-builtin">:select</span> t <span class="org-builtin">:modeline</span> nil <span class="org-builtin">:autosave</span> nil <span class="org-builtin">:ttl</span> 0    <span class="org-builtin">:quit</span> t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org4a8f0c9" class="outline-4">
<h4 id="org4a8f0c9"><span class="section-number-4">3.5.2</span> Help mode and Man mode</h4>
<div class="outline-text-4" id="text-3-5-2">
<p>
I want to give a similar treatment I did to the <code>Info-mode</code> to both these modes, and like the <code>Info-mode</code>, the first thing to do is to create the functions that will configure these modes:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 163: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-help-man-buffer-config-h</span> ()
  (<span class="org-keyword">setq</span> writeroom-width 75)
  (<span class="org-keyword">let</span> ((+zen-text-scale 0))
    (+zen/toggle))
  (visual-line-mode 1))
</pre>
</div>

<p>
And then, hook them up to their modes hooks:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 164: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">add-hook!</span> (help-mode
            helpful-mode
            Man-mode
            WoMan-mode)
           #'my-help-man-buffer-config-h)
</pre>
</div>

<p>
The last step on these configuration is to add a popup rule for each mode to make their buffers to open on the right side of the editor:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 165: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(set-popup-rule! <span class="org-string">"^\\*[Hh]elp"</span>
  <span class="org-builtin">:slot</span> 2   <span class="org-builtin">:vslot</span> -1     <span class="org-builtin">:side</span> 'right  <span class="org-builtin">:width</span> 85 <span class="org-builtin">:height</span> 0.4
  <span class="org-builtin">:select</span> t <span class="org-builtin">:modeline</span> nil <span class="org-builtin">:autosave</span> nil <span class="org-builtin">:ttl</span> 0    <span class="org-builtin">:quit</span> t)

(set-popup-rule! <span class="org-string">"^\\*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">Wo</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?Man "</span>
  <span class="org-builtin">:slot</span> 2   <span class="org-builtin">:vslot</span> -1     <span class="org-builtin">:side</span> 'right  <span class="org-builtin">:width</span> 88 <span class="org-builtin">:height</span> 0.4
  <span class="org-builtin">:select</span> t <span class="org-builtin">:modeline</span> nil <span class="org-builtin">:autosave</span> nil <span class="org-builtin">:ttl</span> 0     <span class="org-builtin">:quit</span> t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org79a69eb" class="outline-4">
<h4 id="org79a69eb"><span class="section-number-4">3.5.3</span> Rainbow mode</h4>
<div class="outline-text-4" id="text-3-5-3">
<p>
The Rainbow mode is a small visual helper to display colors on the buffer, whenever it finds a string that can be a color.
</p>

<p>
I already configured a key binding (<code>SPC t R</code>) to toggle this mode.
</p>

<p>
What I still need to do, is to make sure that I use a fixed font when displaying the color text, unfortunately, the <code>rainbow-mode</code> uses an anonymous face to display the colors, so the only way for me to customize it, is to override the <code>rainbow-colorize-match</code> with a function that add any property I want to the face (in this case, to inherit from the <code>fixed-pitch</code> face):
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 166: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-fontify-rainbow-colorize-match-a (color <span class="org-type">&amp;optional</span> match)
  <span class="org-doc">"Return a matched string propertized with a face whose background is COLOR.</span>

<span class="org-doc">This function computes the foreground using `</span><span class="org-doc"><span class="org-constant">rainbow-color-luminance</span></span><span class="org-doc">', and is</span>
<span class="org-doc">either white or black."</span>
  <span class="org-builtin">:override</span> 'rainbow-colorize-match
  (<span class="org-keyword">let</span> ((match (<span class="org-keyword">or</span> match 0)))
    (put-text-property
     (match-beginning match) (match-end match)
     'face `((<span class="org-builtin">:foreground</span> ,(<span class="org-keyword">if</span> (&gt; 0.5 (rainbow-x-color-luminance color))
                               <span class="org-string">"white"</span> <span class="org-string">"black"</span>))
             (<span class="org-builtin">:background</span> ,color)
             (<span class="org-builtin">:inherit</span> fixed-pitch)))))
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgcbc3ef3" class="outline-2">
<h2 id="orgcbc3ef3"><span class="section-number-2">4</span> Temporary workarounds</h2>
<div class="outline-text-2" id="text-4">
<p>
This section contain configurations that will get integrated on Doom on a relative short period of time. This means that sooner or later, sections here will get replaced by a better module from Doom.
</p>
</div>

<div id="outline-container-orga79a25d" class="outline-3">
<h3 id="orga79a25d"><span class="section-number-3">4.1</span> <span class="todo TODO">TODO</span> Completion framework</h3>
<div class="outline-text-3" id="text-4-1">
<p>
What I call the completion framework, is what we use to incrementally select an input when using the interactive mode.
</p>

<p>
We call the standard interactive mode on Emacs <a href="https://www.gnu.org/software/emacs/manual/html_mono/ido.html">Ido</a> (<a href="https://www.emacswiki.org/emacs/InteractivelyDoThings">Interactively Do Things</a>), and users have been building packages to improve or replace it for ages. Among the most famous package are:
</p>

<dl class="org-dl">
<dt>Icomplete</dt><dd>Bundled with Emacs;</dd>
<dt>Helm</dt><dd>One of the first heavy weight contender to replace Ido;</dd>
<dt>Ivy</dt><dd>Created as a lightweight version of Helm, with the goal to achieve parity with Help at a minimum;</dd>
</dl>

<p>
When I was writing this document, one of the <i>new kids on the block</i> for completion framework was a set of packages that I kindly named <i>Selectrum and Friends</i>. The list of packages that compose this set are:
</p>

<dl class="org-dl">
<dt><a href="https://github.com/raxod502/selectrum">Selectrum</a></dt><dd>A better solution for incremental narrowing in Emacs, replacing Helm, Ivy, and Ido;</dd>
<dt><a href="https://github.com/minad/marginalia">Marginalia</a></dt><dd>Marginalia are marks or annotations placed at the margin of the page of a book or in this case helpful colorful annotations placed at the margin of the minibuffer for your completion candidates;</dd>
<dt><a href="https://github.com/oantolin/orderless">Orderless</a></dt><dd>A completion style that divides the pattern into space-separated components, and matches candidates that match all of the components in any order;</dd>
<dt><a href="https://github.com/raxod502/prescient.el">Prescient</a></dt><dd>A library which sorts and filters lists of candidates, such as appear when you use a package like Ivy or Company;</dd>
<dt><a href="https://github.com/oantolin/embark/">Embark</a></dt><dd>A sort of right-click contextual menu for Emacs, accessed through the embark-act command, offering you relevant actions to use on a target determined by the current context;</dd>
<dt><a href="https://github.com/minad/consult">Consult</a></dt><dd>Provides handy commands based on the Emacs completion function completing-read, which allows to quickly select an item from a list of candidates with completion;</dd>
</dl>

<p>
Unfortunately, these packages are not yet bundled in Doom, so I have to install and configure them here until the Pull Request <a href="https://github.com/hlissner/doom-emacs/pull/4664">#4664</a> gets merged.
</p>

<p>
The appeal of <i>Selectrum and Friends</i>, is the fact they use the standard Emacs features to achieve their goals, this way, there is a better chance to not need to change my configuration in the future, even if I decide to use a different package for the completion UI.
</p>

<p>
To configure all these packages on Doom, I have to do it in the following order:
</p>

<ul class="org-ul">
<li>Configure result filtering and mach highlights;</li>
<li>Configure result sorting;</li>
<li>Configure result item annotations (to display extra information for each completion candidate);</li>
<li>Configure the completion UI;</li>
<li>Configure contextual menu;</li>
<li>Configure extra commands;</li>
<li>Alter the standard behavior of Doom Emacs, to fit my preferences;</li>
</ul>
</div>

<div id="outline-container-org3ba2789" class="outline-4">
<h4 id="org3ba2789"><span class="section-number-4">4.1.1</span> Filtering and highlighting</h4>
<div class="outline-text-4" id="text-4-1-1">
<p>
The first package I want to install is <code>orderless</code>. This package augment the standard Emacs completion system providing multiple matches for your input.
</p>

<p>
First, we need to add it to <code>packages.el</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 167: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> orderless)
</pre>
</div>

<p>
And then configure it with <code>use-package!</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 168: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> orderless
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> orderless-component-separator <span class="org-string">"[ &amp;]"</span>
        orderless-matching-styles '(orderless-prefixes
                                    orderless-initialism
                                    orderless-regexp))
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setq</span> completion-styles '(orderless))
  (<span class="org-keyword">setq</span> orderless-skip-highlighting (<span class="org-keyword">lambda</span> () selectrum-active-p))
  (<span class="org-keyword">setq</span> selectrum-highlight-candidates-function #'orderless-highlight-matches)
  (<span class="org-keyword">setq</span> orderless-matching-styles '(orderless-regexp)
        orderless-style-dispatchers '(flex-if-twiddle
                                      without-if-bang)))
</pre>
</div>

<p>
You might have noticed that the last configuration we perform on <code>orderless</code>, uses two functions not implemented by default. The idea on these two functions is to create extra dispatchers to allow us more control on our searches.
</p>

<p>
The first of the functions is <code>flex-if-twiddle</code>. This dispatcher allows one to type a <code>~</code> on the input to trigger the <i>flex</i> search style (which is a resemblance of fuzzy finder).
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 169: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">flex-if-twiddle</span> (pattern _index _total)
  <span class="org-doc">"Return the `</span><span class="org-doc"><span class="org-constant">orderless-flex</span></span><span class="org-doc">' dispatcher if the search contains a ~ character."</span>
  (<span class="org-keyword">when</span> (string-suffix-p <span class="org-string">"~"</span> pattern)
    `(orderless-flex . ,(substring pattern 0 -1))))
</pre>
</div>

<p>
And the second one is <code>without-if-bang</code> which allow us to have a negation operator on our searches.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 170: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">without-if-bang</span> (pattern _index _total)
  <span class="org-doc">"Define a '!not' exclusion prefix for literal strings."</span>
  (<span class="org-keyword">when</span> (string-prefix-p <span class="org-string">"!"</span> pattern)
    `(orderless-without-literal . ,(substring pattern 1))))
</pre>
</div>

<p>
On company, the matching portions of candidates are not highlighted. That’s because <code>company-capf</code> is hard-coded to look for the <code>completions-common-part</code> face, and it only use one face (<code>company-echo-common</code>) to highlight candidates.
</p>

<p>
So, while you can’t get different faces for different components, you can at least get the matches highlighted in the sole available face with this configuration:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 171: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-orderless-match-with-one-face-a (fn <span class="org-type">&amp;rest</span> args)
  <span class="org-doc">"Function to help company to highlight all candidates with just one face."</span>
  <span class="org-builtin">:around</span> 'company-capf--candidates
  (<span class="org-keyword">let</span> ((orderless-match-faces [completions-common-part]))
    (apply fn args)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5de25a1" class="outline-4">
<h4 id="org5de25a1"><span class="section-number-4">4.1.2</span> Sorting</h4>
<div class="outline-text-4" id="text-4-1-2">
<p>
<code>orderless</code> works pretty well, but there is one aspect of it that bothers me: the lack of a sorting system. I couldn't decide if I should use <code>prescient</code> (recommended by the <code>selectrum</code> author) and lose the nice things I like about <code>orderless</code>, or use <code>orderless</code> and lose the sorting and remembering mechanism of <code>prescient</code>.
</p>

<p>
Then it hit me: why not use both?
</p>

<p>
The idea is to install <code>prescient</code> but not call <code>(selectrum-prescient-mode 1)</code>. Instead, setup the two required hooks for remembering, and the one variable, later on <code>selectum</code>, to use the <i>preprocessing</i> from <code>prescient</code>. So let's start with <code>packages.el</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 172: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> selectrum-prescient)
</pre>
</div>

<p>
Then, let's configure it, and set the persistent mode:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 173: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> selectrum-prescient
  <span class="org-builtin">:hook</span> (selectrum-mode . selectrum-prescient-mode)
  <span class="org-builtin">:hook</span> (selectrum-mode . prescient-persist-mode)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setq</span> selectrum-preprocess-candidates-function #'selectrum-prescient--preprocess)
  (add-hook 'selectrum-candidate-selected-hook #'selectrum-prescient--remember)
  (add-hook 'selectrum-candidate-inserted-hook #'selectrum-prescient--remember))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb5798d9" class="outline-4">
<h4 id="orgb5798d9"><span class="section-number-4">4.1.3</span> Candidates annotations</h4>
<div class="outline-text-4" id="text-4-1-3">
<p>
The next package is <code>marginalia</code>. This package will add annotations on candidates depending on the context of it. Think about it as a sort of <code>ivy-rich</code>, but more organized and use to customize.
</p>

<p>
As with <code>ordeless</code>, we need to first, add it to the <code>packages.el</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 174: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> marginalia)
</pre>
</div>

<p>
Then, configure it using <code>use-packages!</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 175: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> marginalia
  <span class="org-builtin">:hook</span> (doom-first-input . marginalia-mode)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq-default</span> marginalia-annotators '(marginalia-annotators-heavy))
  <span class="org-builtin">:config</span>
  (add-to-list 'marginalia-command-categories '(persp-switch-to-buffer . buffer)))
</pre>
</div>

<p>
At this point, our completion system can filter its candidates (<code>orderless</code>) and display extra information for each one of them (<code>marginalia</code>), all that using the Emacs default completion system and UI, which is not up to my taste, so let's get the main package of this section.
</p>
</div>
</div>

<div id="outline-container-org0b4e7e2" class="outline-4">
<h4 id="org0b4e7e2"><span class="section-number-4">4.1.4</span> Completion UI</h4>
<div class="outline-text-4" id="text-4-1-4">
<p>
I like to have a vertical and more dynamic completion UI. Here is where <code>selectrum</code> comes in play. So let's install it.
</p>

<p>
First add <code>selectrum</code> itself to <code>packages.el</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 176: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> selectrum)
</pre>
</div>

<p>
And set it up with <code>use-packages!</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 177: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> selectrum
  <span class="org-builtin">:hook</span> (doom-first-input . selectrum-mode)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> selectrum-display-action nil
        selectrum-num-candidates-displayed 15
        selectrum-extend-current-candidate-highlight t)
  (<span class="org-keyword">unless</span> (<span class="org-keyword">featurep!</span> +orderless)
    (<span class="org-keyword">setq</span> completion-styles '(substring partial-completion)))
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setq</span> selectrum-fix-vertical-window-height 17
        selectrum-max-window-height 17)

  (map!
   <span class="org-builtin">:g</span> <span class="org-string">"C-s-r"</span> #'selectrum-repeat
   (<span class="org-builtin">:map</span> selectrum-minibuffer-map
    <span class="org-builtin">:geni</span> <span class="org-string">"M-RET"</span> #'selectrum-submit-exact-input
    <span class="org-builtin">:geni</span> <span class="org-string">"C-j"</span>   #'selectrum-next-candidate
    <span class="org-builtin">:geni</span> <span class="org-string">"C-S-j"</span> #'selectrum-next-page
    <span class="org-builtin">:geni</span> <span class="org-string">"C-s-j"</span> #'selectrum-goto-end
    <span class="org-builtin">:geni</span> <span class="org-string">"C-k"</span>   #'selectrum-previous-candidate
    <span class="org-builtin">:geni</span> <span class="org-string">"C-S-k"</span> #'selectrum-previous-page
    <span class="org-builtin">:geni</span> <span class="org-string">"C-s-k"</span> #'selectrum-goto-beginning)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 178: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-selectrum-refresh-on-cycle-a (<span class="org-type">&amp;rest</span> _)
  <span class="org-builtin">:after</span> 'marginalia-cycle
  (<span class="org-keyword">when</span> (<span class="org-keyword">bound-and-true-p</span> selectrum-mode) (selectrum-exhibit)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orge32579e" class="outline-4">
<h4 id="orge32579e"><span class="section-number-4">4.1.5</span> Contextual Menu</h4>
<div class="outline-text-4" id="text-4-1-5">
<p>
The next package is a kind of gem I read about. It will allow you to select different actions on a completion candidate based on its context. This package is <code>embark</code>. And again, let's start with <code>packages.el</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 179: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> embark)
(<span class="org-keyword">package!</span> embark-consult)
</pre>
</div>

<p>
Now we can configure <code>embark</code> with <code>use-package!</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 180: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> embark
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> embark-action-indicator #'my-embark-which-key-action-indicator
        embark-become-indicator embark-action-indicator)
  (map!
    <span class="org-builtin">:g</span> <span class="org-string">"C-s-e"</span> #'embark-act
    (<span class="org-builtin">:map</span> minibuffer-local-completion-map
          <span class="org-string">"C-c C-o"</span> #'embark-export)
    (<span class="org-builtin">:map</span> embark-file-map
          <span class="org-builtin">:desc</span> <span class="org-string">"Open Dired on target"</span> <span class="org-builtin">:g</span> <span class="org-string">"j"</span> #'ffap-dired
          <span class="org-builtin">:desc</span> <span class="org-string">"Open target with sudo"</span> <span class="org-builtin">:g</span> <span class="org-string">"s"</span> #'sudo-edit
          <span class="org-builtin">:desc</span> <span class="org-string">"Open target with vlf"</span> <span class="org-builtin">:g</span> <span class="org-string">"l"</span> #'vlf)
    (<span class="org-builtin">:map</span> embark-file-map
          <span class="org-builtin">:desc</span> <span class="org-string">"Cycle marginalia views"</span> <span class="org-builtin">:g</span> <span class="org-string">"A"</span> #'marginalia-cycle)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 181: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-embark-which-key-action-indicator</span> (map)
  <span class="org-doc">"Helper function to display the `</span><span class="org-doc"><span class="org-constant">whichey</span></span><span class="org-doc">' help buffer for embark."</span>
  (which-key--show-keymap <span class="org-string">"Embark"</span> map nil nil 'no-paging)
  #'which-key--hide-popup-ignore-command)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 182: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> embark-consult
  <span class="org-builtin">:after</span> (embark consult)
  <span class="org-builtin">:hook</span>
  (embark-collect-mode . embark-consult-preview-minor-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcf125ea" class="outline-4">
<h4 id="orgcf125ea"><span class="section-number-4">4.1.6</span> Extra commands</h4>
<div class="outline-text-4" id="text-4-1-6">
<p>
In order to be a full replacement for <code>ivy</code> + <code>counsel</code>, we need to install <code>consult</code>, which comes with a bundle of useful helper commands. Let's start with <code>packages.el</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 183: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> consult)
</pre>
</div>

<p>
Now we need to configure each one of this packages. Let's start with the main <code>consult</code> package:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 184: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> consult
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:init</span>
  (define-key!
    [remap apropos]                       #'consult-apropos
    [remap bookmark-jump]                 #'consult-bookmark
    [remap command-history]               #'consult-complex-command
    [remap evil-show-marks]               #'consult-mark
    [remap goto-line]                     #'consult-goto-line
    [remap grep]                          #'consult-grep
    [remap imenu]                         #'consult-imenu
    [remap isearch]                       #'consult-isearch
    [remap locate]                        #'consult-locate
    [remap load-theme]                    #'consult-theme
    [remap man]                           #'consult-man
    [remap multi-occur]                   #'consult-multi-occur
    [remap projectile-ripgrep]            #'consult-ripgrep
    [remap recentf-open-files]            #'consult-recent-file
    [remap switch-to-buffer]              #'consult-buffer
    [remap switch-to-buffer-other-window] #'consult-buffer-other-window
    [remap switch-to-buffer-other-frame]  #'consult-buffer-other-frame
    [remap view-register]                 #'consult-register
    [remap yank-pop]                      #'consult-yank-pop)

  (map! (<span class="org-builtin">:leader</span>
         <span class="org-builtin">:desc</span> <span class="org-string">"Show mode commands"</span> <span class="org-builtin">:n</span> <span class="org-string">"M-x"</span> #'consult-mode-command

         (<span class="org-builtin">:prefix</span> (<span class="org-string">"s"</span> . <span class="org-string">"search"</span>)
          <span class="org-builtin">:desc</span> <span class="org-string">"Jump to mark globally"</span> <span class="org-builtin">:n</span> <span class="org-string">"R"</span> #'consult-global-mark)

         (<span class="org-builtin">:prefix</span> (<span class="org-string">"f"</span> . <span class="org-string">"find"</span>)
          <span class="org-builtin">:desc</span> <span class="org-string">"Find project file"</span> <span class="org-builtin">:n</span> <span class="org-string">"o"</span> #'consult-find

          (<span class="org-builtin">:prefix</span> (<span class="org-string">"i"</span> . <span class="org-string">"inside"</span>)
           <span class="org-builtin">:desc</span> <span class="org-string">"Find inside file"</span> <span class="org-builtin">:n</span> <span class="org-string">"f"</span> #'consult-lines
           <span class="org-builtin">:desc</span> <span class="org-string">"Find inside file (focus)"</span> <span class="org-builtin">:n</span> <span class="org-string">"F"</span> #'consult-focus-lines)))

        (<span class="org-builtin">:map</span> outline-mode-map <span class="org-builtin">:localleader</span> <span class="org-builtin">:prefix</span> (<span class="org-string">"s"</span> . <span class="org-string">"tree/subtree"</span>)
         <span class="org-builtin">:desc</span> <span class="org-string">"Search outline"</span>  <span class="org-string">"o"</span> #'consult-outline))

  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setq</span> consult-project-root-function #'doom-project-root)
  (<span class="org-keyword">setq</span> completion-in-region-function #'consult-completion-in-region)
  (<span class="org-keyword">setq</span> consult-narrow-key <span class="org-string">"&lt;"</span>)
  (<span class="org-keyword">setq</span> consult-line-numbers-widen t)
  (<span class="org-keyword">setq</span> consult-async-input-debounce 0.5)
  (<span class="org-keyword">setq</span> consult-async-input-throttle 0.8))
</pre>
</div>

<p>
We just set couple functions that are not default to <code>consult</code> and some minor tweaks on its options.
</p>

<p>
At this point, our configuration is matching the standard <code>ivy</code> + <code>counsel</code> duo.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 185: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-extended-yank-pop-a (<span class="org-type">&amp;rest</span> _)
  <span class="org-doc">"Interactively select what text to insert from the kill ring."</span>
  <span class="org-builtin">:override</span> '+default/yank-pop
  (<span class="org-keyword">interactive</span> <span class="org-string">"P"</span>)
  (call-interactively
   (<span class="org-keyword">cond</span> ((fboundp 'counsel-yank-pop)    #'counsel-yank-pop)
         ((fboundp 'consult-yank-pop)    #'consult-yank-pop)
         ((fboundp 'helm-show-kill-ring) #'helm-show-kill-ring)
         ((<span class="org-warning">error</span> <span class="org-string">"No kill-ring search backend available. Enable ivy or helm!"</span>)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 186: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-extended-search-project-a (<span class="org-type">&amp;optional</span> arg)
  <span class="org-doc">"Conduct a text search in the current project root.</span>

<span class="org-doc">If prefix ARG is set, include ignored/hidden files."</span>
  <span class="org-builtin">:override</span> '+default/search-project
  (<span class="org-keyword">interactive</span> <span class="org-string">"P"</span>)
  (<span class="org-keyword">let*</span> ( <span class="org-comment-delimiter">;;  </span><span class="org-comment">(projectile-project-root nil)</span>
         (disabled-command-function nil)
         (current-prefix-arg (<span class="org-keyword">unless</span> (eq arg 'other) arg))
         (default-directory
           (<span class="org-keyword">if</span> (eq arg 'other)
               (<span class="org-keyword">if-let</span> (projects (projectile-relevant-known-projects))
                   (completing-read <span class="org-string">"Search project: "</span> projects nil t)
                 (<span class="org-warning">user-error</span> <span class="org-string">"There are no known projects"</span>))
             default-directory)))
    (call-interactively
     (<span class="org-keyword">cond</span> ((<span class="org-keyword">featurep!</span> <span class="org-builtin">:completion</span> ivy)  #'+ivy/project-search)
           ((<span class="org-keyword">featurep!</span> <span class="org-builtin">:completion</span> helm) #'+helm/project-search)
           ((fboundp 'consult--grep)     #'my-selectrum-project-search)
           (#'projectile-ripgrep)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 187: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-extended-search-cwd-a (<span class="org-type">&amp;optional</span> arg)
  <span class="org-doc">"Conduct a text search in files under the current folder.</span>

<span class="org-doc">If prefix ARG is set, prompt for a directory to search from."</span>
  <span class="org-builtin">:override</span> '+default/search-cwd
  (<span class="org-keyword">interactive</span> <span class="org-string">"P"</span>)
  (<span class="org-keyword">let</span> ((default-directory
          (<span class="org-keyword">if</span> arg
              (read-directory-name <span class="org-string">"Search directory: "</span>)
            default-directory)))
    (call-interactively
     (<span class="org-keyword">cond</span> ((<span class="org-keyword">featurep!</span> <span class="org-builtin">:completion</span> ivy)  #'+ivy/project-search-from-cwd)
           ((<span class="org-keyword">featurep!</span> <span class="org-builtin">:completion</span> helm) #'+helm/project-search-from-cwd)
           ((fboundp 'consult--grep) #'my-selectrum-project-search-from-cwd)
           (#'rgrep)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 188: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">cl-defun</span> <span class="org-function-name">my-selectrum-file-search</span> (<span class="org-type">&amp;key</span> query in all-files (recursive t) prompt args)
  <span class="org-doc">"Conduct a file search using ripgrep.</span>

<span class="org-doc">:query STRING</span>
<span class="org-doc">  Determines the initial input to search for.</span>
<span class="org-doc">:in PATH</span>
<span class="org-doc">  Sets what directory to base the search out of. Defaults to the current</span>
<span class="org-doc">  project's root.</span>
<span class="org-doc">:recursive BOOL</span>
<span class="org-doc">  Whether or not to search files recursively from the base directory."</span>
  (<span class="org-keyword">declare</span> (indent defun))
  (<span class="org-keyword">unless</span> (executable-find <span class="org-string">"rg"</span>)
    (<span class="org-warning">user-error</span> <span class="org-string">"Couldn't find ripgrep in your PATH"</span>))
  (<span class="org-keyword">require</span> '<span class="org-constant">consult</span>)
  (<span class="org-keyword">let*</span> ((this-command 'consult-ripgrep)
         (project-root (<span class="org-keyword">or</span> (doom-project-root) default-directory))
         (directory (<span class="org-keyword">or</span> in project-root))
         (ripgrep-command (mapconcat #'identity (seq-remove 'null
                                      (append (butlast (split-string consult-ripgrep-command <span class="org-string">" +"</span>))
                                              (list
                                               (<span class="org-keyword">when</span> all-files <span class="org-string">"-uu"</span>)
                                               (<span class="org-keyword">unless</span> recursive <span class="org-string">" --maxdepth 1"</span>)
                                               <span class="org-string">"--hidden"</span>
                                               <span class="org-string">"-g!.git"</span>)
                                              args
                                              '(<span class="org-string">"-e"</span>))) <span class="org-string">" "</span>))
         (prompt (<span class="org-keyword">or</span> prompt
                     (format <span class="org-string">"%s [%s]: "</span>
                             ripgrep-command
                             (<span class="org-keyword">cond</span> ((equal directory default-directory) <span class="org-string">"./"</span>)
                                   ((equal directory project-root) (projectile-project-name))
                                   ((file-relative-name directory project-root))))))
         (query (<span class="org-keyword">or</span> query
                    (<span class="org-keyword">when</span> (doom-region-active-p)
                      (replace-regexp-in-string
                       <span class="org-string">"[! |]"</span> (<span class="org-keyword">lambda</span> (substr)
                                 (<span class="org-keyword">cond</span> ((string= substr <span class="org-string">" "</span>) <span class="org-string">"  "</span>)
                                       ((string= substr <span class="org-string">"|"</span>) <span class="org-string">"\\\\\\\\|"</span>)
                                       ((concat <span class="org-string">"\\\\"</span> substr))))
                       (rxt-quote-pcre (doom-thing-at-point-or-region))))
                    <span class="org-string">" "</span>)))
    <span class="org-comment-delimiter">;; </span><span class="org-comment">(setq deactivate-mark t)</span>
    (consult--grep prompt ripgrep-command directory query)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 189: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-selectrum-project-search</span> (<span class="org-type">&amp;optional</span> arg initial-query directory)
  <span class="org-doc">"Performs a live project search from the project root using ripgrep.</span>
<span class="org-doc">If ARG (universal argument), include all files, even hidden or compressed ones,</span>
<span class="org-doc">in the search."</span>
  (<span class="org-keyword">interactive</span> <span class="org-string">"P"</span>)
  (my-selectrum-file-search
    <span class="org-builtin">:prompt</span> (format <span class="org-string">"Find text on project files </span><span class="org-string"><span class="org-warning">\</span></span><span class="org-string">[%s</span><span class="org-string"><span class="org-warning">\</span></span><span class="org-string">]"</span>
                    (<span class="org-keyword">if</span> (<span class="org-keyword">or</span> (<span class="org-keyword">and</span> (not directory) (doom-project-root))
                            (<span class="org-keyword">and</span> directory (equal directory (doom-project-root))))
                        (projectile-project-name)
                      (file-relative-name (<span class="org-keyword">or</span> directory (doom-project-root) default-directory))))
    <span class="org-builtin">:query</span> initial-query
    <span class="org-builtin">:in</span> directory
    <span class="org-builtin">:all-files</span> arg))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 190: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-selectrum-project-search-from-cwd</span> (<span class="org-type">&amp;optional</span> arg initial-query)
  <span class="org-doc">"Performs a project search recursively from the current directory.</span>
<span class="org-doc">If ARG (universal argument), include all files, even hidden or compressed ones."</span>
  (<span class="org-keyword">interactive</span> <span class="org-string">"P"</span>)
  (my-selectrum-project-search arg initial-query default-directory))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfd6f574" class="outline-4">
<h4 id="orgfd6f574"><span class="section-number-4">4.1.7</span> Change Doom's behavior</h4>
<div class="outline-text-4" id="text-4-1-7">
<p>
By default, Doom comes with all its configuration tailored for <code>ivy</code> or <code>helm</code>, this means that some packages will need some help from us to work nicely with <code>selectrum</code> and friends.c
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 191: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-spell-correct-a ()
  <span class="org-doc">"Correct spelling of word at point."</span>
  <span class="org-builtin">:override</span> '+spell/correct
  (<span class="org-keyword">interactive</span>)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">spell-fu fails to initialize correctly if it can't find aspell or a similar</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">program. We want to signal the error, not tell the user that every word is</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">spelled correctly.</span>
  (<span class="org-keyword">unless</span> (<span class="org-comment-delimiter">;; </span><span class="org-comment">This is what spell-fu uses to check for the aspell executable</span>
           or (<span class="org-keyword">and</span> ispell-really-aspell ispell-program-name)
           (executable-find <span class="org-string">"aspell"</span>))
    (<span class="org-warning">user-error</span> <span class="org-string">"Aspell is required for spell checking"</span>))

  (ispell-set-spellchecker-params)
  (<span class="org-keyword">save-current-buffer</span>
    (ispell-accept-buffer-local-defs))
  (<span class="org-keyword">cl-destructuring-bind</span> (start . end)
      (<span class="org-keyword">or</span> (bounds-of-thing-at-point 'word)
          (<span class="org-warning">user-error</span> <span class="org-string">"No word at point"</span>))
    (<span class="org-keyword">let</span> ((word (thing-at-point 'word t))
          (orig-pt (point))
          poss ispell-filter)
      (ispell-send-string <span class="org-string">"%\n"</span>)
      (ispell-send-string (concat <span class="org-string">"^"</span> word <span class="org-string">"\n"</span>))
      (<span class="org-keyword">while</span> (<span class="org-keyword">progn</span> (accept-process-output ispell-process)
                    (not (string= <span class="org-string">""</span> (car ispell-filter)))))
      <span class="org-comment-delimiter">;; </span><span class="org-comment">Remove leading empty element</span>
      (<span class="org-keyword">setq</span> ispell-filter (cdr ispell-filter))
      <span class="org-comment-delimiter">;; </span><span class="org-comment">ispell process should return something after word is sent. Tag word as</span>
      <span class="org-comment-delimiter">;; </span><span class="org-comment">valid (i.e., skip) otherwise</span>
      (<span class="org-keyword">unless</span> ispell-filter
        (<span class="org-keyword">setq</span> ispell-filter '(*)))
      (<span class="org-keyword">when</span> (consp ispell-filter)
        (<span class="org-keyword">setq</span> poss (ispell-parse-output (car ispell-filter))))
      (<span class="org-keyword">cond</span>
       ((<span class="org-keyword">or</span> (eq poss t) (stringp poss))
        <span class="org-comment-delimiter">;; </span><span class="org-comment">don't correct word</span>
        (message <span class="org-string">"%s is correct"</span> (funcall ispell-format-word-function word))
        t)
       ((null poss)
        <span class="org-comment-delimiter">;; </span><span class="org-comment">ispell error</span>
        (<span class="org-warning">error</span> <span class="org-string">"Ispell: error in Ispell process"</span>))
       (t
        <span class="org-comment-delimiter">;; </span><span class="org-comment">The word is incorrect, we have to propose a replacement.</span>
        (<span class="org-keyword">setq</span> res (funcall +spell-correct-interface (nth 2 poss) word))
        <span class="org-comment-delimiter">;; </span><span class="org-comment">Some interfaces actually eat 'C-g' so it's impossible to stop rapid</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">mode. So when interface returns nil we treat it as a stop.</span>
        (<span class="org-keyword">unless</span> res (<span class="org-keyword">setq</span> res (cons 'break word)))
        (<span class="org-keyword">cond</span>
         ((stringp res)
          (+spell--correct res poss word orig-pt start end))
         ((<span class="org-keyword">let</span> ((cmd (car res))
                (wrd (cdr res)))
            (<span class="org-keyword">unless</span> (<span class="org-keyword">or</span> (eq cmd 'skip)
                        (eq cmd 'break)
                        (eq cmd 'stop))
              (+spell--correct cmd poss wrd orig-pt start end)
              (<span class="org-keyword">unless</span> (string-equal wrd word)
                (+spell--correct wrd poss word orig-pt start end))))))
        (ispell-pdict-save t))))))

</pre>
</div>

<p>
The first module we have to change, is <i>workspaces</i>.
</p>
</div>
</div>
</div>

<div id="outline-container-org96b9ab2" class="outline-3">
<h3 id="org96b9ab2"><span class="section-number-3">4.2</span> <span class="todo TODO">TODO</span> Workspaces</h3>
<div class="outline-text-3" id="text-4-2">
<p>
There is one module on Doom that don't play nice with <code>selectrum</code>: <i>Workspace</i> (based on <code>persp-mode</code>).
</p>

<p>
The problem with <i>Workspace</i> is that its base package is buggy, and requires Doom to do a lot of work in order to get it more or less working.
</p>

<p>
Instead of trying to replace functions from this package, we will disable the module entirely and add <code>perspective.el</code>, which is the package <code>persp-mode</code> forked.
</p>

<p>
We already disable the module on our <code>init.el</code> by commenting the line referent to it (you can check it on the <a href="#org5cfd538">1</a> section). But there is another package Doom uses to synchronize its workspaces that conflicts with <code>perspective.el</code>: <code>treemacs-persp</code>.
</p>

<p>
Since we will install another package to sync with <code>treemacs</code>, we can disable this one on our <code>packages.el</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 192: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> treemacs-persp <span class="org-builtin">:disable</span> t)
</pre>
</div>

<p>
The next step is to add the three packages we will use to replace <code>persp-mode</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 193: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> perspective)
(<span class="org-keyword">package!</span> persp-projectile)
(<span class="org-keyword">package!</span> treemacs-perspective)
</pre>
</div>

<p>
With that we can start configuring these packages with <code>use-package!</code>. Let's begin with the main package since it is the most complex:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 194: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> perspective
</pre>
</div>

<p>
Add the trigger to let Doom knows when to actually load the package:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 195: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp"><span class="org-builtin">:hook</span> (doom-first-input . persp-mode)
</pre>
</div>

<p>
<code>perspective.el</code> allows different styles of sorting for its workspaces, the one that is closer to what Doom offers by default is to sort them by the order we create them.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 196: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp"><span class="org-builtin">:custom</span>
(persp-sort 'created)
</pre>
</div>

<p>
It still print the perspectives on the inverse order that we want, but we will fix that behavior when we implement the <i>workspace tab bar</i> later.
</p>

<p>
And since we will implement the default Doom <i>workspace tab bar</i>, we don't need <code>perspective.el</code> to print its perspective on the modeline:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 197: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(persp-show-modestring nil)
</pre>
</div>

<p>
This change is something particular to my taste. Doom set the name of the workspace that never closes to "main". Although this is a good name, I would rater something even more generic:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 198: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(persp-initial-frame-name <span class="org-string">"default"</span>)
</pre>
</div>

<p>
With these configurations we can turn <code>perspective.el</code> on when Doom loads the module:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 199: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp"><span class="org-builtin">:config</span>
(persp-mode 1)
</pre>
</div>

<p>
As mentioned before, Doom has the <i>workspaces</i> module tight coupled with other ares. The problem we have is <code>persp-mode</code>, uses the same mode name of <code>perspective.el</code>, and when some Doom configuration tries to retrieve an information from <i>workspaces</i>, it can't detect we disabled the module.
</p>

<p>
To workaround this, we need to define or alias some functions that Doom expects to be available when <i>workspaces</i> is on:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 200: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">persp-parameter</span> (param-name <span class="org-type">&amp;optional</span> persp)
  (alist-get param-name (persp-local-variables (<span class="org-keyword">or</span> persp (persp-curr)))))

<span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defalias</span> '<span class="org-function-name">get-current-persp</span> #'persp-current-name)

<span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defalias</span> '<span class="org-function-name">safe-persp-name</span> (<span class="org-keyword">lambda</span> (<span class="org-type">&amp;rest</span> _) (persp-current-name)))
</pre>
</div>

<p>
Don't forget to close the <code>use-package!</code> sexp:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 201: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">) <span class="org-comment-delimiter">;; </span><span class="org-comment">use-package! perspective</span>
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 202: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">project-bookmark-alist</span> ()
  (seq-filter
   (<span class="org-keyword">lambda</span> (bm)
     (<span class="org-keyword">when-let</span> ((proj-root (doom-project-root)))
       (not (cl-search <span class="org-string">".."</span> (file-relative-name (bookmark-get-filename bm) proj-root)))))
   bookmark-alist))


<span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">project-bookmark-completing-read</span> (prompt <span class="org-type">&amp;optional</span> default)
  <span class="org-doc">"Prompting with PROMPT, read a bookmark name in completion.</span>

<span class="org-doc">PROMPT will get a \": \" stuck on the end no matter what, so you probably don't</span>
<span class="org-doc">want to include one yourself. Optional arg DEFAULT is a string to return if the</span>
<span class="org-doc">user input is empty. If DEFAULT is nil then return empty string for empty</span>
<span class="org-doc">input."</span>
  (bookmark-maybe-load-default-file)    <span class="org-comment-delimiter">; </span><span class="org-comment">paranoia</span>
  (<span class="org-keyword">if</span> (listp last-nonmenu-event)
      (bookmark-menu-popup-paned-menu t prompt
                                      (<span class="org-keyword">if</span> bookmark-sort-flag
                                          (sort (bookmark-all-names)
                                                'string-lessp)
                                        (bookmark-all-names)))
    (<span class="org-keyword">let*</span> ((completion-ignore-case bookmark-completion-ignore-case)
           (default (<span class="org-keyword">unless</span> (equal <span class="org-string">""</span> default) default))
           (prompt (concat prompt (<span class="org-keyword">if</span> default
                                      (format <span class="org-string">" (%s): "</span> default)
                                    <span class="org-string">": "</span>))))
      (completing-read prompt
                       (<span class="org-keyword">lambda</span> (string pred action)
                         (<span class="org-keyword">if</span> (eq action 'metadata)
                             '(metadata (category . bookmark))
                           (complete-with-action
                            action
                            (project-bookmar-alist)
                            string
                            pred)))
                       nil 0 nil 'bookmark-history default))))


<span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">project-bookmark-jump</span> (bookmark <span class="org-type">&amp;optional</span> display-func)
  <span class="org-doc">"Jump to bookmark BOOKMARK (a point in some file).</span>

<span class="org-doc">You may have a problem using this function if the value of variable</span>
<span class="org-doc">`</span><span class="org-doc"><span class="org-constant">bookmark-alist</span></span><span class="org-doc">' is nil. If that happens, you need to load in some bookmarks.</span>
<span class="org-doc">See help on function `</span><span class="org-doc"><span class="org-constant">bookmark-load</span></span><span class="org-doc">' for more about this.</span>

<span class="org-doc">If the file pointed to by BOOKMARK no longer exists, you will be asked if you</span>
<span class="org-doc">wish to give the bookmark a new location, and `</span><span class="org-doc"><span class="org-constant">bookmark-jump</span></span><span class="org-doc">' will then jump to</span>
<span class="org-doc">the new location, as well as recording it in place of the old one in the</span>
<span class="org-doc">permanent bookmark record.</span>

<span class="org-doc">BOOKMARK is usually a bookmark name (a string).  It can also be a</span>
<span class="org-doc">bookmark record, but this is usually only done by programmatic callers.</span>

<span class="org-doc">If DISPLAY-FUNC is non-nil, it is a function to invoke to display the</span>
<span class="org-doc">bookmark.  It defaults to `</span><span class="org-doc"><span class="org-constant">pop-to-buffer-same-window</span></span><span class="org-doc">'.  A typical value for</span>
<span class="org-doc">DISPLAY-FUNC would be `</span><span class="org-doc"><span class="org-constant">switch-to-buffer-other-window</span></span><span class="org-doc">'."</span>
  (<span class="org-keyword">interactive</span>
   (list (project-bookmark-completing-read <span class="org-string">"Jump to bookmark"</span>
                                           bookmark-current-bookmark)))
  (<span class="org-keyword">unless</span> bookmark
    (<span class="org-warning">error</span> <span class="org-string">"No bookmark specified"</span>))
  (bookmark-maybe-historicize-string bookmark)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Don't use `</span><span class="org-comment"><span class="org-constant">switch-to-buffer</span></span><span class="org-comment">' because it would let the</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">window-point override the bookmark's point when</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">`</span><span class="org-comment"><span class="org-constant">switch-to-buffer-preserve-window-point</span></span><span class="org-comment">' is non-nil.</span>
  (bookmark--jump-via bookmark (<span class="org-keyword">or</span> display-func 'pop-to-buffer-same-window)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 203: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">project-recentf-list</span> ()
  (seq-filter
   (<span class="org-keyword">lambda</span> (fname)
     (<span class="org-keyword">when-let</span> ((proj-root (doom-project-root)))
       (not (cl-search <span class="org-string">".."</span> (file-relative-name fname proj-root)))))
   recentf-list))

<span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">persp-current-real-buffers</span> ()
  <span class="org-doc">"Return a list of names of all living buffers in the current perspective."</span>
  (<span class="org-keyword">let</span> ((ignore-rx (persp--make-ignore-buffer-rx)))
    (<span class="org-keyword">cl-loop</span> for buf in (persp-current-buffers)
             if (<span class="org-keyword">and</span> (doom-real-buffer-p buf)
                     (not (string-match-p ignore-rx (buffer-name buf))))
             collect buf)))

<span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">persp-current-real-buffer-names</span> ()
  <span class="org-doc">"Return a list of names of all living buffers in the current perspective."</span>
  (<span class="org-keyword">let</span> ((ignore-rx (persp--make-ignore-buffer-rx)))
    (<span class="org-keyword">cl-loop</span> for buf in (persp-current-buffers)
             if (<span class="org-keyword">and</span> (doom-real-buffer-p buf)
                     (not (string-match-p ignore-rx (buffer-name buf))))
             collect (buffer-name buf))))

<span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">persp-switch-to-real-buffer*</span> (buffer-or-name)
  <span class="org-doc">"Like `</span><span class="org-doc"><span class="org-constant">switch-to-buffer</span></span><span class="org-doc">', restricted to the current perspective.</span>
<span class="org-doc">This respects ido-ignore-buffers, since we automatically add buffer filtering to</span>
<span class="org-doc">ido-mode already (see use of PERSP-SET-IDO-BUFFERS)."</span>
  (<span class="org-keyword">interactive</span>
   (list
    (<span class="org-keyword">if</span> (<span class="org-keyword">or</span> current-prefix-arg (not persp-mode))
        (<span class="org-keyword">let</span> ((read-buffer-function nil))
          (read-buffer-to-switch <span class="org-string">"Switch to buffer"</span>))
      (<span class="org-keyword">let*</span> ((candidates (persp-current-real-buffer-names))
             (other (buffer-name (persp-other-buffer))))
        <span class="org-comment-delimiter">;; </span><span class="org-comment">NB: This intentionally calls completing-read instead of</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">persp-interactive-completion-function, since it is expected to have</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">been replaced by a completion framework.</span>
        (completing-read (format <span class="org-string">"Switch to buffer%s: "</span>
                                 (<span class="org-keyword">if</span> other
                                     (format <span class="org-string">" (default %s)"</span> other)
                                   <span class="org-string">""</span>))
                         candidates
                         nil nil nil nil
                         (buffer-name (persp-other-buffer)))))))
  (<span class="org-keyword">let</span> ((buffer (window-normalize-buffer-to-switch-to buffer-or-name)))
    (switch-to-buffer buffer)))
</pre>
</div>


<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 204: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">persp-consult-buffer</span> ()
  <span class="org-doc">"Enhanced `</span><span class="org-doc"><span class="org-constant">switch-to-buffer</span></span><span class="org-doc">' command with support for perspectives.</span>

<span class="org-doc">The command supports recent files, bookmarks, views and project files as virtual</span>
<span class="org-doc">buffers. Buffers are previewed. Furthermore narrowing to buffers (b), files (f),</span>
<span class="org-doc">bookmarks (m), views (v) and project files (p) is supported via the</span>
<span class="org-doc">corresponding keys. In order to determine the project-specific files and</span>
<span class="org-doc">buffers, the `</span><span class="org-doc"><span class="org-constant">consult-project-root-function</span></span><span class="org-doc">' is used. The list of available</span>
<span class="org-doc">views is obtained by calling `</span><span class="org-doc"><span class="org-constant">consult-view-list-function</span></span><span class="org-doc">'."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">require</span> '<span class="org-constant">consult</span>)
  (persp-consult--buffer #'switch-to-buffer
                         #'find-file
                         #'bookmark-jump))

(<span class="org-keyword">defun</span> <span class="org-function-name">persp-consult--buffer</span> (open-buffer open-file open-bookmark)
  <span class="org-doc">"Backend implementation of `</span><span class="org-doc"><span class="org-constant">consult-buffer</span></span><span class="org-doc">'.</span>

<span class="org-doc">Depending on the selected item OPEN-BUFFER, OPEN-FILE or OPEN-BOOKMARK will be</span>
<span class="org-doc">used to display the item."</span>
  (<span class="org-keyword">let*</span> ((curr-buf (current-buffer))
         (all-bufs (append (delq curr-buf (persp-current-real-buffers)) (list curr-buf)))
         (buf-file-hash (<span class="org-keyword">let</span> ((ht (make-hash-table <span class="org-builtin">:test</span> #'equal <span class="org-builtin">:size</span> (length all-bufs))))
                          (<span class="org-keyword">dolist</span> (buf all-bufs ht)
                            (<span class="org-keyword">when-let</span> (file (buffer-file-name buf))
                              (puthash file t ht)))))
         (buf-filter (consult--regexp-filter consult-buffer-filter))
         (bufs (mapcar (<span class="org-keyword">lambda</span> (x)
                         (<span class="org-keyword">let</span> ((name (buffer-name x)))
                           (consult--buffer-candidate
                            (<span class="org-keyword">if</span> (string-match-p buf-filter name) ?h ?b)
                            name 'consult-buffer)))
                       all-bufs))
         (views (<span class="org-keyword">when</span> consult-view-list-function
                  (mapcar (<span class="org-keyword">lambda</span> (x)
                            (consult--buffer-candidate ?v x 'consult-view))
                          (funcall consult-view-list-function))))
         (bookmarks (<span class="org-keyword">progn</span>
                      (bookmark-maybe-load-default-file)
                      (mapcar (<span class="org-keyword">lambda</span> (x)
                                (consult--buffer-candidate ?m (car x) 'consult-bookmark))
                              (project-bookmark-alist))))
         (all-files (seq-remove (<span class="org-keyword">lambda</span> (x) (gethash x buf-file-hash)) (project-recentf-list)))
         (files (mapcar (<span class="org-keyword">lambda</span> (x)
                          (consult--buffer-candidate ?f (abbreviate-file-name x) 'consult-file))
                        all-files))
         (proj-root (<span class="org-keyword">and</span> consult-project-root-function (funcall consult-project-root-function)))
         (proj-bufs (<span class="org-keyword">when</span> proj-root
                      (mapcar (<span class="org-keyword">lambda</span> (x)
                                (consult--buffer-candidate ?p (buffer-name x) 'consult-buffer))
                              (seq-filter (<span class="org-keyword">lambda</span> (x)
                                            (<span class="org-keyword">when-let</span> (file (buffer-file-name x))
                                              (string-prefix-p proj-root file)))
                                          all-bufs))))
         (proj-files (<span class="org-keyword">when</span> proj-root
                       (<span class="org-keyword">let</span> ((len (length proj-root))
                             (hidden-root (propertize proj-root 'invisible t)))
                         (mapcar (<span class="org-keyword">lambda</span> (x)
                                   (consult--buffer-candidate
                                    ?q
                                    (concat hidden-root (substring x len))
                                    'consult-file))
                                 (seq-filter (<span class="org-keyword">lambda</span> (x) (string-prefix-p proj-root x)) all-files)))))
         (selected
          (consult--read
           <span class="org-string">"Switch to: "</span> (append bufs files proj-bufs proj-files views bookmarks)
           <span class="org-builtin">:history</span> 'consult--buffer-history
           <span class="org-builtin">:sort</span> nil
           <span class="org-builtin">:predicate</span>
           (<span class="org-keyword">lambda</span> (cand)
             (<span class="org-keyword">let</span> ((type (- (aref cand 0) consult--tofu-char)))
               (<span class="org-keyword">when</span> (= type ?q) (<span class="org-keyword">setq</span> type ?p)) <span class="org-comment-delimiter">;; </span><span class="org-comment">q=project files</span>
               (<span class="org-keyword">if</span> (eq consult--narrow 32) <span class="org-comment-delimiter">;; </span><span class="org-comment">narrowed to hidden buffers</span>
                   (= type ?h)
                 (<span class="org-keyword">and</span>
                  (/= type ?h) <span class="org-comment-delimiter">;; </span><span class="org-comment">non-hidden buffers</span>
                  (<span class="org-keyword">or</span> (not consult--narrow) <span class="org-comment-delimiter">;; </span><span class="org-comment">narrowed</span>
                      (= type consult--narrow))))))
           <span class="org-builtin">:narrow</span> `((32 . <span class="org-string">"Hidden"</span>)
                     (?b . <span class="org-string">"Buffer"</span>)
                     (?f . <span class="org-string">"File"</span>)
                     (?m . <span class="org-string">"Bookmark"</span>)
                     ,@(<span class="org-keyword">when</span> proj-root '((?p . <span class="org-string">"Project"</span>)))
                     ,@(<span class="org-keyword">when</span> consult-view-list-function '((?v . <span class="org-string">"View"</span>))))
           <span class="org-builtin">:category</span> 'consult-buffer
           <span class="org-builtin">:lookup</span>
           (<span class="org-keyword">lambda</span> (_ candidates cand)
             (<span class="org-keyword">if</span> (member cand candidates)
                 (cons (<span class="org-keyword">pcase-exhaustive</span> (- (aref cand 0) consult--tofu-char)
                         (?b open-buffer)
                         (?h open-buffer)
                         (?m open-bookmark)
                         (?v consult-view-open-function)
                         (?p open-buffer)
                         (?q open-file)
                         (?f open-file))
                       (substring cand 1))
               <span class="org-comment-delimiter">;; </span><span class="org-comment">When candidate is not found in the alist,</span>
               <span class="org-comment-delimiter">;; </span><span class="org-comment">default to creating a new buffer.</span>
               (<span class="org-keyword">and</span> (not (string-blank-p cand)) (cons open-buffer cand))))
           <span class="org-builtin">:preview</span>
           (<span class="org-keyword">lambda</span> (cand restore)
             (<span class="org-keyword">cond</span>
              (restore)
              <span class="org-comment-delimiter">;; </span><span class="org-comment">In order to avoid slowness and unnecessary complexity, we</span>
              <span class="org-comment-delimiter">;; </span><span class="org-comment">only preview buffers. Loading recent files, bookmarks or</span>
              <span class="org-comment-delimiter">;; </span><span class="org-comment">views can result in expensive operations.</span>
              ((<span class="org-keyword">and</span> (<span class="org-keyword">or</span> (eq (car cand) #'switch-to-buffer)
                        (eq (car cand) #'switch-to-buffer-other-window))
                    (get-buffer (cdr cand)))
               (funcall (car cand) (cdr cand) 'norecord)))))))
    (<span class="org-keyword">when</span> selected (funcall (car selected) (cdr selected)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 205: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:leader</span>
      <span class="org-builtin">:desc</span> <span class="org-string">"Switch buffer"</span> <span class="org-builtin">:nvm</span> <span class="org-string">","</span> #'persp-consult-buffer
      <span class="org-builtin">:desc</span> <span class="org-string">"Switch to any buffer"</span> <span class="org-builtin">:nvm</span> <span class="org-string">"&lt;"</span> #'consult-buffer)
</pre>
</div>


<p>
Now we can install the <code>projectile</code> extension for <code>perspective.el</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 206: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> persp-projectile <span class="org-builtin">:after</span> (projectile perspective))
</pre>
</div>

<p>
And the one for <code>treemacs</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 207: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> treemacs-perspective <span class="org-builtin">:after</span> (treemacs perspective)
</pre>
</div>

<p>
The <code>treemacs</code> integration, also needs some tweaks to functions and hooks that Doom installs in order to guarantee a better behavior from <code>treemacs</code> and <code>persp-mode</code>.
</p>

<p>
Once Doom loads the <code>treemacs</code> package, we set its scope to <code>'Perspectives</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 208: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp"><span class="org-builtin">:config</span>
(treemacs-set-scope-type 'Perspectives)
</pre>
</div>

<p>
Next, we need to change the <code>treemacs--on-scope-kill</code> function signature. <code>persp-mode</code> calls all hooks from <code>persp-killed-hook</code> with the current perspective as an argument. <code>perspective.el</code> changed this behavior to not send any information when calling hooks.
</p>

<p>
The easiest way to fix this is to create a thin wrapper function for <code>treemacs--on-scope-kill</code> that will call the correct function passing the result of <code>(persp-curr)</code> as an argument:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 209: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defalias</span> '<span class="org-function-name">treemacs--new-on-scope-kill</span>
  (<span class="org-keyword">lambda</span> () (treemacs--on-scope-kill (persp-curr))))
</pre>
</div>

<p>
Then, we can swap the functions on the <code>persp-killed-hook</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 210: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(remove-hook 'persp-killed-hook #'treemacs--on-scope-kill)
(add-hook 'persp-killed-hook #'treemacs--new-on-scope-kill)
</pre>
</div>

<p>
And finish it by closing the sexp for <code>use-package!</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 211: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">)
</pre>
</div>

<p>
The configuration we have so far will get <code>perspective.el</code> working, but not as conveniently as the standard feature on Doom. To achieve the whole functionality, there are two changes we still needs: Dashboard integration and keybindings.
</p>

<p>
As with other keybindings in my configuration, I will get new functions to live on an <i>autoload</i> file, and call them on the mapping.
</p>

<p>
The main idea is to mimic Doom's keybindings, so let's look what binds are available for workspaces:
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Action</th>
<th scope="col" class="org-left">Keybinding</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Display tab bar</td>
<td class="org-left"><code>SPC TAB TAB</code></td>
</tr>

<tr>
<td class="org-left">Switch workspace</td>
<td class="org-left"><code>SPC TAB .</code></td>
</tr>

<tr>
<td class="org-left">Switch to N<sup>th</sup> workspace</td>
<td class="org-left"><code>SPC TAB</code> <i>N</i></td>
</tr>

<tr>
<td class="org-left">Switch to final workspace</td>
<td class="org-left"><code>SPC TAB 0</code></td>
</tr>

<tr>
<td class="org-left">Switch to last used workspace</td>
<td class="org-left"><code>SPC TAB `</code></td>
</tr>

<tr>
<td class="org-left">Previous workspace</td>
<td class="org-left"><code>SPC TAB [</code></td>
</tr>

<tr>
<td class="org-left">Next workspace</td>
<td class="org-left"><code>SPC TAB ]</code></td>
</tr>

<tr>
<td class="org-left">New workspace</td>
<td class="org-left"><code>SPC TAB n</code></td>
</tr>

<tr>
<td class="org-left">Rename workspace</td>
<td class="org-left"><code>SPC TAB r</code></td>
</tr>

<tr>
<td class="org-left">Delete this workspace</td>
<td class="org-left"><code>SPC TAB d</code></td>
</tr>

<tr>
<td class="org-left">Delete session</td>
<td class="org-left"><code>SPC TAB x</code></td>
</tr>

<tr>
<td class="org-left">Delete session and quit</td>
<td class="org-left"><code>SPC TAB X</code></td>
</tr>

<tr>
<td class="org-left">Save session to file</td>
<td class="org-left"><code>SPC TAB s</code></td>
</tr>

<tr>
<td class="org-left">Load session from file</td>
<td class="org-left"><code>SPC TAB l</code></td>
</tr>

<tr>
<td class="org-left">Restore last session</td>
<td class="org-left"><code>SPC TAB R</code></td>
</tr>
</tbody>
</table>

<p>
The next sections will cover each one of these commands, but before we begin, let's prepare our mapping functions:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 212: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! (<span class="org-builtin">:leader</span>
      (<span class="org-builtin">:prefix</span> (<span class="org-string">"TAB"</span> . <span class="org-string">"workspace"</span>)
</pre>
</div>

<p>
Now we can start with the <i>Display tab bar</i> binding, since it is the foundation of Doom's workspace system.
</p>
</div>

<div id="outline-container-orgbb30c03" class="outline-4">
<h4 id="orgbb30c03"><span class="section-number-4">4.2.1</span> Display tab bar</h4>
<div class="outline-text-4" id="text-4-2-1">
<p>
We know Doom uses two special font faces to draw the workspace tab bar (<code>+workspace-tab-selected-face</code> and <code>+workspace-tab-face</code>), but we removed the <code>workspace</code> module from our <code>init.el</code>. To keep our configuration as close to Doom as possible we need to redefine these faces. Let's use our <i>autoload</i> file <code>autoload/workspace.el</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 213: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defface</span> <span class="org-variable-name">+workspace-tab-selected-face</span> '((t (<span class="org-builtin">:inherit</span> highlight)))
  <span class="org-doc">"The face for selected tabs displayed by `</span><span class="org-doc"><span class="org-constant">+workspace/display</span></span><span class="org-doc">'"</span>
  <span class="org-builtin">:group</span> 'persp-mode)


<span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defface</span> <span class="org-variable-name">+workspace-tab-face</span> '((t (<span class="org-builtin">:inherit</span> default)))
  <span class="org-doc">"The face for selected tabs displayed by `</span><span class="org-doc"><span class="org-constant">+workspace/display</span></span><span class="org-doc">'"</span>
  <span class="org-builtin">:group</span> 'persp-mode)
</pre>
</div>

<p>
With the faces defined, we can create a helper function to build the tab bar string using a propertized string so we can simply use it when we need it:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 214: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace--tabline</span> (<span class="org-type">&amp;optional</span> names)
  <span class="org-doc">"Returns the given NAMES list as a propertied string representing each name as a</span>
<span class="org-doc">tab for the current workspace session. If an item on the NAMES list matches the</span>
<span class="org-doc">current workspace name, it will represent this item as a selected item."</span>
  (<span class="org-keyword">let</span> ((names (<span class="org-keyword">or</span> names (reverse (persp-names))))
        (current-name (persp-current-name)))
    (mapconcat
     #'identity
     (<span class="org-keyword">cl-loop</span> for name in names
              for i to (length names)
              collect
              (propertize (format <span class="org-string">" [%d] %s "</span> (1+ i) name)
                          'face (<span class="org-keyword">if</span> (equal current-name name)
                                    '+workspace-tab-selected-face
                                  '+workspace-tab-face)))
     <span class="org-string">" "</span>)))
</pre>
</div>

<p>
Notice that we use <code>reverse</code> when we call <code>(persp-names)</code>. This is to fix the order of tabs that Doom uses.
</p>

<p>
This helper function allows us to build the interactive function we need:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 215: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace/display</span> ()
  <span class="org-doc">"Display a list of workspaces (like tabs) in the echo area."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">when</span> (<span class="org-keyword">bound-and-true-p</span> persp-mode)
    (<span class="org-keyword">let</span> (message-log-max)
      (message <span class="org-string">"%s"</span> (+workspace--tabline)))))
</pre>
</div>

<p>
And we can simply bind it to our shortcut key:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 216: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp"><span class="org-builtin">:desc</span> <span class="org-string">"Display tab bar"</span>           <span class="org-string">"TAB"</span> #'+workspace/display
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf527d4c" class="outline-4">
<h4 id="orgf527d4c"><span class="section-number-4">4.2.2</span> Switch workspace</h4>
<div class="outline-text-4" id="text-4-2-2">
<p>
The <code>persp-projectile</code> package will take care of creating a new workspace for each project we open, but we still need to switch to those workspaces, so let's take care of the <i>Switch workspace</i> binding.
</p>

<p>
Let's list the requirements for such function:
</p>

<ul class="org-ul">
<li>This function needs to be interactive, and if I call it with <code>M-x</code>, it should request the name of the workspace I want to switch to;</li>
<li>I can refer to a workspace when calling this function in two ways:
<ul class="org-ul">
<li>Passing a string representing the workspace name;</li>
<li>Passing a number representing the 1-based index for the workspace on the <i>workspace tab bar</i>;</li>
</ul></li>
<li>If I pass a negative number to the function, it should get the workspace from end to start (e.g. a <code>-3</code> on a <code>10</code> workspaces session would represent workspace <code>8</code>);</li>
<li>If an error happens, we should warn the user;</li>
<li>When the switch is complete, we should display the <i>workspace tab bar</i>;</li>
</ul>

<p>
And here is the implementation for such function:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 217: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace/switch-to</span> (index <span class="org-type">&amp;optional</span> auto-create-p)
  <span class="org-doc">"Switch to a workspace at a given INDEX. A negative number will start from the</span>
<span class="org-doc">end of the workspace list."</span>
  (<span class="org-keyword">interactive</span>
   (<span class="org-keyword">let</span> ((last-used-workspace (+workspace-last-name)))
     (list (completing-read <span class="org-string">"Switch to workspace: "</span>
                            (persp-names)            <span class="org-comment-delimiter">;; </span><span class="org-comment">lis t</span>
                            nil                      <span class="org-comment-delimiter">;; </span><span class="org-comment">filter</span>
                            (not current-prefix-arg) <span class="org-comment-delimiter">;; </span><span class="org-comment">required</span>
                            nil                      <span class="org-comment-delimiter">;; </span><span class="org-comment">initial input</span>
                            nil                      <span class="org-comment-delimiter">;; </span><span class="org-comment">history</span>
                            last-used-workspace))))  <span class="org-comment-delimiter">;; </span><span class="org-comment">default value</span>
  (<span class="org-keyword">when</span> (<span class="org-keyword">bound-and-true-p</span> persp-mode)
    (<span class="org-keyword">condition-case</span> err
        (<span class="org-keyword">let</span> ((target (+workspace-name-from-reference index))
              (old-name (persp-current-name)))
          (<span class="org-keyword">unless</span> target
            (<span class="org-keyword">if</span> (numberp index)
                (+workspace-error <span class="org-string">"No workspace on index #%s"</span> (1+ index))
              (+workspace-error <span class="org-string">"Invalid workspace '%s'"</span> index)))
          (<span class="org-keyword">if</span> (equal target old-name)
              (+workspace-warn <span class="org-string">"Already in %s"</span> old-name)
            (+workspace-switch target (<span class="org-keyword">or</span> current-prefix-arg auto-create-p))
            (+workspace/display)))
      (t (minibuffer-message <span class="org-string">"%s"</span> (+workspace--message-body (error-message-string err) 'error))))))
</pre>
</div>

<p>
If you analyze this function, you'll realize we don't have some of the functions used here. They are:
</p>

<ul class="org-ul">
<li><code>+workspace-last-name</code> to get the name of the last used workspace;</li>
<li><code>+workspace-name-from-reference</code> to get a workspace name from a reference variable;</li>
<li><code>+workspace-switch</code> to call the lower level API to switch the workspace;</li>
<li><code>+workspace-error</code> called when we need to present an error to the user;</li>
<li><code>+workspace-warn</code> called when we need to present a less problematic error to the user;</li>
<li><code>+workspace-internal-error</code> when we find a failure on the internal APIs of <code>perspective.el</code>;</li>
</ul>

<p>
We can start with the last workspace name:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 218: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace-last-name</span> ()
  (<span class="org-keyword">when-let</span> ((last-used-persp (persp-last)))
    (persp-name last-used-persp)))
</pre>
</div>

<p>
Then we can add the function to resolve a workspace name from any type of reference:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 219: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace-name-from-reference</span> (ref)
  <span class="org-doc">"Returns the name of a workspace referenced by REF.</span>

<span class="org-doc">REF can be a perspective object, a string name, a string number, a positive</span>
<span class="org-doc">number, or a negative number. How it retrieves the workspace name depends on the</span>
<span class="org-doc">value of REF:</span>

<span class="org-doc">Perspective object - it access the `</span><span class="org-doc"><span class="org-constant">CL-X-&gt;name</span></span><span class="org-doc">' from the object;</span>

<span class="org-doc">String name - return the same value if a workspace with that name exists;</span>

<span class="org-doc">String number - parse the number and get the workspace name from the index</span>
<span class="org-doc">  representing the parsed number;</span>

<span class="org-doc">Positive number - get the workspace name from the index representing the giving</span>
<span class="org-doc">  number;</span>

<span class="org-doc">Negative number - Access the workspace index from the end to the start too</span>
<span class="org-doc">  retrieve the correct workspace;</span>

<span class="org-doc">If REF does not match a current workspace in any way, it returns nil."</span>
  (<span class="org-keyword">cond</span> ((perspective-p ref) (persp-name ref))
        ((numberp ref) (+workspace-name-from-index ref t))
        ((stringp ref) (<span class="org-keyword">cond</span> ((+workspace-exists-p ref) ref)
                             ((string-match-p <span class="org-string">"^[0-9]+$"</span> ref) (+workspace-name-from-index (string-to-number ref)
                                                                                          t))))))
</pre>
</div>

<p>
This last function needs another helper one, to make sure it returns the correct name for a session on a given index:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 220: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace-name-from-index</span> (index <span class="org-type">&amp;optional</span> noerror)
  <span class="org-doc">"Return the workspace name on INDEX.</span>

<span class="org-doc">This function throw an error if there is no workspace on INDEX. If you pass a</span>
<span class="org-doc">non-nil value to NOERROR, it will return nil when it can't find a workspace.</span>

<span class="org-doc">When INDEX is negative, it access the workspace on the reverse order (e.g. on a</span>
<span class="org-doc">4 workspaces session, -1 access the workspace on index 3)."</span>
  (<span class="org-keyword">or</span> (<span class="org-keyword">when-let</span> ((is-number (numberp index))
                 (names (reverse (persp-names)))
                 (len (length names))
                 (index (<span class="org-keyword">if</span> (&lt; index 0) (+ len index) index))
                 (inbounds (<span class="org-keyword">and</span> (&gt;= index 0) (&lt; index len))))
        (nth index names))
      (<span class="org-keyword">unless</span> noerror
        (+workspace-error <span class="org-string">"There is no workspace on index #%s!"</span> index))))
</pre>
</div>

<p>
And then we can add the low-level API:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 221: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace-switch</span> (name <span class="org-type">&amp;optional</span> auto-create-p)
  <span class="org-doc">"Switch to another workspace named NAME (a string).</span>

<span class="org-doc">If AUTO-CREATE-P is non-nil, create the workspace if it doesn't exist, otherwise</span>
<span class="org-doc">throws an error."</span>
  (<span class="org-keyword">unless</span> (+workspace-exists-p name)
    (<span class="org-keyword">if</span> auto-create-p
        (+workspace-new name)
      (+workspace-error <span class="org-string">"%s is not an available workspace"</span> name)))
  (<span class="org-keyword">let</span> ((old-name (persp-current-name)))
    (<span class="org-keyword">unless</span> (equal old-name name)
      (persp-switch name))
    (equal (persp-current-name) name)))
</pre>
</div>

<p>
This function can brings an existent workspace to the front, or create a new workspace if the given name does not exist and the <code>auto-create-p</code> flag is a non-nil value.
</p>

<p>
In this function, there are three functions we still don't have on our configuration:
</p>

<ul class="org-ul">
<li><code>+workspace-exists-p</code> to check if a workspace with the given name exists;</li>
<li><code>+workspace-new</code> to call actual <i>new perspective</i> function;</li>
<li><code>+workspace-error</code> called when we need to present an error to the user;</li>
</ul>

<p>
Let's start with the <code>+workspace-exists-p</code> function:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 222: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace-exists-p</span> (name)
  <span class="org-doc">"Returns t if NAME is the name of an existing workspace."</span>
  (member name (persp-names)))
</pre>
</div>

<p>
Then, we can implement the <code>workspace-new</code> function:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 223: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace-new</span> (name)
  <span class="org-doc">"Create a new workspace named NAME. If one already exists, return nil.</span>
<span class="org-doc">otherwise return t on success, nil otherwise."</span>
  (<span class="org-keyword">when</span> (+workspace--protected-p name)
    (+workspace-error <span class="org-string">"Can't create a new '%s' workspace"</span> name))
  (<span class="org-keyword">when</span> (+workspace-exists-p name)
    (+workspace-error <span class="org-string">"A workspace named '%s' already exists"</span> name))
  (persp-new name))
</pre>
</div>

<p>
The <code>+workspace-new</code> function have to block the creation of a workspace if the given name is the one used by the main workspace, or if it is the same used on the auto-save feature. These workspace names are what we consider <i>protected</i> names. So let's create a function to check it:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 224: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace--protected-p</span> (name)
  <span class="org-doc">"Return non nil if the given NAME is the default initial</span>
<span class="org-doc">workspace name."</span>
  (<span class="org-keyword">or</span> (equal name +workspaces-main)
      (equal name +workspaces-auto-save-identifier)))
</pre>
</div>

<p>
Let's also define those two variables in case we just want to change them later:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 225: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defvaralias</span> #'+workspaces-main #'persp-initial-frame-name)


<span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defvar</span> <span class="org-variable-name">+workspaces-auto-save-identifier</span> <span class="org-string">"autosave"</span>
  <span class="org-doc">"Identifier used to auto-save the workspace session."</span>)
</pre>
</div>

<p>
Now we need to define our workspaces messaging API. To stay in parity with Doom, we need display the tab bar on the minibuffer, and then a message on its side with the severity of the message color coded.
</p>

<p>
Since we already have a function to display the tabs for us, lets use that function to build a <i>message body</i> for our API:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 226: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace--message-body</span> (text <span class="org-type">&amp;optional</span> type)
  <span class="org-doc">"Returns a propertied string representing a workspace</span>
<span class="org-doc">message.</span>

<span class="org-doc">A workspace message consist of a 'tab line' representation of the workspace</span>
<span class="org-doc">session, with the given TEXT concatenated after it.</span>

<span class="org-doc">The text color changes depending of TYPE passed. If we omit the TYPE, the</span>
<span class="org-doc">function assumes this message is an 'info message.</span>

<span class="org-doc">We associate the message color to the respective font faces, which are:</span>

<span class="org-doc">- 'info</span>
<span class="org-doc">- 'success</span>
<span class="org-doc">- 'warn</span>
<span class="org-doc">- 'error</span>

<span class="org-doc">The only TYPE that does not have a direct font face representation is 'info,</span>
<span class="org-doc">which uses the `</span><span class="org-doc"><span class="org-constant">font-lock-comment-face</span></span><span class="org-doc">' font face."</span>
  (concat (+workspace--tabline)
          (propertize <span class="org-string">" | "</span> 'face 'font-lock-comment-face)
          (propertize (format <span class="org-string">"%s"</span> text)
                      'face (<span class="org-keyword">pcase</span> type
                              ('error 'error)
                              ('warn 'warning)
                              ('success 'success)
                              ('info 'font-lock-comment-face)
                              (_ 'font-lock-comment-face)))))
</pre>
</div>

<p>
With this last function we can implement a generic message function that we can associate to the right calls later:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 227: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace-message</span> (text <span class="org-type">&amp;optional</span> type)
  <span class="org-doc">"Displays the given TEXT message on the echo area, formatted as a workspace</span>
<span class="org-doc">message (see `</span><span class="org-doc"><span class="org-constant">+workspace--message-body</span></span><span class="org-doc">' for details on the formatting) of the</span>
<span class="org-doc">given TYPE. When type is 'error, if thee INTERNAL argument is a non-nil value,</span>
<span class="org-doc">the message will use the `</span><span class="org-doc"><span class="org-constant">persp-error</span></span><span class="org-doc">' function print it, and when it is nil, it</span>
<span class="org-doc">uses the `</span><span class="org-doc"><span class="org-constant">error</span></span><span class="org-doc">' function. Otherwise, it uses the normal `</span><span class="org-doc"><span class="org-constant">message</span></span><span class="org-doc">' function."</span>
  (<span class="org-keyword">cond</span> ((eq type 'error) (<span class="org-warning">error</span> text))
        ((eq type 'user-error) (<span class="org-warning">user-error</span> text))
        ((eq type 'internal-error) (persp-error text))
        (t (message <span class="org-string">"%s"</span> (+workspace--message-body text type)))))
</pre>
</div>

<p>
And now we can define all the <i>end functions</i> for the messaging API.
</p>

<p>
All these functions have the same pattern. Instead of us defining each one of them, we can loop through the list of possible message types, and create a function for each one:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 228: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(mapc (<span class="org-keyword">lambda</span> (type)
        (<span class="org-keyword">defalias</span> (intern (format <span class="org-string">"+workspace-%s"</span> type))
          (<span class="org-keyword">lambda</span> (text <span class="org-type">&amp;rest</span> args)
            (+workspace-message (apply 'format (cons text args)) (intern type)))
          (format <span class="org-string">"Wrapper function around `</span><span class="org-string"><span class="org-constant">+workspace-message</span></span><span class="org-string">' with the arg TYPE set to '%s."</span> type)))
      '(<span class="org-string">"info"</span> <span class="org-string">"success"</span> <span class="org-string">"warn"</span> <span class="org-string">"error"</span> <span class="org-string">"user-error"</span> <span class="org-string">"internal-error"</span>))
</pre>
</div>

<p>
With all the functions necessary to switch between workspaces, I can bind it to their correct key:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 229: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp"><span class="org-builtin">:desc</span> <span class="org-string">"Switch workspace"</span>          <span class="org-string">"."</span>   #'+workspace/switch-to
</pre>
</div>
</div>
</div>

<div id="outline-container-org5122b01" class="outline-4">
<h4 id="org5122b01"><span class="section-number-4">4.2.3</span> Switch to N<sup>th</sup> workspace</h4>
<div class="outline-text-4" id="text-4-2-3">
<p>
Doom allows you to switch workspaces by their index numbers, and since we already have the main function to do the switch, we can just create the others.
</p>

<p>
As  with the message API, the <i>switch to workspace N</i> is repetitive, and we can automate the creation of every one of these functions:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 230: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">dotimes</span> (i 9)
  (<span class="org-keyword">defalias</span> (intern (format <span class="org-string">"+workspace/switch-to-%d"</span> i))
    (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>) (+workspace/switch-to i))
    (format
     <span class="org-string">"Thin wrapper around `</span><span class="org-string"><span class="org-constant">+workspace/switch-to</span></span><span class="org-string">' function where we pass #%d as the INDEX parameter."</span>
     (1+ i))))
</pre>
</div>

<p>
This will create 9 functions to switch to their respective workspace, so let's bind them:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 231: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp"><span class="org-builtin">:desc</span> <span class="org-string">"Switch to 1st workspace"</span>   <span class="org-string">"1"</span>   #'+workspace/switch-to-0
<span class="org-builtin">:desc</span> <span class="org-string">"Switch to 2nd workspace"</span>   <span class="org-string">"2"</span>   #'+workspace/switch-to-1
<span class="org-builtin">:desc</span> <span class="org-string">"Switch to 3rd workspace"</span>   <span class="org-string">"3"</span>   #'+workspace/switch-to-2
<span class="org-builtin">:desc</span> <span class="org-string">"Switch to 4th workspace"</span>   <span class="org-string">"4"</span>   #'+workspace/switch-to-3
<span class="org-builtin">:desc</span> <span class="org-string">"Switch to 5th workspace"</span>   <span class="org-string">"5"</span>   #'+workspace/switch-to-4
<span class="org-builtin">:desc</span> <span class="org-string">"Switch to 6th workspace"</span>   <span class="org-string">"6"</span>   #'+workspace/switch-to-5
<span class="org-builtin">:desc</span> <span class="org-string">"Switch to 7th workspace"</span>   <span class="org-string">"7"</span>   #'+workspace/switch-to-6
<span class="org-builtin">:desc</span> <span class="org-string">"Switch to 8th workspace"</span>   <span class="org-string">"8"</span>   #'+workspace/switch-to-7
<span class="org-builtin">:desc</span> <span class="org-string">"Switch to 9th workspace"</span>   <span class="org-string">"9"</span>   #'+workspace/switch-to-8
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd7069e1" class="outline-4">
<h4 id="orgd7069e1"><span class="section-number-4">4.2.4</span> Switch to final workspace</h4>
<div class="outline-text-4" id="text-4-2-4">
<p>
Doom also provides a shortcut to get to the last opened workspace (last in the sense of order we created them):
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 232: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace/switch-to-final</span> ()
  <span class="org-doc">"Switch to the final workspace in open workspaces."</span>
  (<span class="org-keyword">interactive</span>)
  (+workspace/switch-to (car (persp-names))))
</pre>
</div>

<p>
Now we just need to bind this function:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 233: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp"><span class="org-builtin">:desc</span> <span class="org-string">"Switch to final workspace"</span> <span class="org-string">"0"</span>   #'+workspace/switch-to-final
</pre>
</div>
</div>
</div>

<div id="outline-container-orge919231" class="outline-4">
<h4 id="orge919231"><span class="section-number-4">4.2.5</span> Switch to last used workspace</h4>
<div class="outline-text-4" id="text-4-2-5">
<p>
The next binding is the <i>Switch to last workspace</i>, which luckily has a function defined on <code>perspective.el</code> for it:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 234: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp"><span class="org-builtin">:desc</span> <span class="org-string">"Switch to last used workspace"</span>  <span class="org-string">"`"</span>   #'persp-switch-last
</pre>
</div>
</div>
</div>

<div id="outline-container-org2c02379" class="outline-4">
<h4 id="org2c02379"><span class="section-number-4">4.2.6</span> Previous and next workspace</h4>
<div class="outline-text-4" id="text-4-2-6">
<p>
I'm bundling these two commands together because usually in emacs, you have a function that move to any direction, and then you define different functions for different directions that just call the <i>move</i> function with different parameters.
</p>

<p>
Let's create our <i>cycle</i> function:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 235: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace/cycle</span> (n)
  <span class="org-doc">"Cycle n workspaces to the right (default) or left."</span>
  (<span class="org-keyword">interactive</span> (list 1))
  (<span class="org-keyword">when</span> (<span class="org-keyword">bound-and-true-p</span> persp-mode)
    (<span class="org-keyword">let</span> ((current-name (persp-current-name)))
      (<span class="org-keyword">condition-case-unless-debug</span> err
          (<span class="org-keyword">let*</span> ((persps (reverse (persp-names)))
                 (perspc (length persps))
                 (index (cl-position current-name persps)))
            (<span class="org-keyword">when</span> (= perspc 1)
              (+workspace-user-error <span class="org-string">"No other workspaces"</span>))
            (+workspace/switch-to (% (+ index n perspc) perspc))
            (<span class="org-keyword">unless</span> (called-interactively-p 'interactive)
              (+workspace/display)))
        (t (minibuffer-message <span class="org-string">"%s"</span>
                             (+workspace--message-body
                              (error-message-string err)
                              'error)))))))
</pre>
</div>

<p>
Then, we just need to create a function to move to the previous workspace:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 236: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace/switch-previous</span> ()  (<span class="org-keyword">interactive</span>) (+workspace/cycle -1))
</pre>
</div>

<p>
And one for next one:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 237: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace/switch-next</span> () (<span class="org-keyword">interactive</span>) (+workspace/cycle +1))
</pre>
</div>

<p>
Then, we can bind both functions to their proper keys:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 238: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp"><span class="org-builtin">:desc</span> <span class="org-string">"Previous workspace"</span>        <span class="org-string">"["</span>   #'+workspace/switch-previous
<span class="org-builtin">:desc</span> <span class="org-string">"Next workspace"</span>            <span class="org-string">"]"</span>   #'+workspace/switch-next
</pre>
</div>
</div>
</div>

<div id="outline-container-org54d4b96" class="outline-4">
<h4 id="org54d4b96"><span class="section-number-4">4.2.7</span> New workspace</h4>
<div class="outline-text-4" id="text-4-2-7">
<p>
On the sequence, we have the <i>New workspace</i>. We already created a helper low-level function to spun new workspaces, now we need a command to call that function:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 239: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace/new</span> (<span class="org-type">&amp;optional</span> name)
  <span class="org-doc">"Create a new blank workspace named NAME."</span>
  (<span class="org-keyword">interactive</span>
   (list (<span class="org-keyword">when</span> current-prefix-arg
           (read-from-minibuffer <span class="org-string">"Name for the new workspace: "</span>))))
  (<span class="org-keyword">when</span> (<span class="org-keyword">bound-and-true-p</span> persp-mode)
    (<span class="org-keyword">unless</span> name
      (<span class="org-keyword">setq</span> name (format <span class="org-string">"Unnamed %s"</span> (+workspace--generate-id))))
    (<span class="org-keyword">condition-case</span> err
        (<span class="org-keyword">cond</span> ((+workspace-exists-p name) (+workspace-user-error <span class="org-string">"%s already exists"</span> name))
              (t (+workspace-switch name t)
                 (+workspace/display)))
      (t (minibuffer-message <span class="org-string">"%s"</span> (+workspace--message-body (error-message-string err) 'error))))))
</pre>
</div>

<p>
Notice how we use the <code>auto-create-p</code> functionality on the <code>+workspace-switch</code> function. Also, you might have noticed we use a helper function to get a sequential number when we don't provide a name to the new workspace, and we didn't implement it yet, so let's do it now:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 240: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace--generate-id</span> ()
  <span class="org-doc">"Returns the next sequential number that a new perspective</span>
<span class="org-doc">could use on its name."</span>
  (<span class="org-keyword">or</span> (<span class="org-keyword">cl-loop</span> for name in (persp-names)
               when (string-match-p <span class="org-string">"^Unnamed </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[0-9]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">$"</span> name)
               maximize (string-to-number (substring name
                                                     (match-beginning 1)
                                                     (match-end 1))) <span class="org-warning">into max</span>
               finally return (<span class="org-keyword">if</span> max (1+ max)))
      1))
</pre>
</div>

<p>
This function will iterate over all workspaces and if it finds one called <code>Unnamed N</code>, <code>N</code> becomes the maximum number found. In the end, it returns the maximum number plus one.
</p>

<p>
Now, we just need to bind the main function with its keys:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 241: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp"><span class="org-builtin">:desc</span> <span class="org-string">"New workspace"</span>             <span class="org-string">"n"</span>   #'+workspace/new
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd6c9adb" class="outline-4">
<h4 id="orgd6c9adb"><span class="section-number-4">4.2.8</span> Rename workspace</h4>
<div class="outline-text-4" id="text-4-2-8">
<p>
Going through our list of commands, we need to provide a way for us to rename a giving workspace, specially if we create an empty and unnamed workspace.
</p>

<p>
Let's start with the command function:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 242: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace/rename</span> (new-name)
  <span class="org-doc">"Rename the current workspace."</span>
  (<span class="org-keyword">interactive</span> (list (read-from-minibuffer <span class="org-string">"New workspace name: "</span>)))
  (<span class="org-keyword">when</span> (<span class="org-keyword">bound-and-true-p</span> persp-mode)
    (<span class="org-keyword">condition-case-unless-debug</span> err
        (<span class="org-keyword">let*</span> ((current (persp-current-name))
               (current (<span class="org-keyword">if</span> current-prefix-arg
                            (completing-read (format <span class="org-string">"Select a workspace to rename (default: %s): "</span> current)
                                             (persp-names)           <span class="org-comment-delimiter">;; </span><span class="org-comment">list</span>
                                             (<span class="org-keyword">lambda</span> (ws-name)       <span class="org-comment-delimiter">;; </span><span class="org-comment">filter</span>
                                               (not (string= ws-name +workspaces-main)))
                                             t                       <span class="org-comment-delimiter">;; </span><span class="org-comment">required</span>
                                             nil                     <span class="org-comment-delimiter">;; </span><span class="org-comment">initial input</span>
                                             nil                     <span class="org-comment-delimiter">;; </span><span class="org-comment">history</span>
                                             current)                <span class="org-comment-delimiter">;; </span><span class="org-comment">default value</span>
                          current))
               (old-name (+workspace-rename current new-name)))
          (<span class="org-keyword">unless</span> old-name
            (+workspace-error <span class="org-string">"Failed to rename %s"</span> current))
          (+workspace-success (format <span class="org-string">"Renamed '%s'-&gt;'%s'"</span> old-name new-name)))
      (t (minibuffer-message <span class="org-string">"%s"</span> (+workspace--message-body (error-message-string err) 'error))))))
</pre>
</div>

<p>
Pretty straightforward, but we still need the low-level function that actually renames the workspace:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 243: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace-rename</span> (name new-name)
  <span class="org-doc">"Rename the current workspace named NAME to NEW-NAME. Returns old name on</span>
<span class="org-doc">success, nil otherwise."</span>
  (<span class="org-keyword">cond</span> ((+workspace--protected-p name) (+workspace-error <span class="org-string">"Can't rename `</span><span class="org-string"><span class="org-constant">%s</span></span><span class="org-string">' workspace"</span> name))
        ((not (+workspace-get name)) (+workspace-error <span class="org-string">"Perspective `</span><span class="org-string"><span class="org-constant">%s</span></span><span class="org-string">' does not exists"</span> name))
        ((+workspace-get new-name) (+workspace-error <span class="org-string">"Perspective `</span><span class="org-string"><span class="org-constant">%s</span></span><span class="org-string">' already exists"</span> new-name))
        (t (<span class="org-keyword">progn</span>
             (persp-rename new-name)
             name))))
</pre>
</div>

<p>
This function do 3 validations on the given arguments:
</p>

<ol class="org-ol">
<li>Is the new name one of the protected names?
<i>Should fail if yes</i>;</li>
<li>Is there a real workspace with the given name?
<i>Should fail if no</i>;</li>
<li>Is there a real workspace with the new name?
<i>Should fail if yes</i>;</li>
</ol>

<p>
And to make these validations we still need a function we didn't implement yet:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 244: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace-get</span> (name <span class="org-type">&amp;optional</span> noerror)
  <span class="org-doc">"return a workspace named name. Unless NOERROR is non-nil, this throws an error</span>
<span class="org-doc">if name doesn't exist."</span>
  (<span class="org-warning">cl-check-type</span> name string)
  (<span class="org-keyword">when-let</span> (persp (gethash name (perspectives-hash)))
    (<span class="org-keyword">cond</span> ((perspective-p persp) persp)
          ((not noerror) (+workspace-error <span class="org-string">"There is no workspace called '%s'"</span> name)))))
</pre>
</div>

<p>
Now, with all the functions in place, we can bind the main command to its key:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 245: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp"><span class="org-builtin">:desc</span> <span class="org-string">"Rename workspace"</span>               <span class="org-string">"r"</span>   #'+workspace/rename
</pre>
</div>
</div>
</div>

<div id="outline-container-org0ba7480" class="outline-4">
<h4 id="org0ba7480"><span class="section-number-4">4.2.9</span> Delete this workspace</h4>
<div class="outline-text-4" id="text-4-2-9">
<p>
There are two main tasks still missing in our refactor of Doom Workspaces and this next three sections will cover one of them: Delete (or kill if you want).
</p>

<p>
We will start with the ability to delete a single workspace:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 246: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace/delete</span> (name)
  <span class="org-doc">"Delete workspace named NAME. If called with C-U, prompts you for the name of</span>
<span class="org-doc">the workspace to delete."</span>
  (<span class="org-keyword">interactive</span>
   (<span class="org-keyword">let</span> ((current-name (persp-current-name)))
     (list (<span class="org-keyword">if</span> current-prefix-arg
               (completing-read (format <span class="org-string">"Delete workspace (default: %s): "</span> current-name)
                                (persp-names)           <span class="org-comment-delimiter">;; </span><span class="org-comment">list</span>
                                (<span class="org-keyword">lambda</span> (ws-name)       <span class="org-comment-delimiter">;; </span><span class="org-comment">filter</span>
                                  (not (string= ws-name +workspaces-main)))
                                t                       <span class="org-comment-delimiter">;; </span><span class="org-comment">required</span>
                                nil                     <span class="org-comment-delimiter">;; </span><span class="org-comment">initial input</span>
                                nil                     <span class="org-comment-delimiter">;; </span><span class="org-comment">history</span>
                                current-name)           <span class="org-comment-delimiter">;; </span><span class="org-comment">default value</span>
             current-name))))
  (<span class="org-keyword">when</span> (<span class="org-keyword">bound-and-true-p</span> persp-mode)
    (<span class="org-keyword">condition-case</span> err
        (+workspace-delete name)
      (t (minibuffer-message <span class="org-string">"%s"</span> (+workspace--message-body (error-message-string err) 'error))))))
</pre>
</div>

<p>
The command function simply allows us to select which workspace to delete, or it deletes the current one. As with the other commands, we still need the low-level function that actually deletes the workspace:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 247: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace-delete</span> (workspace)
  <span class="org-doc">"Delete the workspace denoted by WORKSPACE, which can be the name of a</span>
<span class="org-doc">workspace, its index, or the workspace object itself."</span>
  (<span class="org-keyword">let</span> ((ws-name (+workspace-name-from-reference workspace)))
    (<span class="org-keyword">unless</span> ws-name
      (+workspace-error <span class="org-string">"Can't find a workspace for the reference '%s'"</span> workspace))
    (<span class="org-keyword">if</span> (+workspace--protected-p ws-name)
        t
      (persp-kill ws-name)
      (+workspace-success (format <span class="org-string">"Deleted '%s' workspace"</span> workspace))
      (not (+workspace-exists-p ws-name)))))
</pre>
</div>

<p>
Now we can bind the command to its proper key:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 248: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp"><span class="org-builtin">:desc</span> <span class="org-string">"Delete this workspace"</span>          <span class="org-string">"d"</span>   #'+workspace/delete
</pre>
</div>
</div>
</div>

<div id="outline-container-org9176834" class="outline-4">
<h4 id="org9176834"><span class="section-number-4">4.2.10</span> Delete session</h4>
<div class="outline-text-4" id="text-4-2-10">
<p>
The next command on the <i>delete</i> series is to delete all workspaces.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 249: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace/delete-session</span> (<span class="org-type">&amp;optional</span> interactive)
  <span class="org-doc">"Delete the current session, all workspaces, windows and their buffers."</span>
  (<span class="org-keyword">interactive</span> (list t))
  (<span class="org-keyword">when</span> (<span class="org-keyword">bound-and-true-p</span> persp-mode)
    (<span class="org-keyword">condition-case</span> err
        (<span class="org-keyword">let</span> ((windows (length (window-list)))
              (persps (length (persp-names)))
              (buffers 0))
          (<span class="org-keyword">unless</span> (cl-every #'+workspace-delete (persp-names))
            (+workspace-error <span class="org-string">"Could not clear session"</span>))
          (+workspace/switch-to +workspaces-main t)
          (<span class="org-keyword">setq</span> buffers (doom/kill-all-buffers (buffer-list)))
          (<span class="org-keyword">when</span> interactive
            (+workspace-success <span class="org-string">"Killed %s workspace(s), %s window(s) &amp; %s buffer(s)"</span> persps windows buffers)))
        (t (minibuffer-message <span class="org-string">"%s"</span> (+workspace--message-body (error-message-string err) 'error))))))
</pre>
</div>

<p>
And since we only used functions we already have implemented, we can bind it to its key:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 250: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp"><span class="org-builtin">:desc</span> <span class="org-string">"Delete session"</span>                 <span class="org-string">"x"</span>   #'+workspace/delete-session
</pre>
</div>
</div>
</div>

<div id="outline-container-org1014d04" class="outline-4">
<h4 id="org1014d04"><span class="section-number-4">4.2.11</span> Delete session and quit</h4>
<div class="outline-text-4" id="text-4-2-11">
<p>
On the next sections in this document, we will configure session persistence, and the time when we will save our sessions, is when we kill Emacs. If we delete all sessions, and then quit, the result is that Emacs will save our <i>empty</i> session before quitting. Although we might desire this behavior some times, we also need a way to tell emacs to <i>discard</i> our current session. To achieve this, let's define a variable to use as a flag for saving the session or not:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 251: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">+workspace--auto-save-session-p</span> t
  <span class="org-doc">"Flag used to determine if Emacs should automatically save the current session</span>
<span class="org-doc">when we quit."</span>)
</pre>
</div>

<p>
And now, we can have our last command on the <i>delete</i> category to flag Emacs to not save current session when quitting. This way, if we wants to quit and save the current session, we simply quit Emacs, and if we want to discard the current session, we invoke the <i>delete session and quit</i> command:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 252: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace/delete-session-and-quit</span> ()
  <span class="org-doc">"Kill emacs without saving anything."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">when</span> (<span class="org-keyword">bound-and-true-p</span> persp-mode)
    (call-interactively #'+workspace/delete-session)
    (<span class="org-keyword">let</span> ((+workspace--auto-save-session-p nil))
      (kill-emacs))))
</pre>
</div>

<p>
And since we only used functions we already have implemented, we can bind it to its key:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 253: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp"><span class="org-builtin">:desc</span> <span class="org-string">"Delete session and quit"</span>        <span class="org-string">"X"</span>   #'+workspace/delete-session-and-quit
</pre>
</div>
</div>
</div>

<div id="outline-container-orge843bda" class="outline-4">
<h4 id="orge843bda"><span class="section-number-4">4.2.12</span> Save session to file</h4>
<div class="outline-text-4" id="text-4-2-12">
<p>
Our workspace refactor is working as expected, but we still need persistence. <code>perspective.el</code> and <code>persp-mode</code> behave a bit different on this regard. The former can only save your entire session to file, while the latter saves individual workspaces. For me particularly, is not a big issue, but if you rely on such feature, know that you won't have it with my setup.
</p>

<p>
With that out of the way, let's jump right into the first command:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 254: </span>autoload/workspaces.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace/save-session</span> (name)
  <span class="org-doc">"Save the current workspace with the given NAME as its identifier."</span>
  (<span class="org-keyword">interactive</span>
   (list (completing-read <span class="org-string">"Save workspace session to file: "</span>
                          (mapcar
                           (<span class="org-keyword">lambda</span> (file)
                             (string-remove-prefix
                              +workspaces-data-file-prefix (file-name-base file)))
                           (file-expand-wildcards (format <span class="org-string">"%s%s*.dws"</span>
                                                          +workspaces-data-dir
                                                          +workspaces-data-file-prefix))))))
  (<span class="org-keyword">when</span> (<span class="org-keyword">bound-and-true-p</span> persp-mode)
    (<span class="org-keyword">condition-case</span> err
        (<span class="org-keyword">if</span> (+workspace-session-save name)
            (+workspace-success (format <span class="org-string">"'%s' workspace saved"</span> name))
          (+workspace-error (format <span class="org-string">"Could not save workspace %s"</span> name)))
      (t (minibuffer-message <span class="org-string">"%s"</span> (+workspace--message-body (error-message-string err) 'error))))))
</pre>
</div>

<p>
The only part of this function that is worth mentioning is that we show the list of current saved workspaces so we can see what is there when we're choosing a filename.
</p>

<p>
We still need to code our low level  function to save a workspace:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 255: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace-session-save</span> (<span class="org-type">&amp;optional</span> identifier force interactive?)
  <span class="org-doc">"Saves the workspace session to a file named IDENTIFIER located on the</span>
<span class="org-doc">`</span><span class="org-doc"><span class="org-constant">+workspaces-data-dir</span></span><span class="org-doc">' directory. We can load a saved session with</span>
<span class="org-doc">`</span><span class="org-doc"><span class="org-constant">+workspace-load</span></span><span class="org-doc">'.</span>

<span class="org-doc">If we call this function without a IDENTIFIER, we will generate a name using the</span>
<span class="org-doc">current time, and the format \"%Y-%0m-%0d-%0H-%0M\".</span>

<span class="org-doc">If FORCE is non nil, this function will overwrite the session file if it is</span>
<span class="org-doc">already present in the system.</span>

<span class="org-doc">Returns t on success, nil otherwise."</span>
  (<span class="org-keyword">unless</span> (file-exists-p +workspaces-data-dir)
    (make-directory +workspaces-data-dir))
  (<span class="org-keyword">when-let</span> ((fname (+workspace-resolve-session-file-path identifier))
             (should-save (<span class="org-keyword">or</span> (<span class="org-keyword">or</span> (not (file-exists-p fname)) force)
                              (yes-or-no-p (format <span class="org-string">"Overwrite the '%s' session state?"</span> identifier)))))
    (<span class="org-keyword">let</span> ((current-prefix-arg t))
      (persp-state-save fname interactive?))
    (file-exists-p fname)))
</pre>
</div>

<p>
We will make sure that the most complex part of this function goes to another function to make easy to understand and reusable:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 256: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace-resolve-session-file-path</span> (<span class="org-type">&amp;optional</span> name)
  <span class="org-doc">"Returns the full path for a session filename given a NAME identifier.</span>

<span class="org-doc">If we omit the NAME, we will use the current time with the format</span>
<span class="org-doc">\"%Y-%0m-%0d-%0H-%0M\" (see `</span><span class="org-doc"><span class="org-constant">format-time-string</span></span><span class="org-doc">' for information about the</span>
<span class="org-doc">format), if NAME is not a string nor nil, we throw an error."</span>
  (<span class="org-keyword">unless</span> (string-or-null-p name)
    (+workspace-error <span class="org-string">"Invalid name! Argument '%s' is not string or nil"</span> name))
  (expand-file-name (format <span class="org-string">"%s%s.dws"</span>
                            +workspaces-data-file-prefix
                            (<span class="org-keyword">or</span> name (format-time-string <span class="org-string">"%Y-%0m-%0d-%0H-%0M"</span>)))
                    +workspaces-data-dir))
</pre>
</div>

<p>
In this function we introduce two new variables that we still didn't define. The <code>+workspaces-data-dir</code> holds the location of our workspace saved files, and <code>+workspaces-data-file-prefix</code> holds a common prefix for workspace files so we can filter them easily.
</p>

<p>
Let's add these variables to our autoload file:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 257: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defvar</span> <span class="org-variable-name">+workspaces-data-dir</span> (concat doom-etc-dir <span class="org-string">"workspaces/"</span>)
  <span class="org-doc">"Directory where we store perspective files."</span>)


<span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defvar</span> <span class="org-variable-name">+workspaces-data-file-prefix</span> <span class="org-string">"_workspaces_"</span>
  <span class="org-doc">"The filename prefix of files used to store a workspace session. We will store</span>
<span class="org-doc">these file at `</span><span class="org-doc"><span class="org-constant">+workspaces-data-dir</span></span><span class="org-doc">'."</span>)
</pre>
</div>

<p>
And now we can add the command to its key:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 258: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp"><span class="org-builtin">:desc</span> <span class="org-string">"Save session to file"</span>           <span class="org-string">"s"</span>   #'+workspace/save-session
</pre>
</div>
</div>
</div>

<div id="outline-container-orge78de60" class="outline-4">
<h4 id="orge78de60"><span class="section-number-4">4.2.13</span> Load session from file</h4>
<div class="outline-text-4" id="text-4-2-13">
<p>
At this point, we can arbitrarily save our sessions to files, but still need a way to load them. Let's create the <i>load</i> command:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 259: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace/load-session</span> (name)
  <span class="org-doc">"Load a workspace session with identifier NAME."</span>
  (<span class="org-keyword">interactive</span>
   (list
    (completing-read <span class="org-string">"Workspace session to load: "</span>
                     (mapcar
                      (<span class="org-keyword">lambda</span> (file)
                        (string-remove-prefix +workspaces-data-file-prefix (file-name-base file)))
                      (file-expand-wildcards (format <span class="org-string">"%s%s*.dws"</span>
                                                     +workspaces-data-dir
                                                     +workspaces-data-file-prefix)))
                     (<span class="org-keyword">lambda</span> (identifier)
                       (not (string= identifier +workspaces-auto-save-identifier)))
                     t)))
  (<span class="org-keyword">when</span> (<span class="org-keyword">bound-and-true-p</span> persp-mode)
    (<span class="org-keyword">condition-case</span> err
        (<span class="org-keyword">if</span> (not (+workspace-session-load name))
            (+workspace-error <span class="org-string">"Could not load workspace session %s"</span> name)
          (+workspace/display))
      (t (minibuffer-message <span class="org-string">"%s"</span> (+workspace--message-body (error-message-string err) 'error))))))
</pre>
</div>

<p>
The difference between the <i>save</i> and <i>load</i> commands (besides the obvious), is that when we load, we force the user to complete to a valid load file with the 4<sup>th</sup> parameter on <code>completing-read</code>.
</p>

<p>
As usual, lets get our low-level API coded as well:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 260: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace-session-load</span> (name)
  <span class="org-doc">"Loads a workspace session identified by NAME. Can only retrieve workspace</span>
<span class="org-doc">sessions that were explicitly saved with `</span><span class="org-doc"><span class="org-constant">+workspace-session-save</span></span><span class="org-doc">'.</span>

<span class="org-doc">Returns t if successful, nil otherwise."</span>
  (persp-state-load (+workspace-resolve-session-file-path name))
  (&gt; (length (persp-names)) 0))
</pre>
</div>

<p>
And bind this command to its key:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 261: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp"><span class="org-builtin">:desc</span> <span class="org-string">"Load session from file"</span>         <span class="org-string">"l"</span>   #'+workspace/load-session
</pre>
</div>
</div>
</div>

<div id="outline-container-orgda6593a" class="outline-4">
<h4 id="orgda6593a"><span class="section-number-4">4.2.14</span> Restore last session</h4>
<div class="outline-text-4" id="text-4-2-14">
<p>
Now that we save and load our workspace sessions, is time for us to make this process a bit more automated. Just like Doom's behavior, we want Emacs to save our session when it exits, and we want to be able to restore the last auto-saved session.
</p>

<p>
The first thing we need is a hook function to execute every time Emacs quits:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 262: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace-auto-save-h</span> ()
  (<span class="org-keyword">when</span> +workspace--auto-save-session-p
    (+workspace-session-save +workspaces-auto-save-identifier t nil)))
</pre>
</div>

<p>
And we need a function to restore the last saved session:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 263: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace/restore-last-session</span> ()
  <span class="org-doc">"Tries to load the 'auto-saved' session from last time we used Emacs."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">condition-case</span> err
      (<span class="org-keyword">let</span> ((as-file (+workspace-resolve-session-file-path +workspaces-auto-save-identifier)))
        (message <span class="org-string">"Restoring session..."</span>)
        (<span class="org-keyword">if</span> (file-exists-p as-file)
            (<span class="org-keyword">unless</span> (+workspace-session-load +workspaces-auto-save-identifier)
              (+workspace-error <span class="org-string">"Failed to restore previous auto-saved session"</span>))
          (+workspace-warn <span class="org-string">"There is no session previously saved"</span>))
        (message <span class="org-string">"Session restored. Welcome back."</span>))
    (t (minibuffer-message <span class="org-string">"%s"</span> (+workspace--message-body (error-message-string err) 'error)))))
</pre>
</div>

<p>
With the restore command done, we can associate it with its key:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 264: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp"><span class="org-builtin">:desc</span> <span class="org-string">"Restore last session"</span>           <span class="org-string">"R"</span>   #'+workspace/restore-last-session
</pre>
</div>

<p>
Now that we defined all <i>leader</i> keys, we can close our <i>leader</i> mapping:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 265: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">)  <span class="org-comment-delimiter">;; </span><span class="org-comment">:prefix ("TAB" . "workspace")</span>
)  <span class="org-comment-delimiter">;; </span><span class="org-comment">:leader</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org08d4809" class="outline-4">
<h4 id="org08d4809"><span class="section-number-4">4.2.15</span> Other shortcuts</h4>
<div class="outline-text-4" id="text-4-2-15">
<p>
Doom also offers nice shortcuts for us to access our workspace. They're all bound to <code>Meta</code> plus a number:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 266: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp"><span class="org-builtin">:ne</span> <span class="org-string">"C-t"</span>   #'+workspace/new
<span class="org-builtin">:ne</span> <span class="org-string">"C-S-t"</span> #'+workspace/display
<span class="org-builtin">:ne</span> <span class="org-string">"M-1"</span>   #'+workspace/switch-to-0
<span class="org-builtin">:ne</span> <span class="org-string">"M-2"</span>   #'+workspace/switch-to-1
<span class="org-builtin">:ne</span> <span class="org-string">"M-3"</span>   #'+workspace/switch-to-2
<span class="org-builtin">:ne</span> <span class="org-string">"M-4"</span>   #'+workspace/switch-to-3
<span class="org-builtin">:ne</span> <span class="org-string">"M-5"</span>   #'+workspace/switch-to-4
<span class="org-builtin">:ne</span> <span class="org-string">"M-6"</span>   #'+workspace/switch-to-5
<span class="org-builtin">:ne</span> <span class="org-string">"M-7"</span>   #'+workspace/switch-to-6
<span class="org-builtin">:ne</span> <span class="org-string">"M-8"</span>   #'+workspace/switch-to-7
<span class="org-builtin">:ne</span> <span class="org-string">"M-9"</span>   #'+workspace/switch-to-8
<span class="org-builtin">:ne</span> <span class="org-string">"M-0"</span>   #'+workspace/switch-to-final
</pre>
</div>

<p>
These shortcuts close the majority of workspace binding we may need:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 267: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">)  <span class="org-comment-delimiter">;; </span><span class="org-comment">map!</span>
</pre>
</div>

<p>
There are couple shortcuts that are not defined with the <code>map!</code> function, so we can tackle them here:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 268: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(define-key! persp-mode-map
  [remap delete-window] #'+workspace/close-window-or-workspace
  [remap evil-window-delete] #'+workspace/close-window-or-workspace)
</pre>
</div>

<p>
This will delete the current workspace if closing the last open window. But we still need to implement the target function here:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 269: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">+workspace/close-window-or-workspace</span> ()
  <span class="org-doc">"Close the selected window. If it's the last window in the workspace, either</span>
<span class="org-doc">close the workspace (as well as its associated frame, if one exists) and move to</span>
<span class="org-doc">the next."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">condition-case</span> err
      (<span class="org-keyword">if</span> (cdr (my-tabs-mode-persp-window))
          (tab-line-close-tab)
        (<span class="org-keyword">let</span> ((delete-window-fn (<span class="org-keyword">if</span> (<span class="org-keyword">featurep</span> '<span class="org-constant">evil</span>)
                                    #'evil-window-delete
                                  #'delete-window))
              (buf (current-buffer)))
          (<span class="org-keyword">if</span> (window-dedicated-p)
              (funcall delete-window-fn)
            (<span class="org-keyword">let</span> ((current-persp-name (persp-current-name)))
              (<span class="org-keyword">cond</span> ((<span class="org-keyword">or</span> (+workspace--protected-p current-persp-name)
                         (cdr (doom-visible-windows)))
                     (funcall delete-window-fn))
                    ((cdr (persp-names))
                     (+workspace/delete current-persp-name))
                    ((+workspace-error <span class="org-string">"Can't delete last workspace"</span>)))))))
    (t (minibuffer-message <span class="org-string">"%s"</span> (+workspace--message-body (error-message-string err) 'error)))))
</pre>
</div>

<p>
When we have the feature <code>workspaces</code> on our <code>init.el</code>, Doom will add an option on its dashboard to allow us to recover the last saved session. Since we disabled that feature, we need to add this option again:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 270: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(add-to-list
 '+doom-dashboard-menu-sections
 '(<span class="org-string">"Reload last session"</span>
   <span class="org-builtin">:icon</span> (all-the-icons-octicon <span class="org-string">"history"</span>
                                <span class="org-builtin">:face</span> 'doom-dashboard-menu-title)
   <span class="org-builtin">:face</span> (<span class="org-builtin">:inherit</span> (doom-dashboard-menu-title bold))
   <span class="org-builtin">:action</span> +workspace/restore-last-session))
</pre>
</div>

<p>
The only thing remaining on our refactor, is to connect our auto-save function to the hook <code>kill-emacs-hook</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 271: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(add-hook 'kill-emacs-hook #'+workspace-auto-save-h)
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org7681d60" class="outline-2">
<h2 id="org7681d60"><span class="section-number-2">5</span> Writing&#xa0;&#xa0;&#xa0;<span class="tag"><span class="wip">wip</span></span></h2>
<div class="outline-text-2" id="text-5">
<p>
In my day-time job, my role, among other things, is to do mobile development for the Android platform. While Emacs is OK handling Java, Kotlin, and friends, compared to IDEs like IntelliJ and Android Studio, it lacks a substantial amount of features. The amount of configurations and adjustments I would need to do to get a distance resemblance of those IDEs is prohibitive. Because of this reason, one of my main usage for Emacs is writing and scripting.
</p>

<p>
I decided to use Org mode as my writing platform. And because of that, this section is as big and detailed as it can be.
</p>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
I come up with a directory infrastructure for my writings that will hold all type of text I need to produce, while keeping them well organized:
</p>


<figure id="org6723bd5">
<img src="assets/org-dir-struct.png" alt="org-dir-struct.png">

</figure>

<p>
Most of these directories are straightforward to understand their purpose, but I still want to go through them to document my need.
</p>

<dl class="org-dl">
<dt><code>.archives</code></dt><dd>Any Org task archived on my system will end up in this directory. After a while, this directory should be a shadow copy of the root <code>org</code> directory, but containing only files with archived tasks;</dd>
<dt><code>.attach</code></dt><dd>This is the Doom's directory to store attached files;</dd>
<dt><code>agenda</code></dt><dd>The root folder for task management:
<dl class="org-dl">
<dt><code>calendars</code></dt><dd>Here is where I will add the events for my calendars. Each calendar I have will have its own file here. These files are not intended to manage my calendars, and I will consider them as <i>read-only files</i>. Outside Emacs, I will have process running and synchronizing these files;</dd>
<dt><code>tasks</code></dt><dd>Directory to store Org files with tasks. The main file, which I will track on Org Agenda is the <code>todo.org</code>, but I have this extra file called <code>someday.org</code> as a dump for tasks I wish to accomplish but are not essentials;</dd>
<dt><code>contacts.org</code></dt><dd>The Org file used to record my contacts. I still need to find a good way to synchronize this file with my phone contacts, but this is out of the scope of this document;</dd>
<dt><code>habits.org</code></dt><dd>Once I'm ready to try tracking my habits, this is the file I should use;</dd>
</dl></dd>
<dt><code>documents</code></dt><dd>This is the dumping ground for any type of document (articles, design architecture, blog posts, wiki entries, etc.). Inside of it, I will have one directory per area (work, home, personal site, etc.);</dd>
<dt><code>journal</code></dt><dd>I need to have one work journal and one personal journal, but I still don't know how to do this separation effectively. For now, I will have all my journaling stored here;</dd>
<dt><code>notes</code></dt><dd>My curated notes. All files in this directory have no name (I use UUID as their name), and I can access their content by using the Zettelkasten method on my system;</dd>
<dt><code>presentations</code></dt><dd>The directory for my presentation projects using <code>reveal.js</code>;</dd>
</dl>

<p>
Regarding my configuration for writing, I will split it into 7 distinct sections:
</p>

<ul class="org-ul">
<li>Org configuration</li>
<li>Prose writing</li>
<li>Reading or reviewing</li>
<li>Publishing</li>
<li>Presenting</li>
<li>Note Taking</li>
<li>Other writing modes</li>
</ul>
</div>

<div id="outline-container-orga95845a" class="outline-3">
<h3 id="orga95845a"><span class="section-number-3">5.1</span> <span class="todo TODO">TODO</span> Requirements</h3>
<div class="outline-text-3" id="text-5-1">
<ul class="org-ul">
<li>Fonts
<ul class="org-ul">
<li>Variable pitch</li>
<li>Variable size</li>
</ul></li>
<li>Text quality
<ul class="org-ul">
<li>Spell-checking</li>
<li>Grammar check</li>
<li>Dictionary/Thesaurus</li>
<li>Text linting
<ul class="org-ul">
<li>Insensible words</li>
<li>Weasel words</li>
</ul></li>
</ul></li>
<li>Revisions
<ul class="org-ul">
<li>Annotations / Document comments</li>
</ul></li>
<li>Exports
<ul class="org-ul">
<li>Hugo</li>
<li>XWiki</li>
<li>Confluense</li>
<li>Book format?</li>
<li>RevealJS</li>
</ul></li>
<li>Notes
<ul class="org-ul">
<li>???</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org12b940a" class="outline-3">
<h3 id="org12b940a"><span class="section-number-3">5.2</span> <span class="todo TODO">TODO</span> Common Org configurations</h3>
<div class="outline-text-3" id="text-5-2">
<p>
But before we dive in each one of these usages, there are some things I like to configure on Org that will affect all the other areas, so I will start with them here.
</p>

<p>
The first thing I like to do, is to create some variables pointing to key locations and files on my directory structure:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 272: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">unpin!</span> org-mode)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 273: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> writeroom-mode-line       t
      +zen-window-divider-size  2
      +zen-text-scale           1)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 274: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-html-htmlize-output-type 'css
      org-html-head-include-default-style nil
      org-html-doctype <span class="org-string">"html5"</span>
      org-html-html5-fancy t)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 275: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-directory (expand-file-name <span class="org-string">"~/depot/Dropbox/org"</span>))

(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-journal-directory</span> (expand-file-name <span class="org-string">"journal"</span> org-directory)
  <span class="org-doc">"Path to directory holding all journal files"</span>)

(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-docs-directory</span> (expand-file-name <span class="org-string">"documents"</span> org-directory)
  <span class="org-doc">"Path to directory used to store non specific documents."</span>)

(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-agenda-directory</span> (expand-file-name <span class="org-string">"agenda"</span> org-directory)
  <span class="org-doc">"Path to the base directory for the agenda system."</span>)

(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-calendars-directory</span> (expand-file-name <span class="org-string">"calendars"</span> my-agenda-directory)
  <span class="org-doc">"Path to directory used to store calendar files."</span>)

(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-tasks-directory</span> (expand-file-name <span class="org-string">"tasks"</span> my-agenda-directory)
  <span class="org-doc">"Path to directory used to store task files."</span>)

(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-notes-directory</span> (expand-file-name <span class="org-string">"notes"</span> org-directory)
  <span class="org-doc">"Path to directory used to store note files."</span>)

(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-presentations-directory</span> (expand-file-name <span class="org-string">"presentations"</span> org-directory)
  <span class="org-doc">"Path to directory used to store presentation files."</span>)
</pre>
</div>

<p>
Notice that we crated these variables before loading anything related to Org. The <code>org-directory</code> variable needs to have the correct value when Org mode is initializing, and the others are just grouped close to the main Org one.
</p>

<p>
Now we can wait Org to load to  continue our configuration:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 276: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(my-typography-reset (<span class="org-keyword">cl-loop</span> for i from 1 to 8 collect (intern (format <span class="org-string">"outline-%d"</span> i))))
(custom-set-faces!
  `(outline-1 <span class="org-builtin">:inherit</span> my-headline-1 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  `(outline-2 <span class="org-builtin">:inherit</span> my-headline-2 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  `(outline-3 <span class="org-builtin">:inherit</span> my-headline-3 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  `(outline-4 <span class="org-builtin">:inherit</span> my-headline-4 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  `(outline-5 <span class="org-builtin">:inherit</span> my-headline-5 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  `(outline-6 <span class="org-builtin">:inherit</span> my-headline-6 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  `(outline-7 <span class="org-builtin">:inherit</span> my-headline-7 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  `(outline-8 <span class="org-builtin">:inherit</span> my-headline-8 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 277: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-org-font-lock-beautify-keywords</span>
  `((<span class="org-string">"^#\\+TITLE: *"</span>
     (0 (<span class="org-keyword">prog1</span> nil (put-text-property (match-beginning 0) (match-end 0) 'invisible t))))
    (<span class="org-string">"^\\*+ "</span>
     (0 (<span class="org-keyword">prog1</span> nil (put-text-property (match-beginning 0) (match-end 0) 'invisible t))))
    (<span class="org-string">"^ *</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[-+*] \\[ \\]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"> "</span>
     (0 (<span class="org-keyword">prog1</span> nil (compose-region (match-beginning 1) (match-end 1) <span class="org-string">"&#9744; "</span>))))
    (<span class="org-string">"^ *</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[-+*] \\[</span><span class="org-string"><span class="org-constant">-\\</span></span><span class="org-string">]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"> "</span>
     (0 (<span class="org-keyword">prog1</span> nil (compose-region (match-beginning 1) (match-end 1) <span class="org-string">"&#8865; "</span>))))
    (<span class="org-string">"^ *</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[-+*] \\[[xX]\\]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"> "</span>
     (0 (<span class="org-keyword">prog1</span> nil (compose-region (match-beginning 1) (match-end 1) <span class="org-string">"&#9745; "</span>))))
    (<span class="org-string">"^ *</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">-</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"> </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">\\[]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\[[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string"> xX-]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span>
     (0 (<span class="org-keyword">prog1</span> nil (compose-region (match-beginning 1) (match-end 1) <span class="org-string">"&#8226;"</span>))))
    (<span class="org-string">"^ *</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">\\+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"> </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">\\[]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\[[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string"> xX-]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span>
     (0 (<span class="org-keyword">prog1</span> nil (compose-region (match-beginning 1) (match-end 1) <span class="org-string">"&#8227;"</span>))))
    (<span class="org-string">"^ *</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">\\*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"> </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">\\[]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\[[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string"> xX-]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span>
     (0 (<span class="org-keyword">prog1</span> nil (compose-region (match-beginning 1) (match-end 1) <span class="org-string">"&#8269;"</span>)))))
  <span class="org-doc">"This is a list of text elements fontification for Org. It</span>
<span class="org-doc">beautifies title, check-boxes, and list bullets."</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 278: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org
</pre>
</div>

<p>
I like to <i>beautify</i> Org buffers with some tweaks. First I want header tags to be close to the header text:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 279: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-tags-column 0)
</pre>
</div>

<p>
Then I like to have some indentation indicating which header level I am:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 280: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-startup-indented nil)
</pre>
</div>

<p>
I also like to display text formatting as close to WYSIWYG as I can have. This means that if I mark a word as italic, instead of showing <code>/word/</code>, I want to display <i>word</i>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 281: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-hide-emphasis-markers t
      org-pretty-entities t)
</pre>
</div>

<p>
When Org collapse a header, it displays an ellipsis right after the header text. Although this is not "bad", I like to have a better indication of a collapsed header:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 282: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-ellipsis <span class="org-string">" &#61703; "</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 283: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-adapt-indentation nil)
</pre>
</div>


<p>
In some documents, I need to write math formulas and Org can render them pretty well using LaTeX, but I like to adjust their render to use SVG instead of image, and use a transparent background to match the overall theme of Emacs
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 284: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">plist-put!</span> org-format-latex-options
            <span class="org-builtin">:scale</span> 1.55
            <span class="org-builtin">:foreground</span> <span class="org-string">"White"</span>
            <span class="org-builtin">:background</span> <span class="org-string">"Transparent"</span>)

(<span class="org-keyword">setq</span> org-preview-latex-default-process 'dvisvgm
      org-startup-with-latex-preview t)

(<span class="org-keyword">pushnew!</span> org-link-abbrev-alist
          '(<span class="org-string">"sim"</span>   . <span class="org-string">"https://sim.amazon.com/issues/%s"</span>)
          '(<span class="org-string">"tt"</span>    . <span class="org-string">"https://t.corp.amazon.com/%s"</span>)
          '(<span class="org-string">"pkg"</span>   . <span class="org-string">"https://code.amazon.com/packages/%s"</span>)
          '(<span class="org-string">"ptool"</span> . <span class="org-string">"https://phonetool.amazon.com/users/%s"</span>)
          '(<span class="org-string">"crux"</span>  . <span class="org-string">"https://code.amazon.com/reviews/%s"</span>)
          '(<span class="org-string">"vs"</span>    . <span class="org-string">"https://code.amazon.com/version-sets/%s"</span>)
          '(<span class="org-string">"coe"</span>   . <span class="org-string">"https://www.coe.a2z.com/coe/%s/content"</span>)
          '(<span class="org-string">"xwiki"</span> . <span class="org-string">"https://w.amazon.com/bin/view/%(+org-xwiki--translate-path)"</span>))
</pre>
</div>

<p>
I need to adjust some of the Org fonts to use fixed pitch regardless if I'm using variable pitch. This will guarantee that tables, source blocks, and some other formatting will render properly on the UI, so let's create a function for it:
</p>

<p>
Once we create the function, we can attach it to a hook or execute it right away depending on Emacs running as a daemon or not:
</p>

<p>
And to close out my <i>beautification</i>, I want to render some unicode characters instead of some Org elements:
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Org element</th>
<th scope="col" class="org-left">Unicode character</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>- [ ]</code></td>
<td class="org-left">☐</td>
</tr>

<tr>
<td class="org-left"><code>- [-]</code></td>
<td class="org-left">⊡</td>
</tr>

<tr>
<td class="org-left"><code>- [X]</code></td>
<td class="org-left">☑</td>
</tr>
</tbody>
</table>

<p>
And I also want to have better bullet marks:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 285: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(font-lock-add-keywords 'org-mode my-org-font-lock-beautify-keywords)
</pre>
</div>

<p>
Besides <i>beautification</i>, there are some configurations I like to have as a default behavior. The first one is how I can edit a code block on a separate buffer. By default, Org will edit it using <code>switch-to-buffer-other-window</code>. While this seams to be a popular choice, I just can't stand the two buffers together when I can't touch on the Org file while I have the source block opened.
</p>

<p>
I will use the <code>'current-window</code> option to have the source block behaving like a normal buffer:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 286: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-src-window-setup 'split-window-right)
</pre>
</div>

<p>
After all these tweaks, we can close our parenthesis:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 287: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">) <span class="org-comment-delimiter">;; </span><span class="org-comment">after! org</span>
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 288: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(custom-set-faces!
  '((org-document-info
     org-document-info-keyword
     org-property-value
     org-drawer
     org-table
     org-block
     org-verbatim
     org-code
     org-date
     org-block-begin-line)
    <span class="org-builtin">:inherit</span> fixed-pitch))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 289: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(my-typography-reset 'org-document-title)

(custom-set-faces!
  '(org-document-title <span class="org-builtin">:inherit</span> my-document-title <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  '(org-meta-line <span class="org-builtin">:height</span> 0.8 <span class="org-builtin">:inherit</span> font-lock-comment-face)
  '(org-special-keyword <span class="org-builtin">:inherit</span> font-lock-comment-face)
  `(org-drawer <span class="org-builtin">:foreground</span> ,(doom-color 'doc-comments))
  '(org-formula <span class="org-builtin">:inherit</span> org-table)
  '(org-block-begin-line <span class="org-builtin">:height</span> 0.8)
  '(org-block-end-line <span class="org-builtin">:inherit</span> org-block-begin-line)
  '(org-tag <span class="org-builtin">:height</span> 150)
  '(org-indent <span class="org-builtin">:inherit</span> (org-hide fixed-pitch)))
</pre>
</div>

<p>
Even though our configuration can renders math formulas nicely, it's still awkward to edit them once you write them. To help us with this task, I'll install a plugin called <a href="https://github.com/io12/org-fragtog"><code>org-fragtog</code></a>. This plugin will show the math formula with the LaTeX syntax if the cursor is inside the formula area, and will render the formula when the cursor leaves it.
</p>

<p>
First we add the plugin on our <code>packages.el</code> file:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 290: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> org-fragtog)
</pre>
</div>

<p>
Then, we use <code>use-package!</code> to defer its loading (we will load it manually later):
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 291: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> org-fragtog <span class="org-builtin">:defer</span> t)
</pre>
</div>

<p>
Another nice plugin to have is the <a href="https://github.com/casouri/valign"><code>valign</code></a> plugin. It will align your Org tables nicely, even when you have formulas and images on them.
</p>

<p>
As with the <code>org-fragtog</code>, let's first add it to our <code>packages.el</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 292: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> valign)
</pre>
</div>

<p>
Then, we use <code>use-package!</code> to defer its loading as we did with <code>org-fragtog</code>, but for this plugin, we want to set the <code>valign-fancy-bar</code> to <code>t</code>, to have even nicer renders of tables:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 293: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> valign
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:init</span> (<span class="org-keyword">setq</span> valign-fancy-bar t))
</pre>
</div>

<p>
So far, with our configuration, we will use the entire size of the frame as our text canvas before wrapping it. This is far from ideal when you're reading a text (specially for me). I want to have narrower text to reduce the amount of focus I need to read a line.
</p>

<p>
We could configure the left and right gutter to achieve a narrower text area, or we could use another plugin for it. I tried both methods, and find out that the plugin has a better response and is easier to install and maintain.
</p>

<p>
Let's add it to our <code>packages.el</code>:
</p>

<p>
Defer its loading on our configuration, and as with the <code>valign</code> package, we will use this time to also set the maximum width for our text:
</p>

<p>
Now that I have a narrower width, the text will wrap more often, but the normal navigation keys will make the cursor jump from one line to the other, even if I have other <i>visual</i> lines displayed.
</p>

<p>
To fix this behavior, we just need to re-bind some of the movement keys to the <i>visual</i> version of their original command, for instance, while we have <code>j</code> bound to <code>evil-next-line</code>, in <code>org-moode</code>, we want it bound to <code>evil-next-visual-line</code>:
</p>

<p>
While I'm sure I'm missing a command or two, these will get me started.
</p>

<p>
I also need to adjust the window navigation keys that clash with default Org bindings:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 294: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:after</span> org
      <span class="org-builtin">:map</span> org-mode-map
      <span class="org-builtin">:prefix</span> (<span class="org-string">"g"</span> . <span class="org-string">"action"</span>)
      <span class="org-builtin">:desc</span> <span class="org-string">"org-ctrl-c-ctrl-c"</span> <span class="org-builtin">:n</span> [return] #'org-ctrl-c-ctrl-c
      <span class="org-builtin">:desc</span> <span class="org-string">"org-ctrl-c-ctrl-c"</span> <span class="org-builtin">:n</span> <span class="org-string">"RET"</span> #'org-ctrl-c-ctrl-c)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 295: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:after</span> org
      <span class="org-builtin">:map</span> org-mode-map
      <span class="org-builtin">:n</span> <span class="org-string">"s-j"</span> #'org-next-visible-heading
      <span class="org-builtin">:n</span> <span class="org-string">"s-k"</span> #'org-previous-visible-heading
      <span class="org-builtin">:n</span> <span class="org-string">"C-s-j"</span> #'org-forward-heading-same-level
      <span class="org-builtin">:n</span> <span class="org-string">"C-s-k"</span> #'org-backward-heading-same-level
      <span class="org-builtin">:n</span> <span class="org-string">"C-j"</span> #'evil-window-down
      <span class="org-builtin">:n</span> <span class="org-string">"C-k"</span> #'evil-window-up)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 296: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:after</span> org
      <span class="org-builtin">:map</span> org-mode-map
      <span class="org-builtin">:g</span> <span class="org-string">"s-RET"</span>     #'org-edit-special
      <span class="org-builtin">:g</span> [s-return]  #'org-edit-special)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 297: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:after</span> org
      <span class="org-builtin">:map</span> org-src-mode-map
      <span class="org-builtin">:in</span> [s-escape] #'org-edit-src-abort
      <span class="org-builtin">:gin</span> <span class="org-string">"s-RET"</span>     #'org-edit-src-exit
      <span class="org-builtin">:gin</span> [s-return]  #'org-edit-src-exit)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 298: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-link-snippet-in-place</span> ()
  (<span class="org-keyword">interactive</span>)
  (yas-expand-snippet (yas-lookup-snippet <span class="org-string">"Link"</span>)
                      (region-beginning)
                      (region-end)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 299: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:after</span> org
      (<span class="org-builtin">:map</span> org-mode-map
       <span class="org-builtin">:v</span> <span class="org-string">"s-k"</span> #'my-link-snippet-in-place))
</pre>
</div>

<p>
At this point we can tight up everything and setup our buffer when we open an org file.
</p>

<p>
<a href="https://github.com/awth13/org-appear">https://github.com/awth13/org-appear</a>
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 300: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> org-appear
  <span class="org-builtin">:recipe</span> (<span class="org-builtin">:host</span> github
           <span class="org-builtin">:repo</span> <span class="org-string">"awth13/org-appear"</span>))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 301: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> org-appear
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> org-appear-autolinks t
        org-appear-autosubmarkers t))
</pre>
</div>

<p>
To separate my configuration from initialization logic, let's create another autoload function, but this time on a file used for <i>Org things</i> (<code>autoload/org.el</code>):
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 302: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-org-buffer-config-h</span> ()
  <span class="org-doc">"Configure all aspects of an Org buffer right before we display it to the user."</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Enable minor modes</span>
  (<span class="org-keyword">when</span> window-system
    (+zen/toggle)
    (valign-mode 1)
    (variable-pitch-mode 1)

    (<span class="org-keyword">add-hook!</span> evil-insert-state-entry <span class="org-builtin">:local</span>
      (org-fragtog-mode 1)
      (org-appear-mode 1))
    (<span class="org-keyword">add-hook!</span> evil-insert-state-exit <span class="org-builtin">:local</span>
      (org-fragtog-mode -1)
      (org-appear-mode -1)))
  (visual-line-mode 1)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Call org configuration functions</span>
  (org-display-inline-images)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Ignore flycheck errors on source blocks</span>
  (my-noflycheck-h)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Force a buffer refresh to guarantee all setup is in use</span>
  (set-window-buffer nil (current-buffer)))
</pre>
</div>

<p>
With this function in place, we can <i>hook</i> it to our Org major mode:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 303: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(add-hook 'org-mode-hook #'my-org-buffer-config-h)
</pre>
</div>

<ul class="org-ul">
<li><a href="https://github.com/Townk/org-ol-tree">https://github.com/Townk/org-ol-tree</a></li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 304: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">if</span> (getenv <span class="org-string">"GITHUB_WORKFLOW"</span>)
    (<span class="org-keyword">package!</span> org-ol-tree
      <span class="org-builtin">:recipe</span> (<span class="org-builtin">:host</span> github
               <span class="org-builtin">:repo</span> <span class="org-string">"Townk/org-ol-tree"</span>))
  (<span class="org-keyword">package!</span> org-ol-tree
    <span class="org-builtin">:recipe</span> (<span class="org-builtin">:local-repo</span> <span class="org-string">"~/workplace/personal/emacs/org-ol-tree"</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 305: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> org-ol-tree
  <span class="org-builtin">:commands</span> org-ol-tree
  <span class="org-builtin">:init</span>
  (map! <span class="org-builtin">:map</span> org-mode-map
        <span class="org-builtin">:localleader</span> <span class="org-builtin">:prefix</span> (<span class="org-string">"g"</span> . <span class="org-string">"goto"</span>)
        <span class="org-builtin">:desc</span> <span class="org-string">"Open outline"</span>  <span class="org-string">"o"</span> #'org-ol-tree)

  (<span class="org-keyword">setq</span> org-ol-tree-ui-window-header-format
        '((<span class="org-builtin">:eval</span> (concat <span class="org-string">" &#9776; "</span> (propertize <span class="org-string">"Outline"</span> 'face '(<span class="org-builtin">:inherit</span> 'my-default-ui <span class="org-builtin">:height</span> 0.8)))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9d10ad5" class="outline-3">
<h3 id="org9d10ad5"><span class="section-number-3">5.3</span> <span class="todo TODO">TODO</span> Prose writing</h3>
<div class="outline-text-3" id="text-5-3">
<p>
I don't like to write. After reading this page or any other text I published you might think this is a lie, but it's not. I say way more then I need at any given moment. Suffice to say that this takes a big chunk of my energy, and on top of that, I'm not really good at it. This means that for my crazy brain, there is not much reward when I write, and in some times, there is actually anxiety and discomfort.
</p>

<p>
With that out of the way, I need to acknowledge that, currently in my career, there is no way I can get away with <i>not writing</i>. There are too much design, architecture, plans, and projects involved on my day to day work, that my team and I need some form of record of our decisions. And if writing is inevitable, I should, at least, try to make it less painful.
</p>

<p>
For me, this means I should have a tool that offers me the power required to do any kind of writing, but in the same time, makes my life easier when doing the <i>writing thing</i>.
</p>

<p>
Emacs and Org Mode fulfill the <i>power</i> part of my goal, and this configuration will try to tackle the second.
</p>

<p>
Let's look into my list of requirements for writing:
</p>

<dl class="org-dl">
<dt>File templates</dt><dd>My setup should have a set of file templates that would help me start writing something faster. At any time while using Emacs, I can start a new document and select one of these templates, and Emacs will create the file on the right location, using the selected template;</dd>
<dt>No hard line wrap</dt><dd>While I can't stand soft-wraps on code, I'm getting used to it when I'm writing text, specially now that I can navigate using <i>visual lines</i> on Org Mode. So, this requirement is to make sure I use soft wraps while editing an Org file;</dd>
<dt>Inline images</dt><dd>If I add an image to a text, I want the image to show up right away. Also, if I open a file containing an image, Emacs should display the image automatically. I also want to auto-split the image into chunks so when navigate the text with the cursor, the screen does not jump over the image.</dd>
<dt>Inline formulas</dt><dd>As with images, I want to render math formulas automatically;</dd>
<dt>Formatted tables</dt><dd>Tables on my Org files should stay aligned all the time, and render with proper borders;</dd>
<dt>Focus writing</dt><dd>When I need to dive deep into creating a document, it's useful to remove distractions from my writing environment. Besides getting rid of UI elements, I would like to have the same <i>Focus Mode</i> behavior from <a href="https://ia.net/writer">iA Writer</a>;</dd>
<dt>Snippets</dt><dd>I like to have a snippet system to help me with boilerplate writing for Org;</dd>
</dl>

<p>
Although we already covered most of this list of the previous section, we still need to configure <i>File templates,</i> some personal <i>Snippets</i>, and <i>Focus Writing</i>, so let's get to it.
</p>
</div>

<div id="outline-container-org94575ad" class="outline-4">
<h4 id="org94575ad"><span class="section-number-4">5.3.1</span> Dictionary and writing helpers</h4>
<div class="outline-text-4" id="text-5-3-1">
<ul class="org-ul">
<li><a href="https://github.com/tecosaur/lexic">https://github.com/tecosaur/lexic</a></li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 306: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> lexic
  <span class="org-builtin">:recipe</span> (<span class="org-builtin">:host</span> github
           <span class="org-builtin">:repo</span> <span class="org-string">"tecosaur/lexic"</span>))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 307: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> lexic
  <span class="org-builtin">:commands</span> lexic-search lexic-list-dictionary
  <span class="org-builtin">:init</span>
  (set-popup-rule! <span class="org-string">"^\\*lexic\\*$"</span>
    <span class="org-builtin">:slot</span> 2   <span class="org-builtin">:vslot</span> -1     <span class="org-builtin">:side</span> 'right  <span class="org-builtin">:width</span> 100 <span class="org-builtin">:height</span> 0.4
    <span class="org-builtin">:select</span> t <span class="org-builtin">:modeline</span> nil <span class="org-builtin">:autosave</span> nil <span class="org-builtin">:ttl</span> 0     <span class="org-builtin">:quit</span> t)

  <span class="org-builtin">:config</span>
  (cl-delete-if (<span class="org-keyword">lambda</span> (spec)
                  (equal (car-safe spec) <span class="org-string">"Online Etymology Dictionary"</span>))
                lexic-dictionary-specs)

  (<span class="org-keyword">pushnew!</span> lexic-dictionary-specs
            '(<span class="org-string">"GNU Collaborative International Dictionary of English"</span>
              <span class="org-builtin">:short</span> <span class="org-string">"Meaning"</span>
              <span class="org-builtin">:formatter</span> lexic-format-webster
              <span class="org-builtin">:priority</span> 1)
            '(<span class="org-string">"English - Portuguese"</span>
              <span class="org-builtin">:short</span> <span class="org-string">"Portuguese"</span>
              <span class="org-builtin">:formatter</span> lexic-format-online-etym
              <span class="org-builtin">:priority</span> 2)
            '(<span class="org-string">"Online Etymology Dictionary"</span>
              <span class="org-builtin">:short</span> <span class="org-string">"Origin"</span>
              <span class="org-builtin">:formatter</span> lexic-format-online-etym
              <span class="org-builtin">:priority</span> 4))

  (map! <span class="org-builtin">:map</span> lexic-mode-map
        <span class="org-builtin">:n</span> <span class="org-string">"q"</span> #'lexic-return-from-lexic
        <span class="org-builtin">:nv</span> <span class="org-string">"RET"</span> #'lexic-search-word-at-point
        <span class="org-builtin">:n</span> <span class="org-string">"a"</span> #'outline-show-all
        <span class="org-builtin">:n</span> <span class="org-string">"o"</span> #'lexic-toggle-entry
        <span class="org-builtin">:n</span> <span class="org-string">"n"</span> #'lexic-next-entry
        <span class="org-builtin">:n</span> <span class="org-string">"N"</span> (<span class="org-keyword">cmd!</span> (lexic-next-entry t))
        <span class="org-builtin">:n</span> <span class="org-string">"p"</span> #'lexic-previous-entry
        <span class="org-builtin">:n</span> <span class="org-string">"P"</span> (<span class="org-keyword">cmd!</span> (lexic-previous-entry t))
        <span class="org-builtin">:n</span> <span class="org-string">"E"</span> (<span class="org-keyword">cmd!</span> (lexic-return-from-lexic) <span class="org-comment-delimiter">; </span><span class="org-comment">expand</span>
                     (switch-to-buffer (lexic-get-buffer)))
        <span class="org-builtin">:n</span> <span class="org-string">"M"</span> (<span class="org-keyword">cmd!</span> (lexic-return-from-lexic) <span class="org-comment-delimiter">; </span><span class="org-comment">minimise</span>
                     (lexic-goto-lexic))
        <span class="org-builtin">:n</span> <span class="org-string">"C-p"</span> #'lexic-search-history-backwards
        <span class="org-builtin">:n</span> <span class="org-string">"C-n"</span> #'lexic-search-history-forwards
        <span class="org-builtin">:n</span> <span class="org-string">"/"</span> (<span class="org-keyword">cmd!</span> (call-interactively #'lexic-search))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 308: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-lexic-buffer-config-h</span> ()
  (<span class="org-keyword">setq</span> writeroom-width 75)
  (<span class="org-keyword">let</span> ((+zen-text-scale 0))
    (+zen/toggle)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 309: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(add-hook 'lexic-mode-hook #'my-lexic-buffer-config-h)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 310: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-dictionary-definition-lexic-a (identifier <span class="org-type">&amp;optional</span> _)
  <span class="org-doc">"Look up the definition of the word at point (or selection) using `</span><span class="org-doc"><span class="org-constant">lexic-search</span></span><span class="org-doc">'."</span>
  <span class="org-builtin">:override</span> #'+lookup/dictionary-definition
  (<span class="org-keyword">interactive</span>
   (list (<span class="org-keyword">or</span> (doom-thing-at-point-or-region 'word)
             (read-string <span class="org-string">"Look up in dictionary: "</span>))
         current-prefix-arg))
  (lexic-search identifier nil nil t))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 311: </span>Commands to install custom aspell dictionary</label><pre class="src src-shell"><span class="org-builtin">cd</span> $<span class="org-variable-name">TMPDIR</span>
curl -o <span class="org-string">"aspell6-en-custom.tar.bz2"</span> <span class="org-string">'http://app.aspell.net/create?max_size=95&amp;spelling=GBs&amp;spelling=AU&amp;max_variant=0&amp;diacritic=keep&amp;special=hacker&amp;special=roman-numerals&amp;encoding=utf-8&amp;format=inline&amp;download=aspell'</span>
tar -xjf <span class="org-string">"aspell6-en-custom.tar.bz2"</span>
<span class="org-builtin">cd</span> aspell6-en-custom
./configure &amp;&amp; make &amp;&amp; sudo make install
<span class="org-builtin">cd</span> ..
rm -rf aspell6-en-custom*
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 312: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-aspell-local-data-dir</span> (expand-file-name <span class="org-string">"~/.local/share/aspell"</span>)
  <span class="org-doc">"Directory of Aspell dictionaries."</span>)

(<span class="org-keyword">unless</span> (file-exists-p my-aspell-local-data-dir)
  (mkdir my-aspell-local-data-dir t))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 313: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-aspell--personal-dictionary</span> (expand-file-name <span class="org-string">"personal.en.pws"</span> my-aspell-local-data-dir)
  <span class="org-doc">"File path for my personal word dictionaries."</span>)

(<span class="org-keyword">when</span> (not (file-exists-p my-aspell--personal-dictionary))
  (append-to-file <span class="org-string">"personal_ws-1.1 en 0 utf-8"</span> nil my-aspell--personal-dictionary))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 314: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-aspell-cmd-flags</span> (<span class="org-type">&amp;optional</span> camel-case <span class="org-type">&amp;rest</span> extra-args)
  <span class="org-doc">"Return the list of arguments Emacs should use to run aspell.</span>

<span class="org-doc">You can use this list of arguments directly as the value of `</span><span class="org-doc"><span class="org-constant">ispell-extra-args</span></span><span class="org-doc">'.</span>
<span class="org-doc">If CAMEL-CASE is a non-nil value, the list of arguments will include the</span>
<span class="org-doc">\"--camel-case\" option.</span>

<span class="org-doc">If EXTRA-ARGS is not nil, this function will append its value to the result."</span>
  (append '(<span class="org-string">"--sug-mode=ultra"</span>) extra-args (<span class="org-keyword">when</span> camel-case '(<span class="org-string">"--camel-case"</span>))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 315: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> ispell
  (<span class="org-keyword">setq</span> ispell-personal-dictionary my-aspell--personal-dictionary)
  (<span class="org-keyword">setq</span> ispell-really-aspell t)
  (<span class="org-keyword">setq</span> ispell-extra-args (my-aspell-cmd-flags t)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 316: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-spell-fu-find-urls</span> (point-start point-end)
  (<span class="org-keyword">let</span> ((url-ranges (list)))
    (<span class="org-keyword">save-match-data</span>
      (<span class="org-keyword">save-excursion</span>
        (goto-char point-start)
        (<span class="org-keyword">while</span> (re-search-forward browse-url-button-regexp point-end t)
          (<span class="org-keyword">push</span> (cons (match-beginning 0) (match-end 0)) url-ranges))
        url-ranges))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 317: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-spell-fu-check-range</span> (point-start point-end)
  <span class="org-doc">"Check spelling for POINT-START &amp; POINT-END ignoring urls."</span>
  (spell-fu--remove-overlays point-start point-end)
  (<span class="org-keyword">with-syntax-table</span> spell-fu-syntax-table
    (<span class="org-keyword">save-match-data</span>
      (<span class="org-keyword">save-excursion</span>
        (goto-char point-start)
        (<span class="org-keyword">while</span> (re-search-forward spell-fu-word-regexp point-end t)
          (<span class="org-keyword">let</span> ((url-ranges (my-spell-fu-find-urls point-start point-end))
                (word-start (match-beginning 0))
                (word-end (match-end 0)))
            (<span class="org-keyword">unless</span> (seq-some (<span class="org-keyword">lambda</span> (range)
                                (<span class="org-keyword">or</span> (<span class="org-keyword">and</span> (&gt; word-start (car range))
                                         (&lt; word-start (cdr range)))
                                    (<span class="org-keyword">and</span> (&gt; word-end (car range))
                                         (&lt; word-end (cdr range)))))
                              url-ranges)
              (<span class="org-keyword">when</span> (spell-fu--check-faces-at-point
                     word-start
                     spell-fu-faces-include
                     spell-fu-faces-exclude)
                (spell-fu-check-word word-start word-end (match-string-no-properties 0))))))))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 318: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> spell-fu
  (<span class="org-keyword">setq</span> spell-fu-check-range 'my-spell-fu-check-range))
</pre>
</div>

<p>
Rules:
</p>
<ul class="org-ul">
<li><a href="https://github.com/textlint-rule/textlint-rule-no-start-duplicated-conjunction">https://github.com/textlint-rule/textlint-rule-no-start-duplicated-conjunction</a></li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 319: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> flycheck
  (<span class="org-keyword">setq</span> flycheck-textlint-config <span class="org-string">"~/.config/textlint/config.json"</span>))
</pre>
</div>

<ul class="org-ul">
<li><a href="https://emacs.stackexchange.com/questions/48587/have-flycheck-skip-certain-regions">https://emacs.stackexchange.com/questions/48587/have-flycheck-skip-certain-regions</a></li>
<li><a href="https://emacs.stackexchange.com/questions/47878/how-can-i-disable-a-specific-lint-error-for-emacs-lisp-using-flycheck">https://emacs.stackexchange.com/questions/47878/how-can-i-disable-a-specific-lint-error-for-emacs-lisp-using-flycheck</a></li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 320: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">my-noflycheck-region-alist</span>
  '((org-mode (<span class="org-string">"^[ \\t]*?#\\+begin_</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">src</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">quote</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span> . <span class="org-string">"^[ \\t]*?#\\+end_</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">src</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">quote</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span>)))
  <span class="org-doc">"An association list between major modes and a noflycheck region delimiters.</span>

<span class="org-doc">The region delimiters are two regular expressions that should match the</span>
<span class="org-doc">beginning and the end of the region respectively."</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 321: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-noflycheck-should-skip-error-h</span> (err)
  <span class="org-doc">"Ignore flycheck ERR if it happens inside a 'no flycheck' region."</span>
  (<span class="org-keyword">when-let</span> ((region (car (alist-get major-mode my-noflycheck-region-alist)))
             (_ (<span class="org-keyword">save-excursion</span>
                  (<span class="org-keyword">save-match-data</span>
                    (<span class="org-keyword">let*</span> ((start (car region))
                           (end (cdr region))
                           (both (format <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">%s</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">%s</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span> start end)))
                      (goto-char (flycheck-error-pos err))
                      (<span class="org-keyword">and</span> (re-search-backward both nil t)
                           (match-beginning 1)))))))
    (<span class="org-keyword">setq-local</span> flycheck-current-errors (remove err flycheck-current-errors))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 322: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-noflycheck-should-skip-urls-h</span> (err)
  <span class="org-doc">"Ignore flycheck ERR if it happens inside a 'no flycheck' region."</span>
  (<span class="org-keyword">when-let</span> ((_ (<span class="org-keyword">save-excursion</span>
                  (<span class="org-keyword">save-match-data</span>
                    (<span class="org-keyword">when-let</span> ((err-pos (flycheck-error-pos err)))
                      (goto-char err-pos)
                      (thing-at-point 'url))))))
    (<span class="org-keyword">setq-local</span> flycheck-current-errors (remove err flycheck-current-errors))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 323: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-noflycheck-h</span> ()
  <span class="org-doc">"Add a skip flycheck for regions defined at `</span><span class="org-doc"><span class="org-constant">my-noflycheck-region-alist</span></span><span class="org-doc">'."</span>
  (<span class="org-keyword">require</span> '<span class="org-constant">flycheck</span>)
  (add-hook 'flycheck-process-error-functions #'my-noflycheck-should-skip-error-h nil t)
  (add-hook 'flycheck-process-error-functions #'my-noflycheck-should-skip-urls-h nil t))
</pre>
</div>

<ul class="org-ul">
<li><a href="https://github.com/alexmurray/flycheck-posframe">https://github.com/alexmurray/flycheck-posframe</a></li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 324: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> flycheck-posframe)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 325: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(custom-set-faces!
  '(flycheck-posframe-border-face <span class="org-builtin">:foreground</span> <span class="org-string">"#000000"</span>)
  '(flycheck-posframe-face <span class="org-builtin">:inherit</span> my-default-ui))

(<span class="org-keyword">use-package!</span> flycheck-posframe
  <span class="org-builtin">:hook</span> ((flycheck-mode . flycheck-posframe-mode))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> flycheck-posframe-border-width 1
        flycheck-posframe-prefix
        (format <span class="org-string">"%s\t"</span> (all-the-icons-material <span class="org-string">"close"</span> <span class="org-builtin">:height</span> 0.7 <span class="org-builtin">:v-adjust</span> -0.1))
        flycheck-posframe-info-prefix
        (format <span class="org-string">"%s\t"</span> (all-the-icons-material <span class="org-string">"info"</span> <span class="org-builtin">:height</span> 0.7 <span class="org-builtin">:v-adjust</span> -0.1))
        flycheck-posframe-warning-prefix
        (format <span class="org-string">"%s\t"</span> (all-the-icons-material <span class="org-string">"warning"</span> <span class="org-builtin">:height</span> 0.7 <span class="org-builtin">:v-adjust</span> -0.1))
        flycheck-posframe-error-prefix
        (format <span class="org-string">"%s\t"</span> (all-the-icons-material <span class="org-string">"error"</span> <span class="org-builtin">:height</span> 0.7 <span class="org-builtin">:v-adjust</span> -0.1)))
)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 326: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-flycheck-posframe-format-errors-a (fun <span class="org-type">&amp;rest</span> args)
  <span class="org-doc">"Advice to add a top and bottom padding to the error message."</span>
  <span class="org-builtin">:around</span> 'flycheck-posframe-format-errors
  (concat (propertize <span class="org-string">"  \n"</span> 'face '(<span class="org-builtin">:height</span> 60))
          (apply fun args)
          (propertize <span class="org-string">"\n  "</span> 'face '(<span class="org-builtin">:height</span> 60))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 327: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defadvice!</span> my-flycheck-posframe-show-posframe-a (errors)
  <span class="org-doc">"Display ERRORS, using posframe.el library."</span>
  <span class="org-builtin">:override</span> 'flycheck-posframe-show-posframe
  (posframe-hide flycheck-posframe-buffer)
  (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> errors
             (not (run-hook-with-args-until-success 'flycheck-posframe-inhibit-functions)))
    (<span class="org-keyword">let</span> ((poshandler (intern (format <span class="org-string">"posframe-poshandler-%s"</span> flycheck-posframe-position))))
      (<span class="org-keyword">unless</span> (functionp poshandler)
        (<span class="org-keyword">setq</span> poshandler nil))
      (flycheck-posframe-check-position)
      (posframe-show
       flycheck-posframe-buffer
       <span class="org-builtin">:string</span> (flycheck-posframe-format-errors errors)
       <span class="org-builtin">:background-color</span> (face-background 'flycheck-posframe-background-face nil t)
       <span class="org-builtin">:position</span> (point)
       <span class="org-builtin">:internal-border-width</span> flycheck-posframe-border-width
       <span class="org-builtin">:internal-border-color</span> (face-foreground 'flycheck-posframe-border-face nil t)
       <span class="org-builtin">:poshandler</span> poshandler
       <span class="org-builtin">:hidehandler</span> #'flycheck-posframe-hidehandler
       <span class="org-builtin">:left-fringe</span> 10
       <span class="org-builtin">:right-fringe</span> 10))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org74eac19" class="outline-4">
<h4 id="org74eac19"><span class="section-number-4">5.3.2</span> Templates</h4>
<div class="outline-text-4" id="text-5-3-2">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 328: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-file-templates-yasnippet-dir</span> (expand-file-name <span class="org-string">"share/templates"</span> doom-private-dir))
(<span class="org-keyword">pushnew!</span> yas-snippet-dirs 'my-file-templates-yasnippet-dir)
</pre>
</div>


<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 329: </span>$DOOMDIR/share/templates/org-mode/__</label><pre class="src src-snippet"># name: Blank Org File
# key: __
# --
#+TITLE: ${1:`(s-titleized-words (file-name-sans-extension (buffer-name)))`}
#+AUTHOR: `user-full-name`
#+EMAIL: `user-mail-address`
#+DATE: `(format (format-time-string "%B %%s, %Y") (string-to-number (format-time-string "%d")))`
#+LANGUAGE: ${2:en}

`%`$0
</pre>
</div>
</div>


<ol class="org-ol">
<li><a id="org65b4841"></a><span class="todo TODO">TODO</span> Define a Hydra for <i>new documents</i> to use my templates<br></li>
</ol>
</div>

<div id="outline-container-orgf0ca6ce" class="outline-4">
<h4 id="orgf0ca6ce"><span class="section-number-4">5.3.3</span> Focus Writing</h4>
<div class="outline-text-4" id="text-5-3-3">
<ul class="org-ul">
<li><a href="https://github.com/larstvei/Focus">https://github.com/larstvei/Focus</a></li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 330: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> focus)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 331: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> focus <span class="org-builtin">:defer</span> t)

(map! <span class="org-builtin">:leader</span> <span class="org-builtin">:prefix</span> (<span class="org-string">"t"</span> . <span class="org-string">"toggle"</span>)
      <span class="org-builtin">:desc</span> <span class="org-string">"Focus mode"</span> <span class="org-builtin">:mvn</span> <span class="org-string">"o"</span> #'focus-mode
      <span class="org-builtin">:desc</span> <span class="org-string">"Focus mode (RO)"</span> <span class="org-builtin">:mvn</span> <span class="org-string">"O"</span> #'focus-read-only-mode)
</pre>
</div>
</div>
</div>

<div id="outline-container-org1475e7a" class="outline-4">
<h4 id="org1475e7a"><span class="section-number-4">5.3.4</span> Snippets</h4>
<div class="outline-text-4" id="text-5-3-4">
<p>
Even though writing does not have boilerplate typing <i>per-se</i>, Org mode still has a formal syntax to follow. Most of the syntax are straightforward, but some could use a snippet help to make it easier and faster to type them.
</p>

<p>
This section shows the snippets I decide to use for writing.
</p>

<p>
Before defining the snippets though, I need to adjust the <code>yas-keymap</code> to behave properly with evil:
</p>
</div>


<ol class="org-ol">
<li><a id="org82046f0"></a>Source blocks<br>
<div class="outline-text-5" id="text-5-3-4-1">
<p>
This journey of literate configuration made me realize how much faster is to <i>prepare</i> source blocks using snippets.
</p>

<p>
The first snippet, is a simple <code>emacs-lisp</code> snippet that I use all the time:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 332: </span>$DOOMDIR/snippets/org-mode/src-emacs-lisp</label><pre class="src src-snippet"># name: #+begin_src emacs-lisp
# uuid: emacs-lisp
# key: &lt;el
# --
`(when buffer-file-name (format "#+caption: $DOOMDIR/%s.el\n" (file-name-base buffer-file-name)))`#+begin_src emacs-lisp
`%`$0
#+end_src
</pre>
</div>

<p>
Then I have the same snippet, but allowing me to add a <code>:tangle</code> header to it:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 333: </span>$DOOMDIR/snippets/org-mode/src-emacs-lisp-tangled</label><pre class="src src-snippet"># name: #+begin_src emacs-lisp :tangle
# uuid: emacs-lisp-tangle
# key: &lt;elt
# --
${1:$(unless (or (string-blank-p yas-text) (equal yas-text "no"))
	(format "#+caption: %s\n" yas-text))
}#+begin_src emacs-lisp `":tangle"` ${1:$$(unless (or yas-moving-away-p yas-modified-p)
			    (yas-auto-next
			      (condition-case nil
				  (let ((fname (read-file-name "Tangle to file: ")))
				    (if fname
					(file-relative-name fname (file-name-directory (or buffer-file-name ".")))
				      "no"))
				('quit "no"))))}
`%`$0
#+end_src
</pre>
</div>

<p>
And for a more generic approach, I have this snippet where you can define the language, if you want a tangle header, and if you do, allows you to select the file:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 334: </span>$DOOMDIR/snippets/org-mode/src-tangled</label><pre class="src src-snippet"># name: #+begin_src on steroids
# uuid: src_block
# key: &lt;st
# --
${3:$(unless (or (string-blank-p yas-text) (equal yas-text "no"))
	(format "#+caption: %s\n" yas-text))
}#+begin_src ${1:emacs-lisp} ${2:`":tangle"` ${3:$$(unless (or yas-moving-away-p
							       yas-modified-p)
			    (yas-auto-next
			      (condition-case nil
				  (let ((fname (read-file-name "Tangle to file: ")))
				    (if fname
					(file-relative-name fname (file-name-directory (or (buffer-file-name) ".")))
				      "no"))
				('quit "no"))))}}
`%`$0
#+end_src
</pre>
</div>

<p>
The last snippets I consider useful for source blocks are captions. On the two snippets with tangled files, the capture mark is already there, but if I want to add a caption to the non-tangled snippet I have to do it by hand. So, let's create a snippet to help us with this:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 335: </span>$DOOMDIR/snippets/org-mode/caption</label><pre class="src src-snippet"># name: #+caption:
# key: cap
# --
#+caption: $0
</pre>
</div>

<p>
This snippet is fine, but we still have to type the filename there. Let's create another one to make this task even easier:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 336: </span>$DOOMDIR/snippets/org-mode/caption-file</label><pre class="src src-snippet"># name: #+caption: filename
# uuid: caption-file
# key: capf
# --
#+caption: ${1:$$(unless (or yas-moving-away-p yas-modified-p)
			    (yas-auto-next
			      (file-relative-name
				(read-file-name "Tangle to file: ")
				(file-name-directory (or (buffer-file-name) "."))
			      )))}$0
</pre>
</div>
</div>
</li>

<li><a id="org982a472"></a>Org elements<br>
<div class="outline-text-5" id="text-5-3-4-2">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 337: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-links-in-kill-ring</span> ()
  <span class="org-doc">"Return a list of links in kill ring."</span>
  (<span class="org-keyword">require</span> '<span class="org-constant">goto-addr</span>)
  (<span class="org-keyword">let*</span> ((kill-ring-kills (mapcar #'substring-no-properties kill-ring))
         (clipboard (gui-get-selection 'CLIPBOARD 'NSStringPboardType))
         (clipboard-url (<span class="org-keyword">when</span> (string-match goto-address-url-regexp clipboard)
                          (list (match-string 0 clipboard))))
         (potential-links))
    (<span class="org-keyword">dolist</span> (kill kill-ring-kills)
      (<span class="org-keyword">let</span> (last-match)
        (<span class="org-keyword">while</span>
            (<span class="org-keyword">prog1</span>
                (string-match goto-address-url-regexp
                              kill last-match)
              (<span class="org-keyword">setq</span> last-match (match-end 0)))
          (<span class="org-keyword">cl-pushnew</span> (match-string 0 kill) potential-links)
          )))
    (append clipboard-url (delete-dups potential-links))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 338: </span>$DOOMDIR/snippets/org-mode/link</label><pre class="src src-snippet"># name: Link
# key: link
# --
[[${1:$$(unless (or yas-moving-away-p yas-modified-p)
  (let ((links (my-links-in-kill-ring)))
    (if links
	(yas-auto-next
	  (completing-read "Choose the URL to link: " links))
      "url")))}][${2:`(or yas-selected-text "description")`}]]$0
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-orge7decc8" class="outline-3">
<h3 id="orge7decc8"><span class="section-number-3">5.4</span> <span class="todo TODO">TODO</span> Reading or reviewing</h3>
<div class="outline-text-3" id="text-5-4">
<ul class="org-ul">
<li>Narrower width</li>
<li>Visual motion</li>
<li>Show document structure on sidebar</li>
<li>Annotations
<ul class="org-ul">
<li>Referenceable</li>
<li>Annotate external documents (default to Doom)</li>
</ul></li>

<li><a href="https://depp.brause.cc/nov.el/">https://depp.brause.cc/nov.el/</a></li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 339: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> nov)
</pre>
</div>
</div>
</div>

<div id="outline-container-org11bd62e" class="outline-3">
<h3 id="org11bd62e"><span class="section-number-3">5.5</span> <span class="todo TODO">TODO</span> Publishing</h3>
<div class="outline-text-3" id="text-5-5">
<ul class="org-ul">
<li>Blog or site post</li>
<li>Email document</li>
<li>Wiki entry</li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 340: </span>$DOOMDIR/snippets/org-mode/macro</label><pre class="src src-snippet"># name: #+BEGIN_MACRO ... block
# uuid: macro
# key: &lt;m
# --
#+attr_block: :macro ${1:info} $2
#+BEGIN_MACRO
`%`$0
#+END_MACRO
</pre>
</div>
</div>
</div>

<div id="outline-container-orgba41b4c" class="outline-3">
<h3 id="orgba41b4c"><span class="section-number-3">5.6</span> <span class="todo TODO">TODO</span> Presenting</h3>
<div class="outline-text-3" id="text-5-6">
<ul class="org-ul">
<li>Use <code>reveal.js</code> inside a WebKit XWidget in full screen</li>
</ul>
</div>
</div>

<div id="outline-container-org6a3ffe9" class="outline-3">
<h3 id="org6a3ffe9"><span class="section-number-3">5.7</span> <span class="todo TODO">TODO</span> Note Taking</h3>
<div class="outline-text-3" id="text-5-7">
<p>
Here in this section I need to come clean to the reader. I'm a horrible note taker! I have <a href="https://www.cdc.gov/ncbddd/adhd/facts.html">ADHD</a> and my capacity to keep up with any system to take notes is as short as a <a href="https://www.cdc.gov/ncbddd/adhd/facts.html">fruit fly's attention span</a>. That said, one of the longest streaks of success keeping up with notes I had in the past, was when I tried Org mode for the first time. I believe if I have a setup that makes taking notes effortless, I might be able to finally start taking notes and refer to them when needed.
</p>

<p>
After a lot of reading, consultation, and thinking, I believe I found a system I will enjoy working with. Let me describe it to you.
</p>

<p>
One of the constants I found when searching for a note taking system was the fact that writing down a note (regardless of its type), has to happen in less than two seconds or I don't get motivated to do it all the time. This time is valid to take notes from a computer, as well as on the go. For some individuals, having a small notebook at hand all the time, is crucial for them. Since I'm more of a tech guy, my system will use exclusively computer software.
</p>

<p>
To get under these two seconds to take a note when I'm on a computer, I defined a single entry point for all notes. This way I can optimize this process inside and outside Emacs if I want.
</p>

<p>
My entry point for notes is <a href="https://github.com/bastibe/org-journal">Org Journal</a>. I will use an entry scheme of one file per year, and create an <a href="https://orgmode.org/manual/Capture.html">org-capture</a> system that will use this single journal file and help me achieve the two seconds mark.
</p>

<p>
Part of my strategy is to have one capture template per type of note to reduce the necessary amount of thinking not related to the note itself. Another artifact I will use is <a href="https://joaotavora.github.io/yasnippet/">Yasnippet</a> instead of <code>org-capture</code> templates. The reason for this decision is to keep a visual track on the entry text. With the standard <code>org-capture</code>, I have to move my eyes from top to bottom of the screen to look between the template text and the input field.
</p>

<p>
I will take notes any time I feel the need, but here are the main topics for my notes:
</p>

<dl class="org-dl">
<dt>Fleet notes</dt><dd>These are the <i>quick notes</i> of the day. I will use fleet notes any time a note does not fit on anyone of the next categories;</dd>
<dt>Journal entries</dt><dd>When need to add an event on my personal journal, I will use this category. I need to clarify though, that a <i>personal journal</i> for me, is anything that happens to myself, regardless if is a work related event or not;</dd>
<dt>Meeting notes</dt><dd>Should happen on any meeting, I must review them no longer than 30 minutes after it,  and must include:
<ul class="org-ul">
<li>List of participants;</li>
<li>Meeting time;</li>
<li>Meeting subjects;</li>
<li>Important points on the meeting;</li>
<li>Action items and their owners;</li>
</ul></dd>
<dt>Support</dt><dd>When I spend some time with a co-worker helping her on any subject, I will have a note about this support containing:
<ul class="org-ul">
<li>Co-worker's name;</li>
<li>Support's subject;</li>
<li>Start and end time;</li>
<li>Action items for me or the co-worker;</li>
</ul></dd>
<dt>Idea</dt><dd>Whenever something interesting pops from my brain, I will try to capture it in this category;</dd>
<dt>Link</dt><dd>When I find something interesting online, or something I should spend some time reading or studying;</dd>
<dt>Past entry</dt><dd>If I remember of something that happens a couple days earlier, or when I want to make a journal entry on the past, I will use this category;</dd>
</dl>

<p>
On the end of each day, I will sit down in front of my computer to review the notes I took on the day. I will think about each note I took and verify if its worth ot keeping it. If it is, I'll try to synthesize the note on my own words and relate it with previous notes.
</p>

<p>
I will be able to search notes using their reference label, title, tags, or content (a great package for this is <a href="https://github.com/jrblevin/deft">Deft</a>).
</p>
</div>

<div id="outline-container-org7a9a2c0" class="outline-4">
<h4 id="org7a9a2c0"><span class="section-number-4">5.7.1</span> Capturing</h4>
<div class="outline-text-4" id="text-5-7-1">
<p>
Talk about capture in general:
</p>
<ul class="org-ul">
<li>How am I going to use it?</li>
<li>How am I going to implement it with Yasnippets?</li>
<li>Any goals for this area?</li>
</ul>

<div class="org-src-container">
<pre class="src src-text">[n]     &#9679; Fleet note
[j]...  &#9679; Journal
[t]...  &#9679; Tasks
[c]     &#9679; Contact
[p]...  &#9679; Project
--------------------------------------------------------------------------------
[q]     &#9679; Abort
</pre>
</div>

<p>
Start with the open definition for <code>org-capture</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 341: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-capture--note-frame-height</span> 15
  <span class="org-doc">"Number of lines a note frame should have when capturing a long note."</span>)

(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-capture--long-note-frame-height</span> 35
  <span class="org-doc">"Number of lines a note frame should have when capturing a long note."</span>)

(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-capture--menu-width</span> 50
  <span class="org-doc">"Number of lines a note frame should have when capturing a long note."</span>)

(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-capture--yas-prefix</span> <span class="org-string">"--DOOM-ORG-CAPTURE-YAS-PREFIX--:"</span>
  <span class="org-doc">"String used to identify a yasnippet template on a capture buffer"</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 342: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-capture-yasnippet-dir</span> (expand-file-name <span class="org-string">"share/capture"</span> doom-private-dir)
  <span class="org-doc">"Directory containning all capture snippets."</span>)
(<span class="org-keyword">pushnew!</span> yas-snippet-dirs 'my-capture-yasnippet-dir)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 343: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> org-capture
  <span class="org-builtin">:after</span> all-the-icons
  <span class="org-builtin">:commands</span> (org-capture +org-capture/open-frame)
  <span class="org-builtin">:init</span>
  (add-hook 'org-capture-mode-hook #'my-capture--yas-expand-h)
  (add-hook 'org-capture-after-finalize-hook #'my-capture--finish-h)
  (add-hook 'window-state-change-hook #'my-bring-org-capture-to-front-h)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setq</span> +org-capture-changelog-file <span class="org-string">"CHANGELOG.org"</span>)
  (<span class="org-keyword">setq</span> org-capture-templates-contexts '((<span class="org-string">"p"</span> (my-capture-projects-p))))
  (<span class="org-keyword">setq</span> +org-capture-fn (<span class="org-keyword">lambda</span> ()
                          (<span class="org-keyword">interactive</span>)
                          (set-window-parameter nil 'mode-line-format 'none)
                          (set-window-parameter nil 'header-line-format 'none)
                          (<span class="org-keyword">setq</span> default-minibuffer-frame (org-capture))))

  (map! (<span class="org-builtin">:map</span> org-capture-mode-map
         <span class="org-builtin">:in</span> [s-return] #'org-capture-finalize
         <span class="org-builtin">:in</span> [s-escape] #'org-capture-kill)
        (<span class="org-builtin">:leader</span>
         <span class="org-builtin">:desc</span> <span class="org-string">"Org Capture"</span>           <span class="org-string">"X"</span> #'+org-capture
         (<span class="org-builtin">:prefix</span> (<span class="org-string">"n"</span> . <span class="org-string">"notes"</span>)
          <span class="org-builtin">:desc</span> <span class="org-string">"Org capture"</span>          <span class="org-string">"n"</span> #'+org-capture/open-frame))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 344: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org-capture
  (<span class="org-keyword">setq</span> org-capture-templates '()))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 345: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-bring-org-capture-to-front-h</span> ()
  (<span class="org-keyword">when-let</span> ((captur-buffer (seq-find (<span class="org-keyword">lambda</span> (buf) (string-prefix-p <span class="org-string">"CAPTURE"</span> (buffer-name buf)))
                                      (buffer-list))))
    (my-bring-buffer-to-front captur-buffer)
    (<span class="org-keyword">when</span> (eq (org-roam-buffer--visibility) 'visible)
      (org-roam-buffer-deactivate))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 346: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture--adjust-frame</span> (<span class="org-type">&amp;optional</span> extended-p frame)
  <span class="org-doc">"Dinamically adjust the capture FRAME width to WIDTH and reposition it on the</span>
<span class="org-doc">center of the screen."</span>
  (<span class="org-keyword">when</span> (+org-capture-frame-p)
    (set-frame-size (<span class="org-keyword">or</span> frame (selected-frame))
                    (+ fill-column 20)
                    (<span class="org-keyword">if</span> extended-p
                        my-capture--long-note-frame-height
                      my-capture--note-frame-height))
    (my-capture--reposition-frame frame)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 347: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture--reposition-frame</span> (<span class="org-type">&amp;optional</span> frame)
  <span class="org-doc">"Position FRAME around the center of the screen."</span>
  (<span class="org-keyword">let</span> ((frame-w (window-pixel-width))
        (frame-h (window-pixel-height)))
    (set-frame-position (<span class="org-keyword">or</span> frame (selected-frame))
                        (/ (- (display-pixel-width) frame-w) 2)     <span class="org-comment-delimiter">;; </span><span class="org-comment">X</span>
                        (/ (- (display-pixel-height) frame-h) 3)))) <span class="org-comment-delimiter">;; </span><span class="org-comment">Y</span>
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 348: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture--yas-expand-h</span> ()
  <span class="org-doc">"Expand `</span><span class="org-doc"><span class="org-constant">my-capture--yas-prefix</span></span><span class="org-doc">' on the template."</span>
  (<span class="org-keyword">setq</span> +org-capture--auto-align-tags-store org-auto-align-tags)
  (<span class="org-keyword">let</span> ((saved-point (point)))
    (goto-char (point-min))
    (<span class="org-keyword">if</span> (search-forward-regexp (concat my-capture--yas-prefix <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">:]*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">:"</span>) nil t)
        (<span class="org-keyword">progn</span>
          (<span class="org-keyword">setq</span> org-auto-align-tags nil)
          (goto-char (match-end 0))
          (replace-match (match-string 1))
          (yas-expand))
      (goto-char saved-point)))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">(org-num-mode -1)</span>
  (tab-line-mode -1)
  (ws-butler-mode -1)
  (<span class="org-keyword">setq-local</span> org-startup-folded nil))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 349: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture-yasnippet</span> (snippet)
  <span class="org-doc">"Returns a snippet mark with the given SNIPPET used to expand it with yasnippet</span>
<span class="org-doc">when the capture finishes.</span>

<span class="org-doc">SNIPPET can be a string or a symbol.</span>

<span class="org-doc">The snippet mark will have the format:</span>

<span class="org-doc">\"--DOOM-ORG-CAPTURE-YAS-PREFIX--:&lt;snippet name&gt;:\""</span>
  (concat my-capture--yas-prefix
          (<span class="org-keyword">if</span> (stringp snippet)
              snippet
            (symbol-name snippet))
          <span class="org-string">":"</span>))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 350: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture--finish-h</span> ()
  <span class="org-doc">"Clean up any outstanding variable and values set when capture</span>
<span class="org-doc">starts."</span>
  (<span class="org-keyword">setq</span> org-auto-align-tags +org-capture--auto-align-tags-store)
  (<span class="org-keyword">setq</span> +org-capture--auto-align-tags-store nil))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 351: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture-template-selection</span> ()
  <span class="org-doc">"Returns the text selected on the buffer that originated the capture. If the</span>
<span class="org-doc">selection is the entire buffer, return an org link to buffer."</span>
  (<span class="org-keyword">with-current-buffer</span> (org-capture-get <span class="org-builtin">:original-buffer</span>)
    (<span class="org-keyword">when</span> (region-active-p)
      (<span class="org-keyword">or</span> (my-capture--mu4e-headers-selected)
          (my-capture--mu4e-view-selected)
          (my-capture--buffer-selected)
          <span class="org-string">""</span>))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 352: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture--mu4e-headers-selected</span> (<span class="org-type">&amp;optional</span> buf-name)
  <span class="org-doc">"When on a mu4e-headers buffer, store an org link to each one of the selected</span>
<span class="org-doc">messages and return them all as a string."</span>
  (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> (boundp 'mu4e~headers-buffer-name)
             (string= (<span class="org-keyword">or</span> buf-name (buffer-name)) mu4e~headers-buffer-name))
    (<span class="org-keyword">let*</span> ((beg (region-beginning))
           (end (region-end))
           (lines (count-lines beg end)))
      (<span class="org-keyword">save-excursion</span>
        (goto-char beg)
        (<span class="org-keyword">while</span> (&lt; (point) end)
          (org-store-link t t)
          (forward-line 1)))
      (<span class="org-keyword">with-temp-buffer</span>
        (org-insert-all-links lines)
        (buffer-string)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 353: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture--mu4e-view-selected</span> (<span class="org-type">&amp;optional</span> buf-name)
  <span class="org-doc">"When on a mu4e-view buffer, store an org link to the message and return it as a</span>
<span class="org-doc">string with the selected text as a block-quote. If the selection is the entire</span>
<span class="org-doc">buffer, just return the org link."</span>
  (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> (boundp 'mu4e~view-buffer-name)
             (string= (<span class="org-keyword">or</span> buf-name (buffer-name)) mu4e~view-buffer-name))
    (<span class="org-keyword">let*</span> ((beg (region-beginning))
           (end (region-end))
           (full-buf-sel-p (<span class="org-keyword">and</span> (= beg (point-min))
                                (= end (point-max))))
           (buf-quote (<span class="org-keyword">when</span> (not full-buf-sel-p) (buffer-substring beg end))))
      (org-store-link t t)
      (<span class="org-keyword">with-temp-buffer</span>
        (insert <span class="org-string">"- "</span>)
        (org-insert-last-stored-link 1)
        (<span class="org-keyword">when</span> buf-quote
          (insert <span class="org-string">"#+BEGIN_QUOTE\n"</span>)
          (insert buf-quote)
          (insert <span class="org-string">"#+END_QUOTE\n"</span>))
        (buffer-string)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 354: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture--buffer-selected</span> ()
  <span class="org-doc">"When there is an active selection in the current buffer,</span>
<span class="org-doc">returns an org link to the current buffer with the selection as a blockquote. If</span>
<span class="org-doc">the selection is the entire buffer, just return the org link."</span>
  (<span class="org-keyword">let</span> ((sel-text (<span class="org-keyword">let*</span> ((beg (region-beginning))
                         (end (region-end))
                         (full-buf-sel-p (<span class="org-keyword">and</span> (= beg (point-min))
                                              (= end (point-max))))
                         (buf-file (expand-file-name (buffer-file-name)))
                         (buf-name (buffer-name))
                         (buf-linum (line-number-at-pos beg t))
                         (buf-quote (<span class="org-keyword">when</span> (not full-buf-sel-p) (buffer-substring beg end)))
                         (quote-what (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> buf-quote (derived-mode-p 'prog-mode))
                                         (format <span class="org-string">"SOURCE %s"</span>
                                                 (s-chop-suffix <span class="org-string">"-mode"</span> (symbol-name major-mode)))
                                       <span class="org-string">"QUOTE"</span>)))
                    (<span class="org-keyword">with-temp-buffer</span>
                      (<span class="org-keyword">when</span> (file-exists-p buf-file)
                        (insert (format <span class="org-string">"- [[file:%s::%d][%s]]\n"</span> buf-file buf-linum buf-name)))
                      (<span class="org-keyword">when</span> buf-quote
                        (insert (format <span class="org-string">"#+BEGIN_%s\n"</span> quote-what))
                        (insert buf-quote)
                        (insert (format <span class="org-string">"#+END_%s\n"</span> quote-what)))
                      (buffer-string)))))
    (<span class="org-keyword">unless</span> (s-blank-str-p sel-text) sel-text)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 355: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture-projects-p</span> ()
  <span class="org-doc">"Retuns true when current buffer belongs to current open project."</span>
  (<span class="org-keyword">with-current-buffer</span> (<span class="org-keyword">or</span> (org-capture-get <span class="org-builtin">:original-buffer</span>) (current-buffer))
    (<span class="org-keyword">let*</span> ((proj-root (doom-project-root))
           (proj-root (<span class="org-keyword">when</span> proj-root (expand-file-name proj-root)))
           (buf-path (buffer-file-name))
           (buf-path (<span class="org-keyword">when</span> buf-path (expand-file-name buf-path))))
      (<span class="org-keyword">and</span> proj-root
           buf-path
           (string-prefix-p proj-root buf-path)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 356: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture-description</span> (<span class="org-type">&amp;rest</span> args)
  <span class="org-doc">"Returns a formatted capture description.</span>

<span class="org-doc">ARGS is a declarative builder for the new description:</span>

<span class="org-doc">`</span><span class="org-doc"><span class="org-constant">:text</span></span><span class="org-doc">' (required) - The string displayed on the capture item.</span>
<span class="org-doc">`</span><span class="org-doc"><span class="org-constant">:icon</span></span><span class="org-doc">' (optional) - A cons cell with the icon symbol (check</span>
<span class="org-doc">    `</span><span class="org-doc"><span class="org-constant">+org-capture-supported-icons</span></span><span class="org-doc">' for supported symbols).</span>

<span class="org-doc">Example:</span>

<span class="org-doc">  (my-capture-description :text \"Add journal entry\"</span>
<span class="org-doc">                            :icon '(journal . \"#ff00ff\"))"</span>
  (<span class="org-keyword">let</span> ((text (plist-get args <span class="org-builtin">:text</span>))
        (icon (plist-get args <span class="org-builtin">:icon</span>)))
    (<span class="org-keyword">when</span> (<span class="org-keyword">or</span> (null text)
                (string-blank-p text))
      (<span class="org-warning">error</span> <span class="org-string">"A capture description requires a text."</span>))
    (<span class="org-keyword">if</span> icon
        (<span class="org-keyword">progn</span>
          <span class="org-comment-delimiter">;; </span><span class="org-comment">(unless (and (consp icon)</span>
          <span class="org-comment-delimiter">;;              </span><span class="org-comment">(my-supported-icons-p (car-safe icon))</span>
          <span class="org-comment-delimiter">;;              </span><span class="org-comment">(stringp (cdr-safe icon)))</span>
          <span class="org-comment-delimiter">;;   </span><span class="org-comment">(error (concat "A capture description icon must be a cons cell with"</span>
          <span class="org-comment-delimiter">;;                  </span><span class="org-comment">" one of my-supported-icons symbol and a string color.")))</span>
          (format <span class="org-string">"%s %s"</span> (my-icon (car icon) (cdr icon)) text))
      text)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 357: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture-heading-template</span> (<span class="org-type">&amp;rest</span> args)
  <span class="org-doc">"Returns a formatted capture template for a heading.</span>

<span class="org-doc">ARGS should all be string that will get concatenated with no spaces between</span>
<span class="org-doc">them. Default to \"%?\"."</span>
  (<span class="org-keyword">let*</span> ((content (<span class="org-keyword">when</span> args (s-join <span class="org-string">""</span> args)))
         (content (<span class="org-keyword">if</span> (s-matches-p content <span class="org-string">"%|</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">|]*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">|"</span>)
                      (s-trim (s-replace-all '((<span class="org-string">" %? "</span> . <span class="org-string">" "</span>) (<span class="org-string">"%?"</span> . <span class="org-string">""</span>)) content))
                    (<span class="org-keyword">or</span> content <span class="org-string">"%?"</span>))))
    (concat (<span class="org-keyword">when</span> (not (s-starts-with-p <span class="org-string">"*"</span> content))
              <span class="org-string">"%(my-capture-heading-prefix) "</span>)
            (replace-regexp-in-string <span class="org-string">"%|</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">|]*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">|"</span>
                                      <span class="org-string">"%(my-capture-yasnippet 'capture-\\1)%?"</span>
                                      content)
            <span class="org-string">"\n%(my-capture-template-selection)"</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 358: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture-heading-prefix</span> ()
  <span class="org-doc">"Returns a string of `*` characters representing an org header level. The number</span>
<span class="org-doc">of characters is the one on the org-capture `</span><span class="org-doc"><span class="org-constant">:heading-level</span></span><span class="org-doc">' property or</span>
<span class="org-doc">calculated by the org-capture `</span><span class="org-doc"><span class="org-constant">:olp</span></span><span class="org-doc">' property size."</span>
  (<span class="org-keyword">let</span> ((level (org-capture-get <span class="org-builtin">:heading-level</span>))
        (olp-size (1+ (length (org-capture-get <span class="org-builtin">:olp</span>)))))
    (s-repeat (max 1 (<span class="org-keyword">or</span> level olp-size)) <span class="org-string">"*"</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 359: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture-position-cursor</span> ()
  <span class="org-doc">"Asks user for a timestamp and store it for template use. It also position the</span>
<span class="org-doc">cursor on the correct place for a new entry, and adjust the capture frame width</span>
<span class="org-doc">to `</span><span class="org-doc"><span class="org-constant">fill-column</span></span><span class="org-doc">' before start editing."</span>
  (my-capture--adjust-frame (org-capture-get <span class="org-builtin">:clock-in</span>))
  (<span class="org-keyword">let*</span> ((read-time (org-capture-get <span class="org-builtin">:read-time</span>))
         (read-time-labal (<span class="org-keyword">or</span> (org-capture-get <span class="org-builtin">:read-time-label</span>) <span class="org-string">"Timestamp"</span>))
         (olp (org-capture-get <span class="org-builtin">:olp</span>))
         (header-point (org-roam-capture-find-or-create-olp olp))
         existent-olp)
    (<span class="org-keyword">when</span> read-time
      (org-capture-put <span class="org-builtin">:time-read</span> (org-read-date t t nil read-time-labal)))
    (<span class="org-keyword">if</span> (not olp)
        (goto-char (point-max))
      (goto-char header-point)
      (org-end-of-subtree)
      (move-end-of-line nil))
    (newline)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 360: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture-file</span>()
  (<span class="org-keyword">let*</span> ((file-name-format (org-capture-get <span class="org-builtin">:file-name-format</span>))
         (file-name (s-trim (org-capture-fill-template file-name-format)))
         (file-path (expand-file-name file-name (<span class="org-keyword">when</span> (not (s-starts-with-p <span class="org-string">"/"</span> file-name)) org-directory)))
         (file-header (org-capture-get <span class="org-builtin">:file-header</span>)))
    (<span class="org-keyword">if</span> (file-exists-p file-path)
        (find-file file-path)
      (make-directory (file-name-directory file-path) t)
      (find-file file-path)
      (<span class="org-keyword">when</span> file-header
        (insert (org-capture-fill-template file-header)))
      (set-buffer-modified-p nil))
    (my-capture-position-cursor)
    (<span class="org-keyword">when</span> (eq 'visible (org-roam-buffer--visibility))
      (org-roam-buffer-deactivate))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 361: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture-time-read</span> ()
  <span class="org-doc">"Returns the last timestamp captured, formatted with the format specified on</span>
<span class="org-doc">`</span><span class="org-doc"><span class="org-constant">org-time-stamp-formats</span></span><span class="org-doc">'. If user didn't capture any date, returns current</span>
<span class="org-doc">time."</span>
  (format-time-string (cdr-safe org-time-stamp-formats) (org-capture-get <span class="org-builtin">:time-read</span>)))
</pre>
</div>
</div>

<ol class="org-ol">
<li><a id="org59bc94c"></a>Dailies<br>
<div class="outline-text-5" id="text-5-7-1-1">
<div class="org-src-container">
<pre class="src src-text">[s]     &#9679; Support
[m]     &#9679; Meeting
[c]     &#9679; Code review
[i]     &#9679; Idea
[l]     &#9679; Interesting link
--------------------------------------------------------------------------------
[q]     &#9679; Abort
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 362: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-roam-dailies-file-name</span> <span class="org-string">"notes/daily/daily-notes-%&lt;%Y-%m-%d&gt;.org"</span>
  <span class="org-doc">"Filename format for the Daily Notes file."</span>)

(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-roam-dailies-header</span> (concat <span class="org-string">"#+TITLE: Daily notes for %&lt;%A, %B %-e, %Y&gt;\n"</span>
                                           <span class="org-string">"#+STARTUP: overview\n"</span>
                                           <span class="org-string">"#+CATEGORY: dailies\n"</span>
                                           <span class="org-string">"\n"</span>)
  <span class="org-doc">"Template used to create new Daily Notes files."</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 363: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org-capture
  (<span class="org-keyword">appendq!</span> org-capture-templates
            `((<span class="org-string">"d"</span>  ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"Daily notes"</span> <span class="org-builtin">:icon</span> `(notes . ,(doom-color 'green)))))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 364: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org-capture
  (<span class="org-keyword">appendq!</span> org-capture-templates
            `((<span class="org-string">"dd"</span>  ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"Fleet note"</span> <span class="org-builtin">:icon</span> `(notes . ,(doom-color 'blue 256)))
               plain (<span class="org-keyword">function</span> my-capture-file)
               ,(my-capture-heading-template <span class="org-string">"%&lt;%H:%M%#p&gt; - %?"</span>)
               <span class="org-builtin">:file-name-format</span> ,my-roam-dailies-file-name
               <span class="org-builtin">:file-header</span> ,my-roam-dailies-header
               <span class="org-builtin">:kill-buffer</span> t
               <span class="org-builtin">:empty-lines-after</span> 2
               <span class="org-builtin">:olp</span> (<span class="org-string">"Fleet notes"</span>)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 365: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org-capture
  (<span class="org-keyword">appendq!</span> org-capture-templates
            `((<span class="org-string">"ds"</span> ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"Support"</span> <span class="org-builtin">:icon</span> `(help . ,(doom-color 'orange 256)))
               plain (<span class="org-keyword">function</span> my-capture-file)
               ,(my-capture-heading-template <span class="org-string">"%&lt;%H:%M%#p&gt; - %|support|"</span>)
               <span class="org-builtin">:file-name-format</span> ,my-roam-dailies-file-name
               <span class="org-builtin">:file-header</span> ,my-roam-dailies-header
               <span class="org-builtin">:clock-in</span> t
               <span class="org-builtin">:kill-buffer</span> t
               <span class="org-builtin">:empty-lines-after</span> 2
               <span class="org-builtin">:olp</span> (<span class="org-string">"Meeting notes"</span>)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 366: </span>$DOOMDIR/share/capture/org-mode/capture-support</label><pre class="src src-snippet"># name: Notes for new support request
# key: capture-support
# --
Support about ${1:Support topic}  `":support:"`
- Requested by ${2:Coworker Name}
- $0
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 367: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org-capture
  (<span class="org-keyword">appendq!</span> org-capture-templates
            `((<span class="org-string">"dm"</span> ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"Meeting"</span> <span class="org-builtin">:icon</span> `(meeting . ,(doom-color 'cyan 256)))
               plain (<span class="org-keyword">function</span> my-capture-file)
               ,(my-capture-heading-template <span class="org-string">"%&lt;%H:%M%#p&gt; - %|meeting|"</span>)
               <span class="org-builtin">:file-name-format</span> ,my-roam-dailies-file-name
               <span class="org-builtin">:file-header</span> ,my-roam-dailies-header
               <span class="org-builtin">:clock-in</span> t
               <span class="org-builtin">:kill-buffer</span> t
               <span class="org-builtin">:empty-lines-after</span> 2
               <span class="org-builtin">:olp</span> (<span class="org-string">"Meeting notes"</span>)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 368: </span>$DOOMDIR/share/capture/org-mode/capture-meeting</label><pre class="src src-snippet"># name: Notes from meetings
# key: capture-meeting
# --
${1:Meeting topic}  `":meeting:"`

*** Attendees
-`" "`

*** Notes
- $0
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 369: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org-capture
  (<span class="org-keyword">appendq!</span> org-capture-templates
            `((<span class="org-string">"dc"</span> ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"Code review"</span> <span class="org-builtin">:icon</span> `(review . ,(doom-color 'green 256)))
               plain (<span class="org-keyword">function</span> my-capture-file)
               ,(my-capture-heading-template <span class="org-string">"%&lt;%H:%M%#p&gt; - %|cr|"</span>)
               <span class="org-builtin">:file-name-format</span> ,my-roam-dailies-file-name
               <span class="org-builtin">:file-header</span> ,my-roam-dailies-header
               <span class="org-builtin">:clock-in</span> t
               <span class="org-builtin">:kill-buffer</span> t
               <span class="org-builtin">:empty-lines-after</span> 2
               <span class="org-builtin">:olp</span> (<span class="org-string">"Meeting notes"</span>)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 370: </span>$DOOMDIR/share/capture/org-mode/capture-cr</label><pre class="src src-snippet"># name: New code review started
# key: capture-cr
# --
Started code review for ${1:Coworker Name}  `":cr:"`
- Review link: [[${2:url}][${2:$$(file-name-base yas-text)}]]
- $0
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 371: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org-capture
  (<span class="org-keyword">appendq!</span> org-capture-templates
            `((<span class="org-string">"dv"</span> ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"Interview"</span> <span class="org-builtin">:icon</span> `(review . ,(doom-color 'green 256)))
               plain (<span class="org-keyword">function</span> my-capture-file)
               ,(my-capture-heading-template <span class="org-string">"%&lt;%H:%M%#p&gt; - %|interview|"</span>)
               <span class="org-builtin">:file-name-format</span> ,my-roam-dailies-file-name
               <span class="org-builtin">:file-header</span> ,my-roam-dailies-header
               <span class="org-builtin">:clock-in</span> t
               <span class="org-builtin">:kill-buffer</span> t
               <span class="org-builtin">:empty-lines-after</span> 2
               <span class="org-builtin">:olp</span> (<span class="org-string">"Meeting notes"</span>)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 372: </span>$DOOMDIR/share/capture/org-mode/capture-interview</label><pre class="src src-snippet"># name: Notes for interview
# key: capture-interview
# --
Interview with ${1:Candidate Name}  `":interview:"`
:PROPERTIES:
:INTERVIEW_ID: ${1:$(file-name-base (car (s-split "?" (url-filename (url-generic-parse-url yas-text)))))}
:URL: [[${1:$$(unless (or yas-moving-away-p yas-modified-p)
  (let ((links (my-links-in-kill-ring)))
    (if links
	(yas-auto-next
	  (completing-read "Choose the URL to link: " links))
      "url")))}][Interview page]]
:FEEDBACK_URL: [[https://hire.amazon.com/interviews/${1:$(file-name-base (car (s-split "?" (url-filename (url-generic-parse-url yas-text)))))}/feedback_vote][Feedback page]]
:END:

*** Notes
- $0

*** Evaluation
- Data points evaluated:
  | ☐ Customer Obsession              | ☐ Ownership            | ☐ Invent and Simplify       |
  | ☐ Are Right, A Lot                | ☐ Learn and Be Curious | ☐ Hire and Develop the Best |
  | ☐ Insist on the Highest Standards | ☐ Think Big            | ☐ Bias for Action           |
  | ☐ Frugality                       | ☐ Earn Trust           | ☐ Dive Deep                 |
  | ☐ Have Backbone                   | ☐ Disagree and Commit  | ☐ Deliver Results           |
- Inclined:
  + [ ] Yes
    + [ ] Strongly inclined
  + [ ] No
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 373: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org-capture
  (<span class="org-keyword">appendq!</span> org-capture-templates
            `((<span class="org-string">"di"</span> ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"Idea"</span> <span class="org-builtin">:icon</span> `(idea . ,(doom-color 'yellow 256)))
               plain (<span class="org-keyword">function</span> my-capture-file)
               ,(my-capture-heading-template <span class="org-string">"%&lt;%H:%M%#p&gt; - %|idea|"</span>)
               <span class="org-builtin">:file-name-format</span> ,my-roam-dailies-file-name
               <span class="org-builtin">:file-header</span> ,my-roam-dailies-header
               <span class="org-builtin">:kill-buffer</span> t
               <span class="org-builtin">:empty-lines-after</span> 1
               <span class="org-builtin">:olp</span> (<span class="org-string">"Ideas"</span>)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 374: </span>$DOOMDIR/share/capture/org-journal-mode/capture-idea</label><pre class="src src-snippet"># name: New Idea
# key: capture-idea
# --
${1:Idea!}  :idea:
$0
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 375: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org-capture
  (<span class="org-keyword">appendq!</span> org-capture-templates
            `((<span class="org-string">"dl"</span> ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"Interesting link"</span> <span class="org-builtin">:icon</span> `(globe . ,(doom-color 'blue 256)))
               plain (<span class="org-keyword">function</span> my-capture-file)
               ,(my-capture-heading-template <span class="org-string">"%&lt;%H:%M%#p&gt; - %|link|"</span>)
               <span class="org-builtin">:file-name-format</span> ,my-roam-dailies-file-name
               <span class="org-builtin">:file-header</span> ,my-roam-dailies-header
               <span class="org-builtin">:kill-buffer</span> t
               <span class="org-builtin">:empty-lines-after</span> 1
               <span class="org-builtin">:olp</span> (<span class="org-string">"Links"</span>)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 376: </span>$DOOMDIR/share/capture/org-journal-mode/capture-link</label><pre class="src src-snippet"># name: Interesting link
# key: capture-link
# --
Check out ${1:Title}
- Link: ${2:url}
${3:- ${4:note}}
$0
</pre>
</div>
</div>
</li>

<li><a id="org9948893"></a>Journal entries<br>
<div class="outline-text-5" id="text-5-7-1-2">
<div class="org-src-container">
<pre class="src src-text">[s]     &#9679; New entry
[p]     &#9679; Past entry
--------------------------------------------------------------------------------
[q]     &#9679; Abort
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 377: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org-capture
  (<span class="org-keyword">appendq!</span> org-capture-templates
            `((<span class="org-string">"j"</span>  ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"Journal"</span> <span class="org-builtin">:icon</span> `(journal . ,(doom-color 'blue 256))))
              (<span class="org-string">"jj"</span>  ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"New entry"</span> <span class="org-builtin">:icon</span> `(journal . ,(doom-color 'green)))
               plain (<span class="org-keyword">function</span> my-capture-journal-file)
               ,(my-capture-heading-template <span class="org-string">"%&lt;%H:%M%#p&gt; - %?"</span>)
               <span class="org-builtin">:empty-lines-after</span> 1
               <span class="org-builtin">:kill-buffer</span> t)
              (<span class="org-string">"jp"</span> ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"Past entry"</span> <span class="org-builtin">:icon</span> `(history . ,(doom-color 'violet 256)))
               plain (<span class="org-keyword">function</span> my-capture-journal-file-for-timestamp)
               ,(my-capture-heading-template <span class="org-string">"%&lt;%H:%M%#p&gt; - %?"</span>)
               <span class="org-builtin">:time</span>
               <span class="org-builtin">:empty-lines-after</span> 1
               <span class="org-builtin">:kill-buffer</span> t))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 378: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture-journal-file-for-timestamp</span> ()
  <span class="org-doc">"Asks user for a specific timestamp and returns the journal file for it. It also</span>
<span class="org-doc">position the cursor on the correct place for a new entry, and adjust the capture</span>
<span class="org-doc">frame width to `</span><span class="org-doc"><span class="org-constant">fill-column</span></span><span class="org-doc">' before start editing."</span>
  (my-capture--adjust-frame)
  (my-journal/new-entry t nil 'my-capture-timestamp))
</pre>
</div>
</div>
</li>

<li><a id="orgffea59a"></a>Tasks<br>
<div class="outline-text-5" id="text-5-7-1-3">
<div class="org-src-container">
<pre class="src src-text">[t]     &#9679; General task
[d]     &#9679; Task with deadline
[s]     &#9679; Scheduled task
--------------------------------------------------------------------------------
[q]     &#9679; Abort
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 379: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org-capture
  (<span class="org-keyword">appendq!</span> org-capture-templates
            `((<span class="org-string">"t"</span>  ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"Tasks"</span> <span class="org-builtin">:icon</span> `(inbox . ,(doom-color 'orange 256))))
              (<span class="org-string">"tt"</span> ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"New task"</span> <span class="org-builtin">:icon</span> `(inbox . ,(doom-color 'green 256)))
               plain (file+function +org-tasks-file my-capture-position-cursor)
               ,(my-capture-heading-template <span class="org-string">"TODO %?"</span>)
               <span class="org-builtin">:olp</span> (<span class="org-string">"To do /this week/"</span>)
               <span class="org-builtin">:empty-lines-after</span> 1
               <span class="org-builtin">:kill-buffer</span> t)
              (<span class="org-string">"td"</span> ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"Task with deadline"</span> <span class="org-builtin">:icon</span> `(timer . ,(doom-color 'yellow 256)))
               plain (file+function +org-tasks-file my-capture-position-cursor)
               ,(my-capture-heading-template <span class="org-string">"TODO %?\nDEADLINE: %(my-capture-time-read)"</span>)
               <span class="org-builtin">:read-time</span> t
               <span class="org-builtin">:read-time-label</span> <span class="org-string">"Deadline"</span>
               <span class="org-builtin">:olp</span> (<span class="org-string">"Time bound tasks"</span>)
               <span class="org-builtin">:empty-lines-after</span> 1
               <span class="org-builtin">:kill-buffer</span> t)
              (<span class="org-string">"ts"</span> ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"Scheduled task"</span> <span class="org-builtin">:icon</span> `(calendar . ,(doom-color 'orange 256)))
               plain (file+function +org-tasks-file my-capture-position-cursor)
               ,(my-capture-heading-template <span class="org-string">"TODO %?\nSCHEDULED: %(my-capture-time-read)"</span>)
               <span class="org-builtin">:read-time</span> t
               <span class="org-builtin">:read-time-label</span> <span class="org-string">"Start time"</span>
               <span class="org-builtin">:olp</span> (<span class="org-string">"Time bound tasks"</span>)
               <span class="org-builtin">:empty-lines-after</span> 1
               <span class="org-builtin">:kill-buffer</span> t))))
</pre>
</div>
</div>
</li>

<li><a id="orgf77c30d"></a>Contacts<br>
<div class="outline-text-5" id="text-5-7-1-4">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 380: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">(after! org-capture</span>
<span class="org-comment-delimiter">;;   </span><span class="org-comment">(appendq! org-capture-templates</span>
<span class="org-comment-delimiter">;;             </span><span class="org-comment">`(("c" ,(my-capture-description :text "Contact" :icon `(contact-add . ,(doom-color 'yellow 256)))</span>
<span class="org-comment-delimiter">;;                </span><span class="org-comment">plain (file+function +org-contacts-file my-capture-position-cursor)</span>
<span class="org-comment-delimiter">;;                </span><span class="org-comment">,(my-capture-heading-template "* %|contact|\n\n")</span>
<span class="org-comment-delimiter">;;                </span><span class="org-comment">:empty-lines-after 1</span>
<span class="org-comment-delimiter">;;                </span><span class="org-comment">:kill-buffer t))))</span>
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 381: </span>$DOOMDIR/share/capture/org-mode/capture-contact</label><pre class="src src-snippet"># name: New Contact
# key: capture-contact
# --
${1:Name}
:PROPERTIES:
:TYPE: ${2:$$(yas-auto-next (yas-choose-value '(" person" " company")))}
:${2:$(if (string= yas-text " company") "CONTACT" "COMPANY")}: ${3:Name}
${2:$(if (string= yas-text " company") ":TITLE: \n" "")}:PHONE: ${4:phone}
${2:$(if (string= yas-text " company") "" ":PHONE-W: \n")}:EMAIL: ${5:email}
:URL:
:ADDRESS:
:PICTURE:
:BIRTHDAY:
:LAST_READ_MAIL:
:END:

$0
</pre>
</div>
</div>
</li>

<li><a id="org82405b2"></a>Project notes<br>
<div class="outline-text-5" id="text-5-7-1-5">
<div class="org-src-container">
<pre class="src src-text">[t]     &#9679; New task
[d]     &#9679; Quick note
[s]     &#9679; New changelog
--------------------------------------------------------------------------------
[q]     &#9679; Abort
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 382: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org-capture
  (<span class="org-keyword">appendq!</span> org-capture-templates
            `((<span class="org-string">"p"</span>  ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"Projct"</span> <span class="org-builtin">:icon</span> `(project . ,(doom-color 'violet 256))))
              (<span class="org-string">"pt"</span> ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"New task"</span> <span class="org-builtin">:icon</span> `(checklist . ,(doom-color 'green 256)))
               entry (file+headline my-capture-project-notes-file-wrapper <span class="org-string">"Tasks"</span>)
               ,(concat <span class="org-string">"* TODO %?\n"</span>
                        <span class="org-string">"%(my-capture-template-selection)"</span>)
               <span class="org-builtin">:empty-lines-after</span> 1
               <span class="org-builtin">:kill-buffer</span> t)
              (<span class="org-string">"pn"</span> ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"Quick note"</span> <span class="org-builtin">:icon</span> `(postit . ,(doom-color 'yellow 256)))
               entry (file+headline my-capture-project-notes-file-wrapper <span class="org-string">"Notes"</span>)
               ,(concat <span class="org-string">"* %U %?\n"</span>
                        <span class="org-string">"%(my-capture-template-selection)"</span>)
               <span class="org-builtin">:empty-lines-after</span> 1
               <span class="org-builtin">:kill-buffer</span> t)
              (<span class="org-string">"pc"</span> ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"New changelog"</span> <span class="org-builtin">:icon</span> `(list . ,(doom-color 'violet 256)))
               item (<span class="org-keyword">function</span> my-capture-project-changelog-file-with-headings)
               <span class="org-string">"- %?"</span>
               <span class="org-builtin">:prepend</span> t
               <span class="org-builtin">:empty-lines-before</span> 1
               <span class="org-builtin">:kill-buffer</span> t))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 383: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture-project-notes-file-wrapper</span> ()
  <span class="org-doc">"Returns an org file to hold notes and tasks for the current</span>
<span class="org-doc">  project."</span>
  (my-capture--adjust-frame)
  (+org-capture-project-notes-file))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 384: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture-project-changelog-file-with-headings</span> ()
  (<span class="org-keyword">let</span> ((entry-path (+org-capture-project-changelog-file))
        (org-complex-heading-regexp-format <span class="org-string">"\\* %s"</span>))
    (<span class="org-keyword">unless</span> (file-exists-p entry-path)
      (make-empty-file entry-path t))
    (find-file entry-path)
    (goto-char (point-min))
    (my-capture--ensure-heading-prepend (my-capture-project-target-heading))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 385: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture-project-target-heading</span> ()
  `(<span class="org-string">"Unreleased"</span> ,(format-time-string <span class="org-string">"%A, %B %-e, %Y"</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 386: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture--ensure-heading-prepend</span> (headings <span class="org-type">&amp;optional</span> initial-level)
  (<span class="org-keyword">if</span> (not headings)
      (widen)
    (<span class="org-keyword">let</span> ((initial-level (<span class="org-keyword">or</span> initial-level 1)))
      (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> (re-search-forward (format org-complex-heading-regexp-format
                                          (regexp-quote (car headings)))
                                  nil t)
               (= (org-current-level) initial-level))
          (<span class="org-keyword">progn</span>
            (message <span class="org-string">"Found heading '%s'"</span> (car headings))
            (beginning-of-line)
            (org-narrow-to-subtree))
        (message <span class="org-string">"Could not find heading '%s'"</span> (car headings))
        (<span class="org-keyword">if</span> (= initial-level 1)
            (goto-char (point-max))
          (end-of-line))
        (<span class="org-keyword">unless</span> (<span class="org-keyword">and</span> (bolp) (eolp)) (insert <span class="org-string">"\n"</span>))
        (insert (make-string initial-level ?*) <span class="org-string">" "</span> (car headings) <span class="org-string">"\n"</span>))
      (my-capture--ensure-heading-prepend (cdr headings) (1+ initial-level)))))
</pre>
</div>
</div>
</li>

<li><a id="orgf149dee"></a>Finalize capture templates<br>
<div class="outline-text-5" id="text-5-7-1-6">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 387: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-org-capture-select-template-prettier-a (<span class="org-type">&amp;optional</span> keys)
  <span class="org-doc">"Select a capture template, in a prettier way than default Lisp programs can</span>
<span class="org-doc">force the template by setting KEYS to a string."</span>
  <span class="org-builtin">:override</span> 'org-capture-select-template
  (<span class="org-keyword">let</span> ((org-capture-templates
         (<span class="org-keyword">or</span> (org-contextualize-keys (org-capture-upgrade-templates org-capture-templates)
                                     org-capture-templates-contexts)
             '((<span class="org-string">"t"</span> <span class="org-string">"Task"</span>
                entry (file+headline <span class="org-string">""</span> <span class="org-string">"Tasks"</span>)
                <span class="org-string">"* TODO %?\n  %u\n  %a"</span>)))))
    (<span class="org-keyword">if</span> keys
        (<span class="org-keyword">or</span> (assoc keys org-capture-templates)
            (<span class="org-warning">error</span> <span class="org-string">"No capture template referred to by \"%s\" keys"</span> keys))
      (org-mks org-capture-templates
               (propertize (<span class="org-keyword">if</span> (+org-capture-frame-p)
                               (concat (s-center 50 <span class="org-string">"Doom Capture"</span>) <span class="org-string">"\n"</span>
                                       (s-center 50 <span class="org-string">"&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;"</span>))
                             (concat <span class="org-string">"Doom Capture\n"</span>
                                     <span class="org-string">"&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;"</span>))
                           'face 'font-lock-type-face)
               <span class="org-string">" "</span>
               `((<span class="org-string">"q"</span> ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"Abort"</span> <span class="org-builtin">:icon</span> `(stop . ,(doom-color 'red 256)))))))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 388: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-org-capture-mks-prettier-a (table title <span class="org-type">&amp;optional</span> prompt specials)
  <span class="org-doc">"Select a member of an alist with multiple keys. Prettified.</span>

<span class="org-doc">TABLE is the alist which should contain entries where the car is a string. There</span>
<span class="org-doc">should be two types of entries.</span>

<span class="org-doc">1. prefix descriptions like (\"a\" \"Description\") This indicates that `a' is a</span>
<span class="org-doc">   prefix key for multi-letter selection, and that there are entries following</span>
<span class="org-doc">   with keys like \"ab\", \"ax\"&#8230;</span>

<span class="org-doc">2. Select-able members must have more than two elements, with the first being</span>
<span class="org-doc">   the string of keys that lead to selecting it, and the second a short</span>
<span class="org-doc">   description string of the item.</span>

<span class="org-doc">The command will then make a temporary buffer listing all entries that can be</span>
<span class="org-doc">selected with a single key, and all the single key prefixes. When you press the</span>
<span class="org-doc">key for a single-letter entry, it is selected. When you press a prefix key, the</span>
<span class="org-doc">commands (and maybe further prefixes) under this key will be shown and offered</span>
<span class="org-doc">for selection.</span>

<span class="org-doc">TITLE will be placed over the selection in the temporary buffer, PROMPT will be</span>
<span class="org-doc">used when prompting for a key. SPECIALS is an alist with (\"key\"</span>
<span class="org-doc">\"description\") entries. When one of these is selected, only the bare key is</span>
<span class="org-doc">returned."</span>
  <span class="org-builtin">:override</span> 'org-mks
  (<span class="org-keyword">save-window-excursion</span>
    (<span class="org-keyword">let</span> ((inhibit-quit t)
          (buffer (org-switch-to-buffer-other-window <span class="org-string">"*Org Select*"</span>))
          (prompt (<span class="org-keyword">or</span> prompt <span class="org-string">"Select: "</span>))
          case-fold-search
          current)
      (<span class="org-keyword">unwind-protect</span>
          (<span class="org-keyword">catch</span> '<span class="org-constant">exit</span>
            (<span class="org-keyword">while</span> t
              (erase-buffer)
              (insert title <span class="org-string">"\n\n"</span>)
              (<span class="org-keyword">let</span> ((original-evil-normal-state-cursor evil-normal-state-cursor)
                    (des-keys nil)
                    (allowed-keys '(<span class="org-string">"\C-g"</span>))
                    (tab-alternatives '(<span class="org-string">"\s"</span> <span class="org-string">"\t"</span> <span class="org-string">"\r"</span>))
                    (cursor-type nil))
                (<span class="org-keyword">setq</span> evil-normal-state-cursor (list nil))
                <span class="org-comment-delimiter">;; </span><span class="org-comment">Populate allowed keys and descriptions keys</span>
                <span class="org-comment-delimiter">;; </span><span class="org-comment">available with CURRENT selector.</span>
                (<span class="org-keyword">let</span> ((re (format <span class="org-string">"\\`%s</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\\'"</span>
                                  (<span class="org-keyword">if</span> current (regexp-quote current) <span class="org-string">""</span>))))
                  (<span class="org-keyword">dolist</span> (entry table)
                    (<span class="org-keyword">pcase</span> entry
                      <span class="org-comment-delimiter">;; </span><span class="org-comment">Description.</span>
                      (`(,(<span class="org-keyword">and</span> key (pred (string-match re))) ,desc)
                       (<span class="org-keyword">let</span> ((k (match-string 1 key)))
                         (<span class="org-keyword">push</span> k des-keys)
                         <span class="org-comment-delimiter">;; </span><span class="org-comment">Keys ending in tab, space or RET are equivalent.</span>
                         (<span class="org-keyword">if</span> (member k tab-alternatives)
                             (<span class="org-keyword">push</span> <span class="org-string">"\t"</span> allowed-keys)
                           (<span class="org-keyword">push</span> k allowed-keys))
                         (insert (my-capture--item-entry k desc current t) <span class="org-string">"\n"</span>)))
                      <span class="org-comment-delimiter">;; </span><span class="org-comment">Usable entry.</span>
                      (`(,(<span class="org-keyword">and</span> key (pred (string-match re))) ,desc . ,_)
                       (<span class="org-keyword">let</span> ((k (match-string 1 key)))
                         (insert (my-capture--item-entry k desc current) <span class="org-string">"\n"</span>)
                         (<span class="org-keyword">push</span> k allowed-keys)))
                      (_ nil))))
                <span class="org-comment-delimiter">;; </span><span class="org-comment">Insert special entries, if any.</span>
                (<span class="org-keyword">when</span> specials
                  (insert <span class="org-string">"\n"</span>)
                  (<span class="org-keyword">pcase-dolist</span> (`(,key ,description) specials)
                    (insert (my-capture--item-entry key
                                                      description
                                                      (<span class="org-keyword">when</span> current
                                                        (s-repeat (length current) <span class="org-string">" "</span>))
                                                      nil
                                                      'all-the-icons-red))
                    (<span class="org-keyword">push</span> key allowed-keys)))
                <span class="org-comment-delimiter">;; </span><span class="org-comment">Display UI and let user select an entry or</span>
                <span class="org-comment-delimiter">;; </span><span class="org-comment">a sub-level prefix.</span>
                (goto-char (point-min))
                (my-capture--refresh-capture-frame)
                (<span class="org-keyword">let</span> ((pressed (org--mks-read-key
                                allowed-keys prompt
                                (not (pos-visible-in-window-p (1- (point-max)))))))
                  (set-frame-name (alist-get 'name +org-capture-frame-parameters))
                  (<span class="org-keyword">setq</span> evil-normal-state-cursor original-evil-normal-state-cursor)
                  (<span class="org-keyword">setq</span> current (concat current pressed))
                  (<span class="org-keyword">cond</span>
                   ((equal pressed <span class="org-string">"\C-g"</span>) (<span class="org-warning">user-error</span> <span class="org-string">"Abort"</span>))
                   <span class="org-comment-delimiter">;; </span><span class="org-comment">Selection is a prefix: open a new menu.</span>
                   ((member pressed des-keys))
                   <span class="org-comment-delimiter">;; </span><span class="org-comment">Selection matches an association: return it.</span>
                   ((<span class="org-keyword">let</span> ((entry (assoc current table)))
                      (<span class="org-keyword">and</span> entry (<span class="org-keyword">throw</span> '<span class="org-constant">exit</span> entry))))
                   <span class="org-comment-delimiter">;; </span><span class="org-comment">Selection matches a special entry: return the</span>
                   <span class="org-comment-delimiter">;; </span><span class="org-comment">selection prefix.</span>
                   ((assoc current specials) (<span class="org-keyword">throw</span> '<span class="org-constant">exit</span> current))
                   (t (<span class="org-warning">error</span> <span class="org-string">"No entry available"</span>)))))))
        (<span class="org-keyword">when</span> buffer
          (kill-buffer buffer))))))

</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 389: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture--item-entry</span> (key description <span class="org-type">&amp;optional</span> prefix parent-option-p key-face-extras)
  <span class="org-doc">"Returns a string representing an Org Capture item with the given KEY and</span>
<span class="org-doc">DESCRIPTION.</span>

<span class="org-doc">PREFIX is the character sequences already pressed during the capture process.</span>

<span class="org-doc">If PARENT-OPTION-P is non-nil, it means the this entry has sub-entries and some</span>
<span class="org-doc">sort of indication should be displayed</span>

<span class="org-doc">The KEY-FACE-EXTRAS is one or more simbols to be added to the KEY face on the</span>
<span class="org-doc">entry."</span>
  (<span class="org-keyword">let</span> ((parent-option-p (<span class="org-keyword">when</span> parent-option-p <span class="org-string">"&#8250;"</span>))
        (prefix (<span class="org-keyword">when</span> prefix (concat prefix <span class="org-string">" "</span>))))
    (concat
     (<span class="org-keyword">when</span> prefix (propertize prefix 'face 'font-lock-comment-face))
     (propertize key 'face (append '(bold) key-face-extras))
     (propertize (<span class="org-keyword">or</span> parent-option-p <span class="org-string">" "</span>) 'face 'font-lock-comment-face)
     <span class="org-string">"  "</span> description (<span class="org-keyword">when</span> parent-option-p <span class="org-string">"&#8230;"</span>))))

</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 390: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture--refresh-capture-frame</span> ()
  <span class="org-doc">"This function is called right after all the capture options were written in the</span>
<span class="org-doc">capture buffer."</span>
  (<span class="org-keyword">when</span> (+org-capture-frame-p)
    (<span class="org-keyword">let</span> ((frame (selected-frame)))
    (set-frame-parameter frame 'left-fringe 30)
    (set-frame-parameter frame 'right-fringe 30)
    (set-frame-name <span class="org-string">" "</span>)
    (set-frame-size frame
                    my-capture--menu-width
                    (+ (line-number-at-pos (point-max)) 3))
    (my-capture--reposition-frame)
    (message <span class="org-string">""</span>))))
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-org09b0fba" class="outline-4">
<h4 id="org09b0fba"><span class="section-number-4">5.7.2</span> Journal</h4>
<div class="outline-text-4" id="text-5-7-2">
<p>
TBD
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 391: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> my-journal-file-format <span class="org-string">"journal-%Y.org"</span>)

(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-journal-file</span> (expand-file-name (format-time-string my-journal-file-format)
                                              my-journal-directory))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 392: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> org-journal
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setq</span> org-journal-encrypt-journal nil
        org-journal-carryover-delete-empty-journal '(ask)
        org-journal-carryover-items <span class="org-string">"TODO=\"STRT\"|TODO=\"HOLD\"|TODO=\"WAIT\"|TODO=\"DELG\""</span>
        org-extend-today-until 4
        org-journal-file-type 'yearly
        org-journal-enable-agenda-integration nil
        org-journal-file-format my-journal-file-format
        org-journal-date-format <span class="org-string">"%A, %B %-e, %Y"</span>
        org-journal-time-format <span class="org-string">"%H:%M%#p - "</span>
        org-journal-time-format-post-midnight <span class="org-string">"+%H:%M%#p - "</span>
                            org-journal-file-header (concat <span class="org-string">"#+TITLE: Daily Journal for %Y (%Z)\n"</span>
                                        <span class="org-string">"#+STARTUP: overview\n"</span>
                                        <span class="org-string">"#+CATEGORY: journal\n"</span>
                                        <span class="org-string">"\n"</span>))

  (font-lock-add-keywords 'org-journal-mode my-org-font-lock-beautify-keywords)
  (set-window-buffer nil (current-buffer)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 393: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-journal/new-entry</span> (<span class="org-type">&amp;optional</span> prefix add-header-p variable make-local)
  <span class="org-doc">"Open a journal file and start a new entry. Without any arguments, this function</span>
<span class="org-doc">is equivalent to calling `(org-journal-new-entry t)'</span>

<span class="org-doc">With PREFIX argumant, request the journal timestamp to the user.</span>

<span class="org-doc">If ADD-HEADER-P is non-nil, fully create the new entry (this is equivalent</span>
<span class="org-doc">to `(not PREFIX)' on the `</span><span class="org-doc"><span class="org-constant">org-journal-new-entry</span></span><span class="org-doc">').</span>

<span class="org-doc">VARIABLE is a string that, when set, will store the timestamp value selected by</span>
<span class="org-doc">the user. This function ignores this argument if PREFIX is nil.</span>

<span class="org-doc">When MAKE-LOCAL is a non-nil value, this function uses VARIABLE to create a</span>
<span class="org-doc">local variable. If PREFIX or VARIABLE is nil, this argument has no effect."</span>
  (<span class="org-keyword">interactive</span> <span class="org-string">"P"</span>)
  (<span class="org-keyword">when</span> make-local
    (make-local-variable variable))
  (org-journal-new-entry (not add-header-p)
                         (<span class="org-keyword">when</span> variable
                           (set variable
                                (<span class="org-keyword">when</span> prefix
                                  (org-read-date t t nil <span class="org-string">"New entry"</span>))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf2fc836" class="outline-4">
<h4 id="orgf2fc836"><span class="section-number-4">5.7.3</span> Zettelkasten</h4>
<div class="outline-text-4" id="text-5-7-3">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 394: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> org-roam
  <span class="org-builtin">:commands</span> (org-roam-capture)
  <span class="org-builtin">:custom</span>
  (org-roam-capture-templates
   '((<span class="org-string">"d"</span> <span class="org-string">"default"</span> plain (<span class="org-keyword">function</span> org-roam-capture--get-point)
      <span class="org-string">"%?"</span>
      <span class="org-builtin">:file-name</span> <span class="org-string">"%(s-trim-right (shell-command-to-string \"uuidgen\"))"</span>
      <span class="org-builtin">:head</span> <span class="org-string">"#+TITLE: ${title}\n#+ROAM_TAGS: \n\n"</span>
      <span class="org-builtin">:unnarrowed</span> t)))
  (org-roam-capture-ref-templates
   '((<span class="org-string">"r"</span> <span class="org-string">"ref"</span> plain (<span class="org-keyword">function</span> org-roam-capture--get-point)
      <span class="org-string">"\n#+BEGIN_QUOTE\n${selection}\n#+END_QUOTE\n\n%?\n\n* See Also\n\n- source :: ${ref}\n"</span>
      <span class="org-builtin">:file-name</span> <span class="org-string">"websites/%(s-trim-right (shell-command-to-string \"uuidgen\"))-${slug}"</span>
      <span class="org-builtin">:head</span> <span class="org-string">"#+TITLE: ${title}\n#+ROAM_TAGS: \n#+ROAM_KEY: ${ref}\n"</span>
      <span class="org-builtin">:unnarrowed</span> t))))

(<span class="org-keyword">after!</span> org-roam
  (<span class="org-keyword">setq</span> org-roam-link-title-format <span class="org-string">"&#10001; %s"</span>
        org-roam-graph-extra-config '((<span class="org-string">"overlap"</span> . <span class="org-string">"false"</span>))
        org-roam-encrypt-files nil
        org-roam-directory my-notes-directory)

  (advice-add 'org-roam-dailies-capture-yesterday <span class="org-builtin">:filter-return</span> #'+org-capture-open-frame-get-info-a)
  (advice-add 'org-roam-dailies-capture-today <span class="org-builtin">:filter-return</span> #'+org-capture-open-frame-get-info-a)
  (advice-add 'org-roam-dailies-capture-tomorrow <span class="org-builtin">:filter-return</span> #'+org-capture-open-frame-get-info-a)
  (advice-add 'org-roam-dailies-capture-date <span class="org-builtin">:filter-return</span> #'+org-capture-open-frame-get-info-a))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9994da6" class="outline-4">
<h4 id="org9994da6"><span class="section-number-4">5.7.4</span> Deft</h4>
<div class="outline-text-4" id="text-5-7-4">
<p>
TBD
</p>
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 395: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> deft-directory my-notes-directory
      deft-strip-summary-regexp (concat <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">"</span>
                                        <span class="org-string">"[\n\t]"</span>                    <span class="org-comment-delimiter">;; </span><span class="org-comment">blank</span>
                                        <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">^#\\+[[:upper:]_]+:.*$"</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">org-mode metadata</span>
                                        <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span>)
      deft-time-format <span class="org-string">"  %A, %B %e %Y (%H:%M)"</span>)

(<span class="org-keyword">add-hook!</span> 'deft-mode-hook
  (<span class="org-keyword">defun</span> <span class="org-function-name">my-deft-buffer-config-h</span> ()
    (hl-line-mode 1)
    (<span class="org-keyword">setq-local</span> evil-normal-state-cursor (list nil)
                evil-insert-state-cursor (list nil))))

(map! <span class="org-builtin">:after</span> deft
      (<span class="org-builtin">:map</span> deft-mode-map
       <span class="org-builtin">:i</span>   <span class="org-string">"&lt;escape&gt;"</span> #'kill-current-buffer
       <span class="org-builtin">:i</span>   <span class="org-string">"C-c C-q"</span>  #'kill-current-buffer
       <span class="org-builtin">:i</span>   <span class="org-string">"C-j"</span>      #'widget-forward
       <span class="org-builtin">:i</span>   <span class="org-string">"C-k"</span>      #'widget-backward))
</pre>
</div>
</div>
</div>

<div id="outline-container-org736c93d" class="outline-4">
<h4 id="org736c93d"><span class="section-number-4">5.7.5</span> Utilities</h4>
<div class="outline-text-4" id="text-5-7-5">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 396: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-notes-add-action-item</span> ()
  (<span class="org-keyword">interactive</span>)
  (call-interactively '+org/insert-item-below)
  (insert <span class="org-string">"Action Items"</span>)
  (call-interactively 'org-insert-subheading)
  (insert <span class="org-string">"TODO "</span>))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 397: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:after</span> org
      (<span class="org-builtin">:map</span> org-mode-map
       <span class="org-builtin">:leader</span>
       (<span class="org-builtin">:prefix</span> (<span class="org-string">"n"</span> . <span class="org-string">"notes"</span>)
        (<span class="org-builtin">:prefix</span> (<span class="org-string">"i"</span> . <span class="org-string">"notes-insert"</span>)
         <span class="org-builtin">:desc</span> <span class="org-string">"Insert action items"</span>  <span class="org-string">"a"</span> #'my-notes-add-action-item))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 398: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> plantuml-mode
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> plantuml-jar-path <span class="org-string">"/usr/local/var/homebrew/linked/plantuml/libexec/plantuml.jar"</span>
        org-plantuml-jar-path plantuml-jar-path)
  (set-popup-rule! <span class="org-string">"^\\*PLANTUML"</span> <span class="org-builtin">:size</span> 0.4 <span class="org-builtin">:side</span> 'right <span class="org-builtin">:select</span> nil <span class="org-builtin">:ttl</span> 0))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgdeb659d" class="outline-3">
<h3 id="orgdeb659d"><span class="section-number-3">5.8</span> <span class="todo TODO">TODO</span> Other modes</h3>
<div class="outline-text-3" id="text-5-8">
<p>
Although my writing will be exclusive in <code>org-mode</code>, I'm still interaction with other writing modes, and I want the experience using those modes to get <i>as close as possible</i> to the experience with <code>org-mode</code>.
</p>
</div>

<div id="outline-container-orgcd4cd93" class="outline-4">
<h4 id="orgcd4cd93"><span class="section-number-4">5.8.1</span> Markdown</h4>
<div class="outline-text-4" id="text-5-8-1">
<p>
TBD
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 399: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> markdown-split-window-direction 'right
      markdown-list-item-bullets '(<span class="org-string">"&#8226;"</span> <span class="org-string">"&#8227;"</span> <span class="org-string">"&#8269;"</span>)
      markdown-blockquote-display-char `(,(propertize <span class="org-string">"&#9612;"</span> 'face '(<span class="org-builtin">:inherit</span> markdown-blockquote-face
                                                                  <span class="org-builtin">:slant</span> normal))
                                         ,(propertize <span class="org-string">"&#9475;"</span> 'face '(<span class="org-builtin">:inherit</span> markdown-blockquote-face
                                                                  <span class="org-builtin">:slant</span> normal))
                                         <span class="org-string">"&gt;"</span>)
      markdown-header-scaling t
      markdown-header-scaling-values (list (face-attribute 'my-headline-1 <span class="org-builtin">:height</span>)
                                           (face-attribute 'my-headline-2 <span class="org-builtin">:height</span>)
                                           (face-attribute 'my-headline-3 <span class="org-builtin">:height</span>)
                                           (face-attribute 'my-headline-4 <span class="org-builtin">:height</span>)
                                           (face-attribute 'my-headline-5 <span class="org-builtin">:height</span>)
                                           (face-attribute 'my-headline-6 <span class="org-builtin">:height</span>)))

(my-typography-reset (<span class="org-keyword">cl-loop</span> for i from 1 to 6 collect (intern (format <span class="org-string">"markdown-header-face-%d"</span> i))))
(my-typography-reset 'markdown-code-face)

(custom-set-faces!
  `(markdown-header-face-1 <span class="org-builtin">:inherit</span> outline-1 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  `(markdown-header-face-2 <span class="org-builtin">:inherit</span> outline-2 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  `(markdown-header-face-3 <span class="org-builtin">:inherit</span> outline-3 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  `(markdown-header-face-4 <span class="org-builtin">:inherit</span> outline-4 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  `(markdown-header-face-5 <span class="org-builtin">:inherit</span> outline-5 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  `(markdown-header-face-6 <span class="org-builtin">:inherit</span> outline-6 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  '(markdown-code-face <span class="org-builtin">:inherit</span> my-default-mono <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  `(markdown-header-face <span class="org-builtin">:inherit</span> unspecified)
  `(markdown-list-face <span class="org-builtin">:foreground</span> unspecified <span class="org-builtin">:inherit</span> org-list-dt))

(<span class="org-keyword">add-hook!</span> (markdown-mode gfm-mode)
  (<span class="org-keyword">defun</span> <span class="org-function-name">my-markdown-buffer-config-h</span> ()
    (+zen/toggle 1)
    (variable-pitch-mode 1)
    (markdown-toggle-markup-hiding 1)))
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org088c01c" class="outline-2">
<h2 id="org088c01c"><span class="section-number-2">6</span> Development</h2>
<div class="outline-text-2" id="text-6">
<p>
TBD
</p>
</div>

<div id="outline-container-org558bf69" class="outline-3">
<h3 id="org558bf69"><span class="section-number-3">6.1</span> <span class="todo TODO">TODO</span> Requirements</h3>
<div class="outline-text-3" id="text-6-1">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 400: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> lsp-ui
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:custom</span>
  (lsp-ui-sideline-show-hover t)
  (lsp-ui-doc-enable t))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc424ab5" class="outline-3">
<h3 id="orgc424ab5"><span class="section-number-3">6.2</span> <span class="todo TODO">TODO</span> Common configuration</h3>
<div class="outline-text-3" id="text-6-2">
<p>
TBD
</p>
</div>

<div id="outline-container-org9ddf3f5" class="outline-4">
<h4 id="org9ddf3f5"><span class="section-number-4">6.2.1</span> Version control system</h4>
<div class="outline-text-4" id="text-6-2-1">
<ul class="org-ul">
<li><a href="https://github.com/Townk/gitmoji">https://github.com/Townk/gitmoji</a></li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 401: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">if</span> (getenv <span class="org-string">"GITHUB_WORKFLOW"</span>)
    (<span class="org-keyword">package!</span> gitmoji
      <span class="org-builtin">:recipe</span> (<span class="org-builtin">:host</span> github
               <span class="org-builtin">:repo</span> <span class="org-string">"Townk/gitmoji"</span>))
  (<span class="org-keyword">package!</span> gitmoji
    <span class="org-builtin">:recipe</span> (<span class="org-builtin">:local-repo</span> <span class="org-string">"~/workplace/personal/emacs/gitmoji"</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 402: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> gitmoji
  <span class="org-builtin">:commands</span> (gitmoji-insert gitmoji-select)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> gitmoji-insert-utf8-emoji t
        gitmoji-display-utf8-emoji t))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 403: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> magit
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(remove-hook 'server-switch-hook 'magit-commit-diff)</span>
  (add-hook 'git-commit-setup-hook 'my-git-commit-buffer-config-h))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 404: </span>$DOOMDIR/autoload/development.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-git-commit-buffer-config-h</span> ()
  <span class="org-doc">"Configure the Git Commit Message buffer."</span>
  (<span class="org-keyword">setq-local</span> display-fill-column-indicator-column 72)
  (display-fill-column-indicator-mode 1)
  (goto-char (point-min))
  (evil-append-line 1)
  (yas-expand-snippet (yas-lookup-snippet <span class="org-string">"commit-message"</span> 'git-commit-mode)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 405: </span>$DOOMDIR/snippets/git-commit-mode/commit-message</label><pre class="src src-snippet"># name: commit-message
# key: msg
# --
${1:$$(unless (or yas-moving-away-p yas-modified-p)
	      (yas-auto-next
		(condition-case nil
		    (or (gitmoji-select) "")
		  ('quit ""))))}${2:Subject}

;-------------------------------------------------|
;       Do not pass this column on the subject -&gt; |
;-------------------------------------------------|
${3:`"## Changes Description\n"`}$0
; 1. Separate subject from body with a blank line
; 2. Limit the subject line to 50 characters
; 3. Capitalize the subject line
; 4. Do not end the subject line with a period
; 5. Use the imperative mood in the subject line
; 6. Wrap the body at 72 characters
; 7. Use the body to explain what and why vs. how
</pre>
</div>
</div>
</div>

<div id="outline-container-org0084c1c" class="outline-4">
<h4 id="org0084c1c"><span class="section-number-4">6.2.2</span> Comments</h4>
<div class="outline-text-4" id="text-6-2-2">
<p>
TBD
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 406: </span>$DOOMDIR/autoload/development.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-comment-and-next-line-a (func <span class="org-type">&amp;rest</span> args)
  <span class="org-builtin">:around</span> 'evilnc-comment-or-uncomment-lines
  (<span class="org-keyword">let</span> ((no-selection-p (not (region-active-p))))
    (apply func args)
    (<span class="org-keyword">when</span> no-selection-p
      (next-line)
      (goto-char (point-at-bol))
      (skip-chars-forward <span class="org-string">" \t\r"</span>))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3f398b5" class="outline-3">
<h3 id="org3f398b5"><span class="section-number-3">6.3</span> <span class="todo TODO">TODO</span> Lisp</h3>
<div class="outline-text-3" id="text-6-3">
<p>
TBD
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 407: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> emacs-lisp-docstring-fill-column 80)
</pre>
</div>
</div>
</div>

<div id="outline-container-org30cf093" class="outline-3">
<h3 id="org30cf093"><span class="section-number-3">6.4</span> <span class="todo TODO">TODO</span> Shell script</h3>
</div>
<div id="outline-container-orgee3843a" class="outline-3">
<h3 id="orgee3843a"><span class="section-number-3">6.5</span> <span class="todo TODO">TODO</span> Python</h3>
</div>
<div id="outline-container-org3940d90" class="outline-3">
<h3 id="org3940d90"><span class="section-number-3">6.6</span> <span class="todo TODO">TODO</span> Ansible</h3>
<div class="outline-text-3" id="text-6-6">
<p>
TBD
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 408: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(def-project-mode! +ansible-yaml-mode
  <span class="org-builtin">:modes</span> '(yaml-mode)
  <span class="org-builtin">:add-hooks</span> '(ansible ansible-auto-decrypt-encrypt ansible-doc-mode)
  <span class="org-builtin">:files</span> (<span class="org-keyword">and</span> <span class="org-string">"ansible.cfg"</span>
              (<span class="org-keyword">or</span> <span class="org-string">"main.yaml"</span>
                  <span class="org-string">"main.yml"</span>
                  <span class="org-string">"tasks/main.yaml"</span>
                  <span class="org-string">"tasks/main.yml"</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org546907a" class="outline-3">
<h3 id="org546907a"><span class="section-number-3">6.7</span> <span class="todo TODO">TODO</span> Javascript/TypeScript</h3>
</div>
<div id="outline-container-orga2ebf3f" class="outline-3">
<h3 id="orga2ebf3f"><span class="section-number-3">6.8</span> <span class="todo TODO">TODO</span> C/C++</h3>
</div>
<div id="outline-container-org126f802" class="outline-3">
<h3 id="org126f802"><span class="section-number-3">6.9</span> <span class="todo TODO">TODO</span> Swift</h3>
</div>
<div id="outline-container-org28c2d4c" class="outline-3">
<h3 id="org28c2d4c"><span class="section-number-3">6.10</span> <span class="todo TODO">TODO</span> Kotlin</h3>
</div>
<div id="outline-container-org06417f0" class="outline-3">
<h3 id="org06417f0"><span class="section-number-3">6.11</span> <span class="todo TODO">TODO</span> Java</h3>
</div>
</div>

<div id="outline-container-org35dbadc" class="outline-2">
<h2 id="org35dbadc"><span class="section-number-2">7</span> Non-editor features</h2>
<div class="outline-text-2" id="text-7">
<p>
TBD
</p>
</div>

<div id="outline-container-orge6474b6" class="outline-3">
<h3 id="orge6474b6"><span class="section-number-3">7.1</span> <span class="todo TODO">TODO</span> Requirements</h3>
</div>
<div id="outline-container-orgd0a6fff" class="outline-3">
<h3 id="orgd0a6fff"><span class="section-number-3">7.2</span> <span class="todo TODO">TODO</span> File management</h3>
<div class="outline-text-3" id="text-7-2">
<p>
Before we start configuring the target packages for this section (<code>dired</code> and <code>eshel</code>), I want to make some small adjustments to Treemacs. Although it is not a full blown file manager, it is a sort of a file manager for my projects, so it fits in this section.
</p>

<p>
The first thing I like to do, is to unpin Treemacs and let Doom use the latest version of it:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 409: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">unpin!</span> treemacs)
</pre>
</div>

<p>
The next change is to use our custom <code>my-default-ui</code> font face. I have to replace the entire <code>doom-themes-enable-treemacs-variable-pitch-labels</code> function with a version that uses my custom font instead. To do that, I'll use Emacs advices:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 410: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-themes-enable-treemacs-variable-pitch-labels-a (<span class="org-type">&amp;rest</span> _)
  <span class="org-doc">"This advice changes the treemacs variable pitch font to one without serif so</span>
<span class="org-doc">the UI looks more polished."</span>
  <span class="org-builtin">:override</span> #'doom-themes-enable-treemacs-variable-pitch-labels
  (<span class="org-keyword">when</span> doom-themes-treemacs-enable-variable-pitch
    (<span class="org-keyword">dolist</span> (face '(treemacs-root-face
                    treemacs-git-unmodified-face
                    treemacs-git-modified-face
                    treemacs-git-renamed-face
                    treemacs-git-ignored-face
                    treemacs-git-untracked-face
                    treemacs-git-added-face
                    treemacs-git-conflict-face
                    treemacs-directory-face
                    treemacs-directory-collapsed-face
                    treemacs-file-face
                    treemacs-tags-face))
      (<span class="org-keyword">let</span> ((faces (face-attribute face <span class="org-builtin">:inherit</span> nil)))
        (set-face-attribute
         face nil <span class="org-builtin">:inherit</span>
         `(my-default-ui ,@(delq 'unspecified (<span class="org-keyword">if</span> (listp faces) faces (list faces)))))))))
</pre>
</div>

<p>
By default, Treemacs will stay opened after you select a file to visit. Personally I don't like this, I rather have Treemacs closing when I select a file.
</p>

<p>
In order to help me achieve my desired behavior, I'll  create another <i>autoload</i> function that I'll call when I select a file:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 411: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-treemacs-visit-node-and-close-h</span> (<span class="org-type">&amp;optional</span> arg)
  <span class="org-doc">"Closes treemacs window after selecting a file to visit."</span>
  (treemacs-visit-node-default arg)
  (delete-window (treemacs-get-local-window)))
</pre>
</div>

<p>
We can now, configure Treemacs properly:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 412: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> treemacs
</pre>
</div>

<p>
First we need to tell Treemacs to use the new autoload function when I press <code>&lt;ENTER&gt;</code> on a file:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 413: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(treemacs-define-RET-action 'file-node-open #'my-treemacs-visit-node-and-close-h)
(treemacs-define-RET-action 'file-node-closed #'my-treemacs-visit-node-and-close-h)
</pre>
</div>

<p>
Then, I like Treemacs to collapse directory into one when possible:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 414: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> treemacs-collapse-dirs (<span class="org-keyword">if</span> (executable-find <span class="org-string">"python3"</span>) 3 0))
</pre>
</div>

<p>
<a href="https://andreyorst.gitlab.io/posts/2020-05-01-dynamic-title-for-treemacs-workspace/">https://andreyorst.gitlab.io/posts/2020-05-01-dynamic-title-for-treemacs-workspace/</a>
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 415: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-treemacs-buffer-config-h</span> ()
  (<span class="org-keyword">let</span> ((bg (face-attribute 'default <span class="org-builtin">:background</span>))
        (fg (face-attribute 'default <span class="org-builtin">:foreground</span>)))
    (face-remap-add-relative 'header-line
                             <span class="org-builtin">:background</span> bg <span class="org-builtin">:foreground</span> fg
                             <span class="org-builtin">:box</span> `(<span class="org-builtin">:line-width</span> ,(/ my-line-pixel-height 2) <span class="org-builtin">:color</span> ,bg)))
  (<span class="org-keyword">setq</span> header-line-format
        '((<span class="org-builtin">:eval</span>
           (concat
            <span class="org-string">" &#9776; "</span>
            (propertize (s-titleize (persp-current-name)) 'face 'my-ui-window-header))))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 416: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(add-hook 'treemacs-mode-hook #'my-treemacs-buffer-config-h)
</pre>
</div>

<p>
And finally, we can close our Treemacs configuration
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 417: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">)
</pre>
</div>

<p>
I also like to make sure it behaves as expected if I use the mouse:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 418: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map!
 (<span class="org-builtin">:after</span> treemacs
  (<span class="org-builtin">:map</span> treemacs-mode-map
   [mouse-1] #'treemacs-single-click-expand-action))

 (<span class="org-builtin">:after</span> treemacs-evil
  (<span class="org-builtin">:map</span> evil-treemacs-state-map
   <span class="org-string">"C-h"</span> #'evil-window-left
   <span class="org-string">"C-l"</span> #'evil-window-right))

 (<span class="org-builtin">:after</span> cfrs
  (<span class="org-builtin">:map</span> cfrs-input-mode-map
   <span class="org-builtin">:n</span> [escape] #'cfrs-cancel)))
</pre>
</div>

<p>
Treemacs offers a function that adds the current project if it is not on the workspace. That is a nice feature, but because I use workspaces heavily, the fact that this function does not <i>remove</i> projects that do not belong to this workspace bothers me, so I  wrote this advice to do the dirty work for me:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 419: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-treemacs-add-and-display-current-project-a ()
  <span class="org-doc">"Open treemacs with current project. This function removes any project that is</span>
<span class="org-doc">not the current one."</span>
  <span class="org-builtin">:override</span> #'treemacs-add-and-display-current-project
  (<span class="org-keyword">interactive</span>)

  (<span class="org-keyword">cl-dolist</span> (p (treemacs-workspace-&gt;projects (treemacs-current-workspace)))
    (<span class="org-keyword">unless</span> (string= (doom-project-name) (treemacs-project-&gt;name p))
      (treemacs-do-remove-project-from-workspace p t)))

  (<span class="org-keyword">when</span> (treemacs-workspace-&gt;is-empty?)
      (treemacs-do-add-project-to-workspace (doom-project-root) (doom-project-name)))

  (treemacs-select-window)
  (treemacs-pulse-on-success))
</pre>
</div>

<p>
And to finalize the Treemacs configuration, let's make it respect my window navigation keys:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 420: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-dired-toggle-git-mode</span> ()
  <span class="org-doc">"Toggle `</span><span class="org-doc"><span class="org-constant">dired-git-info-mode</span></span><span class="org-doc">' in git repos."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> (not (file-remote-p default-directory))
             (locate-dominating-file <span class="org-string">"."</span> <span class="org-string">".git"</span>))
    (call-interactively 'dired-git-info-mode)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 421: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-dired-open-directory</span> ()
  <span class="org-doc">"Enters in the directory at point. If the cursor is not on a directory, do</span>
<span class="org-doc">nothing."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((target-file (dired-get-file-for-visit)))
    (<span class="org-keyword">when</span> (<span class="org-keyword">or</span> (file-directory-p target-file)
              (dired-avfs--archive-p target-file))
      (dired-find-file))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 422: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-dired-mac-quick-view</span> ()
  <span class="org-doc">"Invoke the macOS Quiclview on the file under point."</span>
  (<span class="org-keyword">interactive</span>)
  (shell-command (concat <span class="org-string">"qlmanage -p \""</span>
                         (dired-get-file-for-visit)
                         <span class="org-string">"\" &gt; /dev/null 2&gt;&amp;1"</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 423: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-dired-widen-or-quit-all</span> ()
  <span class="org-doc">"If `</span><span class="org-doc"><span class="org-constant">dired-narow</span></span><span class="org-doc">' is on, revert to the normal view. If there is no active</span>
<span class="org-doc">narrow, quit Dired."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> dired-narrow-mode
      (revert-buffer)
    (mapc (<span class="org-keyword">lambda</span> (buf)
            (<span class="org-keyword">let</span> ((win (get-buffer-window buf)))
              (<span class="org-keyword">unless</span> (append (window-prev-buffers win) (window-prev-buffers win))
                (delete-window win))
              (kill-buffer buf)))
          (doom-buffers-in-mode 'dired-mode))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 424: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-dired-narrow</span> (narrow-func)
  <span class="org-doc">"Start a dynamic narrowing of files in current view."</span>
  (<span class="org-keyword">interactive</span>
   (list (<span class="org-keyword">if</span> current-prefix-arg
             'dired-narrow-fuzzy
           'dired-narrow-regexp)))
  (call-interactively narrow-func))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 425: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-dired-yank-absolute-path</span> ()
  <span class="org-doc">"Copy the absolute path of file on pointer to kill ring."</span>
  (<span class="org-keyword">interactive</span>)
  (dired-copy-filename-as-kill 0))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 426: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-dired-yank-relative-path</span> ()
  <span class="org-doc">"Copy the relative path of file on pointer to kill ring."</span>
  (<span class="org-keyword">interactive</span>)
  (dired-copy-filename-as-kill))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 427: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-dired-open-externally</span> ()
  <span class="org-doc">"Open file with application defined by OS."</span>
  (<span class="org-keyword">interactive</span>)
  (shell-command (concat <span class="org-string">"open \""</span>
                         (dired-get-file-for-visit)
                         <span class="org-string">"\" &gt; /dev/null 2&gt;&amp;1"</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 428: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-dired-reveal-on-finder</span> ()
  <span class="org-doc">"Show current file in Finder."</span>
  (<span class="org-keyword">interactive</span>)
  (shell-command (concat <span class="org-string">"open --reveal \""</span>
                         (dired-get-file-for-visit)
                         <span class="org-string">"\" &gt; /dev/null 2&gt;&amp;1"</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 429: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-dired-marked-file-p</span> ()
  <span class="org-doc">"Return non-nil if we have marked file at point."</span>
  (dired-file-marker (dired-get-file-for-visit)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 430: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-dired-toggle-mark</span> (<span class="org-type">&amp;optional</span> _)
  <span class="org-doc">"Toggle mark of file at point."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> (my-dired-marked-file-p)
      (dired-unmark 1)
    (dired-mark 1)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 431: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-dired-open-split-right</span> ()
  (<span class="org-keyword">interactive</span>)
  (select-window
   (window--display-buffer (find-file-noselect (dired-get-file-for-visit))
                           (split-window-right)
                           'window)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 432: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-dired-open-split-bellow</span> ()
  (<span class="org-keyword">interactive</span>)
  (select-window
   (window--display-buffer (find-file-noselect (dired-get-file-for-visit))
                           (split-window-below)
                           'window)))
</pre>
</div>

<ul class="org-ul">
<li><a href="https://github.com/Fuco1/dired-hacks">https://github.com/Fuco1/dired-hacks</a> for all packages</li>
<li><a href="https://blog.breadncup.com/2012/05/27/emacs-sunrise-commander-and-avfs-fuse-unionfs-fuse-in-mac-os-x-lion/">https://blog.breadncup.com/2012/05/27/emacs-sunrise-commander-and-avfs-fuse-unionfs-fuse-in-mac-os-x-lion/</a> for starting the avfsd service</li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 433: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> dired-collapse)
(<span class="org-keyword">package!</span> dired-narrow)
(<span class="org-keyword">package!</span> dired-ranger)
(<span class="org-keyword">package!</span> dired-quick-sort)
(<span class="org-keyword">package!</span> dired-avfs)
(<span class="org-keyword">package!</span> peep-dired)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 434: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> dired
  (<span class="org-keyword">setq</span>
        auto-revert-verbose nil
        dired-dwim-target t
        dired-listing-switches <span class="org-string">"-lAhvFoG --group-directories-first"</span>
        dired-omit-files <span class="org-string">"^\\.?#</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">^\\.$</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">^\\.\\.$</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">^\\..+$</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">^.DS_STORE$</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">^.projectile$"</span>
        dired-recursive-copies '(always)
        dired-recursive-deletes '(top)
        dired-use-ls-dired t
        global-auto-revert-non-file-buffers t
        insert-directory-program <span class="org-string">"gls"</span>
        wdired-allow-to-change-permissions t
        wdired-allow-to-redirect-links t
        wdired-confirm-overwrite t))

(<span class="org-keyword">use-package!</span> peep-dired
  <span class="org-builtin">:after</span> dired
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> peep-dired-cleanup-on-disable t
        peep-dired-cleanup-eagerly t
        peep-dired-enable-on-directories nil))
(<span class="org-keyword">use-package!</span> dired-collapse <span class="org-builtin">:after</span> dired)
(<span class="org-keyword">use-package!</span> dired-narrow <span class="org-builtin">:after</span> dired)
(<span class="org-keyword">use-package!</span> dired-quick-sort
  <span class="org-builtin">:hook</span> ((dired-mode . dired-quick-sort)))
(<span class="org-keyword">use-package!</span> dired-avfs
  <span class="org-builtin">:after</span> dired
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> dired-avfs-root <span class="org-string">"~/.local/var/avfs"</span>))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 435: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:after</span> dired
      (<span class="org-builtin">:map</span> dired-mode-map
       <span class="org-builtin">:ne</span> <span class="org-string">"t"</span>        nil
       <span class="org-builtin">:ne</span> <span class="org-string">"y"</span>        nil
       <span class="org-builtin">:ne</span> <span class="org-string">"c"</span>        nil
       <span class="org-builtin">:ne</span> <span class="org-string">"o"</span>        nil
       <span class="org-builtin">:ne</span> <span class="org-string">"m"</span>        nil
       <span class="org-builtin">:ne</span> <span class="org-string">"/"</span>        #'my-dired-narrow
       <span class="org-builtin">:ne</span> <span class="org-string">"&lt;escape&gt;"</span> #'my-dired-widen-or-quit-all
       <span class="org-builtin">:ne</span> <span class="org-string">"q"</span>        #'my-dired-widen-or-quit-all
       <span class="org-builtin">:ne</span> <span class="org-string">"RET"</span>      #'dired-find-file
       <span class="org-builtin">:ne</span> <span class="org-string">"TAB"</span>      #'my-dired-open-directory
       <span class="org-builtin">:ne</span> <span class="org-string">"&lt;tab&gt;"</span>    #'my-dired-open-directory
       <span class="org-builtin">:ne</span> <span class="org-string">"j"</span>        #'dired-next-line
       <span class="org-builtin">:ne</span> <span class="org-string">"k"</span>        #'dired-previous-line
       <span class="org-builtin">:ne</span> <span class="org-string">"l"</span>        #'my-dired-open-directory
       <span class="org-builtin">:ne</span> <span class="org-string">"h"</span>        #'dired-up-directory
       <span class="org-builtin">:ne</span> <span class="org-string">"U"</span>        #'dired-up-directory
       <span class="org-builtin">:ne</span> <span class="org-string">"R"</span>        #'dired-do-rename
       <span class="org-builtin">:ne</span> <span class="org-string">"d"</span>        #'dired-do-delete
       <span class="org-builtin">:ne</span> <span class="org-string">"x"</span>        #'my-dired-toggle-mark
       <span class="org-builtin">:ne</span> <span class="org-string">"p"</span>        #'dired-ranger-paste
       <span class="org-builtin">:ne</span> <span class="org-string">"M"</span>        #'dired-ranger-move
       <span class="org-builtin">:ne</span> <span class="org-string">"`"</span>        #'dired-ranger-bookmark
       <span class="org-builtin">:ne</span> <span class="org-string">"'"</span>        #'dired-ranger-bookmark-visit
       (<span class="org-builtin">:prefix</span> (<span class="org-string">"c"</span> . <span class="org-string">"create"</span>)
        <span class="org-builtin">:desc</span> <span class="org-string">"Create empty file"</span>     <span class="org-builtin">:ne</span> <span class="org-string">"f"</span> #'dired-create-empty-file
        <span class="org-builtin">:desc</span> <span class="org-string">"Create directory"</span>      <span class="org-builtin">:ne</span> <span class="org-string">"d"</span> #'dired-create-directory
        <span class="org-builtin">:desc</span> <span class="org-string">"Create project"</span>        <span class="org-builtin">:ne</span> <span class="org-string">"p"</span> #'xxx)
       (<span class="org-builtin">:prefix</span> (<span class="org-string">"m"</span> . <span class="org-string">"mark"</span>)
        <span class="org-builtin">:ne</span> <span class="org-string">"h"</span> nil
        <span class="org-builtin">:desc</span> <span class="org-string">"Mark directories"</span>  <span class="org-builtin">:ne</span> <span class="org-string">"d"</span> #'dired-mark-directories
        <span class="org-builtin">:desc</span> <span class="org-string">"Mark extension"</span>    <span class="org-builtin">:ne</span> <span class="org-string">"e"</span> #'dired-mark-extension
        <span class="org-builtin">:desc</span> <span class="org-string">"Mark hidden files"</span> <span class="org-builtin">:ne</span> <span class="org-string">"h"</span> #'dired-mark-omitted
        <span class="org-builtin">:desc</span> <span class="org-string">"Mark with regexp"</span>  <span class="org-builtin">:ne</span> <span class="org-string">"r"</span> #'dired-mark-files-regexp
        <span class="org-builtin">:desc</span> <span class="org-string">"Mark subdir files"</span> <span class="org-builtin">:ne</span> <span class="org-string">"s"</span> #'dired-mark-omitted
        <span class="org-builtin">:desc</span> <span class="org-string">"Unmark all files"</span>  <span class="org-builtin">:ne</span> <span class="org-string">"u"</span> #'dired-unmark-all-files
        <span class="org-builtin">:desc</span> <span class="org-string">"Remove all marks"</span>  <span class="org-builtin">:ne</span> <span class="org-string">"U"</span> #'dired-unmark-all-marks
        <span class="org-builtin">:desc</span> <span class="org-string">"Mark executables"</span>  <span class="org-builtin">:ne</span> <span class="org-string">"x"</span> #'dired-mark-executables)
       (<span class="org-builtin">:prefix</span> (<span class="org-string">"o"</span> . <span class="org-string">"open"</span>)
        <span class="org-builtin">:desc</span> <span class="org-string">"Open no split"</span>         <span class="org-builtin">:ne</span> <span class="org-string">"o"</span> #'dired-find-alternate-file
        <span class="org-builtin">:desc</span> <span class="org-string">"Quick view"</span>            <span class="org-builtin">:ne</span> <span class="org-string">"q"</span> #'my-dired-mac-quick-view
        <span class="org-builtin">:desc</span> <span class="org-string">"Reveal on Finder"</span>      <span class="org-builtin">:ne</span> <span class="org-string">"f"</span> #'my-dired-reveal-on-finder
        <span class="org-builtin">:desc</span> <span class="org-string">"Open vertically"</span>       <span class="org-builtin">:ne</span> <span class="org-string">"s"</span> #'my-dired-open-split-bellow
        <span class="org-builtin">:desc</span> <span class="org-string">"Open horizontally"</span>     <span class="org-builtin">:ne</span> <span class="org-string">"v"</span> #'my-dired-open-split-right
        <span class="org-builtin">:desc</span> <span class="org-string">"Open externally"</span>       <span class="org-builtin">:ne</span> <span class="org-string">"x"</span> #'my-dired-open-externally)
       (<span class="org-builtin">:prefix</span> (<span class="org-string">"t"</span> . <span class="org-string">"toggle"</span>)
        <span class="org-builtin">:desc</span> <span class="org-string">"Toggle collapsed dirs"</span> <span class="org-builtin">:ne</span> <span class="org-string">"c"</span> #'dired-collapse-mode
        <span class="org-builtin">:desc</span> <span class="org-string">"Toggle details"</span>        <span class="org-builtin">:ne</span> <span class="org-string">"d"</span> #'dired-hide-details-mode
        <span class="org-builtin">:desc</span> <span class="org-string">"Toggle git info"</span>       <span class="org-builtin">:ne</span> <span class="org-string">"g"</span> #'my-dired-toggle-git-mode
        <span class="org-builtin">:desc</span> <span class="org-string">"Toggle hidden files"</span>   <span class="org-builtin">:ne</span> <span class="org-string">"h"</span> #'dired-omit-mode
        <span class="org-builtin">:desc</span> <span class="org-string">"Toggle all marks"</span>      <span class="org-builtin">:ne</span> <span class="org-string">"m"</span> #'dired-toggle-marks
        <span class="org-builtin">:desc</span> <span class="org-string">"Toggle preview"</span>        <span class="org-builtin">:ne</span> <span class="org-string">"p"</span> #'peep-dired
        <span class="org-builtin">:desc</span> <span class="org-string">"Toggle sorting"</span>        <span class="org-builtin">:ne</span> <span class="org-string">"s"</span> #'hydra-dired-quick-sort/body
        <span class="org-builtin">:desc</span> <span class="org-string">"Toggle edit mode"</span>      <span class="org-builtin">:ne</span> <span class="org-string">"w"</span> #'wdired-change-to-wdired-mode)
       (<span class="org-builtin">:prefix</span> (<span class="org-string">"y"</span> . <span class="org-string">"yank"</span>)
        <span class="org-builtin">:desc</span> <span class="org-string">"Yank files"</span>            <span class="org-builtin">:ne</span> <span class="org-string">"y"</span> #'dired-ranger-copy
        <span class="org-builtin">:desc</span> <span class="org-string">"Copy absolut path"</span>     <span class="org-builtin">:ne</span> <span class="org-string">"a"</span> #'my-dired-yank-absolute-path
        <span class="org-builtin">:desc</span> <span class="org-string">"Copy file"</span>             <span class="org-builtin">:ne</span> <span class="org-string">"f"</span> #'dired-do-copy
        <span class="org-builtin">:desc</span> <span class="org-string">"Copy with regexp"</span>      <span class="org-builtin">:ne</span> <span class="org-string">"R"</span> #'dired-do-copy-regexp
        <span class="org-builtin">:desc</span> <span class="org-string">"Copy relative path"</span>    <span class="org-builtin">:ne</span> <span class="org-string">"r"</span> #'my-dired-yank-relative-path))
      (<span class="org-builtin">:map</span> wdired-mode-map
        <span class="org-builtin">:in</span> <span class="org-string">"s-RET"</span> #'wdired-finish-edit
        <span class="org-builtin">:in</span> [s-return] #'wdired-finish-edit
        <span class="org-builtin">:in</span> <span class="org-string">"s-ESC"</span> #'wdired-revert
        <span class="org-builtin">:in</span> [s-escape] #'wdired-revert))
</pre>
</div>
</div>
</div>

<div id="outline-container-org0a39331" class="outline-3">
<h3 id="org0a39331"><span class="section-number-3">7.3</span> <span class="todo TODO">TODO</span> Project management</h3>
<div class="outline-text-3" id="text-7-3">
<p>
Projectile is a great package. It usually provides more features that one particular user would need. But I still want to tweak it to make it behave more according my expectations.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 436: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> projectile
</pre>
</div>

<p>
To make <code>projectile</code> work with <code>selectrum</code>, we need to tell it to use the default Emacs completion system:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 437: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> projectile-ignored-projects `(<span class="org-string">"~/"</span>
                                    <span class="org-string">"/tmp"</span>
                                    ,(expand-file-name <span class="org-string">"straight/repos"</span> doom-local-dir)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 438: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> projectile-completion-system 'default)
</pre>
</div>

<p>
Doom sets a function to run when we open a project with <code>projectile</code>, but that function is not calling any <i>open file</i> function for us. Let's create our own version of such function and help projectile to do the appropriate thing when we open a project.
</p>

<p>
The actions I expect are:
</p>

<ul class="org-ul">
<li>Check if the project has one of the recognized files and open it, in this order (we should look for four extensions on each one of the files, also in this order: <code>.org</code>, no extension, <code>.md</code>, and <code>.rst</code>):
<ul class="org-ul">
<li><code>CHANGELOG</code></li>
<li><code>NEWS</code></li>
<li><code>README</code></li>
</ul></li>
<li>If none of the recognizable files is present, run <code>project-find-file</code>;</li>
</ul>

<p>
Let's create such function as an <i>autoload</i> function:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 439: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-after-switch-project-action-h</span> ()
  <span class="org-doc">"A project first action to execute when we switch our current project."</span>
  (<span class="org-keyword">let</span> ((file (<span class="org-keyword">file-exists-p!</span> (<span class="org-keyword">or</span> <span class="org-string">"README.rst"</span>
                                  <span class="org-string">"README.md"</span>
                                  <span class="org-string">"README"</span>
                                  <span class="org-string">"README.org"</span>
                                  <span class="org-string">"NEWS.rst"</span>
                                  <span class="org-string">"NEWS.md"</span>
                                  <span class="org-string">"NEWS"</span>
                                  <span class="org-string">"NEWS.org"</span>
                                  <span class="org-string">"CHANGELOG.rst"</span>
                                  <span class="org-string">"CHANGELOG.md"</span>
                                  <span class="org-string">"CHANGELOG"</span>
                                  <span class="org-string">"CHANGELOG.org"</span>))))
    (<span class="org-keyword">if</span> file
        (find-file-existing file)
      (projectile-find-file))))
</pre>
</div>

<p>
And attach it to the <code>projectile</code> hook:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 440: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> projectile-switch-project-action #'my-after-switch-project-action-h)
</pre>
</div>

<p>
As usual, don't forget to close the <code>after!</code> sexp:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 441: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">)  <span class="org-comment-delimiter">;; </span><span class="org-comment">after! projectile</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc1958bf" class="outline-3">
<h3 id="orgc1958bf"><span class="section-number-3">7.4</span> <span class="todo TODO">TODO</span> Terminal</h3>
<div class="outline-text-3" id="text-7-4">
<p>
In general, I really like the setup Doom has for the terminal. There are 3 things I like to add there.
</p>

<p>
One are some aliases that I'm used to use when working on the terminal:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 442: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> eshell
  (set-eshell-alias!
   <span class="org-string">"d"</span>     <span class="org-string">"dired $1"</span>
   <span class="org-string">"edit"</span>  <span class="org-string">"find-file-other-window $1"</span>
   <span class="org-string">"em"</span>    <span class="org-string">"find-file-other-window $1"</span>
   <span class="org-string">"emacs"</span> <span class="org-string">"find-file-other-window $1"</span>
   <span class="org-string">"f"</span>     <span class="org-string">"find-file $1"</span>
   <span class="org-string">"gc"</span>    <span class="org-string">"magit-commit $1"</span>
   <span class="org-string">"gl"</span>    <span class="org-string">"(call-interactively 'magit-log-current)"</span>
   <span class="org-string">"gst"</span>   <span class="org-string">"magit-status $1"</span>
   <span class="org-string">"ls"</span>    <span class="org-string">"exa --group-directories-first --color always -F $1"</span>
   <span class="org-string">"la"</span>    <span class="org-string">"exa --group-directories-first --color always -F -a $1"</span>
   <span class="org-string">"ll"</span>    <span class="org-string">"exa --group-directories-first --color always -F -l -h --git $1"</span>
   <span class="org-string">"lla"</span>   <span class="org-string">"exa --group-directories-first --color always -F -a -l -h --git $1"</span>
   <span class="org-string">"rg"</span>    <span class="org-string">"rg --color=always $*"</span>
   <span class="org-string">"up"</span>    <span class="org-string">"eshell-up $1"</span>
   <span class="org-string">"pk"</span>    <span class="org-string">"eshell-up-peek $1"</span>
   <span class="org-string">"vi"</span>    <span class="org-string">"find-file-other-window $1"</span>
   <span class="org-string">"vim"</span>   <span class="org-string">"find-file-other-window $1"</span>))
</pre>
</div>

<p>
Two is the window navigation mapping:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 443: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:after</span> eshell
      (<span class="org-builtin">:map</span> eshell-mode-map
       <span class="org-builtin">:in</span> <span class="org-string">"C-h"</span> #'evil-window-left
       <span class="org-builtin">:in</span> <span class="org-string">"C-j"</span> #'evil-window-down
       <span class="org-builtin">:in</span> <span class="org-string">"C-k"</span> #'evil-window-up
       <span class="org-builtin">:in</span> <span class="org-string">"C-l"</span> #'evil-window-right))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 444: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(set-popup-rule! <span class="org-string">"^\\*doom:</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">v?term</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">e?shell</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">-popup"</span>
  <span class="org-builtin">:slot</span> 2   <span class="org-builtin">:vslot</span> -1     <span class="org-builtin">:side</span> 'bottom  <span class="org-builtin">:width</span> 110 <span class="org-builtin">:height</span> 0.4
  <span class="org-builtin">:select</span> t <span class="org-builtin">:modeline</span> nil <span class="org-builtin">:autosave</span> nil  <span class="org-builtin">:ttl</span> nil   <span class="org-builtin">:quit</span> nil)
</pre>
</div>

<p>
And three is to fix <code>magit-status</code>. When I'm on the terminal, if I open <code>magit-status</code>, everything works as expected, but when I exit back to the terminal, Emacs switch the buffer on my terminal window to something else.
</p>

<p>
The ideal behavior would be to any app launch from the terminal to take over eshell's window until done. Then, revert back to the terminal.
</p>

<p>
I like to have a hint of the next possible completion while I'm working on shell. Zsh and Fish have great plugins for such feature, so I decided to add one for eshell as well:
</p>

<ul class="org-ul">
<li><a href="https://github.com/dieggsy/esh-autosuggest">https://github.com/dieggsy/esh-autosuggest</a></li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 445: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> esh-autosuggest)
</pre>
</div>

<p>
The only configuration we need to get this mode working, is to let Emacs enable it when <code>eshell-mode</code> is up.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 446: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> esh-autosuggest
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:hook</span> ((eshell-mode . esh-autosuggest-mode)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9672e4e" class="outline-3">
<h3 id="org9672e4e"><span class="section-number-3">7.5</span> <span class="todo TODO">TODO</span> Emails</h3>
<div class="outline-text-3" id="text-7-5">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 447: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp">
</pre>
</div>
</div>
</div>

<div id="outline-container-orge8d5a23" class="outline-3">
<h3 id="orge8d5a23"><span class="section-number-3">7.6</span> <span class="todo TODO">TODO</span> Calendars</h3>
<div class="outline-text-3" id="text-7-6">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 448: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defconst</span> <span class="org-variable-name">+work-calendar-personal</span> (expand-file-name <span class="org-string">"personal.org"</span> my-calendars-directory)
  <span class="org-doc">"File path for my personal calendar"</span>)

(<span class="org-keyword">defconst</span> <span class="org-variable-name">+work-calendar-family</span> (expand-file-name <span class="org-string">"family.org"</span> my-calendars-directory)
  <span class="org-doc">"File path for my personal calendar"</span>)

(<span class="org-keyword">defconst</span> <span class="org-variable-name">+work-calendar-work</span> (expand-file-name <span class="org-string">"work.org"</span> my-calendars-directory)
  <span class="org-doc">"File path for my personal calendar"</span>)

(<span class="org-keyword">defconst</span> <span class="org-variable-name">+org-calendars-files</span> (list +work-calendar-personal
                                     +work-calendar-family
                                     +work-calendar-work)
  <span class="org-doc">"List of directories to find files with appointment events (calendar)"</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 449: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defconst</span> <span class="org-variable-name">+doom-calendar-color-table</span> (make-hash-table <span class="org-builtin">:test</span> #'equal)
  <span class="org-doc">"A hash table to hold an association between a calendar name (in our org world,</span>
<span class="org-doc">this is the event's category), and its defined color."</span>)

(puthash <span class="org-string">"work"</span>     '(<span class="org-builtin">:color</span> <span class="org-string">"#a67a63"</span> <span class="org-builtin">:bg</span> <span class="org-string">"#4f3426"</span> <span class="org-builtin">:fg</span> <span class="org-string">"#ffc8a9"</span>) +doom-calendar-color-table)
(puthash <span class="org-string">"personal"</span> '(<span class="org-builtin">:color</span> <span class="org-string">"#19adf8"</span> <span class="org-builtin">:bg</span> <span class="org-string">"#17445d"</span> <span class="org-builtin">:fg</span> <span class="org-string">"#a9e3ff"</span>) +doom-calendar-color-table)
(puthash <span class="org-string">"family"</span>   '(<span class="org-builtin">:color</span> <span class="org-string">"#cd73e1"</span> <span class="org-builtin">:bg</span> <span class="org-string">"#45285c"</span> <span class="org-builtin">:fg</span> <span class="org-string">"#f1aeff"</span>) +doom-calendar-color-table)

<span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-work-calendar-color</span> (name <span class="org-type">&amp;optional</span> prop)
  <span class="org-doc">"Returns a string representing the color for PROP for the calendar with the</span>
<span class="org-doc">given NAME.</span>

<span class="org-doc">If color is nil, this function uses the property `</span><span class="org-doc"><span class="org-constant">:color</span></span><span class="org-doc">'"</span>
  (plist-get (gethash name +doom-calendar-color-table) (<span class="org-keyword">or</span> prop <span class="org-builtin">:color</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 450: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> +calendar-open-function #'my-work/open-calendar)

(map! <span class="org-builtin">:leader</span> <span class="org-builtin">:prefix</span> (<span class="org-string">"o"</span> . <span class="org-string">"open"</span>)
      <span class="org-builtin">:desc</span> <span class="org-string">"Open calendar"</span> <span class="org-builtin">:nvm</span> <span class="org-string">"c"</span> #'=calendar)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 451: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-work/open-calendar</span> ()
  <span class="org-doc">"TODO"</span>
  (<span class="org-keyword">interactive</span>)
  (cfw:open-calendar-buffer
   <span class="org-builtin">:contents-sources</span>
   (list
    (cfw:org-create-file-source <span class="org-string">"Personal"</span> +work-calendar-personal (my-work-calendar-color <span class="org-string">"personal"</span>))
    (cfw:org-create-file-source <span class="org-string">"Family"</span> +work-calendar-family (my-work-calendar-color <span class="org-string">"family"</span>))
    (cfw:org-create-file-source <span class="org-string">"Work"</span> +work-calendar-work (my-work-calendar-color <span class="org-string">"work"</span>))
    )))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 452: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> calfw
  (custom-theme-set-faces! 'doom-one
    `(cfw:face-today-title <span class="org-builtin">:foreground</span> <span class="org-string">"#FFFFFF"</span>
                           <span class="org-builtin">:background</span> <span class="org-string">"#2E475E"</span>)
    `(cfw:face-today <span class="org-builtin">:foreground</span> ,(doom-color 'fg)
                     <span class="org-builtin">:background</span> <span class="org-string">"#1c2b39"</span>)
    `(cfw:face-grid <span class="org-builtin">:foreground</span> ,(doom-color 'base4 256))
    `(cfw:face-select <span class="org-builtin">:foreground</span> ,(doom-darken 'number 256)
                      <span class="org-builtin">:background</span> ,(doom-lighten 'number 256))
    `(cfw:face-holiday <span class="org-builtin">:foreground</span> ,(doom-color 'green 256))
    `(cfw:face-saturday <span class="org-builtin">:foreground</span> ,(doom-color 'red 256))
    `(cfw:face-sunday <span class="org-builtin">:foreground</span> ,(doom-color 'red 256)))

  (map! <span class="org-builtin">:map</span> cfw:calendar-mode-map
        <span class="org-builtin">:e</span> <span class="org-string">"q"</span> #'+calendar/quit))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 453: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-work-calendar-open-a ()
  <span class="org-doc">"Activate (or switch to) `</span><span class="org-doc"><span class="org-constant">calendar</span></span><span class="org-doc">' in its workspace."</span>
  <span class="org-builtin">:override</span> '=calendar
  (<span class="org-keyword">interactive</span>)
  (+workspace-switch <span class="org-string">"Calendar"</span> t)
  (doom/switch-to-scratch-buffer)
  (+calendar--init)
  (+workspace/display))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 454: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-work-calendar-quit-a ()
  <span class="org-doc">"Activate (or switch to) `</span><span class="org-doc"><span class="org-constant">calendar</span></span><span class="org-doc">' in its workspace."</span>
  <span class="org-builtin">:override</span> '+calendar/quit
  (<span class="org-keyword">interactive</span>)
  (+workspace/delete <span class="org-string">"Calendar"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org580a97a" class="outline-3">
<h3 id="org580a97a"><span class="section-number-3">7.7</span> <span class="todo TODO">TODO</span> Contacts</h3>
<div class="outline-text-3" id="text-7-7">
<p>
TBD
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 455: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defconst</span> <span class="org-variable-name">+org-contacts-file</span> (expand-file-name <span class="org-string">"contacts.org"</span> my-agenda-directory)
  <span class="org-doc">"Path to the org file that will store all contacts."</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 456: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">(use-package! org-contacts</span>
<span class="org-comment-delimiter">;;   </span><span class="org-comment">:after (org-capture)</span>
<span class="org-comment-delimiter">;;   </span><span class="org-comment">:init</span>
<span class="org-comment-delimiter">;;   </span><span class="org-comment">(setq org-contacts-icon-property "PICTURE"</span>
<span class="org-comment-delimiter">;;         </span><span class="org-comment">org-contacts-icon-use-gravatar t))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org0d1a606" class="outline-3">
<h3 id="org0d1a606"><span class="section-number-3">7.8</span> <span class="todo TODO">TODO</span> Time Management</h3>
<div class="outline-text-3" id="text-7-8">
<dl class="org-dl">
<dt>Triage</dt><dd>This process is to mark done tasks as done, and adjust any deadlines or other information on my tasks:
<dl class="org-dl">
<dt>Daily</dt><dd>Should be a quick 5 min check on the tasks done during the day. I will use this time to also add unexpected tasks on my list so I can have a more accurate record of my work day;</dd>
<dt>Weekly</dt><dd>Should be a more in-depth review, where I will evaluate if I need to change or amend any of the tasks I'm tracking. This process shouldn't take more than 30 minutes;</dd>
</dl></dd>
</dl>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 457: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defconst</span> <span class="org-variable-name">+org-tasks-file</span> (expand-file-name <span class="org-string">"todo.org"</span> my-tasks-directory)
  <span class="org-doc">"Path to the org file that will store all habits."</span>)


(<span class="org-keyword">defconst</span> <span class="org-variable-name">+org-habits-file</span> (expand-file-name <span class="org-string">"habits.org"</span> my-agenda-directory)
  <span class="org-doc">"Path to the org file that will store all habits."</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 458: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org
  (<span class="org-keyword">setq</span> org-archive-location (concat org-directory <span class="org-string">"/.archives/%s::datetree/* Archived From %s"</span>)
        org-archive-tag <span class="org-string">"ARCHIVED"</span>
        org-log-done t
        org-todo-keywords '((sequence
                             <span class="org-string">"TODO(t)"</span>  <span class="org-comment-delimiter">; </span><span class="org-comment">This task needs to be done.</span>

                             <span class="org-string">"NEXT(n)"</span>  <span class="org-comment-delimiter">; </span><span class="org-comment">I committed to work on this task next. This can be used to</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">plan my next day, or to indicate in a project the next</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">logical step.</span>

                             <span class="org-string">"STRT(s)"</span>  <span class="org-comment-delimiter">; </span><span class="org-comment">This task is actively in progress. Ideally you only have</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">one task marked as started, but in some cases you can</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">start a task, and while you wait for something to</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">complete, you can start another task.</span>

                             <span class="org-string">"WAIT(w)"</span>  <span class="org-comment-delimiter">; </span><span class="org-comment">This task is waiting some external condition to happen,</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">like waiting for an authorization, waiting for account to</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">be created, etc.</span>

                             <span class="org-string">"HOLD(h)"</span>  <span class="org-comment-delimiter">; </span><span class="org-comment">This task is paused. This state can mean many different</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">things. A task can be paused because I simply don't want</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">to continue doing it, or it is paused because I want to</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">make sure I understand I shouldn't be work on this task.</span>

                             <span class="org-string">"DELG(g)"</span>  <span class="org-comment-delimiter">; </span><span class="org-comment">This task is delegated to someone else. Usually, a</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">delegated task has a property indicating to whom it is</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">delegated and when is the tentative ETA. This state is not</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">considered final because I want to follow up with the</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">person about the outcome.</span>
                             <span class="org-string">"|"</span>
                             <span class="org-string">"DONE(d)"</span>  <span class="org-comment-delimiter">; </span><span class="org-comment">Task successfully completed</span>

                             <span class="org-string">"KILL(k)"</span>  <span class="org-comment-delimiter">; </span><span class="org-comment">Task was cancelled, aborted or is no longer applicable,</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">but I want to keep it as a record instead of simply</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">remove it from the file.</span>
                             ))
        org-todo-keyword-faces '((<span class="org-string">"STRT"</span> . +org-todo-active)
                                 (<span class="org-string">"DELG"</span> . +org-todo-active)
                                 (<span class="org-string">"WAIT"</span> . +org-todo-onhold)
                                 (<span class="org-string">"HOLD"</span> . +org-todo-onhold))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 459: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-org-agenda-buffer-config-h</span> ()
  (evil-window-set-width 100)
  (doom-themes-hide-modeline)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(variable-pitch-mode -1)</span>
  (<span class="org-keyword">setq-local</span> wrap-prefix (s-repeat +org-agenda--wrap-prefix <span class="org-string">" "</span>))
  (<span class="org-keyword">setq</span> writeroom-width 65)
  (+zen/toggle 1)
  (visual-line-mode 1)
  (tab-line-mode -1)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(hl-line-mode -1)</span>
  (<span class="org-keyword">when</span> (not (= text-scale-mode-amount 1))
    (<span class="org-keyword">setq-local</span> text-scale-mode-amount 1)
    (text-scale-mode 1)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 460: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-org-agenda-setup-time-grid-h</span> ()
  <span class="org-doc">"Set different line spacing based on clock time duration."</span>
  (<span class="org-keyword">let</span> (first-item)
    (<span class="org-keyword">save-excursion</span>
      (<span class="org-keyword">let</span> (pos duration curr-time blocked-time marker)
        (goto-char (point-min))

        (<span class="org-keyword">while</span> (<span class="org-keyword">setq</span> pos (next-single-property-change (point) 'time-of-day))
          (goto-char pos)
          (<span class="org-keyword">setq</span> curr-time (org-get-at-bol 'time-of-day))
          (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> (not (equal pos (point-at-eol)))
                     curr-time)
            (<span class="org-keyword">if</span> (<span class="org-keyword">setq</span> duration (org-get-at-bol 'duration))
                (<span class="org-keyword">progn</span>
                  (<span class="org-keyword">unless</span> first-item (<span class="org-keyword">setq</span> first-item pos))
                  (<span class="org-keyword">setq</span> blocked-time (max (+ curr-time (* (/ duration 60.0) 100.0))
                                          (<span class="org-keyword">or</span> blocked-time 0)))

                  (<span class="org-keyword">if</span> (&gt; (+ (point-at-bol) 71) (point-at-eol))
                      (<span class="org-keyword">progn</span>
                        (goto-char (point-at-eol))
                        (insert-char #x20 (- 71 (- (point-at-eol) (point-at-bol))) t))
                    (<span class="org-keyword">when</span> (&lt; (+ (point-at-bol) 69) (point-at-eol))
                      (goto-char (+ (point-at-bol) 69))
                      (delete-region (point) (point-at-eol))
                      (insert-char ?&#8230; 1 t)
                      (insert-char #x20 1 t)))

                  (remove-text-properties (point-at-bol) (point-at-eol) '(mouse-face nil))

                  (<span class="org-keyword">let*</span> ((line-height (<span class="org-keyword">if</span> (&lt; duration 15) 1.0 (+ 0.5 (/ duration 30))))
                         (block-start (+ (point-at-bol) (- +org-agenda--category-length 1)))
                         (block-end (+ block-start 59))
                         (ov (make-overlay (point-at-bol) (1+ (point-at-eol))))
                         (color-ov (make-overlay block-start block-end))
                         (mouse-ov (make-overlay block-start (point-at-eol)))
                         (cal (org-get-at-bol 'org-category)))
                    (<span class="org-keyword">when</span> (<span class="org-keyword">setq</span> marker (org-get-at-bol 'org-marker))
                      (add-text-properties (point-at-bol)
                                           (point-at-eol)
                                           `(org-target-file ,(cons
                                                               (buffer-file-name (marker-buffer marker))
                                                               (marker-position marker)))))

                    (overlay-put ov 'priority 1010)
                    (overlay-put ov 'line-height line-height)
                    (overlay-put ov 'line-spacing (1- line-height))
                    (overlay-put color-ov 'priority 1020)
                    (overlay-put color-ov 'face `(<span class="org-builtin">:background</span> ,(my-work-calendar-color cal <span class="org-builtin">:bg</span>)
                                                  <span class="org-builtin">:foreground</span> ,(my-work-calendar-color cal <span class="org-builtin">:fg</span>)
                                                  <span class="org-builtin">:box</span> (<span class="org-builtin">:line-width</span> -2 <span class="org-builtin">:color</span> ,(doom-color 'bg))))
                    (overlay-put mouse-ov 'priority 1030)
                    (overlay-put mouse-ov 'mouse-face `(<span class="org-builtin">:background</span> ,(my-work-calendar-color cal)
                                                        <span class="org-builtin">:foreground</span> <span class="org-string">"white"</span>
                                                        <span class="org-builtin">:box</span> (<span class="org-builtin">:line-width</span> -2 <span class="org-builtin">:color</span> ,(doom-color 'bg))))))
              (<span class="org-keyword">when</span> (&lt; curr-time (<span class="org-keyword">or</span> blocked-time -1))
                (kill-whole-line)
                (previous-line)))))))
    (<span class="org-keyword">when</span> first-item
      (goto-char first-item))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 461: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-org-agenda-reset-font-a (<span class="org-type">&amp;rest</span> _)
  <span class="org-doc">"Reset text scale before running `</span><span class="org-doc"><span class="org-constant">org-agenda-redo</span></span><span class="org-doc">' to prevent messing with</span>
<span class="org-doc">layout."</span>
  <span class="org-builtin">:before</span> 'org-agenda-redo
  (<span class="org-keyword">setq-local</span> text-scale-mode-amount 0)
  (text-scale-mode -1))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 462: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defconst</span> <span class="org-variable-name">+org-agenda--category-length</span> 14
  <span class="org-doc">"The length of the space categories occupy on org-agenda"</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 463: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defconst</span> <span class="org-variable-name">+org-agenda--wrap-prefix</span> (+ +org-agenda--category-length 5)
  <span class="org-doc">"Length that a wrapped text should indent on org-agenda. This</span>
<span class="org-doc">length is the `</span><span class="org-doc"><span class="org-constant">+org-agenda--category-length</span></span><span class="org-doc">' plus 5 characters to</span>
<span class="org-doc">account for the TODO word plus one space."</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 464: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org
  (<span class="org-keyword">setq</span> org-agenda-block-separator <span class="org-string">" "</span>
        org-agenda-compact-blocks nil
        org-agenda-current-time-string <span class="org-string">"&#9664;- now - - - - - - - - - - - - - - - - - - -"</span>
        org-agenda-files  (append (list +org-tasks-file my-journal-file) +org-calendars-files)
        org-agenda-include-deadlines t
        org-agenda-skip-deadline-if-done t
        org-agenda-skip-scheduled-if-done t
        org-agenda-time-grid '((daily today require-timed remove-match)
                               (700 800 900 1000 1100 1200 1300 1400 1500 1600 1700 1800)
                               <span class="org-string">"&#183;&#183;&#183;&#183;&#183;&#183;"</span>
                               <span class="org-string">"&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;"</span>)
        org-agenda-window-setup 'other-window))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 465: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-contain-buffer-p</span> (lst buf)
  <span class="org-doc">"Return t if th given BUF is in the given LST.</span>

<span class="org-doc">This function searches the buffer in all nested lists containd in LST."</span>
  (<span class="org-keyword">unless</span> (not lst)
    (<span class="org-keyword">if</span> (seqp lst)
        (seq-some (<span class="org-keyword">lambda</span> (elm) (my-contain-buffer-p elm buf)) lst)
      (eq lst buf))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 466: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-bring-buffer-to-front</span> (buffer-or-name)
  <span class="org-doc">"Make sure buffer is visible on its window.</span>

<span class="org-doc">BUFFER-OR-NAME is the buffer to look for.</span>

<span class="org-doc">Return t if the buffer moved to front."</span>
  (<span class="org-keyword">when-let</span> ((buf (<span class="org-keyword">when</span> buffer-or-name (get-buffer buffer-or-name)))
             (win (seq-find (<span class="org-keyword">lambda</span> (window)
                              (seq-some (<span class="org-keyword">lambda</span> (buf-list) (my-contain-buffer-p buf-list buf))
                                        (append (mapcar #'car (window-prev-buffers window))
                                                (list (window-buffer window))
                                                (window-next-buffers window))))
                            (window-list))))
    (set-window-buffer win buf t)
    t))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 467: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-bring-org-agenda-to-front-h</span> ()
  (<span class="org-keyword">when</span> (my-bring-buffer-to-front org-agenda-buffer)
    (my-org-agenda-buffer-config-h)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 468: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(custom-set-faces!
  `(org-agenda-current-time <span class="org-builtin">:foreground</span> ,(doom-color 'red 256))
  `(org-agenda-date-today <span class="org-builtin">:foreground</span> ,(doom-color 'violet 256)
                          <span class="org-builtin">:height</span> 1.5
                          <span class="org-builtin">:weight</span> bold
                          <span class="org-builtin">:inherit</span> variable-pitch))

(<span class="org-keyword">after!</span> org-agenda
  (add-hook 'org-agenda-mode-hook #'my-org-agenda-buffer-config-h)
  (add-hook 'org-agenda-finalize-hook #'my-org-agenda-setup-time-grid-h)
  (add-hook 'window-state-change-hook #'my-bring-org-agenda-to-front-h)
  (remove-hook 'org-agenda-finalize-hook '+org-exclude-agenda-buffers-from-workspace-h)
  (remove-hook 'org-agenda-finalize-hook '+org-defer-mode-in-agenda-buffers-h))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 469: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> evil-org-agenda
  (map! <span class="org-builtin">:map</span> evil-org-agenda-mode-map
        <span class="org-builtin">:nvm</span> [return] #'org-agenda-goto
        <span class="org-builtin">:nvm</span> <span class="org-string">"RET"</span> #'org-agenda-goto
        <span class="org-builtin">:nvm</span> <span class="org-string">"j"</span> #'org-agenda-next-item
        <span class="org-builtin">:nvm</span> <span class="org-string">"l"</span> #'org-agenda-next-item
        <span class="org-builtin">:nvm</span> <span class="org-string">"k"</span> #'org-agenda-previous-item
        <span class="org-builtin">:nvm</span> <span class="org-string">"h"</span> #'org-agenda-previous-item
        <span class="org-builtin">:nvm</span> <span class="org-string">"&lt;DOWN&gt;"</span> #'org-agenda-next-item
        <span class="org-builtin">:nvm</span> <span class="org-string">"&lt;RIGHT&gt;"</span> #'org-agenda-next-item
        <span class="org-builtin">:nvm</span> <span class="org-string">"&lt;UP&gt;"</span> #'org-agenda-previous-item
        <span class="org-builtin">:nvm</span> <span class="org-string">"&lt;LEFT&gt;"</span> #'org-agenda-previous-item
        <span class="org-builtin">:nvm</span> [down] #'org-agenda-next-item
        <span class="org-builtin">:nvm</span> [right] #'org-agenda-next-item
        <span class="org-builtin">:nvm</span> [up] #'org-agenda-previous-item
        <span class="org-builtin">:nvm</span> [left] #'org-agenda-previous-item
        <span class="org-builtin">:nvm</span> <span class="org-string">"C-h"</span> #'evil-window-left
        <span class="org-builtin">:nvm</span> <span class="org-string">"C-j"</span> #'evil-window-down
        <span class="org-builtin">:nvm</span> <span class="org-string">"C-k"</span> #'evil-window-up
        <span class="org-builtin">:nvm</span> <span class="org-string">"C-l"</span> #'evil-window-right
        <span class="org-builtin">:nvm</span> <span class="org-string">"G"</span> #'(lambda ()
                     (<span class="org-keyword">interactive</span>)
                     (goto-char (point-max)) (org-agenda-previous-item 1))
        (<span class="org-builtin">:prefix</span> (<span class="org-string">"g"</span> . <span class="org-string">"goto"</span>)
         <span class="org-builtin">:desc</span> <span class="org-string">"Go to first item"</span> <span class="org-builtin">:nvm</span> <span class="org-string">"g"</span> #'(lambda ()
                                               (<span class="org-keyword">interactive</span>)
                                               (goto-char (point-min))
                                               (org-agenda-next-item 1)))))
</pre>
</div>

<ul class="org-ul">
<li><a href="https://github.com/alphapapa/org-super-agenda">https://github.com/alphapapa/org-super-agenda</a></li>
<li><a href="https://github.com/alphapapa/org-ql">https://github.com/alphapapa/org-ql</a></li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 470: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> org-super-agenda)
(<span class="org-keyword">package!</span> org-ql)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 471: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-org-agenda-make-agenda-icon-header-a (func name)
  <span class="org-builtin">:around</span> 'org-super-agenda--make-agenda-header
  (<span class="org-keyword">let</span> ((icon (get-text-property 0 'icon name))
        (icon-color (get-text-property 0 'icon-color name))
        (header (s-trim (funcall func name))))
    (concat
     <span class="org-string">"\n"</span>
     (<span class="org-keyword">when</span> icon
       (format <span class="org-string">"%s "</span> (my-icon icon icon-color)))
     header
     <span class="org-string">"\n"</span>
     (<span class="org-keyword">if</span> icon
         (s-repeat (+ 3 (length header)) <span class="org-string">"&#9472;"</span>)
       (s-repeat (length header) <span class="org-string">"&#9472;"</span>)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 472: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-org-agenda-group-title</span> (text <span class="org-type">&amp;optional</span> icon icon-color)
  (propertize text 'icon icon 'icon-color icon-color))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 473: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> org-super-agenda
  <span class="org-builtin">:commands</span> (org-agenda)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> org-agenda-custom-commands
        '((<span class="org-string">"c"</span> <span class="org-string">"Super view"</span>
           ((agenda <span class="org-string">""</span> ((org-agenda-span 'day)
                        (org-agenda-start-day (format-time-string <span class="org-string">"%Y-%m-%d"</span>))
                        (org-agenda-skip-function '(org-agenda-skip-entry-if 'deadline))
                        (org-agenda-show-all-dates t)
                        (org-agenda-use-time-grid t)
                        (org-agenda-overriding-header <span class="org-string">""</span>)
                        (org-super-agenda-groups
                         `((<span class="org-builtin">:name</span> ,(my-org-agenda-group-title <span class="org-string">"Agenda"</span> 'calendar (doom-lighten 'blue 0.5))
                            <span class="org-builtin">:time-grid</span> t
                            <span class="org-builtin">:and</span> (<span class="org-builtin">:date</span> today
                                  <span class="org-builtin">:todo</span> nil))))))
            (alltodo <span class="org-string">""</span> ((org-agenda-overriding-header <span class="org-string">""</span>)
                         (org-super-agenda-groups
                          `(
                            (<span class="org-builtin">:name</span> ,(my-org-agenda-group-title <span class="org-string">"Inbox"</span> 'inbox (doom-color 'orange))
                             <span class="org-builtin">:category</span> <span class="org-string">"journal"</span>
                             <span class="org-builtin">:order</span> 15)
                            (<span class="org-builtin">:name</span> ,(my-org-agenda-group-title <span class="org-string">"Delegated"</span> 'assign (doom-color 'orange))
                             <span class="org-builtin">:todo</span> <span class="org-string">"DELG"</span>
                             <span class="org-builtin">:order</span> 45)
                            (<span class="org-builtin">:name</span> ,(my-org-agenda-group-title <span class="org-string">"Waiting"</span> 'wait  (doom-color 'yellow))
                             <span class="org-builtin">:todo</span> <span class="org-string">"WAIT"</span>
                             <span class="org-builtin">:order</span> 35)
                            (<span class="org-builtin">:name</span> ,(my-org-agenda-group-title <span class="org-string">"On Hold"</span> 'pause (doom-color 'yellow))
                             <span class="org-builtin">:todo</span> <span class="org-string">"HOLD"</span>
                             <span class="org-builtin">:order</span> 40)
                            (<span class="org-builtin">:name</span> ,(my-org-agenda-group-title <span class="org-string">"Issues"</span> 'bug (doom-color 'red))
                             <span class="org-builtin">:tag</span> <span class="org-string">"issue"</span>
                             <span class="org-builtin">:order</span> 30)
                            (<span class="org-builtin">:name</span> ,(my-org-agenda-group-title <span class="org-string">"Habits"</span> 'loop (doom-color 'blue))
                             <span class="org-builtin">:habit</span> t
                             <span class="org-builtin">:order</span> 1)
                            (<span class="org-builtin">:name</span> ,(my-org-agenda-group-title <span class="org-string">"Overdue"</span> 'busy (doom-color 'red))
                             <span class="org-builtin">:deadline</span> past
                             <span class="org-builtin">:face</span> 'all-the-icons-dpink
                             <span class="org-builtin">:order</span> 4)
                            (<span class="org-builtin">:name</span> ,(my-org-agenda-group-title <span class="org-string">"Due Today"</span> 'new (doom-color 'orange))
                             <span class="org-builtin">:deadline</span> today
                             <span class="org-builtin">:face</span> 'all-the-icons-orange
                             <span class="org-builtin">:order</span> 5)
                            (<span class="org-builtin">:name</span> ,(my-org-agenda-group-title <span class="org-string">"Actionable"</span> 'checked (doom-color 'green))
                             <span class="org-builtin">:and</span> (<span class="org-builtin">:todo</span> (<span class="org-string">"TODO"</span> <span class="org-string">"STRT"</span>)
                                   <span class="org-builtin">:scheduled</span> (past today)
                                   <span class="org-builtin">:deadline</span> nil)
                             <span class="org-builtin">:order</span> 21)
                            (<span class="org-builtin">:name</span> ,(my-org-agenda-group-title <span class="org-string">"Due Soon"</span> 'snooze (doom-color 'yellow))
                             <span class="org-builtin">:deadline</span> future
                             <span class="org-builtin">:face</span> 'all-the-icons-yellow
                             <span class="org-builtin">:order</span> 10)
                            (<span class="org-builtin">:name</span> ,(my-org-agenda-group-title <span class="org-string">"Important"</span> 'error (doom-color 'red))
                             <span class="org-builtin">:priority</span> <span class="org-string">"A"</span>
                             <span class="org-builtin">:order</span> 15)
                            (<span class="org-builtin">:name</span> ,(my-org-agenda-group-title <span class="org-string">"Next to do"</span> 'visibility (doom-color 'yellow))
                             <span class="org-builtin">:todo</span> <span class="org-string">"NEXT"</span>
                             <span class="org-builtin">:order</span> 20)
                            (<span class="org-builtin">:name</span> ,(my-org-agenda-group-title <span class="org-string">"To do"</span> 'checked (doom-color 'green))
                             <span class="org-builtin">:anything</span> t
                             <span class="org-builtin">:order</span> 23)
                            ))))))))
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setq</span> org-super-agenda-header-map nil)
  (org-super-agenda-mode))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org24a11f6" class="outline-2">
<h2 id="org24a11f6"><span class="section-number-2">8</span> Appendix</h2>
<div class="outline-text-2" id="text-8">
</div>
<div id="outline-container-org2da8ba0" class="outline-3">
<h3 id="org2da8ba0"><span class="section-number-3">8.1</span> The <code>init.el</code> file</h3>
<div class="outline-text-3" id="text-8-1">
<p>
We can't tangle the <code>init.el</code> on Doom because it is always loaded before <code>doom sync</code> starts tangling <code>config.org</code>.
</p>

<p>
I have two alternatives here:
</p>

<ol class="org-ol">
<li>Let <code>init.el</code> as a lisp package;</li>
<li>Create a <code>doom sync</code> extension to tangle a <code>init.org</code> file;</li>
</ol>

<p>
For now, I will keep it as a separated Lisp file that I'm reproducing in this appendix for sake of documentation:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 474: </span>$DOOMDIR/init.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;; </span><span class="org-comment">init.el -*- lexical-binding: t; -*-</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">This file controls what Doom modules are enabled and what order they load</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">in. Remember to run 'doom sync' after modifying it!</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">NOTE Press 'SPC h d h' (or 'C-h d h' for non-vim users) to access Doom's</span>
<span class="org-comment-delimiter">;;      </span><span class="org-comment">documentation. There you'll find a "Module Index" link where you'll find</span>
<span class="org-comment-delimiter">;;      </span><span class="org-comment">a comprehensive list of Doom's modules and what flags they support.</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">NOTE Move your cursor over a module's name (or its flags) and press 'K' (or</span>
<span class="org-comment-delimiter">;;      </span><span class="org-comment">'C-c c k' for non-vim users) to view its documentation. This works on</span>
<span class="org-comment-delimiter">;;      </span><span class="org-comment">flags as well (those symbols that start with a plus).</span>
<span class="org-comment-delimiter">;;</span>
<span class="org-comment-delimiter">;;      </span><span class="org-comment">Alternatively, press 'gd' (or 'C-c c d') on a module to browse its</span>
<span class="org-comment-delimiter">;;      </span><span class="org-comment">directory (for easy access to its source code).</span>

(<span class="org-keyword">doom!</span> <span class="org-builtin">:input</span>
       <span class="org-comment-delimiter">;;</span><span class="org-comment">chinese</span>
       <span class="org-comment-delimiter">;;</span><span class="org-comment">japanese</span>
       <span class="org-comment-delimiter">;;</span><span class="org-comment">layout            ; auie,ctsrnm is the superior home row</span>

       <span class="org-builtin">:completion</span>
       (company          <span class="org-comment-delimiter">; </span><span class="org-comment">the ultimate code completion backend</span>
        +childframe
        )
       <span class="org-comment-delimiter">;; </span><span class="org-comment">helm              ; the *other* search engine for love and life</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">ido               ; the other *other* search engine...</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">ivy               ; a search engine for love and life</span>

       <span class="org-builtin">:ui</span>
       deft              <span class="org-comment-delimiter">; </span><span class="org-comment">notational velocity for Emacs</span>
       doom              <span class="org-comment-delimiter">; </span><span class="org-comment">what makes DOOM look the way it does</span>
       doom-dashboard    <span class="org-comment-delimiter">; </span><span class="org-comment">a nifty splash screen for Emacs</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">doom-quit         ; DOOM quit-message prompts when you quit Emacs</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">(emoji +unicode)  ; &#128578;</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">fill-column       ; a `</span><span class="org-comment"><span class="org-constant">fill-column</span></span><span class="org-comment">' indicator</span>
       hl-todo           <span class="org-comment-delimiter">; </span><span class="org-comment">highlight TODO/FIXME/NOTE/DEPRECATED/HACK/REVIEW</span>
       hydra
       <span class="org-comment-delimiter">;; </span><span class="org-comment">indent-guides     ; highlighted indent columns</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">ligatures         ; ligatures and symbols to make your code pretty again</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">minimap           ; show a map of the code on the side</span>
       modeline          <span class="org-comment-delimiter">; </span><span class="org-comment">snazzy, Atom-inspired modeline, plus API</span>
       nav-flash         <span class="org-comment-delimiter">; </span><span class="org-comment">blink cursor line after big motions</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">neotree           ; a project drawer, like NERDTree for vim</span>
       ophints           <span class="org-comment-delimiter">; </span><span class="org-comment">highlight the region an operation acts on</span>
       (popup            <span class="org-comment-delimiter">; </span><span class="org-comment">tame sudden yet inevitable temporary windows</span>
        +all             <span class="org-comment-delimiter">;</span>
        +defaults
        )
       <span class="org-comment-delimiter">;; </span><span class="org-comment">tabs              ; a tab bar for Emacs</span>
       (treemacs         <span class="org-comment-delimiter">; </span><span class="org-comment">a project drawer, like neotree but cooler</span>
        +lsp
        )
       <span class="org-comment-delimiter">;; </span><span class="org-comment">unicode           ; extended unicode support for various languages</span>
       vc-gutter         <span class="org-comment-delimiter">; </span><span class="org-comment">vcs diff in the fringe</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">vi-tilde-fringe   ; fringe tildes to mark beyond EOB</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">window-select     ; visually switch windows</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">workspaces        ; tab emulation, persistence &amp; separate workspaces</span>
       zen               <span class="org-comment-delimiter">; </span><span class="org-comment">distraction-free coding or writing</span>

       <span class="org-builtin">:editor</span>
       (evil             <span class="org-comment-delimiter">; </span><span class="org-comment">come to the dark side, we have cookies</span>
        +everywhere
        )
       file-templates    <span class="org-comment-delimiter">; </span><span class="org-comment">auto-snippets for empty files</span>
       fold              <span class="org-comment-delimiter">; </span><span class="org-comment">(nigh) universal code folding</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">(format           ; automated prettiness</span>
       <span class="org-comment-delimiter">;;  </span><span class="org-comment">+onsave</span>
       <span class="org-comment-delimiter">;;  </span><span class="org-comment">)</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">god               ; run Emacs commands without modifier keys</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">lispy             ; vim for lisp, for people who don't like vim</span>
       multiple-cursors  <span class="org-comment-delimiter">; </span><span class="org-comment">editing in many places at once</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">objed             ; text object editing for the innocent</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">parinfer          ; turn lisp into python, sort of</span>
       rotate-text       <span class="org-comment-delimiter">; </span><span class="org-comment">cycle region at point between text candidates</span>
       snippets          <span class="org-comment-delimiter">; </span><span class="org-comment">my elves. They type so I don't have to</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">word-wrap         ; soft wrapping with language-aware indent</span>

       <span class="org-builtin">:emacs</span>
       (dired            <span class="org-comment-delimiter">; </span><span class="org-comment">making dired pretty [functional]</span>
        +icons
        )
       <span class="org-comment-delimiter">;; </span><span class="org-comment">electric          ; smarter, keyword-based electric-indent</span>
       (ibuffer          <span class="org-comment-delimiter">; </span><span class="org-comment">interactive buffer management</span>
        +icons
        )
       (undo             <span class="org-comment-delimiter">; </span><span class="org-comment">persistent, smarter undo for your inevitable mistakes</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">+tree</span>
        )
       vc                <span class="org-comment-delimiter">; </span><span class="org-comment">version-control and Emacs, sitting in a tree</span>

       <span class="org-builtin">:term</span>
       eshell            <span class="org-comment-delimiter">; </span><span class="org-comment">the elisp shell that works everywhere</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">shell             ; simple shell REPL for Emacs</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">term              ; basic terminal emulator for Emacs</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">vterm             ; the best terminal emulation in Emacs</span>

       <span class="org-builtin">:checkers</span>
       syntax            <span class="org-comment-delimiter">; </span><span class="org-comment">tasing you for every semicolon you forget</span>
       (spell            <span class="org-comment-delimiter">; </span><span class="org-comment">tasing you for misspelling mispelling</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">+flyspell</span>
        +aspell
        <span class="org-comment-delimiter">;; </span><span class="org-comment">+hunspell</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">+enchant</span>
        +everywhere
        )
       <span class="org-comment-delimiter">;; </span><span class="org-comment">grammar           ; tasing grammar mistake every you make</span>

       <span class="org-builtin">:tools</span>
       ansible
       <span class="org-comment-delimiter">;; </span><span class="org-comment">debugger          ; FIXME stepping through code, to help you add bugs</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">direnv</span>
       docker
       editorconfig      <span class="org-comment-delimiter">; </span><span class="org-comment">let someone else argue about tabs vs spaces</span>
       <span class="org-comment-delimiter">;;</span><span class="org-comment">ein               ; tame Jupyter notebooks with emacs</span>
       (eval             <span class="org-comment-delimiter">; </span><span class="org-comment">run code, run (also, repls)</span>
        +overlay
        )
       <span class="org-comment-delimiter">;; </span><span class="org-comment">gist              ; interacting with github gists</span>
       (lookup           <span class="org-comment-delimiter">; </span><span class="org-comment">navigate your code and its documentation</span>
        +dictionary
        +offline
        +docsets
        <span class="org-comment-delimiter">;; </span><span class="org-comment">+xwidget</span>
        )
       (lsp
        +peek
        )
       (magit            <span class="org-comment-delimiter">; </span><span class="org-comment">a git porcelain for Emacs</span>
        +forge
        )
       make              <span class="org-comment-delimiter">; </span><span class="org-comment">run make tasks from Emacs</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">pass              ; password manager for nerds</span>
       pdf               <span class="org-comment-delimiter">; </span><span class="org-comment">pdf enhancements</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">prodigy           ; FIXME managing external services &amp; code builders</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">rgb               ; creating color strings</span>
       taskrunner        <span class="org-comment-delimiter">; </span><span class="org-comment">taskrunner for all your projects</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">terraform         ; infrastructure as code</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">tmux              ; an API for interacting with tmux</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">upload            ; map local to remote projects via ssh/ftp</span>

       <span class="org-builtin">:os</span>
       (<span class="org-builtin">:if</span> IS-MAC
        macos            <span class="org-comment-delimiter">; </span><span class="org-comment">improve compatibility with macOS</span>
        )
       <span class="org-comment-delimiter">;; </span><span class="org-comment">tty               ; improve the terminal Emacs experience</span>

       <span class="org-builtin">:lang</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">agda              ; types of types of types of types...</span>
       (cc               <span class="org-comment-delimiter">; </span><span class="org-comment">C/C++/Obj-C madness</span>
        +lsp)
       <span class="org-comment-delimiter">;; </span><span class="org-comment">clojure           ; java with a lisp</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">common-lisp       ; if you've seen one lisp, you've seen them all</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">coq               ; proofs-as-programs</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">crystal           ; ruby at the speed of c</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">csharp            ; unity, .NET, and mono shenanigans</span>
       data              <span class="org-comment-delimiter">; </span><span class="org-comment">config/data formats</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">(dart             ; paint ui and not much else</span>
       <span class="org-comment-delimiter">;;  </span><span class="org-comment">+flutter)</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">elixir            ; erlang done right</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">elm               ; care for a cup of TEA?</span>
       emacs-lisp        <span class="org-comment-delimiter">; </span><span class="org-comment">drown in parentheses</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">erlang            ; an elegant language for a more civilized age</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">ess               ; emacs speaks statistics</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">faust             ; dsp, but you get to keep your soul</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">fsharp            ; ML stands for Microsoft's Language</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">fstar             ; (dependent) types and (monadic) effects and Z3</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">gdscript          ; the language you waited for</span>
       (go               <span class="org-comment-delimiter">; </span><span class="org-comment">the hipster dialect</span>
        +lsp
        )
       <span class="org-comment-delimiter">;; </span><span class="org-comment">(haskell          ; a language that's lazier than I am</span>
       <span class="org-comment-delimiter">;;  </span><span class="org-comment">+dante)</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">hy                ; readability of scheme w/ speed of python</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">idris             ; a language you can depend on</span>
       (json             <span class="org-comment-delimiter">; </span><span class="org-comment">At least it ain't XML</span>
        +lsp
        )
       <span class="org-comment-delimiter">;; </span><span class="org-comment">(java             ; the poster child for carpal tunnel syndrome</span>
       <span class="org-comment-delimiter">;;  </span><span class="org-comment">+meghanada)</span>
       (javascript       <span class="org-comment-delimiter">; </span><span class="org-comment">all(hope(abandon(ye(who(enter(here))))))</span>
        +lsp
        )
       <span class="org-comment-delimiter">;; </span><span class="org-comment">julia             ; a better, faster MATLAB</span>
       kotlin            <span class="org-comment-delimiter">; </span><span class="org-comment">a better, slicker Java(Script)</span>
       latex             <span class="org-comment-delimiter">; </span><span class="org-comment">writing papers in Emacs has never been so fun</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">lean</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">factor</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">ledger            ; an accounting system in Emacs</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">lua               ; one-based indices? one-based indices</span>
       (markdown         <span class="org-comment-delimiter">; </span><span class="org-comment">writing docs for people to ignore</span>
        +grip
        )
       <span class="org-comment-delimiter">;; </span><span class="org-comment">nim               ; python + lisp at the speed of c</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">nix               ; I hereby declare "nix geht mehr!"</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">ocaml             ; an objective camel</span>
       (org              <span class="org-comment-delimiter">; </span><span class="org-comment">organize your plain life in plain text</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">+brain</span>
        +dragndrop
        <span class="org-comment-delimiter">;; </span><span class="org-comment">+gnuplot</span>
        +hugo
        +journal
        <span class="org-comment-delimiter">;; </span><span class="org-comment">+jupyter</span>
        +noter
        <span class="org-comment-delimiter">;; </span><span class="org-comment">+pandoc</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">+pomodoro</span>
        +present
        <span class="org-comment-delimiter">;; </span><span class="org-comment">+pretty</span>
        +roam
        )
       <span class="org-comment-delimiter">;; </span><span class="org-comment">php               ; perl's insecure younger brother</span>
       plantuml          <span class="org-comment-delimiter">; </span><span class="org-comment">diagrams for confusing people more</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">purescript        ; javascript, but functional</span>
       (python           <span class="org-comment-delimiter">; </span><span class="org-comment">beautiful is better than ugly</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">+conda</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">+cython</span>
        +lsp
        +poetry
        +pyenv
        +pyright
        )
       <span class="org-comment-delimiter">;; </span><span class="org-comment">qt                ; the 'cutest' gui framework ever</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">racket            ; a DSL for DSLs</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">raku              ; the artist formerly known as perl6</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">rest              ; Emacs as a REST client</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">rst               ; ReST in peace</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">(ruby             ; 1.step {|i| p "Ruby is #{i.even? ? 'love' : 'life'}"}</span>
       <span class="org-comment-delimiter">;;  </span><span class="org-comment">+rails</span>
       <span class="org-comment-delimiter">;;  </span><span class="org-comment">)</span>
       (rust             <span class="org-comment-delimiter">; </span><span class="org-comment">Fe2O3.unwrap().unwrap().unwrap().unwrap()</span>
        +lsp
        )
       <span class="org-comment-delimiter">;; </span><span class="org-comment">scala             ; java, but good</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">scheme            ; a fully conniving family of lisps</span>
       (sh               <span class="org-comment-delimiter">; </span><span class="org-comment">she sells {ba,z,fi}sh shells on the C xor</span>
        +lsp)
       <span class="org-comment-delimiter">;; </span><span class="org-comment">sml</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">solidity          ; do you need a blockchain? No.</span>
       swift             <span class="org-comment-delimiter">; </span><span class="org-comment">who asked for emoji variables?</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">terra             ; Earth and Moon in alignment for performance.</span>
       web               <span class="org-comment-delimiter">; </span><span class="org-comment">the tubes</span>
       (yaml             <span class="org-comment-delimiter">; </span><span class="org-comment">JSON, but readable</span>
        +lsp)

       <span class="org-builtin">:email</span>
       (mu4e
        <span class="org-comment-delimiter">;; </span><span class="org-comment">+gmail</span>
        )
       <span class="org-comment-delimiter">;; </span><span class="org-comment">notmuch</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">(wanderlust</span>
       <span class="org-comment-delimiter">;;  </span><span class="org-comment">+gmail</span>
       <span class="org-comment-delimiter">;;  </span><span class="org-comment">)</span>

       <span class="org-builtin">:app</span>
       calendar
       <span class="org-comment-delimiter">;; </span><span class="org-comment">irc               ; how neckbeards socialize</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">(rss              ; emacs as an RSS reader</span>
       <span class="org-comment-delimiter">;;  </span><span class="org-comment">+org</span>
       <span class="org-comment-delimiter">;;  </span><span class="org-comment">)</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">twitter           ; twitter client https://twitter.com/vnought</span>

       <span class="org-builtin">:config</span>
       literate
       (default
         +bindings
         +smartparens))

(<span class="org-keyword">when</span> doom-debug-p
  (<span class="org-keyword">require</span> '<span class="org-constant">benchmark-init</span>)
  (add-hook 'doom-first-input-hook #'benchmark-init/deactivate))

<span class="org-comment-delimiter">;; </span><span class="org-comment">I need this hook here to make sure my tangle runs this autoloaded function.</span>
(add-hook 'org-babel-post-tangle-hook
          #'(lambda ()
              (<span class="org-keyword">let</span> ((make-backup-files nil)
                    (last))
                (<span class="org-keyword">when</span> (string-match-p <span class="org-string">"\\/</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">share\\/</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">templates</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">capture</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">snippets</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\\/"</span>
                                      (buffer-file-name))
                  (goto-char (point-min))
                  (insert <span class="org-string">"# -*- mode: snippet -*-\n"</span>))
                (goto-char (point-max))
                (<span class="org-keyword">when</span> (equal (char-before) ?\n)
                  (delete-char -1)
                  (save-buffer)))))

<span class="org-comment-delimiter">;; </span><span class="org-comment">When I'm using soft-wraps to write prose, I like to have Emacs (Evil in</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">particular) to respect my visual lines. In order to do that, I must set</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">the `</span><span class="org-comment"><span class="org-constant">evil-respect-visual-line-mode</span></span><span class="org-comment">' variable before Evil is loaded.</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">Unfortunately, by the time the 'config.el' file is loaded, it is too late,</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">and that is why I have to set this variable here.</span>
(<span class="org-keyword">setq</span> evil-respect-visual-line-mode t)
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Thiago Alves</p>
<p class="date">Created: 2021-05-22 Sat 06:31</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
