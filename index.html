<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-05-16 Sun 22:12 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Thiago's Emacs Configuration</title>
<meta name="author" content="Thiago Alves" />
<meta name="generator" content="Org Mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://gongzhitaao.org/orgcss/org.css"/>
<style type="text/css">
@media all {
body {
font-size: 1.6rem;
line-height: 1.4em;
font-family: 'Cardo', serif;
color: #222
}
label.org-src-name {
float: right;
bottom: -0.5em;
position: absolute;
right: 1em;
font-size: 0.5em;
}
.listing-number {
visibility: hidden;
}
.src {
font-size: 0.7em;
line-height: 1.2em;
}
div.note {
-moz-border-radius: 6px;
-webkit-border-radius: 6px;
background-color: #f0f7fb;
background-image: url(https://f1.madcapsoftware.com/blogImages/2017/08/css-box-icon-3.png);
background-position: 0.3em 0.8em;
background-repeat: no-repeat;
border: solid 1px #3498db;
border-radius: 6px;
overflow: hidden;
padding: 0 1em 0 2.2em;
}
div.warning {
-moz-border-radius: 6px;
-webkit-border-radius: 6px;
background-color: #fde6e5;
background-image: url(https://f1.madcapsoftware.com/blogImages/2017/08/css-box-icon-4.png);
background-position: 0.3em 0.8em;
background-repeat: no-repeat;
border: solid 1px #ce2a21;
border-radius: 6px;
overflow: hidden;
padding: 0 1em 0 2.2em;
}
div.outline-text-2>p:first-child:first-letter {
float: left;
font-size: 4em;
padding-right: 5px;
}
#table-of-contents {
font-size: 10pt;
position: fixed;
right: 3em;
top: 0em;
background: #2b2b2b;
color: #dcdccc;
-webkit-box-shadow: 0 0 5px #777777;
-moz-box-shadow: 0 0 5px #777777;
-webkit-border-radius: 5px;
-moz-border-radius: 5px;
text-align: right;
/* ensure doesn't flow off the screen when expanded */
max-height: 80%;
overflow: auto;
z-index: 1000;
}
#table-of-contents h2 {
font-size: 10pt;
max-width: 8em;
font-weight: normal;
padding-left: 0.5em;
padding-left: 0.5em;
padding-top: 0.05em;
padding-bottom: 0.05em;
}
#table-of-contents #text-table-of-contents {
display: none;
text-align: left;
}
#table-of-contents:hover #text-table-of-contents {
display: block;
padding: 0.5em;
margin-top: 0em;
}
#table-of-contents {
color: black;
background: #FFF;
font-size: 80%;
padding: .5em;
margin: 1em -2em 1em 1em;
display: block;
}
#table-of-contents a {
color: #003333;
}
#table-of-contents a:hover {
color: #003333;
text-decoration: underline;
}
#table-of-contents h2 {
margin-top: 0;
margin-bottom: 0;
padding: 0;
border: none;
}
}
@media screen {
#table-of-contents {
float: right;
border: 1px solid #CCC;
max-width: 50%;
overflow: auto;
}
}
</style>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<h1 class="title">Thiago&rsquo;s Emacs Configuration
<br />
<span class="subtitle">A detailed setup for Emacs using Doom Emacs framework</span>
</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org7a74285">1. Prologue</a>
<ul>
<li><a href="#org596a64f">1.1. About this document</a></li>
<li><a href="#org927fc4a">1.2. About literate configuration</a></li>
<li><a href="#orgfdd5b57">1.3. Acknowledgments</a></li>
<li><a href="#org559507f">1.4. Investigating issues</a></li>
</ul>
</li>
<li><a href="#org31b0a6a">2. Standard features</a>
<ul>
<li><a href="#orgb19620a">2.1. Requirements</a>
<ul>
<li><a href="#org50c033c">2.1.1. Fast start</a></li>
<li><a href="#orgc620c7b">2.1.2. Modal editing</a></li>
<li><a href="#org969211d">2.1.3. Text Snippets</a></li>
<li><a href="#orgbcdc722">2.1.4. Inline completion</a></li>
<li><a href="#orgd66f4d1">2.1.5. Automatic indentation</a></li>
<li><a href="#org38751e6">2.1.6. Smart backspace</a></li>
<li><a href="#orga088411">2.1.7. Balanced pairs</a></li>
<li><a href="#orgb2eb2c4">2.1.8. Rich keybindings</a></li>
<li><a href="#orgca3aa38">2.1.9. Useful line numbers</a></li>
<li><a href="#org6ec95b2">2.1.10. Auto-saving</a></li>
<li><a href="#orgc9de44e">2.1.11. Persist frame position and geometry</a></li>
<li><a href="#org86ece3c">2.1.12. Remote editing</a></li>
</ul>
</li>
<li><a href="#org562b12c">2.2. Emacs-only configurations</a>
<ul>
<li><a href="#org5b1cf71">2.2.1. Identity</a></li>
<li><a href="#org5bcbe6a">2.2.2. Dashboard</a></li>
<li><a href="#orgdf3d444">2.2.3. Key modifiers</a></li>
<li><a href="#org82d47ca">2.2.4. Training wheels</a></li>
<li><a href="#orge1541de">2.2.5. Emacs source code</a></li>
<li><a href="#orgd40879b">2.2.6. Line numbers</a></li>
<li><a href="#orgc207004">2.2.7. Indentation</a></li>
<li><a href="#org2153f5c">2.2.8. Line wrapping</a></li>
<li><a href="#org0e3fcb9">2.2.9. Scrolling</a></li>
</ul>
</li>
<li><a href="#org83f9cf4">2.3. Modal editing</a></li>
<li><a href="#orga4bad90">2.4. Text snippets</a></li>
<li><a href="#org63b5f4e">2.5. Inline completion</a></li>
<li><a href="#org36208e3">2.6. Automatic indentation</a></li>
<li><a href="#org747dc7d">2.7. Smart backspace</a></li>
<li><a href="#org3012857">2.8. Balanced pairs</a></li>
<li><a href="#org4491938">2.9. Rich keybindings</a></li>
<li><a href="#orga115a1f">2.10. Useful line numbers</a></li>
<li><a href="#org37816b0">2.11. Auto-Saving</a></li>
<li><a href="#orgad19e9f">2.12. Persist frame position and geometry</a></li>
<li><a href="#org85f38df">2.13. <span class="todo TODO">TODO</span> Remote editing</a></li>
</ul>
</li>
<li><a href="#orgd0e5b26">3. Personal preferences</a>
<ul>
<li><a href="#org8344590">3.1. Evil</a>
<ul>
<li><a href="#org3d50a2e">3.1.1. Evil-MatchIt</a></li>
<li><a href="#orgd3d6e1a">3.1.2. Plus-Minus</a></li>
<li><a href="#org92bdfc0">3.1.3. Evil-String-Inflection</a></li>
</ul>
</li>
<li><a href="#org7077caf">3.2. Keybindings</a>
<ul>
<li><a href="#org54e027d">3.2.1. Window navigation</a></li>
<li><a href="#org1f1b823">3.2.2. Vim defaults</a></li>
<li><a href="#org1f72307">3.2.3. Personal shortcuts</a></li>
</ul>
</li>
<li><a href="#org9b1d559">3.3. Appearances</a>
<ul>
<li><a href="#orgb8a4d8e">3.3.1. Frame</a></li>
<li><a href="#org8665a3a">3.3.2. Editor</a></li>
<li><a href="#org1925b1a">3.3.3. Theme</a></li>
<li><a href="#orgc69c5cd">3.3.4. Typography</a></li>
<li><a href="#org3f28c8d">3.3.5. Iconography</a></li>
</ul>
</li>
<li><a href="#orgc7abdc5">3.4. Editor Tabs</a>
<ul>
<li><a href="#org8cbc4c2">3.4.1. Tab actions</a></li>
<li><a href="#orgabfbca4">3.4.2. Windows</a></li>
</ul>
</li>
<li><a href="#org2ba7082">3.5. Special modes</a>
<ul>
<li><a href="#orgdd1ea81">3.5.1. Info mode</a></li>
<li><a href="#org557868b">3.5.2. Help mode and Man mode</a></li>
<li><a href="#orge6f9cf3">3.5.3. Rainbow mode</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgf4d224a">4. Temporary workarounds</a>
<ul>
<li><a href="#orgacfad41">4.1. <span class="todo TODO">TODO</span> Completion framework</a>
<ul>
<li><a href="#org1891f24">4.1.1. Filtering and highlighting</a></li>
<li><a href="#org9680082">4.1.2. Sorting</a></li>
<li><a href="#org9d58d21">4.1.3. Candidates annotations</a></li>
<li><a href="#orgb338d30">4.1.4. Completion UI</a></li>
<li><a href="#orgfac8863">4.1.5. Contextual Menu</a></li>
<li><a href="#org6808766">4.1.6. Extra commands</a></li>
<li><a href="#orgd795b20">4.1.7. Change Doom&rsquo;s behavior</a></li>
</ul>
</li>
<li><a href="#org29cc02c">4.2. <span class="todo TODO">TODO</span> Workspaces</a>
<ul>
<li><a href="#org63a17eb">4.2.1. Display tab bar</a></li>
<li><a href="#orga1f3695">4.2.2. Switch workspace</a></li>
<li><a href="#org37b967a">4.2.3. Switch to N<sup>th</sup> workspace</a></li>
<li><a href="#org613fdd2">4.2.4. Switch to final workspace</a></li>
<li><a href="#org82a9694">4.2.5. Switch to last used workspace</a></li>
<li><a href="#orgbba2965">4.2.6. Previous and next workspace</a></li>
<li><a href="#org034ec8f">4.2.7. New workspace</a></li>
<li><a href="#orga59a16c">4.2.8. Rename workspace</a></li>
<li><a href="#org61019da">4.2.9. Delete this workspace</a></li>
<li><a href="#orgb40ac3f">4.2.10. Delete session</a></li>
<li><a href="#org91b5b2e">4.2.11. Delete session and quit</a></li>
<li><a href="#org88fd201">4.2.12. Save session to file</a></li>
<li><a href="#org545ea73">4.2.13. Load session from file</a></li>
<li><a href="#org0c2d0a1">4.2.14. Restore last session</a></li>
<li><a href="#org5570c94">4.2.15. Other shortcuts</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org0ac477e">5. Writing</a>
<ul>
<li><a href="#org5b79e86">5.1. <span class="todo TODO">TODO</span> Requirements</a></li>
<li><a href="#org8495c71">5.2. <span class="todo TODO">TODO</span> Common Org configurations</a></li>
<li><a href="#orgc7921ec">5.3. <span class="todo TODO">TODO</span> Prose writing</a>
<ul>
<li><a href="#org3b8d6d2">5.3.1. Dictionary and writing helpers</a></li>
<li><a href="#orgf419a2b">5.3.2. Templates</a></li>
<li><a href="#orgea7d2a9">5.3.3. Focus Writing</a></li>
<li><a href="#org294ee17">5.3.4. Snippets</a></li>
</ul>
</li>
<li><a href="#org5652e49">5.4. <span class="todo TODO">TODO</span> Reading or reviewing</a></li>
<li><a href="#orgd0bcd72">5.5. <span class="todo TODO">TODO</span> Publishing</a></li>
<li><a href="#orga6bfb2f">5.6. <span class="todo TODO">TODO</span> Presenting</a></li>
<li><a href="#orgb6f7b16">5.7. <span class="todo TODO">TODO</span> Note Taking</a>
<ul>
<li><a href="#orgb61f824">5.7.1. Capturing</a></li>
<li><a href="#org05e33df">5.7.2. Journal</a></li>
<li><a href="#org34cd684">5.7.3. Zettelkasten</a></li>
<li><a href="#org00c9305">5.7.4. Deft</a></li>
<li><a href="#org9a069e0">5.7.5. Utilities</a></li>
</ul>
</li>
<li><a href="#org212c046">5.8. <span class="todo TODO">TODO</span> Other modes</a>
<ul>
<li><a href="#orgea0f71f">5.8.1. Markdown</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org077a878">6. Development</a>
<ul>
<li><a href="#orgc863084">6.1. <span class="todo TODO">TODO</span> Requirements</a></li>
<li><a href="#org201124a">6.2. <span class="todo TODO">TODO</span> Common configuration</a>
<ul>
<li><a href="#org0d9f6e2">6.2.1. Version control system</a></li>
<li><a href="#orged8a9c4">6.2.2. Comments</a></li>
</ul>
</li>
<li><a href="#org68c4d31">6.3. <span class="todo TODO">TODO</span> Lisp</a></li>
<li><a href="#org54129d9">6.4. <span class="todo TODO">TODO</span> Shell script</a></li>
<li><a href="#org151d800">6.5. <span class="todo TODO">TODO</span> Python</a></li>
<li><a href="#orgccdb470">6.6. <span class="todo TODO">TODO</span> Ansible</a></li>
<li><a href="#org2e55b98">6.7. <span class="todo TODO">TODO</span> Javascript/TypeScript</a></li>
<li><a href="#orgeac7e20">6.8. <span class="todo TODO">TODO</span> C/C++</a></li>
<li><a href="#org69880f7">6.9. <span class="todo TODO">TODO</span> Swift</a></li>
<li><a href="#org1819cfc">6.10. <span class="todo TODO">TODO</span> Kotlin</a></li>
<li><a href="#orgb17754f">6.11. <span class="todo TODO">TODO</span> Java</a></li>
</ul>
</li>
<li><a href="#orgf30b36a">7. Non-editor features</a>
<ul>
<li><a href="#org147e4d1">7.1. <span class="todo TODO">TODO</span> Requirements</a></li>
<li><a href="#org11c04e2">7.2. <span class="todo TODO">TODO</span> File management</a></li>
<li><a href="#org41f3367">7.3. <span class="todo TODO">TODO</span> Project management</a></li>
<li><a href="#org2532915">7.4. <span class="todo TODO">TODO</span> Terminal</a></li>
<li><a href="#org2f7d786">7.5. <span class="todo TODO">TODO</span> Emails</a></li>
<li><a href="#org6104f70">7.6. <span class="todo TODO">TODO</span> Calendars</a></li>
<li><a href="#orgec572b9">7.7. <span class="todo TODO">TODO</span> Contacts</a></li>
<li><a href="#org1e0232a">7.8. <span class="todo TODO">TODO</span> Time Management</a></li>
</ul>
</li>
<li><a href="#org53c0602">8. Appendix</a>
<ul>
<li><a href="#org470541e">8.1. The <code>init.el</code> file</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org7a74285" class="outline-2">
<h2 id="org7a74285"><span class="section-number-2">1</span> Prologue</h2>
<div class="outline-text-2" id="text-1">
<p>
Hello there! Thanks for checking my Emacs configuration. I decided to go with a literate configuration to try to contribute back to this community that is always available to help me when I have any question about Emacs.
</p>

<p>
This configuration uses <a href="https://github.com/hlissner/doom-emacs">Doom Emacs</a> (from now on, referred as Doom) as its base, so, my suggestion to you is to get familiarized with it <b>before</b> diving deep into this configuration (a good starting point is the <a href="https://github.com/hlissner/doom-emacs/blob/develop/docs/getting_started.org">Getting Started</a> page on the official repository), there will be options, functions, and variables I will use without much explanation, because they&rsquo;re some sort of <i>common knowledge</i> in the Doom&rsquo;s community.
</p>

<p>
Also, when you install Doom for the first time, it creates the <code>config.el</code> and <code>packages.el</code> files for you, containing some useful doc-strings there. In this version of my configuration, I will try to include as much of those comments as possible in the form of <i>free text</i>, so I want you to remember that I didn&rsquo;t come up with those words, some folks much smarter than me did, so feel free to <a href="https://liberapay.com/hlissner">thank</a> the Doom&rsquo;s <a href="https://paypal.me/henriklissner">creator</a>.
</p>

<div class="note" id="org4fb5a22">
<p>
In your journey configuring Emacs the way you want, you might need to use more functions then I&rsquo;m using in this configuration. Here are some additional functions or macros that could help you configure Doom:
</p>

<ul class="org-ul">
<li><code>load!</code> for loading external <code>*.el</code> files relative to <code>$DOOMDIR/config.el</code>;</li>
<li><code>use-package!</code> for configuring packages;</li>
<li><code>after!</code> for running code after a package has loaded;</li>
<li><code>add-load-path!</code> for adding directories to the <code>load-path</code>, relative to <code>$DOOMDIR/config.el</code>. Emacs searches the <code>load-path</code> when you load packages with <code>require</code> or <code>use-package</code>;</li>
<li><code>map!</code> for binding new keys;</li>
</ul>

<p>
To get information about any of these functions or macros, move the cursor over the highlighted symbol at press &rsquo;<code>K</code>&rsquo; (non-evil users must press &rsquo;<code>C-c g k</code>&rsquo;). This will open documentation for it, including demos on how to use them.
</p>

<p>
You can also try &rsquo;<code>gd</code>&rsquo; (or &rsquo;<code>C-c g d</code>&rsquo;) to jump to their definition and see their source code.
</p>

</div>
</div>

<div id="outline-container-org596a64f" class="outline-3">
<h3 id="org596a64f"><span class="section-number-3">1.1</span> About this document</h3>
<div class="outline-text-3" id="text-1-1">
<p>
The organization of my Emacs configuration tries to structure the design and build of a text editor tailored for my needs.
</p>

<p>
Some of these needs are technology related (e.g. programming languages, diagrams tooling, etc.), while others are aesthetic or productivity related.
</p>

<p>
I want to stress out to the reader, that you are, ultimately, reading a personal opinion, and what works for me may or may not work for you.
</p>

<p>
I intend to start with features I consider common to any text editor, then, I&rsquo;ll go into some personal preferences, still related to text editor in general. Once I&rsquo;m done with the common features, I&rsquo;ll configure Emacs for writing prose. I decided to do all my prose writing using <a href="https://orgmode.org/">Org Mode</a>, so I will focus the configuration at that point, to adjust Emacs and Org to fit my personal workflow.
</p>

<p>
After configuring Emacs for writing prose, I will focus this document on programming (which is what I do for work). I will cover <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/">Emacs Lisp</a>, <a href="https://www.javascript.com/">Javascript</a>/<a href="https://www.typescriptlang.org/">Typescript</a>, <a href="https://kotlinlang.org/">Kotlin</a>, <a href="https://www.python.org/">Python</a>, <a href="https://www.shellscript.sh/">Shell Script</a>, and <a href="https://developer.apple.com/swift/">Swift</a>. Some in more details then others, but at a minimum, I want Emacs to open files of those languages without errors or wrong syntax highlight.
</p>

<p>
Overall, my intention is to make changes on Doom and core Emacs to get consistent keybindings and behaviors, so that when you learn to use one part of my configuration, you will feel comfortable on the other parts.
</p>
</div>
</div>

<div id="outline-container-org927fc4a" class="outline-3">
<h3 id="org927fc4a"><span class="section-number-3">1.2</span> About literate configuration</h3>
<div class="outline-text-3" id="text-1-2">
<p>
A long time ago I found out about <a href="http://literateprogramming.com">Literate Programming</a> when I read my first Emacs configuration with Org Mode. It was the <a href="https://pages.sachachua.com/.emacs.d/Sacha.html">Emacs configuration</a> of <a href="https://sachachua.com/blog/about/">Sacha Chua</a>, which I have to say, it was a fantastic reading. I tried couple times to do the same with past configurations without much success.
</p>

<p>
I believe the mentality shift happened when I finally decided to read the original paper about <a href="http://literateprogramming.com/knuthweb.pdf">Literate Programming</a> by <a href="https://www-cs-faculty.stanford.edu/~knuth/">Donald E. Knuth</a>, and just like that, I want to practice Literate Programming on about everything I do.
</p>

<p>
Since this document is about a text editor configuration, I have to highlight couple differences between Mr. Knuth&rsquo;s Literate Programming and my Literate Configuration.
</p>

<p>
The core difference, is the fact that each piece of code in this document may not be a self contained snippet. When I find appropriate, I will split big block of code into multiples blocks separated by text used to explain the rational behind the snippet in question. So, if you&rsquo;re following this document and copying some snippets, make sure you include the <i>close parenthesis</i> that these split sections contain.
</p>
</div>
</div>

<div id="outline-container-orgfdd5b57" class="outline-3">
<h3 id="orgfdd5b57"><span class="section-number-3">1.3</span> Acknowledgments</h3>
<div class="outline-text-3" id="text-1-3">
<p>
Besides the already mentioned <a href="https://sachachua.com/blog/about/">Sacha Chua</a>, I would also like to thank Timothy (a.k.a. <a href="https://github.com/tecosaur">tecosaur</a>) for his wonderful literate config. I would be lying if I said <a href="https://www.gitmemory.com/tecosaur">tecosaur</a> was not one of the big reasons for me to give it a second try on my literate config, so thank you mate! Feel free to say that this configuration is a byproduct of yours.
</p>

<p>
I would also like to thank <a href="https://github.com/gongzhitaao">Zhitao Gong</a> for the amazing theme I&rsquo;m using in this publication, it&rsquo;s called <a href="https://github.com/gongzhitaao/orgcss">OrgCSS</a> and you should definitely check it out. If you try <a href="https://github.com/gongzhitaao">Zhitao Gong</a>&rsquo;s theme and it does not look like this, you can use my extra modification by adding the following on your Org preamble:
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="font-weight: bold; font-style: italic;">#+setupfile: <a href="https://townk.github.io/doom-emacs-private/assets/html-export.setup">https://townk.github.io/doom-emacs-private/assets/html-export.setup</a></span>
</pre>
</div>

<p>
Last, but not least, I like to give a shout to <a href="https://github.com/justinbondoc">Justin Bondoc</a> for his CSS tutorial on &ldquo;<a href="https://www.madcapsoftware.com/blog/css-tip-creating-styled-boxes-notes-warnings-examples-tips/">Creating Styled Boxes for Notes, Warnings, Examples, and Tips</a>&rdquo;. You will notice that I not only got his CSS here, but also his icons for the note and warning boxes!
</p>
</div>
</div>

<div id="outline-container-org559507f" class="outline-3">
<h3 id="org559507f"><span class="section-number-3">1.4</span> Investigating issues</h3>
<div class="outline-text-3" id="text-1-4">
<p>
If you, like me, try new things with your config until it breaks, is important that we have some tools to help us figure out what is going on. Regardless if you&rsquo;ll use this configuration <i>ipsis litteris</i>, or start yours from scratch, and copy the tidbits that may interest you. Before you start know these things:
</p>

<p>
To get a better sense of what is going on, start Emacs from terminal with the <code>--debug-init</code> flag:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 1: </span>Command to start emacs in debug mode</label><pre class="src src-shell">emacs --debug-init
</pre>
</div>

<p>
This will stop Emacs on the first error and print the stack trace for it. As of now, this might not useful beyond reporting bugs, nevertheless, it&rsquo;s important you keep it in your mind!
</p>

<p>
Another issue that may show up, is slowness, specially after adding packages. This is not uncommon since Emacs startup time is sensible to package loading.
</p>

<p>
What I recommend to do, is to install a package that specializes on benchmarking, and use it, when you have the need:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 2: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">package!</span> benchmark-init)
</pre>
</div>

<p>
Check my <code>init.el</code> file on the <a href="#org53c0602">Appendix</a>, to see how I hook up benchmarking to the <code>--debug-init</code> flag.
</p>

<p>
After starting Emacs with the <code>--debug-init</code> flag, you can check the call tree with the <code>M-x benchmark-init/show-durations-tree</code> command.
</p>
</div>
</div>
</div>

<div id="outline-container-org31b0a6a" class="outline-2">
<h2 id="org31b0a6a"><span class="section-number-2">2</span> Standard features</h2>
<div class="outline-text-2" id="text-2">
<p>
Before jumping in the configuration itself, I like to describe what I&rsquo;m trying to achieve on each section, so the reader don&rsquo;t feel lost. Also, by defining good requirements, this document may help someone else to achieve similar results with different editors. If you are among the crazies that besides liking my choices, decided to port this to other editor, drop me a line, I&rsquo;ll be more than happy to link your document here.
</p>
</div>

<div id="outline-container-orgb19620a" class="outline-3">
<h3 id="orgb19620a"><span class="section-number-3">2.1</span> Requirements</h3>
<div class="outline-text-3" id="text-2-1">
<p>
As mentioned on section <a href="#org596a64f">1.1</a>, this part of the document will deal with configurations and functionalities that I consider as essential on any text editor, from IDEs to editors like <a href="https://en.wikipedia.org/wiki/Microsoft_Notepad">Notepad</a>, even though they&rsquo;re not present in all editors.
</p>
</div>

<div id="outline-container-org50c033c" class="outline-4">
<h4 id="org50c033c"><span class="section-number-4">2.1.1</span> Fast start</h4>
<div class="outline-text-4" id="text-2-1-1">
<p>
Although this seams like the biggest <i>no-brainer</i> of my requirements, it would be funny if was not sad the fact that Emacs is the worst in this category when loaded with plugins (from here on, referred as <i>packages</i>) compared to editors of the same caliber (e.g. <a href="https://www.vim.org/">Vim</a>, <a href="https://www.sublimetext.com">Sublime Text</a>, <a href="https://code.visualstudio.com/">Visual Studio Code</a>, etc.). I personally believe that Emacs compensate with its power, nevertheless, I still want to have an editor that opens on a snap when I need.
</p>

<p>
By default, Doom starts a fresh emacs process fast, but it take its sweet time to open a buffer depending on the buffer&rsquo;s type and the amount of packages you have available. For sake of being able to have a functional editor with all my requirements, I will say that I have just the requirement of starting it in less than 1.8 seconds. Eventually I will address the other part of this equation (probably using <code>emacsclient</code> or some type of memory snapshot).
</p>
</div>
</div>

<div id="outline-container-orgc620c7b" class="outline-4">
<h4 id="orgc620c7b"><span class="section-number-4">2.1.2</span> Modal editing</h4>
<div class="outline-text-4" id="text-2-1-2">
<p>
I need to come clean to the reader about my past experiences with text editors. I&rsquo;m a <i>die-hard</i> Vim user, even though I&rsquo;m not using Vim for some tim now. Nevertheless, I personally believe that modal editing is far superior way to use a text editor than any other alternative, and that is why I consider <i>modal editing</i>, a feature that any text editor should have.
</p>
</div>
</div>

<div id="outline-container-org969211d" class="outline-4">
<h4 id="org969211d"><span class="section-number-4">2.1.3</span> Text Snippets</h4>
<div class="outline-text-4" id="text-2-1-3">
<p>
Although I&rsquo;m not an avid user of snippets, I believe they&rsquo;re a fundamental part of modern editors. Without them, I have to resort to some book keeping method to save interesting coding snippets. So, I consider snippets a base requirement for my editor.
</p>
</div>
</div>

<div id="outline-container-orgbcdc722" class="outline-4">
<h4 id="orgbcdc722"><span class="section-number-4">2.1.4</span> Inline completion</h4>
<div class="outline-text-4" id="text-2-1-4">
<p>
Also know as <i>intellisence</i>, or <i>code complete</i> in other editors and IDEs, <i>at-point completion</i> are those popups that show up when you type, with possible completions for what you&rsquo;re doing. My editor should also offer such feature, but it must play well with modal editing (if I leave the <i>Insert Mode</i> the popup should close), and snippets (snippet expansion keywords have precedence over skipping to the next line with the <code>&lt;TAB&gt;</code> key).
</p>
</div>
</div>

<div id="outline-container-orgd66f4d1" class="outline-4">
<h4 id="orgd66f4d1"><span class="section-number-4">2.1.5</span> Automatic indentation</h4>
<div class="outline-text-4" id="text-2-1-5">
<p>
Here I&rsquo;m not talking about indent after pressing &rsquo;<code>RET</code>&rsquo;. I&rsquo;m talking about re-indenting the file as I change it. On the Emacs world, this is also known as <i>electric indent</i>.
</p>

<p>
I understand that in some occasions this process may slow down the editor, so I will define here that I want the whole indentation to change when I change the total number of lines on the file.
</p>
</div>
</div>

<div id="outline-container-org38751e6" class="outline-4">
<h4 id="org38751e6"><span class="section-number-4">2.1.6</span> Smart backspace</h4>
<div class="outline-text-4" id="text-2-1-6">
<p>
When I&rsquo;m editing a file (usually a source code), in some scenarios, the editor helps me out by inserting text that I want. One example of this is the closing pair character. If I type a &rsquo; <code>"</code> &rsquo;, Doom will add a second one after my cursor. In most of the scenarios, to revert what just happened, I press <code>&lt;BACKSPACE&gt;</code>, and I get the same state I was before pressing the key that generated the completion.
</p>

<p>
But there is one case where this does not happen, which is when Doom adds a paired new line when I press <code>&lt;ENTER&gt;</code> after open a pair. The net effect of this completion, is to have the cursor on the next line, indented correctly. But when I immediately press <code>&lt;BACKSPACE&gt;</code>, Doom deletes the indentation and that&rsquo;s it.
</p>

<p>
This requirement, is to make sure the <code>&lt;BACKSPACE&gt;</code> key behaves in the same way when we use it after a completion.
</p>
</div>
</div>

<div id="outline-container-orga088411" class="outline-4">
<h4 id="orga088411"><span class="section-number-4">2.1.7</span> Balanced pairs</h4>
<div class="outline-text-4" id="text-2-1-7">
<p>
The common behavior you might see on text editors is to complete a character pair as you type. For instance, if you type an open parenthesis, the editor would insert the closing one automatically, and if you press the closing parenthesis, the editor would simply move the cursor to the right of the already inserted close parenthesis character.
</p>

<p>
My requirement is to my editor to keep any of these character pairs balanced. If I try to delete a line with a closing pair character that would make the pairs of such character unbalanced, the editor would delete the line content, but would leave the closing character for the pair, preventing the file from getting on an unbalanced state.
</p>
</div>
</div>

<div id="outline-container-orgb2eb2c4" class="outline-4">
<h4 id="orgb2eb2c4"><span class="section-number-4">2.1.8</span> Rich keybindings</h4>
<div class="outline-text-4" id="text-2-1-8">
<p>
Any half-decent text editor these days supports an infinite plethora of shortcuts. What I believe an editor should support to be ahead of the game, is the ability to bind <b>any</b> editor action to a key, and to offer to the user some sort of guidance while one uses the editor.
</p>

<p>
For instance, if you configure your editor to search for files when you press &rsquo;<code>SPC f f</code>&rsquo;, when you press &rsquo;<code>SPC f</code>&rsquo; and wait, I want the editor to display all the possible options for you to complete your key sequence.
</p>
</div>
</div>

<div id="outline-container-orgca3aa38" class="outline-4">
<h4 id="orgca3aa38"><span class="section-number-4">2.1.9</span> Useful line numbers</h4>
<div class="outline-text-4" id="text-2-1-9">
<p>
I like the text editor to show me line numbers when they mater, and when they do, I like to get the most of them. This requirement is to make sure that line numbers are aware of the modal editing, so when I&rsquo;m on <i>normal mode</i> with line numbers visible, the editor should show me lines as relative numbers, and when I&rsquo;m editing the file (in <i>insert mode</i>), the line numbers should be absolute.
</p>
</div>
</div>

<div id="outline-container-org6ec95b2" class="outline-4">
<h4 id="org6ec95b2"><span class="section-number-4">2.1.10</span> Auto-saving</h4>
<div class="outline-text-4" id="text-2-1-10">
<p>
I want to stop saving my files. Any editor has substantial number of undo actions, and Doom even allow me to save the undo history across sessions. Because of that, I want my editor to save files I&rsquo;m editing from time to time and on special events like switching to a different app, or a different buffer.
</p>
</div>
</div>

<div id="outline-container-orgc9de44e" class="outline-4">
<h4 id="orgc9de44e"><span class="section-number-4">2.1.11</span> Persist frame position and geometry</h4>
<div class="outline-text-4" id="text-2-1-11">
<p>
I move my editor all around my desktop, and I resize it just as much, do I&rsquo;m not particular to any specific size or position it should be, but if I turn it off, the next time I decide to open it, I expect it to be in the same place, and with the same size I defined on the last time I&rsquo;ve open it.
</p>
</div>
</div>

<div id="outline-container-org86ece3c" class="outline-4">
<h4 id="org86ece3c"><span class="section-number-4">2.1.12</span> Remote editing</h4>
<div class="outline-text-4" id="text-2-1-12">
<p>
I want my text editor to edit remote files seamlessly, and by remote, I mean not in the same Operating System where the editor is running. This also include containers like Docker.
</p>

<p>
I also want my text editor to allow me to start this remote editing by picking a server and a remote editor, so it can create a remote <i>project</i> for me to explore.
</p>
</div>
</div>
</div>

<div id="outline-container-org562b12c" class="outline-3">
<h3 id="org562b12c"><span class="section-number-3">2.2</span> Emacs-only configurations</h3>
<div class="outline-text-3" id="text-2-2">
<p>
This section will cover some changes I like to do on the Emacs (or Doom) default behavior, and some required settings to make sure Emacs have all the information it needs to function properly.
</p>
</div>

<div id="outline-container-org5b1cf71" class="outline-4">
<h4 id="org5b1cf71"><span class="section-number-4">2.2.1</span> Identity</h4>
<div class="outline-text-4" id="text-2-2-1">
<p>
It&rsquo;s important we let Emacs know who we are, and also, according to Doom&rsquo;s comments on the sample <code>config.el</code> available upon installation, some functionality uses this identification (e.g. GPG configuration, email clients, file templates and snippets).
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 3: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">user-full-name</span> <span style="font-style: italic;">"Thiago Alves"</span>
      <span style="font-weight: bold; font-style: italic;">user-mail-address</span> <span style="font-style: italic;">"thiago@rapinialves.com"</span>)
</pre>
</div>

<p>
I also like to have a variable holding the value of my email&rsquo;s host name:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 4: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">user-domain</span> (<span style="font-weight: bold;">cadr</span> (<span style="font-weight: bold;">split-string</span> <span style="font-weight: bold; font-style: italic;">user-mail-address</span> <span style="font-style: italic;">"@"</span>))
  <span style="font-style: italic;">"Holds the user's personal domain. By default, this variable is</span>
<span style="font-style: italic;">  the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">user-email-address</span><span style="font-style: italic;">' host."</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org5bcbe6a" class="outline-4">
<h4 id="org5bcbe6a"><span class="section-number-4">2.2.2</span> Dashboard</h4>
<div class="outline-text-4" id="text-2-2-2">
<p>
Doom Emacs offers a lightweight dashboard, that serves as the landing page for Emacs.
</p>

<p>
I really like the idea of a dashboard and I like even more what Doom offers, but, the ASCII art for its logo is not something I&rsquo;m affectionate with.
</p>

<p>
In order to replace the ASCII art with something more pleasant and thematic, I like to add a small picture on the dashboard:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 5: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">+doom-dashboard-banner-dir</span> (<span style="font-weight: bold; text-decoration: underline;">expand-file-name</span> <span style="font-style: italic;">"assets"</span> <span style="font-weight: bold; font-style: italic;">doom-private-dir</span>)
      <span style="font-weight: bold; font-style: italic;">+doom-dashboard-banner-file</span> <span style="font-style: italic;">"doom.png"</span>
      <span style="font-weight: bold; font-style: italic;">+doom-dashboard-banner-padding</span> <span style="font-weight: bold;">'</span>(<span style="font-weight: bold; text-decoration: underline;">0</span> . <span style="font-weight: bold; text-decoration: underline;">4</span>))
</pre>
</div>

<p>
I love the style of this image so much, that it is, besides my dashboard image, my Emacs icon as well. The author of this beauty is <a href="https://github.com/eccentric-j/doom-icon">Jay Zawrotny</a>, feel free to send him an accolade!
</p>

<div class="org-center">

<div id="orgc333c71" class="figure">
<p><img src="./assets/doom.png" alt="doom.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgdf3d444" class="outline-4">
<h4 id="orgdf3d444"><span class="section-number-4">2.2.3</span> Key modifiers</h4>
<div class="outline-text-4" id="text-2-2-3">
<p>
Since I use a Mac as my primary computer, I need to adjust its control keys to match a good set of control keys on Emacs:
</p>

<table id="org1ef8e60" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 1:</span> macOS key mappings</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">macOS Key</th>
<th scope="col" class="org-left">Emacs Key</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">⌘ (cmd)</td>
<td class="org-left">&rsquo;super</td>
</tr>

<tr>
<td class="org-left">⌃ (ctrl)</td>
<td class="org-left">&rsquo;control</td>
</tr>

<tr>
<td class="org-left">⌥ (option)</td>
<td class="org-left">&rsquo;meta</td>
</tr>
</tbody>
</table>

<p>
Emacs expose three variables to allow you to make these adjustments:
</p>

<ul class="org-ul">
<li><code>mac-command-modifier</code></li>
<li><code>mac-control-modifier</code></li>
<li><code>mac-option-modifier</code></li>
</ul>

<p>
To adjust this values according to table <a href="#org1ef8e60">1</a>, set each one of them to the symbol described on the column <code>Emacs Key</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 6: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> mac-command-modifier <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">super</span>
      mac-control-modifier <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">control</span>
      mac-option-modifier  <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">meta</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org82d47ca" class="outline-4">
<h4 id="org82d47ca"><span class="section-number-4">2.2.4</span> Training wheels</h4>
<div class="outline-text-4" id="text-2-2-4">
<p>
By default, Emacs prevent you from executing certain <i>dangerous</i> commands inadvertently. While I understand and sympathize with the need of such feature, I personally prefer to turn it off.
</p>

<p>
To change this option, set the variable <code>disabled-command-function</code> to <code>nil</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 7: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">disabled-command-function</span> nil)
</pre>
</div>

<p>
On Emacs, you can set variables when open files, we call those <a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Specifying-File-Variables.html">File Variables</a>. There are occasions I want to execute some arbitrary code when I open a file. To do that, I would add a file variable called <code>eval</code>, and pass my arbitrary code to it. As you can imagine, this is a dangerous features, so I have to give you the standard disclaimer:
</p>

<div class="warning" id="org30ed6be">
<p>
The next configuration can lead to Emacs executing malicious code upon opening a file. By allowing Emacs to enable local <code>eval</code> you gain some nice ways to configure Emacs per file, on the cost of a high risk of vulnerability, so&#x2026; think a little bit about how do you indiscriminately open files on your editor before enabling this one.
</p>

</div>

<p>
To enable Emacs to use <code>eval</code> as a file variable, set the variable <code>enable-local-eval</code> to a non-<code>nil</code> value:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 8: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">enable-local-eval</span> t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orge1541de" class="outline-4">
<h4 id="orge1541de"><span class="section-number-4">2.2.5</span> Emacs source code</h4>
<div class="outline-text-4" id="text-2-2-5">
<p>
Emacs documentation system is fantastic! It allows you to inspect any value, binding or function on the fly, and it displays the source code for of any callable together with its documentation.
</p>

<p>
For some of the Emacs functions, such source code is a <i>C</i> function from its core code, and by default, Emacs does not knows where to look for its own source code.
</p>

<p>
To help Emacs to find its own source code, first clone it from the Emacs <a href="https://git.savannah.gnu.org/git/emacs.git">repository</a>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 9: </span>Commands to clone Emacs to local directory</label><pre class="src src-shell"><span style="font-weight: bold; text-decoration: underline;">mkdir</span> -p ~/workplace/vendor/gnu
<span style="font-weight: bold; text-decoration: underline;">cd</span> ~/workplace/vendor/gnu
<span style="font-weight: bold; text-decoration: underline;">git</span> clone https://git.savannah.gnu.org/git/emacs.git
</pre>
</div>

<p>
Then, set the variable <code>source-directory</code> to the cloned repository&rsquo;s path:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 10: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">source-directory</span> (<span style="font-weight: bold; text-decoration: underline;">concat</span> (<span style="font-weight: bold;">getenv</span> <span style="font-style: italic;">"HOME"</span>) <span style="font-style: italic;">"/workplace/vendor/gnu/emacs"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd40879b" class="outline-4">
<h4 id="orgd40879b"><span class="section-number-4">2.2.6</span> Line numbers</h4>
<div class="outline-text-4" id="text-2-2-6">
<p>
I like to have line numbers displayed on the side of any source code I edit, but I don&rsquo;t like them everywhere (e.g. during prose writing), so I always make them turned off by default, and let the appropriate modes to set them on when they needed it:
</p>

<p>
To disable line numbers by default, set the variable <code>display-line-numbers-type</code> to <code>nil</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 11: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq-default</span> <span style="font-weight: bold; font-style: italic;">display-line-numbers-type</span> nil)
</pre>
</div>

<p>
Notice I used the function <code>setq-default</code> here. It tells Emacs that if a buffer uses a local version of it, it always starts with the given value.
</p>

<p>
When Emacs is showing line numbers, it do so on the window&rsquo;s left <i>gutter</i>. To save some screen space, Emacs only reserves only the necessary space on its gutter, to display the biggest visible line number. I believe this behavior disrupts the user experience when I scroll from line 99 to 100 and back. The visual effect is the editor screen moving right and left as I scroll.
</p>

<p>
It would be incredible inefficient to read the entire file just to check what is the biggest line number, so we can instruct Emacs do the second best thing: to only grow the gutter&rsquo;s size, and never shrink it.
</p>

<p>
To have such configuration, set the variable <code>display-line-numbers-grow-only</code> to a non-<code>nil</code> value:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 12: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq-default</span> <span style="font-weight: bold; font-style: italic;">display-line-numbers-grow-only</span> t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc207004" class="outline-4">
<h4 id="orgc207004"><span class="section-number-4">2.2.7</span> Indentation</h4>
<div class="outline-text-4" id="text-2-2-7">
<p>
On this section, I will ask the reader to disagree on disagree, and set aside the almost religious subject of tabs versus spaces.
</p>

<p>
I prefer to always indent my files with <code>4</code> spaces with some rare exceptions for certain languages. To make Emacs use <code>4</code> spaces to indent by default, set the variable <code>tab-width</code> to <code>4</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 13: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq-default</span> <span style="font-weight: bold; font-style: italic;">tab-width</span> <span style="font-weight: bold; text-decoration: underline;">4</span>)
</pre>
</div>

<p>
And to force emacs to always use spaces instead of tabs, set the <code>indent-tabs-mode</code> variable to <code>nil</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 14: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq-default</span> <span style="font-weight: bold; font-style: italic;">indent-tabs-mode</span> nil)
</pre>
</div>
</div>
</div>

<div id="outline-container-org2153f5c" class="outline-4">
<h4 id="org2153f5c"><span class="section-number-4">2.2.8</span> Line wrapping</h4>
<div class="outline-text-4" id="text-2-2-8">
<p>
Until the writing of this document, I had the opinion that <i>soft wrap</i> was evil, and it had no place on any editor. Since then, I learned to appreciate <i>soft wrap</i> for prose, and later in this document, you will see all the other setup around <i>soft wrap</i> and have an idea why I was so against it.
</p>

<p>
To prevent Emacs from wrapping your text as it goes over the size of thee screen, set the variable <code>truncate-lines</code> to a non-<code>nil</code> value:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 15: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq-default</span> <span style="font-weight: bold; font-style: italic;">truncate-lines</span> t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org0e3fcb9" class="outline-4">
<h4 id="org0e3fcb9"><span class="section-number-4">2.2.9</span> Scrolling</h4>
<div class="outline-text-4" id="text-2-2-9">
<p>
One of my biggest gripes over Emacs is how it handles scrolling. Besides the slowness, the entire behavior is just bonkers. For me, the logical way to deal with scrolling, is to move the screen only when we move the cursor outside of it, and the editor should only move the screen by the value of current line number minus bottom line when user is going <i>down</i> the text.
</p>

<p>
To make Emacs not jump then necessary when cursor goes outside the screen, set the <code>scroll-conservatively</code> to a big number (bigger then the number of lines your display can show):
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 16: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq scroll-conservatively most-positive-fixnum)</span>
(<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">scroll-margin</span> <span style="font-weight: bold; text-decoration: underline;">3</span>
      <span style="font-weight: bold; font-style: italic;">scroll-conservatively</span> <span style="font-weight: bold; text-decoration: underline;">1000</span>
      <span style="font-weight: bold; font-style: italic;">scroll-up-aggressively</span> <span style="font-weight: bold; text-decoration: underline;">0.001</span>
      <span style="font-weight: bold; font-style: italic;">scroll-down-aggressively</span> <span style="font-weight: bold; text-decoration: underline;">0.001</span>)
</pre>
</div>

<p>
By default, Emacs will move the cursor with the text as you scroll, but only until the edge of the screen. When the cursor reaches the edge, it will stay there as you keep scrolling. This behavior presents an anti-pattern for usability. When I decide to scroll my buffer with the mouse wheel, I&rsquo;m generally looking at the screen, around the area where the cursor is. If the cursor moves up or down from its position, my eyes lose track of it, and I will assume, it stayed with its original position as I scroll. If I decide to get back writing, my expectation is to just start typing, because the cursor should be on its previous position, but if I do this, I will start typing on the wrong part of the text.
</p>

<p>
After some lookup, I believe Emacs does not support such feature yet, so I decided to go with the best alternative for usability, which is to not move the cursor from its screen position at all. This way, my eyes will keep track of its position as I scroll, and I won&rsquo;t have any surprises as I type.
</p>

<p>
To prevent Emacs from moving the cursor up to the edge of the screen, set the variable <code>scroll-preserve-screen-position</code> to a non-<code>nil</code> value, and if you want this behavior to be the same for horizontal and vertical scroll, set it to a non-<code>nil</code> and non-<code>t</code> value:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 17: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">scroll-preserve-screen-position</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">always</span>)
</pre>
</div>

<p>
To fine tune my scroll, I like to have a bit of room between my cursor and the edge of the screen when I navigate the buffer using the keyboard.
</p>

<p>
To add a margin on your cursor as it gets on the edge of the screen, set the variable <code>scroll-margin</code> to the number of lines you want to always keep visible:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 18: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">scroll-margin</span> <span style="font-weight: bold; text-decoration: underline;">2</span>)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org83f9cf4" class="outline-3">
<h3 id="org83f9cf4"><span class="section-number-3">2.3</span> Modal editing</h3>
<div class="outline-text-3" id="text-2-3">
<p>
As I mentioned on section <a href="#orgc620c7b">2.1.2</a>, I do consider <i>Modal Editing</i> far superior then other methods. The main reason is the separation of states while editing a text. At some level, we all do modal editing, but the keybindings style popularized by Vim goes a step forward and <i>formalize</i> these states.
</p>

<p>
I decided to use Doom as the base of my configuration because it has good reasonable defaults, and its author is also an ex-<i>Vimer</i> like me, so he tailored this distribution with a Vim user in mind.
</p>

<p>
On Emacs, the package responsible to provide Vim inside Emacs is <a href="https://github.com/emacs-evil/evil">Evil</a>, and from all Vim plugins for other editors that I use, Evil is by far the best. So much that compare it with other Vim plugins is do injustice to Evil developers. More often than not, we call Evil the Vim inside Emacs.
</p>

<p>
In this section, I will go through configurations and other packages related directly to Evil, so if you don&rsquo;t use Evil or modal editing, feel free to skip this one.
</p>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
If you&rsquo;re new to Vim, when you learn about the modes, on of the first <i>it&rsquo;s weird</i> feelings you&rsquo;ll have is when you are in <i>Normal Mode</i>, then, you decide to go into <i>Insert Mode</i>, but right after that, you change your mind and press <code>&lt;ESC&gt;</code>&#x2026; What just happened? you didn&rsquo;t act on anything, you didn&rsquo;t press any movement key, still, the cursor moved one character to the left!
</p>

<p>
Well, I have to tell you that this behavior is not a bug, is just how we should expect the change of modes to be.
</p>

<p>
I said <i>should</i>, because I disliked this behavior since I first used Vim. I never understood the rationale behind it and I always tried to fix it in my configurations. The good news is, Evil developers added an option to do just that.
</p>

<p>
To fix the moving back the cursor annoyance, set the variable <code>evil-move-cursor-back</code> to <code>nil</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 19: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">evil-move-cursor-back</span> nil)
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
On the same lines of <i>moving back the cursor</i>, there is another <i>expected</i> behavior of Vim that I don&rsquo;t get it, the infamous <i>overwriting your clipboard with the contents of a selection that you just paste on top of it</i> (I couldn&rsquo;t find a better way to refer to this behavior).
</p>

<p>
I&rsquo;m sure that, at some point, this behavior made sense for a lot of developers, but in my personal opinion, if you are pasting the clipboard on top of a selected text, is highly unlikely that you want to use the contents of such selection right after pasting something on top of it. I believe the natural behavior of developers these days, is to consider the selected text you just paste on top of it, as gone.
</p>

<p>
And just like with the previous annoyance, Evil also offers an option to change this behavior. If you want to <b>not</b> copy the content of a selection you just paste something on top of it, set the variable <code>evil-kill-on-visual-paste</code> to <code>nil</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 20: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">evil-kill-on-visual-paste</span> nil)
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
Because Evil tries to stay faithful to Vim, it does not force Emacs objects into Vim&rsquo;s lingo. One of these examples is the visual selection. Emacs has something called <i>regions</i> that serves, also, to the purpose of selecting text, but in reality, the Vim&rsquo;s visual selection and Emacs&rsquo; regions, are not the same thing.
</p>

<p>
However, Evil is an Emacs package, and it also tries to integrate with existent packages and features, and it offers a configuration that makes Evil visual selection, to expand the Emacs selection region when we select something. The net effect of this, is that we can use the terms selection and region interchangeability for all practical purposes.
</p>

<p>
If you want Evil to synchronize its visual selection with the Emacs region, set the variable <code>evil-visual-region-expanded</code> to a non-<code>nil</code> value:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 21: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">evil-visual-region-expanded</span> t)
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
Vim (therefore also Evil) has this notion of a grammar to execute actions on text:
</p>

<div class="org-src-container">
<pre class="src src-text">{operation}{operator}{target object}
</pre>
</div>

<p>
Where <i>operation</i> is the command you&rsquo;re executing, operator can be <i>i</i> (inside) or <i>a</i> (also), and the <i>target object</i> can be any of the targets defined Evil (e.g. <i>s</i> for <i>sentence</i>, <i>p</i> for <i>paragraph</i>, <i>[</i> for <i>square brackets content</i>, etc. ).
</p>

<p>
One of these target object is <i>w</i> for <i>word</i> and in my experience, the meaning of <i>&ldquo;word&rdquo;</i> varies according to context. Let me explain&#x2026;
</p>

<p>
If you&rsquo;re editing a text file for blog, the meaning of <i>&ldquo;word&rdquo;</i> is most likely the same meaning of the English dictionary, but if you&rsquo;re editing a <i>Lisp</i> code, a word probably include more characters then the conventional <i>&ldquo;word&rdquo;</i> (e.g. while <i>&ldquo;foo&rdquo;</i> is a word in any context, <i>&ldquo;foo-bar&rdquo;</i> is a word, probably only when you&rsquo;re editing a Lisp file).
</p>

<p>
A quick trick to make Evil understand the meaning of <i>&ldquo;word&rdquo;</i> as I just described, is to create an alias for the function <code>forward-evil-symbol</code>, and name it <code>forward-evil-word</code>. This way, we override the normal function to act as if it is the <code>forward-evil-symbol</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 22: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold; text-decoration: underline;">defalias</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">forward-evil-word</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">forward-evil-symbol</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orga4bad90" class="outline-3">
<h3 id="orga4bad90"><span class="section-number-3">2.4</span> Text snippets</h3>
<div class="outline-text-3" id="text-2-4">
<p>
Snippets (also known as Live Templates on certain platforms), are tidbits of text that one can include on the editing text by typing a keyword and pressing a shortcut key (usually <code>TAB</code>) with the cursor right after the keyword.
</p>

<p>
Doom Emacs offers basic configuration for the package <i><a href="https://github.com/joaotavora/yasnippet">Yasnippet</a></i>, which is the most used snippet system on Emacs.
</p>

<p>
Most snippet frameworks available across editors (including <i>Yasnippet</i>) offer the ability to edit some placeholders on the snippet so one can have a single snippet and use it on different scenarios. For instance:
</p>

<p>
Let&rsquo;s assume I&rsquo;m a Java developer, and as such, one of the most common scenarios is for me to create a class, more or less like this:
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="font-weight: bold;">public</span> <span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">MyClassName</span> {
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold;">MyClass</span>() {
    }
}
</pre>
</div>

<p>
I could make this text as a snippet, and I would have to replace <code>MyClassName</code> with whatever name I want, but I could go a step further and make my snippet something like this:
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="font-weight: bold;">public</span> <span style="font-weight: bold;">class</span> ${<span style="font-weight: bold; text-decoration: underline;">1</span>:MyClassName} {
    <span style="font-weight: bold;">public</span> $1() {
        $0
    }
}
</pre>
</div>

<p>
Now, when I expand this snippet, I have the chance to type the name of the class right after expanding it, press <code>TAB</code> again, and get my cursor inside the public constructor.
</p>

<p>
For instance, first I type the snippet keyword (the <code>|</code> character represents the cursor, and <code>[]</code> represents a selected placeholder):
</p>

<div class="org-src-container">
<pre class="src src-java">myclass|
</pre>
</div>

<p>
As soon as I press <code>TAB</code>, the snippet expansion happens:
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="font-weight: bold;">public</span> <span style="font-weight: bold;">class</span> [|MyClassName] {
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold;">MyClassName</span>() {

    }
}
</pre>
</div>

<p>
If I type a different name for the class, the constructor will mirror that change:
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="font-weight: bold;">public</span> <span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">AwesomeClass</span>| {
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold;">AwesomeClass</span>() {

    }
}
</pre>
</div>

<p>
And as soon as I press <code>TAB</code> again, the cursor moves to inside the constructor:
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="font-weight: bold;">public</span> <span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">AwesomeClass</span> {
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold;">AwesomeClass</span>() {
        |
    }
}
</pre>
</div>

<p>
Another functionality provided by the snippet framework, is the ability to delete a placeholder that does not make sense on the current context. As an example, lets augment our previous snippet with the ability to type arguments on the constructor:
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="font-weight: bold;">public</span> <span style="font-weight: bold;">class</span> ${<span style="font-weight: bold; text-decoration: underline;">1</span>:MyClassName} {
    <span style="font-weight: bold;">public</span> $1(${<span style="font-weight: bold; text-decoration: underline;">2</span>:args}) {
        $0
    }
}
</pre>
</div>

<p>
Now, after renaming the class, if I press <code>TAB</code>, I have the chance to type anything as an argument tot the constructor:
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="font-weight: bold;">public</span> <span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">AwesomeClass</span> {
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">AwesomeClass</span>([|args]) {

    }
}
</pre>
</div>

<p>
If I press <code>TAB</code> without typing anything, I would move the cursor to inside the constructor, but would have the word <code>args</code> as a parameter definition (which, in Java, is not a valid declaration):
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="font-weight: bold;">public</span> <span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">AwesomeClass</span> {
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold;">AwesomeClass</span>(<span style="font-weight: bold; text-decoration: underline;">args</span>) {   <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">&lt;-- Compile error</span>
        |
    }
}
</pre>
</div>

<p>
What we want to do here, is to delete the placeholder and move to the next position, and end up with the same result as before:
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="font-weight: bold;">public</span> <span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">AwesomeClass</span> {
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold;">AwesomeClass</span>() {
        |
    }
}
</pre>
</div>

<p>
By default, we can achieve this by pressing <code>DEL</code> instead of <code>TAB</code>. In general, this behavior is pretty good, except when you&rsquo;re typing on a MacBook laptop keyboard. MacBook keyboards don&rsquo;t have the key <code>DEL</code> on them, and to get a <code>DEL</code>, I have to use a combination of two keys.
</p>

<p>
For this reason, I want to make sure that the same behavior I have with <code>DEL</code>, I also have with <code>BACKSPACE</code>.
</p>

<p>
The following function, is an adaptation of the Doom&rsquo;s own <code>+snippets/delete-forward-char-or-field</code> function, but doing the reverse of it.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 23: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-snippets-delete-backward-char-or-field</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> field)
  <span style="font-style: italic;">"Delete backward, or skip the current field if it's empty.</span>

<span style="font-style: italic;">Prevents Yas from interfering with backspace deletion."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((field (<span style="font-weight: bold;">or</span> field (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold; text-decoration: underline;">overlayp</span> <span style="font-weight: bold; font-style: italic;">yas--active-field-overlay</span>)
                              (<span style="font-weight: bold; text-decoration: underline;">overlay-buffer</span> <span style="font-weight: bold; font-style: italic;">yas--active-field-overlay</span>)
                              (<span style="font-weight: bold; text-decoration: underline;">overlay-get</span> <span style="font-weight: bold; font-style: italic;">yas--active-field-overlay</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">yas--field</span>)))))
    (<span style="font-weight: bold;">cond</span> ((<span style="font-weight: bold; text-decoration: underline;">not</span> (<span style="font-weight: bold;">yas--field-p</span> field))
           (<span style="font-weight: bold; text-decoration: underline;">call-interactively</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">delete-backward-char</span>))
          ((<span style="font-weight: bold;">and</span> (<span style="font-weight: bold; text-decoration: underline;">not</span> (<span style="font-weight: bold;">yas--field-modified-p</span> field))
                (<span style="font-weight: bold; text-decoration: underline;">eq</span> (<span style="font-weight: bold; text-decoration: underline;">point</span>) (<span style="font-weight: bold; text-decoration: underline;">marker-position</span> (<span style="font-weight: bold;">yas--field-start</span> field))))
           (<span style="font-weight: bold;">yas--skip-and-clear</span> field)
           (<span style="font-weight: bold;">yas-next-field</span> <span style="font-weight: bold; text-decoration: underline;">1</span>))
          ((<span style="font-weight: bold; text-decoration: underline;">eq</span> (<span style="font-weight: bold; text-decoration: underline;">point</span>) (<span style="font-weight: bold; text-decoration: underline;">marker-position</span> (<span style="font-weight: bold;">yas--field-start</span> field))) nil)
          ((<span style="font-weight: bold; text-decoration: underline;">call-interactively</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">delete-backward-char</span>)))))
</pre>
</div>

<p>
With the function defined, I can simply add it to a key bind to start using it. Notice on the following code, that I also map <code>⌘-RET</code> to allow me to end the snippet completion and accept all the default values (I&rsquo;m trying to make <code>⌘-RET</code> a standard keymap that means <i>finish and accept</i>):
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 24: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">map!</span> <span style="font-weight: bold;">:after</span> yasnippet

      (<span style="font-weight: bold;">:leader</span> <span style="font-weight: bold;">:prefix</span> (<span style="font-style: italic;">"h"</span> . <span style="font-style: italic;">"help"</span>)
       <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Show snippets"</span> <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"y"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">yas-describe-tables</span>)

      (<span style="font-weight: bold;">:map</span> <span style="font-weight: bold; font-style: italic;">yas-keymap</span>
       <span style="font-weight: bold;">:g</span> [backspace] <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-snippets-delete-backward-char-or-field</span>
       <span style="font-weight: bold;">:g</span> [deletechar] <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+snippets/delete-forward-char-or-field</span>
       <span style="font-weight: bold;">:g</span> [s-return] <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">yas-exit-snippet</span>))
</pre>
</div>

<p>
The last configuration for snippets is to guarantee the <code>yas-describe-tables</code> shows up on the right side of the screen:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 25: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">set-popup-rule!</span> <span style="font-style: italic;">"^\\*YASnippet Tables\\*"</span>
  <span style="font-weight: bold;">:slot</span> <span style="font-weight: bold; text-decoration: underline;">2</span>   <span style="font-weight: bold;">:vslot</span> <span style="font-weight: bold; text-decoration: underline;">-1</span>     <span style="font-weight: bold;">:side</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">right</span>   <span style="font-weight: bold;">:width</span> <span style="font-weight: bold; text-decoration: underline;">104</span> <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.4</span>
  <span style="font-weight: bold;">:select</span> t <span style="font-weight: bold;">:modeline</span> nil <span style="font-weight: bold;">:autosave</span> nil  <span style="font-weight: bold;">:ttl</span> <span style="font-weight: bold; text-decoration: underline;">0</span>     <span style="font-weight: bold;">:quit</span> t)
</pre>
</div>

<p>
Throughout this document, you will find helpful snippets I like to define for certain features. I decided to spread the snippets across different features because I want to indicate to the reader to consider the snippet in question as an integral part of the configuration at hand.
</p>
</div>
</div>

<div id="outline-container-org63b5f4e" class="outline-3">
<h3 id="org63b5f4e"><span class="section-number-3">2.5</span> Inline completion</h3>
<div class="outline-text-3" id="text-2-5">
<p>
What I call inline completion, is also known as intellisense, code completion, or in the Vim world, omni completion. It&rsquo;s a useful tool to help the user type less and more correctly while editing source code.
</p>

<p>
Years ago, there was two main packages that provided such feature on Emacs:
</p>

<ul class="org-ul">
<li><a href="https://github.com/auto-complete/auto-complete">auto-complete</a></li>
<li><a href="https://github.com/company-mode/company-mode">company-mode</a></li>
</ul>

<p>
On the time I&rsquo;m writing this part of my document, <a href="https://github.com/auto-complete/auto-complete">auto-complete</a> is searching for a new maintainer, and I barely read any mention of it on the mainstream media.
</p>

<p>
Since I&rsquo;ve been using <a href="https://github.com/company-mode/company-mode">company-mode</a> for the most part of my Emacs experience, I will stick with it on my new configuration.
</p>

<p>
One of the best features I like on <a href="https://github.com/company-mode/company-mode">company-mode</a>, is its architecture design, where the author decided to modularize the package, allowing other packages to integrate with it where they actually mater. For instance, if my package offers a major mode to edit files from the <i>Foo</i> language, I can create a <code>foo-company-backend</code> to integrate it on the Company ecosystem, or if my package provides a new cool way to display inline completions, I can create a <i>company frontend</i> to make such integration
</p>

<p>
For the most part, Doom does a pretty good job configuring <a href="https://github.com/company-mode/company-mode">company-mode</a> to my liking, I just need to adjust some small behaviors and keymaps.
</p>

<p>
One of the most prominent differences on my configuration is the fact that I don&rsquo;t like to let <a href="https://github.com/company-mode/company-mode">company-mode</a> to show its popup automatically. It is a nice feature, but with certain backends, it can slow down the edit experience (I&rsquo;m looking at you <a href="https://github.com/company-mode/company-mode/blob/master/company-ispell.el">company-ispell</a>). For that reasons (and also because I rather the experience of <a href="https://github.com/ervandew/supertab">supertab</a> on Vim&rsquo;s world), I decided to not <i>auto-display</i> Company&rsquo;s popup.
</p>

<p>
In order to display the completion on my configuration, one has to press <code>TAB</code> after type couple characters of the word, or type a &ldquo;<code>.</code>&rdquo; character after a keyword on programming modes that support it.
</p>

<p>
Such behavior is so wildly used that Company offers a helper function (<code>company-indent-or-complete-common</code>) to help the user to handle <i>inserting a &ldquo;<code>\t</code>&rdquo; character</i> versus displaying the completion. That is all and good, but unfortunately, as seen on section <a href="#orga4bad90">2.4</a>, I have a third function for the <code>TAB</code> key.
</p>

<p>
In order to help me handle my three cases for <code>TAB</code> I need to create small wrapper function to add the <code>yasnippet</code> check before handling completion to Company:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 26: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-company-indent-or-complete-common</span> (arg)
  <span style="font-style: italic;">"Tab key action for current point.</span>

<span style="font-style: italic;">This function tries to insert a tab character, trigger a snippet or complete a</span>
<span style="font-style: italic;">word with company.</span>

<span style="font-style: italic;">The order for this selection is:</span>

<span style="font-style: italic;">- Org table</span>
<span style="font-style: italic;">- Yasnippet</span>
<span style="font-style: italic;">- Indent region</span>
<span style="font-style: italic;">- Indent line</span>
<span style="font-style: italic;">- Indent org-mode line</span>
<span style="font-style: italic;">- Indent org-mode headline</span>
<span style="font-style: italic;">- Indent org-mode item from a list</span>
<span style="font-style: italic;">- Indent markdown-mode line</span>
<span style="font-style: italic;">- Indent rst-mode line</span>
<span style="font-style: italic;">- Complete with company</span>

<span style="font-style: italic;">The action selection happens in this order and stops as soon as the first action</span>
<span style="font-style: italic;">works."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">org-table-p</span>)
      (<span style="font-weight: bold;">orgtbl-tab</span> arg)
    (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold; text-decoration: underline;">not</span> <span style="font-weight: bold; font-style: italic;">yas-minor-mode</span>)
            (<span style="font-weight: bold; text-decoration: underline;">null</span> (<span style="font-weight: bold;">yas-expand</span>)))
        (<span style="font-weight: bold;">cond</span> ((<span style="font-weight: bold;">use-region-p</span>) (<span style="font-weight: bold;">indent-region</span> (<span style="font-weight: bold; text-decoration: underline;">region-beginning</span>) (<span style="font-weight: bold; text-decoration: underline;">region-end</span>)))
              (t (<span style="font-weight: bold;">let</span> ((old-point (<span style="font-weight: bold; text-decoration: underline;">point</span>))
                       (old-tick (<span style="font-weight: bold; text-decoration: underline;">buffer-chars-modified-tick</span>))
                       (<span style="font-weight: bold; font-style: italic;">tab-always-indent</span> t))
                   (<span style="font-weight: bold;">indent-for-tab-command</span> arg)
                   (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold; text-decoration: underline;">eq</span> old-point (<span style="font-weight: bold; text-decoration: underline;">point</span>))
                              (<span style="font-weight: bold; text-decoration: underline;">eq</span> old-tick (<span style="font-weight: bold; text-decoration: underline;">buffer-chars-modified-tick</span>)))
                     (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">pcase</span> <span style="font-weight: bold; font-style: italic;">major-mode</span>
                               (<span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">org-mode</span> (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">org-indent-line</span>)
                                              (<span style="font-weight: bold;">org-cycle-level</span>)
                                              (<span style="font-weight: bold;">org-cycle-item-indentation</span>)))
                               (<span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">markdown-mode</span> (<span style="font-weight: bold;">markdown-indent-line</span>))
                               (<span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">rst-mode</span> (rst-indent-line nil))
                               (_ nil))
                       (<span style="font-weight: bold;">company-complete-common</span>))))))
      (company-abort))))
</pre>
</div>

<p>
This function incorporates the source code of <code>company-indent-or-complete-common</code> to allow me to handle special cases like in Org mode when I want to indent a list item or headline. It first tries to expand the previous word on a snippet. If it can&rsquo;t, it falls back to the altered Company function, where it also tries to do an Org indent, or a Markdown indent, or a reStructuredText before settling on <code>company-complete-common</code>.
</p>

<p>
But what if I&rsquo;m already displaying the Company popup, but I want to expand what I just typed into a snippet? The previous function can&rsquo;t help us, because it does not handle navigating the completion options with <code>TAB</code>. For such behavior, I need another function that I should run instead of the previous one if I have Company&rsquo;s popup opened:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 27: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-completion-yasnippet-or-completion</span> ()
  <span style="font-style: italic;">"Tab key action when company popup is visible.</span>

<span style="font-style: italic;">This function tries to expand a snippet, complete a common prefix on a company</span>
<span style="font-style: italic;">completion, or move the company selction to the next item."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold; text-decoration: underline;">not</span> <span style="font-weight: bold; font-style: italic;">yas-minor-mode</span>)
          (<span style="font-weight: bold; text-decoration: underline;">null</span> (<span style="font-weight: bold;">yas-expand</span>)))
      (company-complete-common-or-cycle)
    (company-abort)))
</pre>
</div>

<p>
Notice that the only difference between <code>my-company-indent-or-complete-common</code> and <code>my-completion-yasnippet-or-completion</code> is that I call <code>company-indent-or-complete-common</code> on the former, and <code>company-complete-common-or-cycle</code> on the later.
</p>

<p>
Another deviation from the standard that I like, is how the <code>RET</code> should work with Company.
</p>

<p>
For me, there are two scenarios that can happen if one presses <code>RET</code> while the Company popup is visible:
</p>

<ol class="org-ol">
<li>The user meant to insert a &ldquo;<code>\n</code>&rdquo; character on the document;</li>
<li>The user intended to select the selected completion option;</li>
</ol>

<p>
The way to distinguish between these two scenarios, is to check if Company already have a selection stored at <code>company-selection</code>. If it does have, the <code>RET</code> should represent a <code>company-complete-selection</code>, otherwise, the <code>RET</code> should close the Company popup, and insert a &ldquo;<code>\n</code>&rdquo; character on the document. I created the next function to manage these behavior:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 28: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-completion-complete-selection-or-return</span> ()
  <span style="font-style: italic;">"Return key action when company popup is visible.</span>

<span style="font-style: italic;">This function will select current company item if user already selected one, or</span>
<span style="font-style: italic;">insert a new line character."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">if</span> company-selection
      (company-complete-selection)
    (company-abort)
    (<span style="font-weight: bold; text-decoration: underline;">execute-kbd-macro</span> (<span style="font-weight: bold;">read-kbd-macro</span> <span style="font-style: italic;">"&lt;return&gt;"</span>))))
</pre>
</div>

<p>
Notice also, that I didn&rsquo;t use <code>insert</code> when a <code>RET</code> means to <i>add a new line</i>. This decision is to allow Emacs to trigger any function or hook tied to the <code>RET</code> key.
</p>

<p>
With all auxiliary functions created, I just need to setup Company according to my needs:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 29: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> company
  (<span style="font-weight: bold;">setq</span> company-idle-delay nil)
  (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">tab-always-indent</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">complete</span>)
  (<span style="font-weight: bold;">setq</span> company-minimum-prefix-length <span style="font-weight: bold; text-decoration: underline;">2</span>)
  (<span style="font-weight: bold;">setq</span> company-show-numbers t)
  (<span style="font-weight: bold;">setq</span> company-box-doc-enable nil)
  (<span style="font-weight: bold;">setq</span> company-frontends (<span style="font-weight: bold; text-decoration: underline;">delq</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">company-pseudo-tooltip-frontend</span> company-frontends))

  (<span style="font-weight: bold;">add-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">evil-normal-state-entry-hook</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">company-abort</span>))
</pre>
</div>

<p>
One configuration that worth mention why I choose it is to set <code>company-box-doc-enable</code> to <code>nil</code>. I did this, not because I don&rsquo;t like the documentation as another child frame, is the fact that if I do show it, I can&rsquo;t move my popup completion without aborting Company.
</p>

<p>
Last, I need to setup the proper keymaps for the package:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 30: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">map!</span> <span style="font-weight: bold;">:after</span> company
      (<span style="font-weight: bold;">:map</span> <span style="font-weight: bold; font-style: italic;">global-map</span>
       <span style="font-weight: bold;">:i</span> [tab] <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-company-indent-or-complete-common</span>)
      (<span style="font-weight: bold;">:map</span> company-active-map
       <span style="font-weight: bold;">:g</span> [tab] <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-completion-yasnippet-or-completion</span>
       <span style="font-weight: bold;">:g</span> [backtab] <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">company-select-previous</span>
       <span style="font-weight: bold;">:g</span> [down] <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">company-select-next</span>
       <span style="font-weight: bold;">:g</span> [up] <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">company-select-previous</span>
       <span style="font-weight: bold;">:g</span> [return] <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-completion-complete-selection-or-return</span>
       <span style="font-weight: bold;">:g</span> <span style="font-style: italic;">"C-S-j"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">company-next-page</span>
       <span style="font-weight: bold;">:g</span> <span style="font-style: italic;">"C-S-k"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">company-previous-page</span>
       <span style="font-weight: bold;">:g</span> <span style="font-style: italic;">"C-/"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">company-show-doc-buffer</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org36208e3" class="outline-3">
<h3 id="org36208e3"><span class="section-number-3">2.6</span> Automatic indentation</h3>
<div class="outline-text-3" id="text-2-6">
<p>
I appreciate the fact that majority of editor these days can keep the indentation of the previous line, and some of them, are even capable of adding indentation where is necessary. Although this is a good start, I want my editor to do more. When I add braces around a code, or when I make a one-line statement, a multi-line one, I want the editor to reformat my file to properly intent it.
</p>

<p>
Emacs offers a mode called <code>electric-indent-mode</code> where the ultimate goal, is to achieve exactly what I described, but unfortunately, the current state of the mode is falling short of it.
</p>

<p>
The solution I found, is an external package called <code>aggressive-indent</code> that re-indent the entire file on every change.
</p>

<p>
It is a bit too aggressive, but so far is working just fine for me, so let&rsquo;s add it to our packages:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 31: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">package!</span> aggressive-indent)
</pre>
</div>

<p>
A point to note is where to use this package. I need it on <code>prog-mode</code>, but due to some particularities of certain languages (did someone said Python here?), I need to specify the set of languages I want to support aggressive indent. The reader can check the list of supported language on the following code snippet:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 32: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> aggressive-indent
  <span style="font-weight: bold;">:hook</span> ((<span style="font-weight: bold;">emacs-lisp-mode</span>
          c-mode
          cpp-mode
          rust-mode
          go-mode
          java-mode
          kotlin-mode
          shell-mode
          javascript-mode
          typescript-mode) <span style="font-weight: bold;">. aggressive-indent-mode</span><span style="font-weight: bold;">)</span><span style="font-weight: bold;">)</span>
</pre>
</div>

<p>
The reason to not include Python on this list, is the fact that Python uses indentation as block delimiter, and the package does not know how where a block ends and a new starts, causing re-indentation to pretty much break the code.
</p>
</div>
</div>

<div id="outline-container-org747dc7d" class="outline-3">
<h3 id="org747dc7d"><span class="section-number-3">2.7</span> Smart backspace</h3>
<div class="outline-text-3" id="text-2-7">
<p>
As part of my day job, I had to do a lot of Android development, and inevitably I used <a href="https://www.jetbrains.com/">JetBrains</a>
IDE <a href="https://www.jetbrains.com/idea/">IntelliJ IDEA</a>. I bring this up not to chastise who uses or to complain about it. In face, IntelliJ the best IDE for Java and Kotlin out there. It has some features that are so good, that I want to implement on any text editor I use. One of these features is what I call <i>Smart Backspace</i>.
</p>

<p>
On both, Doom and IntelliJ, when you type an open pair, the editor completes with the closing one:
</p>

<div class="org-src-container">
<pre class="src src-kotlin"><span style="font-weight: bold;">fun</span> <span style="font-weight: bold;">foo</span>() {|}
</pre>
</div>

<p>
Also on both, when you press <code>&lt;ENTER&gt;</code>, the editor position the cursor on a newly inserted line, on using the correct indentation, and it also inserts a &rsquo;<code>\n</code>&rsquo; character after cursor. The result of these actions would be like this:
</p>

<div class="org-src-container">
<pre class="src src-kotlin"><span style="font-weight: bold;">fun</span> <span style="font-weight: bold;">foo</span>() {
    |
}
</pre>
</div>

<p>
The difference between both editors happens when you press <code>&lt;BACKSPACE&gt;</code> at this point. While in Doom, this operation would result in:
</p>

<div class="org-src-container">
<pre class="src src-kotlin"><span style="font-weight: bold;">fun</span> <span style="font-weight: bold;">foo</span>() {
|
}
</pre>
</div>

<p>
On IntelliJ, it results in:
</p>

<div class="org-src-container">
<pre class="src src-kotlin"><span style="font-weight: bold;">fun</span> <span style="font-weight: bold;">foo</span>() {|}
</pre>
</div>

<p>
But what happened here?
</p>

<p>
IntelliJ was able to figure out that, since I was on the indent column of the line <b>and</b> I haven&rsquo;t typed anything after the auto-pair, when I pressed <code>&lt;BACKSPACE&gt;</code>, my intention was to get back to the state I was before pressing <code>&lt;ENTER&gt;</code>, therefore the name I gave to this feature: <i>Smart backspace</i>.
</p>

<p>
To achieve the same result with Doom, we have to add a function advice to delete advice Doom adds to Emacs (the <code>+default--delete-backward-char-a</code> advice is what is responsible to balance the blank characters you enter after a pair completion).
</p>

<p>
Our advice function checks if our cursor is position on the expected position to revert the <code>&lt;ENTER&gt;</code> pressed between the two pairs. If it is, we remove all the characters before the cursor on the current line. This will put the cursor on a position that Doom&rsquo;s advice function can remove the two new line characters around the cursor, putting the buffer on the same state we were before we pressed <code>&lt;ENTER&gt;</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 33: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defadvice!</span> my-super-backward-delete-a (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> _)
  <span style="font-style: italic;">"Special function to super-delete things.</span>

<span style="font-style: italic;">If the line content before cursor contains only blank characters, this function</span>
<span style="font-style: italic;">will delete all the blank characters, and then, join with the previous line. I</span>
<span style="font-style: italic;">there is any non-blank character before cursor, this function will delete the</span>
<span style="font-style: italic;">entire line, but keep the correct indentation on it."</span>
  <span style="font-weight: bold;">:before</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">+default--delete-backward-char-a</span>
  (<span style="font-weight: bold;">let*</span> ((line-pos (<span style="font-weight: bold; text-decoration: underline;">-</span> (<span style="font-weight: bold; text-decoration: underline;">point</span>) (<span style="font-weight: bold; text-decoration: underline;">point-at-bol</span>)))
         (prev-indent (<span style="font-weight: bold;">save-excursion</span>
                        (<span style="font-weight: bold; text-decoration: underline;">forward-line</span> <span style="font-weight: bold; text-decoration: underline;">-1</span>)
                        (<span style="font-weight: bold; text-decoration: underline;">current-indentation</span>)))
         (prev-line-bol (<span style="font-weight: bold; text-decoration: underline;">point-at-bol</span> <span style="font-weight: bold; text-decoration: underline;">0</span>))
         (next-line-eol (<span style="font-weight: bold; text-decoration: underline;">point-at-eol</span> <span style="font-weight: bold; text-decoration: underline;">2</span>))
         (smart-bs-p (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">save-excursion</span>
                           (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold; text-decoration: underline;">re-search-backward</span> <span style="font-style: italic;">"{[ \t]*\n[ \t]*"</span> prev-line-bol t)
                                (<span style="font-weight: bold; text-decoration: underline;">re-search-forward</span> <span style="font-style: italic;">"[ \t]*\n[ \t]*}"</span> next-line-eol t)))
                         (<span style="font-weight: bold;">save-excursion</span>
                           (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold; text-decoration: underline;">re-search-backward</span> <span style="font-style: italic;">"\\[[ \t]*\n[ \t]*"</span> prev-line-bol t)
                                (<span style="font-weight: bold; text-decoration: underline;">re-search-forward</span> <span style="font-style: italic;">"[ \t]*\n[ \t]*\\]"</span> next-line-eol t)))
                         (<span style="font-weight: bold;">save-excursion</span>
                           (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold; text-decoration: underline;">re-search-backward</span> <span style="font-style: italic;">"([ \t]*\n[ \t]*"</span> prev-line-bol t)
                                (<span style="font-weight: bold; text-decoration: underline;">re-search-forward</span> <span style="font-style: italic;">"[ \t]*\n[ \t]*)"</span> next-line-eol t))))))
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> smart-bs-p
               (<span style="font-weight: bold; text-decoration: underline;">&lt;=</span> line-pos (<span style="font-weight: bold; text-decoration: underline;">+</span> prev-indent <span style="font-weight: bold; font-style: italic;">standard-indent</span>)))
      (<span style="font-weight: bold; text-decoration: underline;">delete-char</span> (<span style="font-weight: bold; text-decoration: underline;">-</span> line-pos)))))
</pre>
</div>

<p>
Adding this advice as an <i>autoload</i> function on our configuration is all we need to get the functionality working. When Doom loads the <code>smartparens</code> on the default module, it replaces the Emacs <code>delete-backward-char</code> function with its <code>+default--delete-backward-char-a</code> advice, which will load our function, which, in turn, installs itself as a <code>:before</code> advice on Doom&rsquo;s function.
</p>
</div>
</div>

<div id="outline-container-org3012857" class="outline-3">
<h3 id="org3012857"><span class="section-number-3">2.8</span> Balanced pairs</h3>
<div class="outline-text-3" id="text-2-8">
<p>
In most editors (as far as editors go, I only saw Emacs allowing balanced pairs), there is no balanced pair protection. If you remove a line where a closing character is, without removing its open pair, your buffer becomes unbalanced.
</p>

<p>
Emacs has some packages that help you keep the balance on pair characters, even if you try to remove a line containing just one of the pairs.
</p>

<p>
Among the packages I checked, the two top two contenders for me are <code>lispville</code> and <code>smartparens</code> + (<code>evil-cleverparens</code> or <code>evil-smartparens</code>).
</p>

<p>
From the two, <code>lispville</code> seams to be the most maintained, but it depends on <code>lispy</code> and even though you can use it just for the balance protection, it requires much more code and effort to do it right, so my choice is <code>smartparens</code> + <code>evil-cleverparens</code>. I tried <code>evil-smartparens</code> before, and it is not as polished as <code>evil-cleverparens</code>.
</p>

<p>
To install them, make sure <code>smartparens</code> is enable in your <code>init.el</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 34: </span>$DOOMDIR/init.el</label><pre class="src src-emacs-lisp">  <span style="font-weight: bold;">:config</span>
  (default
      +bindings
      +smartparens)
</pre>
</div>

<p>
And <code>evil-cleverparens</code> is on the <code>packages.el</code> file as well:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 35: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">package!</span> evil-cleverparens)
</pre>
</div>

<p>
These changes will make Doom download them into its local cache when you run <code>doom sync</code>.
</p>

<p>
Before I configure these packages, I would like to explain why I turn on balance protection only on Emacs modes deriving from <code>prog-mode</code>.
</p>

<p>
The simplest explanation is that you don&rsquo;t really need pair balance protection in any other place then you coding buffers. I did some informal experiments on this area, and found that pair protection turned on when you write prose is magnitudes more annoying then useful, so I will stick with protection only in <code>prog-mode</code>.
</p>

<p>
To make Emacs turn <code>smartparens</code> and related packages correctly, make sure that you turn on <code>evil-cleverparens-mode</code> on the <code>smartparens-enabled-hook</code>, and only enable the strict mode when editing a <code>prog-mode</code> buffer:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 36: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> smartparens
  <span style="font-weight: bold;">:init</span> (<span style="font-weight: bold;">add-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">smartparens-strict-mode-hook</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">evil-cleverparens-mode</span>)
  <span style="font-weight: bold;">:hook</span> ((<span style="font-weight: bold;">prog-mode</span> . <span style="font-weight: bold; font-style: italic;">smartparens-strict-mode</span>)))
</pre>
</div>

<p>
Doom will turn on <code>smartparens</code> appropriately, so we don&rsquo;t need to hook anything else to get this feature working, but there is one more configuration that I like to have on, all the time. It is the ability of Emacs to highlight the <i>other pair</i> when the cursor is on top of a character pair.
</p>

<p>
To do so, enable the <code>show-smartparens-global-mode</code> after enabling <code>smartparens</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 37: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> smartparens
  (<span style="font-weight: bold; font-style: italic;">show-smartparens-global-mode</span> <span style="font-weight: bold; text-decoration: underline;">1</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org4491938" class="outline-3">
<h3 id="org4491938"><span class="section-number-3">2.9</span> Rich keybindings</h3>
<div class="outline-text-3" id="text-2-9">
<p>
The good thing about this feature is that Emacs already covers almost all of my <a href="#orgb2eb2c4">requirements</a> for free, and doom ships with a package that covers the rest of it (<code>which-key</code>). What I need to do here, is to tweak <code>which-key</code> to <i>look</i> and <i>feel</i> like I want it.
</p>

<p>
One aspect of which key that bothered me is not so much a <code>which-key</code> thing, and more an Emacs thing in general. This aspect is how popup windows show and hide. When Emacs shows one on the bottom of the screen, it shifts the window I&rsquo;m working on upwards, and although this came to be the expected behavior, it disrupt my flow, specially if the time I take to finish a shortcut sequence is couple milliseconds more then the <code>which-key</code> timeout.
</p>

<p>
To remediate this situation, I found this package called <code>which-key-posframe</code> that display the shortcut hints on a child frame. With a configuration or two, I believe this package can deliver what I want.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 38: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">package!</span> which-key-posframe)
</pre>
</div>

<p>
The main adjustments I want to do, is to make sure the child frame <i>width</i> is big enough to fit the biggest description I can have.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 39: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> which-key-posframe
  <span style="font-weight: bold;">:hook</span> (<span style="font-weight: bold; font-style: italic;">which-key-mode</span> . which-key-posframe-mode)
  <span style="font-weight: bold;">:custom</span>
  (which-key-posframe-poshandler <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-posframe-poshandler-frame-right-middle</span>)
  (which-key-posframe-parameters <span style="font-weight: bold;">'</span>((min-width . <span style="font-weight: bold; text-decoration: underline;">44</span>))))
</pre>
</div>

<p>
And respect the border color for popups:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 40: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">custom-set-faces!</span>
  <span style="font-weight: bold;">`</span>(which-key-posframe-border <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#000000"</span>)
  <span style="font-weight: bold;">`</span>(which-key-posframe <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#21242b"</span>))
</pre>
</div>

<p>
I need also to set the <code>which-key-posframe-poshandler</code> variable, to allow a special behavior regarding positioning the child frame on the screen.
</p>

<p>
This special behavior is simply to most of the times, show the shortcut hints on the right side of the frame, but if I invoke an Embark action, I want the shortcut hints child frame to show up right besides the cursor point.
</p>

<p>
To achieve this behavior, I&rsquo;ll define a <code>nil</code> placeholder variable that I can set to <code>t</code> when invoking Embark.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 41: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-which-key-on-embark</span> nil)
</pre>
</div>

<p>
Which such variable created, I can define my function to place the frame where I want it:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 42: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-posframe-poshandler-frame-right-middle</span> (<span style="font-weight: bold;">info</span>)
  <span style="font-style: italic;">"Posframe's position handler.</span>

<span style="font-style: italic;">Get a position which let posframe stay vertically centralized onto current</span>
<span style="font-style: italic;">frame's right site. Checkk the docstring of `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">posframe-show</span><span style="font-style: italic;">' for more information</span>
<span style="font-style: italic;">about the INFO structure."</span>
  (<span style="font-weight: bold;">if</span> my-which-key-on-embark
      (posframe-poshandler-point-bottom-left-corner info)
    (<span style="font-weight: bold;">let*</span> ((<span style="font-weight: bold;">frame-width</span> (<span style="font-weight: bold; text-decoration: underline;">plist-get</span> info <span style="font-weight: bold;">:parent-frame-width</span>))
           (<span style="font-weight: bold;">frame-height</span> (<span style="font-weight: bold; text-decoration: underline;">plist-get</span> info <span style="font-weight: bold;">:parent-frame-height</span>))
           (posframe-width (<span style="font-weight: bold; text-decoration: underline;">plist-get</span> info <span style="font-weight: bold;">:posframe-width</span>))
           (posframe-height (<span style="font-weight: bold; text-decoration: underline;">plist-get</span> info <span style="font-weight: bold;">:posframe-height</span>)))
      (<span style="font-weight: bold; text-decoration: underline;">cons</span> (<span style="font-weight: bold; text-decoration: underline;">-</span> frame-width posframe-width (<span style="font-weight: bold; text-decoration: underline;">line-pixel-height</span>))
            (<span style="font-weight: bold; text-decoration: underline;">/</span> (<span style="font-weight: bold; text-decoration: underline;">-</span> frame-height posframe-height) <span style="font-weight: bold; text-decoration: underline;">2</span>)))))
</pre>
</div>

<p>
In order to connect <code>embark</code> to <code>which-key</code>, I need to advice the function I defined to invoke <code>which-key</code> when I invoke <code>embark</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 43: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defadvice!</span> my-embark-which-key-action-wrapper (orig-fun <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> args)
  <span style="font-style: italic;">"Wrap ORIGIN-FUN on a let bind to indicate this is an Embark call.</span>

<span style="font-style: italic;">It passes ARGS to ORIGIN-FUN without altering them. "</span>
  <span style="font-weight: bold;">:around</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-embark-which-key-action-indicator</span>
  (<span style="font-weight: bold;">let</span> ((my-which-key-on-embark t))
    (<span style="font-weight: bold; text-decoration: underline;">apply</span> orig-fun args)))
</pre>
</div>

<p>
With the <code>which-key-posframe</code> configured, I just need to do some minor adjustments on the <code>which-key</code> package to make it display the hints on a single column with a single description occupying up to 40 characters of such column:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 44: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> which-key
  (<span style="font-weight: bold;">setq</span> which-key-allow-multiple-replacements t)
  (<span style="font-weight: bold;">setq</span> which-key-min-display-lines <span style="font-weight: bold; text-decoration: underline;">10</span>)
  (<span style="font-weight: bold;">setq</span> which-key-max-display-columns <span style="font-weight: bold; text-decoration: underline;">1</span>)
  (<span style="font-weight: bold;">setq</span> which-key-add-column-padding <span style="font-weight: bold; text-decoration: underline;">2</span>)
  (<span style="font-weight: bold;">setq</span> which-key-max-description-length <span style="font-weight: bold; text-decoration: underline;">40</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga115a1f" class="outline-3">
<h3 id="orga115a1f"><span class="section-number-3">2.10</span> Useful line numbers</h3>
<div class="outline-text-3" id="text-2-10">
<p>
A long time ago, I read on some Vim mailing list, an opinion on how line numbers should behave on different editing modes (if you know who is the original author of such idea, please let me know so I can give credit where credit is due). Since on normal mode is pretty useful to know the line count from the cursor until some target text, it makes more sense to have the <code>relative number</code> shown on the gutter, but when I&rsquo;m editing the buffer, is nice to have a sense of size by looking to the line numbers.
</p>

<p>
So, I can describe this behavior as follows:
</p>

<ul class="org-ul">
<li>When on normal mode, show relative line numbers;</li>
<li>When on insert mode, show absolute line numbers;</li>
</ul>

<p>
To achieve this, I need a function that turns the <i>absolute</i> line number when line numbers are visible:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 45: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-line-number-absolute-h</span> ()
  <span style="font-style: italic;">"If line numbers are visible, set the current line number type to `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">absolute.</span><span style="font-style: italic;">'"</span>
  (<span style="font-weight: bold;">if</span> <span style="font-weight: bold; font-style: italic;">display-line-numbers</span>
      (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">display-line-numbers</span> t)))
</pre>
</div>

<p>
And another function to put the line numbers on <i>relative mode</i> (but again, only if line numbers are visible):
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 46: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-line-number-visual-h</span> ()
  <span style="font-style: italic;">"If line numbers are visible, set the current line number type to `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">visual</span><span style="font-style: italic;">'"</span>
  (<span style="font-weight: bold;">if</span> <span style="font-weight: bold; font-style: italic;">display-line-numbers</span>
      (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">display-line-numbers</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">visual</span>)))
</pre>
</div>

<p>
With those functions created, after loading Evil, I can hook them to a mode switch:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 47: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> evil
  (<span style="font-weight: bold;">add-hook!</span> <span style="font-weight: bold;">'</span>(<span style="font-weight: bold; font-style: italic;">evil-emacs-state-entry-hook</span>
               <span style="font-weight: bold; font-style: italic;">evil-insert-state-entry-hook</span>) <span style="font-weight: bold;">'my-line-number-absolute-h</span><span style="font-weight: bold;">)</span>
  (<span style="font-weight: bold;">add-hook!</span> <span style="font-weight: bold;">'</span>(<span style="font-weight: bold; font-style: italic;">evil-emacs-state-exit-hook</span>
               <span style="font-weight: bold; font-style: italic;">evil-insert-state-exit-hook</span>) <span style="font-weight: bold;">'my-line-number-visual-h</span><span style="font-weight: bold;">)</span><span style="font-weight: bold;">)</span>
</pre>
</div>

<p>
To finalize, I want to make line numbers visible on any programming mode:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 48: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> evil
  (<span style="font-weight: bold;">setq-hook!</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">prog-mode-hook</span> <span style="font-weight: bold; font-style: italic;">display-line-numbers-type</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">visual</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org37816b0" class="outline-3">
<h3 id="org37816b0"><span class="section-number-3">2.11</span> Auto-Saving</h3>
<div class="outline-text-3" id="text-2-11">
<p>
First of all, since I&rsquo;m going to save my work constantly, I don&rsquo;t want Emacs to ask me if it should really exit, or if it should kill outstanding processes while doing it. For me, if I&rsquo;m telling Emacs to quit, I want it to do it, regardless its state, but I don&rsquo;t want to lose any content of my current work. So, the first thing I&rsquo;m going to do, is to disable questions when I&rsquo;m quitting Emacs:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 49: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">confirm-kill-emacs</span> nil
      <span style="font-weight: bold; font-style: italic;">confirm-kill-processes</span> nil)
</pre>
</div>

<p>
Emacs allows you to define some <i>advices</i> to any function you want. This allows you to hook some code when the user, or the system calls such functions. On the case of aggressive auto-save, I want Emacs to save any content when I try to close the buffer associated with the content, of if I&rsquo;m trying to quit Emacs. To do so, I&rsquo;ll create an <i>autoload</i> advice to perform such work:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 50: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defadvice!</span> my-save-all-buffers-a (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> _)
  <span style="font-style: italic;">"Advice to run `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">save-some-buffers</span><span style="font-style: italic;">' before a function.</span>

<span style="font-style: italic;">This is a part of the full auto-save feature."</span>
  <span style="font-weight: bold;">:before</span> (<span style="font-weight: bold; text-decoration: underline;">list</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">save-buffers-kill-emacs</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-tabs-close-buffer-tab</span>)
  (<span style="font-weight: bold;">save-some-buffers</span> t t))
</pre>
</div>

<p>
And to wrap up this configuration, I enable the auto-save mode:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 51: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold; font-style: italic;">auto-save-visited-mode</span> <span style="font-weight: bold; text-decoration: underline;">1</span>)
</pre>
</div>

<p>
Call the same advice as a normal function when Emacs executes the auto-save hook:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 52: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">add-hook!</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">auto-save-hook</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-save-all-buffers-a</span>)
</pre>
</div>

<p>
And add the advice function to the <code>after-focus-change-function</code> as well, just to make sure Emacs save any outstanding buffer as soon as possible if it loses focus:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 53: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">add-function</span> <span style="font-weight: bold;">:after</span> <span style="font-weight: bold; font-style: italic;">after-focus-change-function</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-save-all-buffers-a</span>)
</pre>
</div>

<p>
This aggressive auto-save will work as expected, but it will crate a side effect with my literate configuration. Since Doom tangles the Org file every time we save it, the aggressive auto-save will make this tangle happen more often than we want.
</p>

<p>
Doom documentation offers a partial solution to this problem asking us to remove the auto-tangle function from the save hook, so let&rsquo;s do it:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 54: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">remove-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">org-mode-hook</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+literate-enable-recompile-h</span>)
</pre>
</div>

<p>
Another core behavior that does not play well with my aggressive auto-save configuration is how Doom configures <code>ws-butler</code>. While I understand the rational behind the choice of always remove blank spaces regardless the cursor position.
</p>

<p>
To adjust that, let&rsquo;s make <code>ws-butler</code> behave how I expect it:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 55: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> ws-butler
  (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">ws-butler-keep-whitespace-before-point</span> t))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgad19e9f" class="outline-3">
<h3 id="orgad19e9f"><span class="section-number-3">2.12</span> Persist frame position and geometry</h3>
<div class="outline-text-3" id="text-2-12">
<p>
Before I start tackling my own requirement, let&rsquo;s make Emacs <i>remember</i> its window size and position between launches.
</p>

<p>
First, I like to define an auto loaded function to hook into the emacs kill process to save frame dimensions. The reason to get an auto load function, is to allow Emacs to <b>not</b> load it until it really needs it, which would be when I&rsquo;m quitting Emacs.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 56: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-save-frame-dimensions-h</span> ()
  <span style="font-style: italic;">"Caches the current frame dimensions and position."</span>
  (<span style="font-weight: bold;">if-let</span> ((main-frame (<span style="font-weight: bold; text-decoration: underline;">car-safe</span> (<span style="font-weight: bold; text-decoration: underline;">visible-frame-list</span>))))
      (<span style="font-weight: bold;">doom-store-put</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">last-frame-size</span>
                      (<span style="font-weight: bold; text-decoration: underline;">list</span> (<span style="font-weight: bold; text-decoration: underline;">frame-position</span> main-frame)
                            (<span style="font-weight: bold;">frame-width</span> main-frame)
                            (<span style="font-weight: bold;">frame-height</span> main-frame)
                            (<span style="font-weight: bold; text-decoration: underline;">frame-parameter</span> main-frame <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">fullscreen</span>)))))
</pre>
</div>

<p>
Then, I like to have the analog function to call when we create a frame:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 57: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-restore-frame-dimensions-h</span> ()
  <span style="font-style: italic;">"Restore frame dimensions and position from `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my-save-frame-dimensions-h</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">if-let</span> (dims (<span style="font-weight: bold;">doom-store-get</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">last-frame-size</span> <span style="font-style: italic;">"default"</span>))
      (<span style="font-weight: bold;">cl-destructuring-bind</span> ((left . top) width height fullscreen) dims
        (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">initial-frame-alist</span>
              (<span style="font-weight: bold; text-decoration: underline;">append</span> <span style="font-weight: bold; font-style: italic;">initial-frame-alist</span>
                      <span style="font-weight: bold;">`</span>((left . ,left)
                        (top . ,top)
                        (width . ,width)
                        (height . ,height)
                        (fullscreen . ,fullscreen)))))
    (<span style="font-weight: bold;">add-to-list</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">default-frame-alist</span> <span style="font-weight: bold;">'</span>(height . <span style="font-weight: bold; text-decoration: underline;">40</span>))
    (<span style="font-weight: bold;">add-to-list</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">default-frame-alist</span> <span style="font-weight: bold;">'</span>(width . <span style="font-weight: bold; text-decoration: underline;">140</span>))))
</pre>
</div>

<p>
With the function defined, I just need to connect them to the correct hooks:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 58: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">add-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">kill-emacs-hook</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-save-frame-dimensions-h</span>)
(my-restore-frame-dimensions-h)
</pre>
</div>
</div>
</div>

<div id="outline-container-org85f38df" class="outline-3">
<h3 id="org85f38df"><span class="section-number-3">2.13</span> <span class="todo TODO">TODO</span> Remote editing</h3>
</div>
</div>

<div id="outline-container-orgd0e5b26" class="outline-2">
<h2 id="orgd0e5b26"><span class="section-number-2">3</span> Personal preferences</h2>
<div class="outline-text-2" id="text-3">
<p>
This section will show the reader, some of the small changes I decided to implement on Doom related to Evil, my personal keybindings, my choice of appearance, and other personal configurations. All in all, is pretty safe to skip this section if you intend to implement your own customization.
</p>
</div>

<div id="outline-container-org8344590" class="outline-3">
<h3 id="org8344590"><span class="section-number-3">3.1</span> Evil</h3>
<div class="outline-text-3" id="text-3-1">
<p>
For most of it, Doom integration of Evil is pretty amazing, I found just one package I don&rsquo;t use (or don&rsquo;t want to use at all), two configurations that I want to do some adjustments, and three packages missing.
</p>

<p>
The package I don&rsquo;t use is <code>evil-escape</code>, and its purpose, is to allow one to type <code>j k</code> fast enough on insert mode to force moving from insert mode to normal mode.
</p>

<p>
If you&rsquo;re used to this feature, good for you, but I was never able to adjust my muscle memory to it, so I rather disable it on <code>packages.el</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 59: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">package!</span> evil-escape <span style="font-weight: bold;">:disable</span> t)
</pre>
</div>

<p>
The first Evil configuration I want to adjust to my liking is on <code>evil-goggles</code>. I understand Henrik (Doom&rsquo;s creator) has a good rational on why he setup <code>evil-goggles</code> the way it is, but I like the original design where <b>all</b> changes get the highlight treatment.
</p>

<p>
Also, I use <code>evil-cleverparens</code>, and its editing operations are not configured on <code>evil-goggles</code>, so, in order to make it work for me I have to do two things:
</p>

<ol class="org-ol">
<li>Re-enable the change feedback disabled by default on Doom;</li>
<li>Add all <code>evil-cleverparens</code> commands to the <code>evil-goggles--commands</code> to allow <code>evil-goggles</code> to handle changes from those commands as well.</li>
</ol>

<p>
I can perform those changes using <code>use-package</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 60: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> evil-goggles
  <span style="font-weight: bold;">:hook</span> (doom-first-input . <span style="font-weight: bold; font-style: italic;">evil-goggles-mode</span>)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> evil-goggles-duration <span style="font-weight: bold; text-decoration: underline;">0.15</span>
        evil-goggles-enable-delete t
        evil-goggles-enable-change t)

  (<span style="font-weight: bold;">pushnew!</span> evil-goggles--commands
            <span style="font-weight: bold;">'</span>(evil-cp-delete
              <span style="font-weight: bold;">:face</span> evil-goggles-delete-face
              <span style="font-weight: bold;">:switch</span> evil-goggles-enable-delete
              <span style="font-weight: bold;">:advice</span> evil-goggles--generic-blocking-advice)
            <span style="font-weight: bold;">'</span>(evil-cp-delete-line
              <span style="font-weight: bold;">:face</span> evil-goggles-delete-face
              <span style="font-weight: bold;">:switch</span> evil-goggles-enable-delete
              <span style="font-weight: bold;">:advice</span> evil-goggles--delete-line-advice)
            <span style="font-weight: bold;">'</span>(evil-cp-delete-sexp
              <span style="font-weight: bold;">:face</span> evil-goggles-delete-face
              <span style="font-weight: bold;">:switch</span> evil-goggles-enable-delete
              <span style="font-weight: bold;">:advice</span> evil-goggles--generic-blocking-advice)
            <span style="font-weight: bold;">'</span>(evil-cp-delete-enclosing
              <span style="font-weight: bold;">:face</span> evil-goggles-delete-face
              <span style="font-weight: bold;">:switch</span> evil-goggles-enable-delete
              <span style="font-weight: bold;">:advice</span> evil-goggles--generic-blocking-advice)
            <span style="font-weight: bold;">'</span>(evil-cp-yank
              <span style="font-weight: bold;">:face</span> evil-goggles-yank-face
              <span style="font-weight: bold;">:switch</span> evil-goggles-enable-yank
              <span style="font-weight: bold;">:advice</span> evil-goggles--generic-async-advice)
            <span style="font-weight: bold;">'</span>(evil-cp-yank-line
              <span style="font-weight: bold;">:face</span> evil-goggles-yank-face
              <span style="font-weight: bold;">:switch</span> evil-goggles-enable-yank
              <span style="font-weight: bold;">:advice</span> evil-goggles--generic-async-advice)
            <span style="font-weight: bold;">'</span>(evil-cp-yank-sexp
              <span style="font-weight: bold;">:face</span> evil-goggles-yank-face
              <span style="font-weight: bold;">:switch</span> evil-goggles-enable-yank
              <span style="font-weight: bold;">:advice</span> evil-goggles--generic-async-advice)
            <span style="font-weight: bold;">'</span>(evil-cp-yank-enclosing
              <span style="font-weight: bold;">:face</span> evil-goggles-yank-face
              <span style="font-weight: bold;">:switch</span> evil-goggles-enable-yank
              <span style="font-weight: bold;">:advice</span> evil-goggles--generic-async-advice)
            <span style="font-weight: bold;">'</span>(evil-cp-change
              <span style="font-weight: bold;">:face</span> evil-goggles-change-face
              <span style="font-weight: bold;">:switch</span> evil-goggles-enable-change
              <span style="font-weight: bold;">:advice</span> evil-goggles--generic-blocking-advice)
            <span style="font-weight: bold;">'</span>(evil-cp-change-line
              <span style="font-weight: bold;">:face</span> evil-goggles-change-face
              <span style="font-weight: bold;">:switch</span> evil-goggles-enable-change
              <span style="font-weight: bold;">:advice</span> evil-goggles--generic-blocking-advice)
            <span style="font-weight: bold;">'</span>(evil-cp-change-sexp
              <span style="font-weight: bold;">:face</span> evil-goggles-change-face
              <span style="font-weight: bold;">:switch</span> evil-goggles-enable-change
              <span style="font-weight: bold;">:advice</span> evil-goggles--generic-blocking-advice)
            <span style="font-weight: bold;">'</span>(evil-cp-change-enclosing
              <span style="font-weight: bold;">:face</span> evil-goggles-change-face
              <span style="font-weight: bold;">:switch</span> evil-goggles-enable-change
              <span style="font-weight: bold;">:advice</span> evil-goggles--generic-blocking-advice)
            <span style="font-weight: bold;">'</span>(evil-paste-after
              <span style="font-weight: bold;">:face</span> evil-goggles-paste-face
              <span style="font-weight: bold;">:switch</span> evil-goggles-enable-paste
              <span style="font-weight: bold;">:advice</span> evil-goggles--paste-advice
              <span style="font-weight: bold;">:after</span> t)
            <span style="font-weight: bold;">'</span>(evil-cp-copy-paste-form
              <span style="font-weight: bold;">:face</span> evil-goggles-paste-face
              <span style="font-weight: bold;">:switch</span> evil-goggles-enable-paste
              <span style="font-weight: bold;">:advice</span> evil-goggles--paste-advice
              <span style="font-weight: bold;">:after</span> t)))
</pre>
</div>

<p>
After this I can sneak a quick modification to allow <code>evil-goggles</code> to use the same faces used on <code>diff</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 61: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> evil-goggles
  (evil-goggles-use-diff-refine-faces))
</pre>
</div>

<p>
The second configuration is regarding centralizing the cursor after search jumps. I find myself pretty uncomfortable after I press <code>n</code> following a search term, and I figured it out that what makes me uncomfortable is the fact the cursor is on the bottom of the screen, and I have almost no visibility of the text after it.
</p>

<p>
To fix this, I will add an advice after the Evil search function used to perform those jumps, to recenter the cursor on the window:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 62: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defadvice!</span> my-center-after-jump-a (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> _)
  <span style="font-weight: bold;">:after</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">evil-ex-search</span>
  (<span style="font-weight: bold;">evil-scroll-line-to-center</span> nil))
</pre>
</div>

<p>
And to make this behavior more consistent throughout the editor, I will add the same function used to advise <code>'evil-ex-search</code> as a hook to the <code>evil-jumps-post-jump-hook</code> hook:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 63: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> evil
  (<span style="font-weight: bold;">add-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">evil-jumps-post-jump-hook</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-center-after-jump-a</span>))
</pre>
</div>

<p>
And finally, for the packages I&rsquo;m missing, they are:
</p>

<ul class="org-ul">
<li><code>evil-matchit</code></li>
<li><code>plus-minus</code></li>
<li><code>evil-string-inflection</code></li>
</ul>
</div>

<div id="outline-container-org3d50a2e" class="outline-4">
<h4 id="org3d50a2e"><span class="section-number-4">3.1.1</span> Evil-MatchIt</h4>
<div class="outline-text-4" id="text-3-1-1">
<p>
In all fairness, <code>matchit</code> (the one originally from Vim) is also disabled by default, but it provides such useful feature that I can&rsquo;t understand why it is not part of the standard Vim/Evil.
</p>

<p>
To the reader not familiar with this plugin, let me give a brief overview of it. You probably know that pressing the key <code>%</code> on a pair character (e.g. <code>(</code>, <code>)</code>, <code>[</code>, <code>]</code>, etc.), makes the cursor jump to the other pair.
</p>

<p>
The <code>matchit</code> plugin, extends this functionality to other types of pairs, like XML/HTML tags, language control flows like <code>if</code>, <code>else</code>, and <code>endif</code>, and others. So, as I said, a pretty useful plugin!
</p>

<p>
Since <code>evil-matchit</code> is not distributed with Doom, I need to bring its package in:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 64: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">package!</span> evil-matchit)
</pre>
</div>

<p>
Then, need to make sure to enable the plugin itself. In order to not slow the Emacs startup, I will enable it after I load the first file into a buffer:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 65: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> evil-matchit
  <span style="font-weight: bold;">:hook</span> (doom-first-file . global-evil-matchit-mode)
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">setq</span> evilmi-quote-chars (<span style="font-weight: bold;">string-to-list</span> <span style="font-style: italic;">"'\"/"</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd3d6e1a" class="outline-4">
<h4 id="orgd3d6e1a"><span class="section-number-4">3.1.2</span> Plus-Minus</h4>
<div class="outline-text-4" id="text-3-1-2">
<p>
<code>plus-minus</code> is a package that provides the functionality to increase or decrease a number value at point. On Vim, the key bindings for these actions are <code>C-a</code> and <code>C-x</code> respectively.
</p>

<p>
I spend too much time thinking that I should preserve the <code>C-x</code> keybinding for Emacs&rsquo; sake, and I learn to use a command or two that uses it, but the reality is that I don&rsquo;t really need it, so I will give it a try on rebinding this key to its original Vim purpose, but instead of using <code>evil-numbers</code> (which Doom provides as a core package), I&rsquo;ll try a brand new package called <code>plus-minus</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 66: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">package!</span> evil-numbers <span style="font-weight: bold;">:disable</span> t)

(<span style="font-weight: bold;">package!</span> plus-minus
  <span style="font-weight: bold;">:recipe</span> (<span style="font-weight: bold;">:host</span> github
           <span style="font-weight: bold;">:repo</span> <span style="font-style: italic;">"peterwu/plus-minus"</span>))
</pre>
</div>

<p>
Since this package provides the correct <code>autoloads</code> on it, I can simply configure it to get deferred until I actually need it:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 67: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> plus-minus <span style="font-weight: bold;">:defer</span> t)
</pre>
</div>

<p>
Before defining the keybindings for this I would like to have an extra behavior when I try to increase or decrease a number at point. I would like to rotate the text at point with the same keybinding if the <i>thing at point</i> is not a number.
</p>

<p>
Doom ships with the <code>rotate-text</code> package by default, but I need couple helper functions to define which package should handle the key press:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 68: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-inc-or-rotate-at-point</span> (arg)
  <span style="font-style: italic;">"Try to rotate or increase the text at point.</span>

<span style="font-style: italic;">If the thing under cursor is not rotated, tries to increase the number at</span>
<span style="font-style: italic;">`</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">point</span><span style="font-style: italic;">' or the first number from `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">point</span><span style="font-style: italic;">' to `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">point-at-eol</span><span style="font-style: italic;">'.</span>

<span style="font-style: italic;">When called with ARG (by using the universal prefix key) the search for a number</span>
<span style="font-style: italic;">happens from `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">point</span><span style="font-style: italic;">' to `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">point-at-bol</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"p"</span>)
  (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">thing-at-point</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">number</span>)
      (<span style="font-weight: bold;">if</span> <span style="font-weight: bold; font-style: italic;">current-prefix-arg</span> (+/-:backward+) (+/-:forward+))
    (<span style="font-weight: bold;">condition-case</span> nil
        (<span style="font-weight: bold;">rotate-text</span> arg)
      (<span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">error</span> (<span style="font-weight: bold;">if</span> <span style="font-weight: bold; font-style: italic;">current-prefix-arg</span> (+/-:backward+) (+/-:forward+))))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 69: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-dec-or-rotate-at-point</span> (arg)
  <span style="font-style: italic;">"Try to rotate or decrease the text at point.</span>

<span style="font-style: italic;">If the thing under cursor is not rotated, tries to decrease the number at</span>
<span style="font-style: italic;">`</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">point</span><span style="font-style: italic;">' or the first number from `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">point</span><span style="font-style: italic;">' to `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">point-at-eol</span><span style="font-style: italic;">'.</span>

<span style="font-style: italic;">When called with ARG (by using the universal prefix key) the search for a number</span>
<span style="font-style: italic;">happens from `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">point</span><span style="font-style: italic;">' to `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">point-at-bol</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"p"</span>)
  (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">thing-at-point</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">number</span>)
      (<span style="font-weight: bold;">if</span> <span style="font-weight: bold; font-style: italic;">current-prefix-arg</span> (+/-:backward- <span style="font-weight: bold; text-decoration: underline;">1</span>) (+/-:forward- <span style="font-weight: bold; text-decoration: underline;">1</span>))
    (<span style="font-weight: bold;">condition-case</span> nil
        (<span style="font-weight: bold;">rotate-text</span> arg)
      (<span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">error</span> (<span style="font-weight: bold;">if</span> <span style="font-weight: bold; font-style: italic;">current-prefix-arg</span> (+/-:backward- <span style="font-weight: bold; text-decoration: underline;">1</span>) (+/-:forward- <span style="font-weight: bold; text-decoration: underline;">1</span>))))))
</pre>
</div>

<p>
And I also like to define some extra words for rotation:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 70: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> rotate-text
  (<span style="font-weight: bold;">add-to-list</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">rotate-text-words</span> <span style="font-weight: bold;">'</span>(<span style="font-style: italic;">"yes"</span> <span style="font-style: italic;">"no"</span>))
  (<span style="font-weight: bold;">add-to-list</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">rotate-text-words</span> <span style="font-weight: bold;">'</span>(<span style="font-style: italic;">"allow"</span> <span style="font-style: italic;">"deny"</span>))
  (<span style="font-weight: bold;">add-to-list</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">rotate-text-words</span> <span style="font-weight: bold;">'</span>(<span style="font-style: italic;">"allowed"</span> <span style="font-style: italic;">"denyed"</span>)))
</pre>
</div>

<p>
With all in place, we just need to define the keybindings:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 71: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">map!</span>
  <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"C-a"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-inc-or-rotate-at-point</span>
  <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"C-x"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-dec-or-rotate-at-point</span>
  (<span style="font-weight: bold;">:prefix</span> <span style="font-style: italic;">"g"</span>
    <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Inc sequence"</span> <span style="font-weight: bold;">:v</span> <span style="font-style: italic;">"C-a"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+/-:block+</span>
    <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Dec sequence"</span> <span style="font-weight: bold;">:v</span> <span style="font-style: italic;">"C-x"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+/-:block-</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org92bdfc0" class="outline-4">
<h4 id="org92bdfc0"><span class="section-number-4">3.1.3</span> Evil-String-Inflection</h4>
<div class="outline-text-4" id="text-3-1-3">
<p>
I&rsquo;ve been on situations where I realized that I used <i>camelCase</i> for all my variables, where the standard coding style of the language, request to use <i>snake<sub>case</sub></i> style. There are packages available, that allow you to cycle through all case styles on a given word.
</p>

<p>
I found the <code>evil-string-inflection</code> to have one of the best integration with Evil, so I will stick with it for a while to evaluate things:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 72: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">package!</span> evil-string-inflection)
</pre>
</div>

<p>
As with the <code>matchit</code> package, I&rsquo;ll defer its loading until we need it, but different from <code>matchit</code>, I have to defer it using an alternative approach. I will make the package load on the first invocation of the command <code>evil-operator-string-inflection</code>, then, on the <code>:init</code> section, I will setup the proper keymap using the Doom <code>map!</code> function:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 73: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> evil-string-inflection
  <span style="font-weight: bold;">:commands</span> (evil-operator-string-inflection)
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">map!</span> <span style="font-weight: bold;">:prefix</span> <span style="font-style: italic;">"g"</span>
        <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"String inflection"</span> <span style="font-weight: bold;">:o</span> <span style="font-style: italic;">"~"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">evil-operator-string-inflection</span>))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org7077caf" class="outline-3">
<h3 id="org7077caf"><span class="section-number-3">3.2</span> Keybindings</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Since I decided to write this configuration, I also decided to try to use the standard Doom key bindings as much as possible, and for the most part of it, I&rsquo;m not having as much problem as I expected. There are three main areas where I still like to define my own bindings.
</p>
</div>

<div id="outline-container-org54e027d" class="outline-4">
<h4 id="org54e027d"><span class="section-number-4">3.2.1</span> Window navigation</h4>
<div class="outline-text-4" id="text-3-2-1">
<p>
A while ago, I configured Vim to move the cursor from one window to another using the standard movements keys (<code>h</code>, <code>j</code>, <code>k</code>, and <code>l</code>) while keeping <code>Ctrl</code> pressed. I got so used to these shortcuts, that I can&rsquo;t live without it anymore.
</p>

<p>
The good news is that, on most cases, there is no conflict between features I use and these shortcuts, and on the cases that a conflict exists, there are reasonable options to workaround these limitations.
</p>

<p>
The first step to achieve a global is to clean the target keys from any keymap that might bind them to a command:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 74: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">map!</span>
 (<span style="font-weight: bold;">:after</span> outline
  (<span style="font-weight: bold;">:map</span> <span style="font-weight: bold; font-style: italic;">outline-mode-map</span>
   <span style="font-weight: bold;">:gn</span> <span style="font-style: italic;">"C-h"</span> nil
   <span style="font-weight: bold;">:gn</span> <span style="font-style: italic;">"C-j"</span> nil
   <span style="font-weight: bold;">:gn</span> <span style="font-style: italic;">"C-k"</span> nil
   <span style="font-weight: bold;">:gn</span> <span style="font-style: italic;">"C-l"</span> nil)))
</pre>
</div>

<p>
After that, I can bind these keys to the target window movements to the proper window commands:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 75: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">map!</span>
  <span style="font-weight: bold;">:gn</span> <span style="font-style: italic;">"C-h"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">evil-window-left</span>
  <span style="font-weight: bold;">:gn</span> <span style="font-style: italic;">"C-j"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">evil-window-down</span>
  <span style="font-weight: bold;">:gn</span> <span style="font-style: italic;">"C-k"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">evil-window-up</span>
  <span style="font-weight: bold;">:gn</span> <span style="font-style: italic;">"C-l"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">evil-window-right</span>)
</pre>
</div>

<p>
Some other modes don&rsquo;t play nice with this particular key bindings I choose, and I have to adjust them accordingly. This is the case of the <code>Info-mode</code>, where <code>C-j</code> and <code>C-k</code> are the keys to navigate forward and backwards on nodes. The solution for me is to bind those commands to other keys, and configure the proper window navigation:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 76: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">map!</span> <span style="font-weight: bold;">:after</span> info
      <span style="font-weight: bold;">:map</span> Info-mode-map
      <span style="font-weight: bold;">:gn</span> <span style="font-style: italic;">"s-k"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">Info-backward-node</span>
      <span style="font-weight: bold;">:gn</span> <span style="font-style: italic;">"s-j"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">Info-forward-node</span>
      <span style="font-weight: bold;">:gn</span> <span style="font-style: italic;">"C-k"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">evil-window-up</span>
      <span style="font-weight: bold;">:gn</span> <span style="font-style: italic;">"C-j"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">evil-window-down</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org1f1b823" class="outline-4">
<h4 id="org1f1b823"><span class="section-number-4">3.2.2</span> Vim defaults</h4>
<div class="outline-text-4" id="text-3-2-2">
<p>
Here I need to make yet another disclaimer to the reader: I know what I&rsquo;m about to write is a pet peeve, and most likely most Doom users won&rsquo;t even understand this, but&#x2026;
</p>

<p>
On Doom, there are these keymaps bound to <code>&lt;leader&gt; w ...</code>, that should match Vim&rsquo;s <code>&lt;C-w&gt; &lt;C-...&gt;</code>. Since the <i>leader shortcuts</i> are more ergonomic for me, I got used to them quickly. The problem I have, is the difference between <code>&lt;C-w&gt; &lt;C-o&gt;</code> and <code>&lt;leader&gt; w o</code>!
</p>

<p>
To not lose a Doom-only keymap, instead of simply rebinding <code>&lt;leader&gt; w o</code> to the <i>correct</i> command, I&rsquo;ll <i>move</i> <code>doom/window-enlargen</code> to a different keymap (<code>&lt;leader&gt; w z</code> to represent <i>zoom window</i>), and assign the <i>correct</i> command to the <i>correct</i> keymap:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 77: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">map!</span> <span style="font-weight: bold;">:leader</span> <span style="font-weight: bold;">:prefix</span> (<span style="font-style: italic;">"w"</span> . <span style="font-style: italic;">"window"</span>)
      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Enlarge window"</span>         <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"z"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">doom/window-enlargen</span>
      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Select window"</span>          <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"o"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">delete-other-windows</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org1f72307" class="outline-4">
<h4 id="org1f72307"><span class="section-number-4">3.2.3</span> Personal shortcuts</h4>
<div class="outline-text-4" id="text-3-2-3">
<p>
Key bindings in this section are purely personal choice. Feel free to give them a try if you want, but if you&rsquo;re used to Doom Emacs already, my suggestion is to skip this section.
</p>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
The first keymap group I like to add custom shortcuts is the multiple cursors. When I first heard about multiple cursors, was on a demo of the <a href="https://macromates.com/">TextMate</a> editor. I got so impressed by it that this feature was one of the first things I would search on an editor. Fast forwarding to January 2008, I was watching yet another demo of a brand new editor, when the person showing off the features, demonstrated the multiple cursors. This editor was <a href="https://www.sublimetext.com">Sublime Text</a>, and I couldn&rsquo;t resist the chance to give it a try. For reasons of the brain (at least my brain), the shortcuts defined to manipulate multiple cursors got engraved in my memory, and recently, I decide to stop fighting against it and embrace! So these are the shortcuts (which might be different from the current shortcuts in Sublime) that I got <i>used to</i>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 78: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">map!</span>
 <span style="font-weight: bold;">:gn</span> <span style="font-style: italic;">"s-d"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">evil-mc-make-and-goto-next-match</span>
 <span style="font-weight: bold;">:gn</span> <span style="font-style: italic;">"s-u"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">evil-mc-skip-and-goto-prev-cursor</span>
 <span style="font-weight: bold;">:gn</span> <span style="font-style: italic;">"s-n"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">evil-mc-skip-and-goto-next-match</span>
 <span style="font-weight: bold;">:gn</span> <span style="font-style: italic;">"s-g"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">evil-mc-make-all-cursors</span>
 <span style="font-weight: bold;">:gn</span> <span style="font-style: italic;">"C-M-k"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">evil-mc-make-cursor-move-prev-line</span>
 <span style="font-weight: bold;">:gn</span> <span style="font-style: italic;">"C-M-j"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">evil-mc-make-cursor-move-next-line</span>)
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
Another <i>nice to have</i> binding I got used to, is to move blocks of text up and down, using <code>j</code> and <code>k</code>, plus the <code>Meta</code> (a.k.a. <code>Alt</code>, <code>option</code>, or  <code>⌥</code>):
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 79: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">map!</span> <span style="font-weight: bold;">:nvi</span> <span style="font-style: italic;">"M-j"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">drag-stuff-down</span>
      <span style="font-weight: bold;">:nvi</span> <span style="font-style: italic;">"M-k"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">drag-stuff-up</span>)
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
Something that I really like but usually forget to use is the ability to insert a new line while on <i>insert mode,</i> above or bellow the current line, regardless where the cursor is. To use it, I would simply press <code>&lt;ENTER&gt;</code> with <code>&lt;SUPER&gt;</code> (a.k.a. <code>cmd</code> or <code>⌘</code>) to insert a line bellow, or <code>&lt;ENTER&gt;</code> plus <code>&lt;SHIFT&gt;</code> and <code>&lt;SUPER&gt;</code> for a line above:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 80: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">map!</span> <span style="font-weight: bold;">:i</span> [s-return]   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+default/newline-below</span>
      <span style="font-weight: bold;">:i</span> [s-S-return] <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+default/newline-above</span>
      (<span style="font-weight: bold;">:when</span> <span style="font-weight: bold; font-style: italic;">IS-MAC</span>
         <span style="font-weight: bold;">:gn</span> <span style="font-style: italic;">"s-RET"</span>        nil
         <span style="font-weight: bold;">:gn</span> [s-return]     nil
         <span style="font-weight: bold;">:gn</span> <span style="font-style: italic;">"S-s-RET"</span>      nil
         <span style="font-weight: bold;">:gn</span> [S-s-return]   nil))
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
Doom Emacs, offer a shortcut to bring back the last dismissed popup, which is what I want to do on the majority of the cases. But some times, I want to bring back a specific popup buffer to the front, and I like to have a dedicated prefix key to handle this scenario.
</p>

<p>
For now, I set a shortcut for the <code>*Messages*</code>, and the <code>*Backtrace*</code> buffers, but more popup buffer might get added here in the future:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 81: </span>config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">map!</span> <span style="font-weight: bold;">:leader</span> <span style="font-weight: bold;">:prefix</span> (<span style="font-style: italic;">"v"</span> . <span style="font-style: italic;">"view"</span>)
      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"View Messages"</span> <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"m"</span> <span style="font-weight: bold;">#'</span>(lambda ()
                                       (<span style="font-weight: bold;">interactive</span>)
                                       (<span style="font-weight: bold;">pop-to-buffer</span> <span style="font-style: italic;">"*Messages*"</span>)
                                        (<span style="font-weight: bold; text-decoration: underline;">goto-char</span> (<span style="font-weight: bold; text-decoration: underline;">point-max</span>)))
      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"View Backtrace"</span> <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"e"</span> <span style="font-weight: bold;">#'</span>(lambda ()
                                        (<span style="font-weight: bold;">interactive</span>)
                                        (<span style="font-weight: bold;">pop-to-buffer</span> <span style="font-style: italic;">"*Backtrace*"</span>)))
</pre>
</div>

<p>
As you can see, I also like to <i>scroll to the bottom</i> of the buffer when opening messages. The rational behind it is the fact that if I want to quick loo into the <code>*Messages*</code> buffer, is most likely to check the latest messages there.
</p>

<p>
Also for the <code>*Messages*</code> buffer, I like to be able to press <code>q</code> to quit as well. Unfortunately this is not defined by default:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 82: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">map!</span> <span style="font-weight: bold;">:map</span> <span style="font-weight: bold; font-style: italic;">messages-buffer-mode-map</span>
      <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"q"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">delete-window</span>)
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
One binding I feel is missing on Doom, is the ability to evaluate any sexp on <b>any</b> mode, like a <i>global</i> <code>eval-last-sexp</code>. Gladly, it&rsquo;s easy enough to create my own:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 83: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">map!</span> <span style="font-weight: bold;">:prefix</span> <span style="font-style: italic;">"g"</span>
      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Eval last sexp"</span> <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">")"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">eval-last-sexp</span>)
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
I don&rsquo;t remember when this shortcut entered my life, but some time ago I got used to use <code>s-RET</code> to <i>confirm operations</i> like sending emails and messages. In order to try to replicate this behavior I will start setting it to the <code>with-editor-mode-map</code> together with the analog cancel operation with <code>s-ESC</code> shortcut:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 84: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">map!</span> <span style="font-weight: bold;">:map</span> <span style="font-weight: bold; font-style: italic;">with-editor-mode-map</span>
      <span style="font-weight: bold;">:in</span> [s-return] <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">with-editor-finish</span>
      <span style="font-weight: bold;">:in</span> [s-escape] <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">with-editor-cancel</span>)
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
Doom ships with the <i>Rainbow Mode</i> package, which is a package that colorizes strings that represent colors. Usually there is no need to enable this mode globally because the colorization might get in the way of legibility, but on the cases where it is useful (e.g. editing CSS or Android XML files), it is <b>really</b> useful.
</p>

<p>
Because of this, I want to set this mode as a toggable shortcut:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 85: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">map!</span> <span style="font-weight: bold;">:leader</span> <span style="font-weight: bold;">:prefix</span> (<span style="font-style: italic;">"t"</span> . <span style="font-style: italic;">"toggle"</span>)
      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Rainbow mode"</span> <span style="font-weight: bold;">:mvn</span> <span style="font-style: italic;">"R"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">rainbow-mode</span>)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9b1d559" class="outline-3">
<h3 id="org9b1d559"><span class="section-number-3">3.3</span> Appearances</h3>
<div class="outline-text-3" id="text-3-3">
<p>
As far as I understand, there is a share of Emacs users that value Emacs functionalities over its looks, and I would like to write something targeted for those users.
</p>

<p>
You are awesome! I can&rsquo;t imagine how liberating it would feel if my brain did not obsessed about my editor&rsquo;s appearance, so, stay strong folks! The breakthroughs on technology happens more often by the desired of people like you then people like me.
</p>

<p>
With that out of the way, I need to explain to the reader my personal position on this subject. As a person with <a href="https://en.wikipedia.org/wiki/Attention_deficit_hyperactivity_disorder">ADHD</a> and <a href="https://en.wikipedia.org/wiki/Obsessive%E2%80%93compulsive_disorder">OCD</a>.
</p>

<p>
Looks mater. There is not much else to say, but if you need a bit more let me say this: When your brain is constantly searching for dopamine, and is incapable to retain it for much longer, every tinny rewarding counts towards the goal to keep my focus on one subject. If my work environment is pleasing to look, there is a lower chance my brain gets distracted by the scene outside the window. If I open my editor and get the feeling of <i>&ldquo;oh yeah&rdquo;</i>, than my brain will look forward to use the same tool again, or as I saw on this <a href="https://twitter.com/ADHDelaide/status/1326412306079682560">tweet</a> a while ago, and reproduce it here for you:
</p>

<blockquote>
<p>
❝ Having <b>ADHD</b> is basically finding new ways to trick your brain into doing the stuff you want it to do, until you die. ❞
─ <b>@ADHDelaide</b>
</p>
</blockquote>

<p>
Nevertheless, keep in mind that taste, is a personal thing. What I consider to be beautiful, might look horrendous to the reader, and that is OK.
</p>

<p>
So, if you&rsquo;re happy with the look and feel of your editor, feel free to skip this entire section.
</p>
</div>

<div id="outline-container-orgb8a4d8e" class="outline-4">
<h4 id="orgb8a4d8e"><span class="section-number-4">3.3.1</span> Frame</h4>
<div class="outline-text-4" id="text-3-3-1">
<p>
The Emacs frame is the container for my small world, and although I intend to do most of my things within Emacs, I still want it to look like it belongs to its environment (macOS in my case), and there are couple things I like to change to make it more macOS.
</p>

<p>
The first one is to remove the text from the title bar. On macOS, the application name is present on the system menu, so there is no reason to keep any text on the title bar:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 86: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">frame-title-format</span> nil
      ns-use-proxy-icon nil)
</pre>
</div>

<p>
And the second one, is to make the title bar to have the same color as the background of my selected theme:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 87: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">add-to-list</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">default-frame-alist</span> <span style="font-weight: bold;">'</span>(ns-transparent-titlebar . t))
</pre>
</div>
</div>
</div>

<div id="outline-container-org8665a3a" class="outline-4">
<h4 id="org8665a3a"><span class="section-number-4">3.3.2</span> Editor</h4>
<div class="outline-text-4" id="text-3-3-2">
<p>
The first thing to do to help with my editor appearance, is to store the current line height in a variable. This way, other adjustments can use this value without worrying about different font sizes:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 88: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-line-pixel-height</span> (<span style="font-weight: bold; text-decoration: underline;">line-pixel-height</span>)
  <span style="font-style: italic;">"Line height in pixels.</span>

<span style="font-style: italic;">Used to avoid getting the wrong line height when `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">text-scale-mode</span><span style="font-style: italic;">' is active."</span>)
</pre>
</div>

<p>
One editor visual I like to have while I&rsquo;m coding, is the <code>fill-column-indicator</code>. Unfortunately I discovered that on macOS, the default <code>fill-column-indicator</code> face, can&rsquo;t render Unicode characters properly. The workaround here is to make this particular face to use a font that can render them:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 89: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">set-face-attribute</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">fill-column-indicator</span> nil
                    <span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"Arial Unicode MS"</span>
                    <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">140</span>
                    <span style="font-weight: bold;">:foreground</span> (<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">base3</span> <span style="font-weight: bold; text-decoration: underline;">256</span>))
</pre>
</div>

<p>
Using <i>Arial Unicode MS</i> allow me to use the &ldquo;<code>┊</code>&rdquo; character to decorate my <code>prog-mode</code> buffers. After setting this up, I need to adjust the <code>fill-column</code> value to the column I want (while is usually 100),  and make the column indicator use the correct Unicode character (which is <code>0x9482</code>):
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 90: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq-default</span> <span style="font-weight: bold; font-style: italic;">fill-column</span> <span style="font-weight: bold; text-decoration: underline;">100</span>
              <span style="font-weight: bold; font-style: italic;">display-fill-column-indicator-column</span> <span style="font-weight: bold; text-decoration: underline;">100</span>
              <span style="font-weight: bold; font-style: italic;">display-fill-column-indicator-character</span> <span style="font-weight: bold; text-decoration: underline;">9482</span>)
</pre>
</div>

<p>
After this configuration I want to make sure the column indicator is off by default:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 91: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold; font-style: italic;">global-hl-line-mode</span> <span style="font-weight: bold; text-decoration: underline;">-1</span>)
</pre>
</div>

<p>
And enabled on all <code>prog-mode</code> buffers:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 92: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">add-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">prog-mode-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">display-fill-column-indicator-mode</span>)
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
As with column indicator, there is another visual that I consider crucial for programming, but a bit annoying when writing prose: The current line highlight.
</p>

<p>
I can&rsquo;t imagine coding without it, but when I&rsquo;m writing, it becomes more a distraction then an aid.
</p>

<p>
On Doom, to make sure current line highlight gets disabled, you need to remove its global mode from the <code>doom-first-buffer-hook</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 93: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">remove-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">doom-first-buffer-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">global-hl-line-mode</span>)
</pre>
</div>

<p>
Then, I can add the mode to all <code>prog-mode</code> buffers with another hook:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 94: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">add-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">prog-mode-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">hl-line-mode</span>)
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
Another extra for the editor visuals is rendering the character <code>^L</code>, which represents a page break (more precisely, the <i>form feed</i> character).
</p>

<p>
The page break character is consider a <i>space</i> or <i>empty</i> character, which allows one to add it on a coding file without breaking the build for such file.
</p>

<p>
There are a couple packages that achieve this goal but I set on the <a href="https://github.com/purcell/page-break-lines"><code>page-break-lines</code></a> from <a href="https://github.com/purcell">Steve Purcell</a> because he chose to implement this feature using glyph composition instead of <i>font-lock</i>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 95: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">package!</span> page-break-lines)
</pre>
</div>

<p>
There is just one configuration I prefer to change over the defaults, which is the size of thee horizontal line. I like the horizontal like to stop at the <code>fill-column</code> column, which gives this nice <i>box feeling</i> to the code.
</p>

<p>
Besides this change, I only enable the mode on <code>prog-mode</code> buffers, and I like to define a shortcut key to jump to the next or previous page break:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 96: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> page-break-lines
  <span style="font-weight: bold;">:hook</span> ((<span style="font-weight: bold;">prog-mode</span> . page-break-lines-mode))
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">setq</span> page-break-lines-max-width <span style="font-weight: bold; font-style: italic;">fill-column</span>)

  (<span style="font-weight: bold;">map!</span> <span style="font-weight: bold;">:prefix</span> <span style="font-style: italic;">"g"</span>
        <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Prev page break"</span> <span style="font-weight: bold;">:nv</span> <span style="font-style: italic;">"["</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">backward-page</span>
        <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Next page break"</span> <span style="font-weight: bold;">:nv</span> <span style="font-style: italic;">"]"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">forward-page</span>))
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
Since the time when widescreen monitors became the standard, when it comes to split windows in two, I prefer horizontal splits (one window aside of the other). In order to tell Emacs that I prefer horizontal splits, I have to set the width split threshold to a small number to add weight on Emacs&rsquo; decision of which orientation to split:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 97: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">split-width-threshold</span> <span style="font-weight: bold; text-decoration: underline;">40</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org1925b1a" class="outline-4">
<h4 id="org1925b1a"><span class="section-number-4">3.3.3</span> Theme</h4>
<div class="outline-text-4" id="text-3-3-3">
<p>
I believe this section to be the most volatile section on this text. Since I got interested on cool old esoteric editors, I&rsquo;m on an endless search for the Holy Grail of themes. So far I got fond of Tomorrow Night and I use it for the most part of the last 5 years. Recently I got annoyed by some color choices of the theme (the background and line highlight are a bit odd in my opinion), so I kept looking.
</p>

<p>
I decided to give <i>Doom-One</i> a try, and so far I&rsquo;m enjoying. I will admit that the purple-ish feeling of the palette is not my style, but overall, I&rsquo;m not finding a bed choice.
</p>

<p>
So, to make <i>Doom-One</i> the default theme, set the variable <code>doom-theme</code> to the symbol <code>'doom-one</code> to let Doom know what is the theme it should load:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 98: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">doom-theme</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">doom-one</span>)
</pre>
</div>

<p>
And because I like visual cues on my editor, I will turn on the ability to display <b>bold</b> and <i>italic</i> faces for the theme:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 99: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> doom-themes-enable-bold t
      doom-themes-enable-italic t)
</pre>
</div>

<p>
The one complain I have on Doom theme in general, is the conflict <code>solaire-mode</code> has with <code>mixed-pitch</code>. If you turn both on, you will lose the variable pitch font. Until somehow, someone fix this, I will disable <code>solaire</code> mode to keep the editor UX consistent with my requirements:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 100: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">package!</span> solaire-mode <span style="font-weight: bold;">:disable</span> t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc69c5cd" class="outline-4">
<h4 id="orgc69c5cd"><span class="section-number-4">3.3.4</span> Typography</h4>
<div class="outline-text-4" id="text-3-3-4">
<p>
This section requires an important disclaimer to the reader. In majority of the cases, one should not <i>need</i> to customize their fonts the way I&rsquo;m doing it. Doom Emacs has a system to configure the editor fonts, and one should prefer to use such systems instead of this particular configuration.
</p>

<p>
Doom exposes five (optional) variables for controlling fonts:
</p>

<dl class="org-dl">
<dt><code>doom-font</code></dt><dd>The global font used by Emacs;</dd>
<dt><code>doom-big-font</code></dt><dd>Used for <code>doom-big-font-mode</code>, which you can use for presentations or streaming;</dd>
<dt><code>doom-variable-pitch-font</code></dt><dd>Font used for prose text (if you configure such modes to accept variable pitch fonts);</dd>
<dt><code>doom-serif-font</code></dt><dd>The default font to use for the fixed-pitch-serif face;</dd>
<dt><code>doom-unicode-font</code></dt><dd>Fallback font for Unicode glyphs;</dd>
</dl>

<p>
They all accept either a font-spec, a font string (e.g. &ldquo;Input Mono-12&rdquo;), or a <code>xlfd</code> font string. You generally only need <code>doom-font</code> and <code>doom-variable-pitch-font</code>, but I like to set <code>doom-big-font</code> as well, to make sure any time I switch to a presentation mode, it still feels like I have the same editor, but with a bigger font.
</p>

<p>
With that out of the way, I need to explain what is, and why my <i>typography</i> configuration exists.
</p>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
In the past years, I&rsquo;ve got involved in some projects where I worked directly with the UX team on visual identity tasks. One of the first thing I got used to do, is to define the typography of the project. But what is typography? According to the wikipedia:
</p>

<blockquote>
<p>
<b>Typography</b> is the art and technique of arranging type to make written language legible, readable and appealing when displayed.
</p>
</blockquote>

<p>
In the case of my configuration, I can define typography as a set of rules regarding displayed text that I want to use regardless the mode Emacs is in. Or simply put:
</p>

<p>
Text in my editor must be consistent, and look good.
</p>

<p>
To achieve this, I have to define said rules, and create a mechanism that will help me get the editor to behave the way I want. The one exception are the colors used on text elements. I want to let this particular trait to the theme I&rsquo;m using.
</p>

<p>
The first rule to define is the simplest one: which fonts to use throughout the editor.
</p>

<p>
Currently, I narrowed my selection to these 3 fonts:
</p>

<dl class="org-dl">
<dt><a href="https://github.com/iaolo/iA-Fonts">iA Writer Mono</a></dt><dd>Used as my default monospaced font. The actual font I&rsquo;m using is the <a href="https://www.nerdfonts.com/">Nerd Fonts</a> version, known as <i>&ldquo;iMWritingMonoS Nerd Font&rdquo;</i> due to its support for the <code>all-the-icons</code> package;</dd>
<dt><a href="https://github.com/iaolo/iA-Fonts">iA Writer Quattro</a></dt><dd>Used as my default font for prose writing. For this font in particular, I can&rsquo;t use the Nerd Fonts version, nor the version distributed through <a href="https://brew.sh/">Homebrew</a>. These versions, use the static version of the font that does not support different weights. For my configuration I use the <a href="https://github.com/iaolo/iA-Fonts/tree/master/iA%20Writer%20Quattro/Variable">Veriable</a> version of the font;</dd>
<dt><a href="https://github.com/googlefonts/roboto">Roboto</a></dt><dd>Used on UI elements like the project drawer, tab names, and tooltips;</dd>
</dl>

<p>
To install the <a href="https://github.com/iaolo/iA-Fonts">iA Writer Mono</a> and the <a href="https://github.com/googlefonts/roboto">Roboto</a>, one can use <a href="https://brew.sh/">Homebrew</a> on macOS:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 101: </span>Commands to install fonts with Homebrew</label><pre class="src src-shell">brew tap homebrew/cask-fonts
brew install --cask font-roboto font-im-writing-nerd-font
</pre>
</div>

<p>
But for the <a href="https://github.com/iaolo/iA-Fonts">iA Writer Quattro</a> you have to use to install it manually because the version offered by Homebrew is the static version of the font, which does not come with all the weights available. The correct font to install here is the <i>variable</i> type.
</p>

<p>
To install the correct font, first download it using <code>curl</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 102: </span>Commands to download the iA Writer font</label><pre class="src src-shell"><span style="font-weight: bold; text-decoration: underline;">cd</span> ~/Downloads &amp;&amp; {
 <span style="font-weight: bold; text-decoration: underline;">curl</span> -O <span style="font-style: italic;">'https://github.com/iaolo/iA-Fonts/raw/master/iA%20Writer%20Quattro/Variable/iAWriterQuattroV.ttf'</span>
 <span style="font-weight: bold; text-decoration: underline;">curl</span> -O <span style="font-style: italic;">'https://github.com/iaolo/iA-Fonts/raw/master/iA%20Writer%20Quattro/Variable/iAWriterQuattroV-Italic.ttf'</span>
 <span style="font-weight: bold; text-decoration: underline;">cd</span> -
}
</pre>
</div>

<p>
Then, run the following AppleScript to perform the installation:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 103: </span>Apple Script used to install iA Writer fonts</label><pre class="src src-shell">osascript &lt;&lt;<span style="font-style: italic;">'END'</span>
<span style="font-weight: bold;">  set theDownloadsFolder to get path to Downloads folder</span>
<span style="font-weight: bold;">  tell application "Finder"</span>
<span style="font-weight: bold;">    set allFonts to every file of theDownloadsFolder whose name starts with "iAWriterQuattroV"</span>
<span style="font-weight: bold;">  end tell</span>

<span style="font-weight: bold;">  repeat with theFont in allFonts</span>
<span style="font-weight: bold;">    tell application "Finder"</span>
<span style="font-weight: bold;">        open theFont</span>
<span style="font-weight: bold;">    end tell</span>

<span style="font-weight: bold;">    tell application "Font Book"</span>
<span style="font-weight: bold;">        activate</span>
<span style="font-weight: bold;">        set theFontWindow to the first window</span>
<span style="font-weight: bold;">    end tell</span>

<span style="font-weight: bold;">    tell application "System Events"</span>
<span style="font-weight: bold;">        tell process "Font Book"</span>
<span style="font-weight: bold;">            tell window 1</span>
<span style="font-weight: bold;">                tell group 1</span>
<span style="font-weight: bold;">                    click button "Install Font"</span>
<span style="font-weight: bold;">                end tell</span>
<span style="font-weight: bold;">            end tell</span>
<span style="font-weight: bold;">        end tell</span>
<span style="font-weight: bold;">    end tell</span>
<span style="font-weight: bold;">  end repeat</span>
<span style="font-weight: bold;">END</span>
</pre>
</div>

<p>
The rest of the rules are more subjective, and in all honesty, the methodology I used to decide which slant, and weight to use to each one of the text elements is non existent. I simply tried, checked how it looked, and asked myself, <i>&ldquo;Is this a nice looking element?&rdquo;</i>. If the answer was yes, I kept the configuration.
</p>

<p>
For the size, I started with the headline level 1 and configure it to be as big as it could be without looking disproportional to the text. Then, I reduced the size for the next level gradually until I get to the 8<sup>th</sup> one, guaranteeing that it would not be smaller than the normal font size.
</p>

<p>
In practice, this means:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Headline Level</th>
<th scope="col" class="org-right">Proportional size</th>
<th scope="col" class="org-right">Multiplier</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Level 1</td>
<td class="org-right">100%</td>
<td class="org-right">2.0</td>
</tr>

<tr>
<td class="org-left">Level 2</td>
<td class="org-right">80%</td>
<td class="org-right">1.8</td>
</tr>

<tr>
<td class="org-left">Level 3</td>
<td class="org-right">60%</td>
<td class="org-right">1.6</td>
</tr>

<tr>
<td class="org-left">Level 4</td>
<td class="org-right">40%</td>
<td class="org-right">1.4</td>
</tr>

<tr>
<td class="org-left">Level 5</td>
<td class="org-right">30%</td>
<td class="org-right">1.3</td>
</tr>

<tr>
<td class="org-left">Level 6</td>
<td class="org-right">20%</td>
<td class="org-right">1.2</td>
</tr>

<tr>
<td class="org-left">Level 7</td>
<td class="org-right">10%</td>
<td class="org-right">1.1</td>
</tr>

<tr>
<td class="org-left">Level 8</td>
<td class="org-right">0%</td>
<td class="org-right">1.0</td>
</tr>
</tbody>
</table>

<p>
To make my typography rules easy to refer to, I create one face for each rule as follows:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 104: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">my-default-mono</span> <span style="font-weight: bold;">`</span>((t <span style="font-weight: bold;">:font</span> ,(<span style="font-weight: bold; text-decoration: underline;">font-spec</span> <span style="font-weight: bold;">:family</span> <span style="font-style: italic;">"iMWritingMonoS Nerd Font"</span>
                                                <span style="font-weight: bold;">:size</span> <span style="font-weight: bold; text-decoration: underline;">16</span>)))
  <span style="font-style: italic;">"Default monospaced font used on majority of the buffers."</span>
  <span style="font-weight: bold;">:group</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-typography</span>)

(<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">my-big-face-mono</span> <span style="font-weight: bold;">`</span>((t <span style="font-weight: bold;">:font</span> ,(<span style="font-weight: bold; text-decoration: underline;">font-spec</span> <span style="font-weight: bold;">:family</span> <span style="font-style: italic;">"iMWritingMonoS Nerd Font"</span>
                                                 <span style="font-weight: bold;">:size</span> <span style="font-weight: bold; text-decoration: underline;">26</span>)))
  <span style="font-style: italic;">"Monospaced font used on presentation mode."</span>
  <span style="font-weight: bold;">:group</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-typography</span>)

(<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">my-default-ui</span> <span style="font-weight: bold;">`</span>((t <span style="font-weight: bold;">:font</span> ,(<span style="font-weight: bold; text-decoration: underline;">font-spec</span> <span style="font-weight: bold;">:family</span> <span style="font-style: italic;">"Roboto"</span>
                                              <span style="font-weight: bold;">:size</span> <span style="font-weight: bold; text-decoration: underline;">16</span>)))
  <span style="font-style: italic;">"Extra face used on UI elements."</span>
  <span style="font-weight: bold;">:group</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-typography</span>)

(<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">my-ui-window-header</span> <span style="font-weight: bold;">`</span>((t <span style="font-weight: bold;">:inherit</span> my-default-ui
                                  <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.8</span>))
  <span style="font-style: italic;">"Face used on decorative buffer headers."</span>
  <span style="font-weight: bold;">:group</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-typography</span>)

(<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">my-default-prose</span> <span style="font-weight: bold;">`</span>((t <span style="font-weight: bold;">:font</span> ,(<span style="font-weight: bold; text-decoration: underline;">font-spec</span> <span style="font-weight: bold;">:family</span> <span style="font-style: italic;">"iA Writer Quattro V"</span>
                                                 <span style="font-weight: bold;">:size</span> <span style="font-weight: bold; text-decoration: underline;">18</span>)))
  <span style="font-style: italic;">"Default variable pitch font used on prose writing."</span>
  <span style="font-weight: bold;">:group</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-typography</span>)

(<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">my-document-title</span> <span style="font-weight: bold;">`</span>((t <span style="font-weight: bold;">:inherit</span> my-default-prose
                                <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">2.4</span>
                                <span style="font-weight: bold;">:weight</span> light
                                <span style="font-weight: bold;">:slant</span> normal))
  <span style="font-style: italic;">"Face used for document titles."</span>
  <span style="font-weight: bold;">:group</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-typography</span>)

(<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">my-headline-1</span> <span style="font-weight: bold;">`</span>((t <span style="font-weight: bold;">:inherit</span> my-default-prose
                            <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">2.0</span>
                            <span style="font-weight: bold;">:weight</span> semi-light
                            <span style="font-weight: bold;">:slant</span> normal))
  <span style="font-style: italic;">"Face used for headlines of level 1."</span>
  <span style="font-weight: bold;">:group</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-typography</span>)

(<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">my-headline-2</span> <span style="font-weight: bold;">`</span>((t <span style="font-weight: bold;">:inherit</span> my-default-prose
                            <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">1.8</span>
                            <span style="font-weight: bold;">:weight</span> semi-light
                            <span style="font-weight: bold;">:slant</span> italic))
  <span style="font-style: italic;">"Face used for headlines of level 1."</span>
  <span style="font-weight: bold;">:group</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-typography</span>)

(<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">my-headline-3</span> <span style="font-weight: bold;">`</span>((t <span style="font-weight: bold;">:inherit</span> my-default-prose
                            <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">1.6</span>
                            <span style="font-weight: bold;">:weight</span> semi-light
                            <span style="font-weight: bold;">:slant</span> normal))
  <span style="font-style: italic;">"Face used for headlines of level 1."</span>
  <span style="font-weight: bold;">:group</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-typography</span>)

(<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">my-headline-4</span> <span style="font-weight: bold;">`</span>((t <span style="font-weight: bold;">:inherit</span> my-default-prose
                            <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">1.4</span>
                            <span style="font-weight: bold;">:weight</span> semi-light
                            <span style="font-weight: bold;">:slant</span> italic))
  <span style="font-style: italic;">"Face used for headlines of level 1."</span>
  <span style="font-weight: bold;">:group</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-typography</span>)

(<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">my-headline-5</span> <span style="font-weight: bold;">`</span>((t <span style="font-weight: bold;">:inherit</span> my-default-prose
                            <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">1.3</span>
                            <span style="font-weight: bold;">:weight</span> bold
                            <span style="font-weight: bold;">:slant</span> normal))
  <span style="font-style: italic;">"Face used for headlines of level 1."</span>
  <span style="font-weight: bold;">:group</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-typography</span>)

(<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">my-headline-6</span> <span style="font-weight: bold;">`</span>((t <span style="font-weight: bold;">:inherit</span> my-default-prose
                            <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">1.2</span>
                            <span style="font-weight: bold;">:weight</span> bold
                            <span style="font-weight: bold;">:slant</span> italic))
  <span style="font-style: italic;">"Face used for headlines of level 1."</span>
  <span style="font-weight: bold;">:group</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-typography</span>)

(<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">my-headline-7</span> <span style="font-weight: bold;">`</span>((t <span style="font-weight: bold;">:inherit</span> my-default-prose
                            <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">1.1</span>
                            <span style="font-weight: bold;">:weight</span> bold
                            <span style="font-weight: bold;">:slant</span> normal))
  <span style="font-style: italic;">"Face used for headlines of level 1."</span>
  <span style="font-weight: bold;">:group</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-typography</span>)

(<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">my-headline-8</span> <span style="font-weight: bold;">`</span>((t <span style="font-weight: bold;">:inherit</span> my-default-prose
                            <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">1.0</span>
                            <span style="font-weight: bold;">:weight</span> bold
                            <span style="font-weight: bold;">:slant</span> italic))
  <span style="font-style: italic;">"Face used for headlines of level 1."</span>
  <span style="font-weight: bold;">:group</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-typography</span>)

(<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">my-uri-face</span> <span style="font-weight: bold;">`</span>((t <span style="font-weight: bold;">:inherit</span> link))
  <span style="font-style: italic;">"Face used to display URIs."</span>
  <span style="font-weight: bold;">:group</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-typography</span>)
</pre>
</div>

<p>
The goal is to customize the fonts I want to have follow one of these rules by resetting all its values to <code>'unspecified</code> and inheriting one of my typography faces.
</p>

<p>
To help the tedious task of resetting a face, I want to have a helper function that will do the work for me:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 105: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defsubst</span> <span style="font-weight: bold;">my-typography-reset</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> faces)
  <span style="font-style: italic;">"Mark all face attributes from each face on FACES as `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">unspecified</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">custom-set-faces!</span>
            <span style="font-weight: bold;">`</span>(,faces
              <span style="font-weight: bold;">:family</span> unspecified
              <span style="font-weight: bold;">:foundry</span> unspecified
              <span style="font-weight: bold;">:width</span> unspecified
              <span style="font-weight: bold;">:height</span> unspecified
              <span style="font-weight: bold;">:weight</span> unspecified
              <span style="font-weight: bold;">:slant</span> unspecified
              <span style="font-weight: bold;">:underline</span> unspecified
              <span style="font-weight: bold;">:overline</span> unspecified
              <span style="font-weight: bold;">:strike-through</span> unspecified
              <span style="font-weight: bold;">:box</span> unspecified
              <span style="font-weight: bold;">:stipple</span> unspecified
              <span style="font-weight: bold;">:font</span> unspecified
              <span style="font-weight: bold;">:fontset</span> unspecified
              <span style="font-weight: bold;">:extend</span> unspecified)))
</pre>
</div>

<p>
The astute reader might ask: <i>&ldquo;Why not have this function do the whole work of resetting the font and assign an inheritance?&rdquo;</i>
</p>

<p>
Unfortunately at this point, the answer is not clear. When I tried to implement the <i>one-shot</i> function, the target face would not get the inheritance value, and fonts were all messed up.
</p>

<p>
By splitting the process into cleaning and then setting, Emacs seams to behave as expected.
</p>

<div class="note" id="org2324078">
<p>
If you know what is going on here, please let me know. I&rsquo;ll be more than happy to learn and credit you for that!
</p>

</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
To start the configuration, per-se, I will get the Doom&rsquo;s font system configured accordingly to my typography:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 106: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">doom-font</span> (<span style="font-weight: bold;">face-attribute</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-default-mono</span> <span style="font-weight: bold;">:font</span>)
      <span style="font-weight: bold; font-style: italic;">doom-big-font</span> (<span style="font-weight: bold;">face-attribute</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-big-face-mono</span> <span style="font-weight: bold;">:font</span>)
      <span style="font-weight: bold; font-style: italic;">doom-variable-pitch-font</span> (<span style="font-weight: bold;">face-attribute</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-default-prose</span> <span style="font-weight: bold;">:font</span>))
</pre>
</div>

<p>
It would be great if Doom could accept a <i>face</i> as the value for these variables, but unfortunately, it does not. Until this change, I have to live with this anonymous face that copy the <code>font</code> attribute from my typography face.
</p>

<p>
The next step is to make sure the base faces used on the editor match my base typography. The process to do so is the same I will use throughout this document whenever I find a mode that I need to adjust to match the defined typography.
</p>

<p>
I first clean up all styles except color on the faces I want to configure, in this case the faces are <code>fixed-pitch</code> and <code>variable-pitch</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 107: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(my-typography-reset <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">fixed-pitch</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">variable-pitch</span>)
</pre>
</div>

<p>
Then I set each face inheritance to the correct typography face:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 108: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">custom-set-faces!</span>
  <span style="font-weight: bold;">'</span>(fixed-pitch <span style="font-weight: bold;">:inherit</span> my-default-mono)
  <span style="font-weight: bold;">'</span>(variable-pitch <span style="font-weight: bold;">:inherit</span> my-default-prose))
</pre>
</div>

<p>
At his point, Emacs have <code>'default</code>, <code>'fixed-pitch</code>, and <code>'variable-pitch</code> faces matching my selection of fonts. This is, probably, a major part on the typography configuration. The rest of my setup, are individual packages, which I will configure once they show up in this document.
</p>

<p>
To close out the typography section, I like to enable font smoothing on macOS. To do so, simply set <code>ns-use-thin-smoothing</code> to <code>t</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 109: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> ns-use-thin-smoothing t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org3f28c8d" class="outline-4">
<h4 id="org3f28c8d"><span class="section-number-4">3.3.5</span> Iconography</h4>
<div class="outline-text-4" id="text-3-3-5">
<p>
Doom offers the <code>all-the-icons</code> package, which allow one to insert Unicode glyphs on buffers. That is a great start, but the problem I see here is how inconsistent the size of these icons are.
</p>

<p>
The idea for this section is to create a list of curated icons, adjusted to occupy exactly 2 ASCII characters on the buffer. This allows for a better alignment of text when we use an Icon.
</p>

<p>
I will create an <i>Association List</i> to store symbols associated with an adjusted icon:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 110: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">my-supported-icons</span>
  (<span style="font-weight: bold; text-decoration: underline;">list</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">assign</span>       (<span style="font-weight: bold;">all-the-icons-material</span> <span style="font-style: italic;">"assignment_ind"</span>          <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.95</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">-0.17</span>)
        <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">bug</span>          (<span style="font-weight: bold;">all-the-icons-material</span> <span style="font-style: italic;">"bug_report"</span>              <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.95</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">-0.17</span>)
        <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">busy</span>         (<span style="font-weight: bold;">all-the-icons-material</span> <span style="font-style: italic;">"event_busy"</span>              <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.95</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">-0.17</span>)
        <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">calendar</span>     (<span style="font-weight: bold;">all-the-icons-octicon</span>  <span style="font-style: italic;">"calendar"</span>                <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">1.05</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">0.0</span>)
        <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">checked</span>      (<span style="font-weight: bold;">all-the-icons-material</span> <span style="font-style: italic;">"check_box"</span>               <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.95</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">-0.17</span>)
        <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">checklist</span>    (<span style="font-weight: bold;">all-the-icons-octicon</span>  <span style="font-style: italic;">"checklist"</span>               <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.95</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">0.1</span>)
        <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">contact-add</span>  (<span style="font-weight: bold;">all-the-icons-material</span> <span style="font-style: italic;">"person_add"</span>              <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.95</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">-0.17</span>)
        <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">error</span>        (<span style="font-weight: bold;">all-the-icons-material</span> <span style="font-style: italic;">"error_outline"</span>           <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.95</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">-0.17</span>)
        <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">globe</span>        (<span style="font-weight: bold;">all-the-icons-faicon</span>   <span style="font-style: italic;">"globe"</span>                   <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">1.15</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">-0.05</span>)
        <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">help</span>         (<span style="font-weight: bold;">all-the-icons-material</span> <span style="font-style: italic;">"live_help"</span>               <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.95</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">-0.22</span>)
        <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">history</span>      (<span style="font-weight: bold;">all-the-icons-material</span> <span style="font-style: italic;">"history"</span>                 <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.95</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">-0.17</span>)
        <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">idea</span>         (<span style="font-weight: bold;">all-the-icons-material</span> <span style="font-style: italic;">"lightbulb_outline"</span>       <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.95</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">-0.17</span>)
        <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">inbox</span>        (<span style="font-weight: bold;">all-the-icons-material</span> <span style="font-style: italic;">"inbox"</span>                   <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.95</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">-0.15</span>)
        <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">journal</span>      (<span style="font-weight: bold;">all-the-icons-material</span> <span style="font-style: italic;">"book"</span>                    <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.95</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">-0.15</span>)
        <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">list</span>         (<span style="font-weight: bold;">all-the-icons-faicon</span>   <span style="font-style: italic;">"list"</span>                    <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.93</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">-0.05</span>)
        <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">loop</span>         (<span style="font-weight: bold;">all-the-icons-material</span> <span style="font-style: italic;">"loop"</span>                    <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.95</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">-0.17</span>)
        <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">meeting</span>      (<span style="font-weight: bold;">all-the-icons-material</span> <span style="font-style: italic;">"date_range"</span>              <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.95</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">-0.15</span>)
        <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">new</span>          (<span style="font-weight: bold;">all-the-icons-material</span> <span style="font-style: italic;">"new_releases"</span>            <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.95</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">-0.17</span>)
        <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">notes</span>        (<span style="font-weight: bold;">all-the-icons-material</span> <span style="font-style: italic;">"library_books"</span>           <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.95</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">-0.1</span>)
        <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">pause</span>        (<span style="font-weight: bold;">all-the-icons-material</span> <span style="font-style: italic;">"pause_circle_outline"</span>    <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.95</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">-0.17</span>)
        <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">postit</span>       (<span style="font-weight: bold;">all-the-icons-faicon</span>   <span style="font-style: italic;">"sticky-note"</span>             <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">1.15</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">0.05</span>)
        <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">project</span>      (<span style="font-weight: bold;">all-the-icons-octicon</span>  <span style="font-style: italic;">"briefcase"</span>               <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">1.05</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">0.05</span>)
        <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">review</span>       (<span style="font-weight: bold;">all-the-icons-material</span> <span style="font-style: italic;">"rate_review"</span>             <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.95</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">-0.15</span>)
        <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">semi-checked</span> (<span style="font-weight: bold;">all-the-icons-material</span> <span style="font-style: italic;">"indeterminate_check_box"</span> <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.95</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">-0.17</span>)
        <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">snooze</span>       (<span style="font-weight: bold;">all-the-icons-material</span> <span style="font-style: italic;">"snooze"</span>                  <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.95</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">-0.17</span>)
        <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">stop</span>         (<span style="font-weight: bold;">all-the-icons-octicon</span>  <span style="font-style: italic;">"stop"</span>                    <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">1.05</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">-0.05</span>)
        <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">timer</span>        (<span style="font-weight: bold;">all-the-icons-material</span> <span style="font-style: italic;">"timer"</span>                   <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.95</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">-0.15</span>)
        <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">unchecked</span>    (<span style="font-weight: bold;">all-the-icons-material</span> <span style="font-style: italic;">"check_box_outline_blank"</span> <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.95</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">-0.17</span>)
        <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">visibility</span>   (<span style="font-weight: bold;">all-the-icons-material</span> <span style="font-style: italic;">"visibility"</span>              <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.95</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">-0.17</span>)
        <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">wait</span>         (<span style="font-weight: bold;">all-the-icons-material</span> <span style="font-style: italic;">"hourglass_empty"</span>         <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.95</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">-0.17</span>))
  <span style="font-style: italic;">"Property list with all supported icons from my configuration."</span>)
</pre>
</div>

<p>
In order to allow other parts of this configuration to leverage the curated icons, I&rsquo;ll create a predicate function to  check if a given symbol has an icon associated with it:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 111: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-supported-icons-p</span> (icon)
  <span style="font-style: italic;">"Return t if the symbol given on ICON, is one associated with supported icon."</span>
  (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold; text-decoration: underline;">boundp</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-supported-icons</span>)
       (<span style="font-weight: bold; text-decoration: underline;">listp</span> my-supported-icons)
       (<span style="font-weight: bold; text-decoration: underline;">plist-member</span> my-supported-icons icon)))
</pre>
</div>

<p>
I want to also create a thin-wrapper around the <code>plist-get</code> to retrieve the icon string for a given symbol:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 112: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-raw-icon</span> (icon)
  <span style="font-style: italic;">"This function returns the requested ICON as if you're calling the</span>
<span style="font-style: italic;">`</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">all-the-icons-</span><span style="font-style: italic;">'* functions directly.</span>

<span style="font-style: italic;">Icons supported by this function were all optimized to use exactly 2 characters</span>
<span style="font-style: italic;">of space when used with the font and size defined in the main configuration.</span>

<span style="font-style: italic;">Check th documentation of `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my-supported-icons</span><span style="font-style: italic;">' to see the list of supported</span>
<span style="font-style: italic;">icons."</span>
  (<span style="font-weight: bold; text-decoration: underline;">plist-get</span> my-supported-icons icon))
</pre>
</div>

<p>
And to finalize my icons configuration, I need to expose a function where one (me in this case) will call it to get a curated icon with a given color (this is the only function in this section that a user should call to get an icon).
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 113: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-icon</span> (icon <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> color)
  <span style="font-style: italic;">"This function returns the requested ICON as a 2-characters string,</span>
<span style="font-style: italic;">propertized to display the associated icon from the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">all-the-icons</span><span style="font-style: italic;">' package. It</span>
<span style="font-style: italic;">uses the COLOR arg to 'paint' the icon.</span>

<span style="font-style: italic;">Check documentation of the function `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my-raw-icon</span><span style="font-style: italic;">' for a list of supported</span>
<span style="font-style: italic;">icons."</span>
  (<span style="font-weight: bold;">cond</span> ((<span style="font-weight: bold; text-decoration: underline;">eq</span> color <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">raw</span>) (my-raw-icon icon))
        (color (<span style="font-weight: bold; text-decoration: underline;">propertize</span> <span style="font-style: italic;">"--"</span>
                   <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">face</span> <span style="font-weight: bold;">`</span>(<span style="font-weight: bold;">:foreground</span> ,color)
                   <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">display</span> (my-raw-icon icon)))
        (t (<span style="font-weight: bold; text-decoration: underline;">propertize</span> <span style="font-style: italic;">"--"</span>
                   <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">face</span> <span style="font-weight: bold;">`</span>(<span style="font-weight: bold;">:foreground</span> ,(<span style="font-weight: bold;">face-attribute</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">default</span> <span style="font-weight: bold;">:foreground</span>))
                   <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">display</span> (my-raw-icon icon)))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc7abdc5" class="outline-3">
<h3 id="orgc7abdc5"><span class="section-number-3">3.4</span> Editor Tabs</h3>
<div class="outline-text-3" id="text-3-4">
<p>
I&rsquo;ve been all over the place regarding the use of tabs on editors. I use to think they were useless, since all files on my editor were buffers, not tabs. I though that using tabs as a sort of layout manager was a great idea, because I would have the visual cue of <i>workspaces</i> I had configured.
</p>

<p>
Recently, I spent time thinking about this and I changed my mind regarding tabs. First of all, I believe the common knowledge that one tab represents one file, is too ingrained into our collective minds by all other software that use them (web browsers, IDEs, file managers, etc.). This causes a weird feeling when I look to the tabs and they do not represent opened files. Also, as I work on my editor, I lose track of files opened without tabs.
</p>

<p>
For some Emacs users, all these arguments are silly because they are too used to the way Emacs works. But I believe that this argument should be the other way around. Because of the way Emacs developers decided to use the tab paradigm inside the editor, Emacs users accepted and got used to it.
</p>

<p>
But, as if to point out things I&rsquo;m arguing for, there are way too many packages that say they <i>fix the Emacs window system</i> on GitHub these days.
</p>

<p>
On 2020, I read a blog post from <a href="https://andreyorst.gitlab.io/">Andrey Listopadov</a> about his desire to have <a href="https://andreyorst.gitlab.io/posts/2020-05-07-making-emacs-tabs-work-like-in-atom/">Emacs tabs behaving more like tabs on Atom</a>. The post itself is a really good read, but I would like to reproduce here Andrey&rsquo;s description of how he believes the tab behavior should be:
</p>

<blockquote>
<p>
In Emacs, however, we can’t close tab via close button, because it will cycle buffers, so instead we can switch to second policy of killing buffer instead. But it will not work either, because it will not kill the window, and it will kill buffer in all windows. So how do we fix this?
</p>

<p>
First let’s establish some logical rules:
</p>

<ul class="org-ul">
<li>Buffer can exist without a tab, but tab can not exist without a buffer,</li>
<li>If tab was closed buffer should be killed only if there are no tabs for this buffer left,</li>
<li>If tab was closed and there are no more tabs in the window, window should be killed.</li>
</ul>

<p>
These three rules are basically how tabs work in modern editors.
</p>
</blockquote>

<p>
The configuration you&rsquo;re reading here is almost a copy from Andrey&rsquo;s posts (there is a sequel to the aforementioned post called <a href="https://andreyorst.gitlab.io/posts/2020-05-10-making-emacs-tabs-look-like-in-atom/">Making Emacs tabs look like in Atom</a>, that I also copy snippets in order fully configure tabs here.) with minor modifications to adjust it to my code style.
</p>

<p>
The way to achieve this configuration, is to define a set of <code>tab-line</code> variables and let Emacs do its thing.
</p>

<p>
My tab configuration uses dynamic values in almost all of it, but there are two constants that I have to decide beforehand: <code>tab-line-tab-min-width</code> and <code>tab-line-tab-max-width</code>.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 114: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">tab-line-tab-min-width</span> <span style="font-weight: bold; text-decoration: underline;">20</span>
  <span style="font-style: italic;">"Minimum width of a tab in characters."</span>)

(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">tab-line-tab-max-width</span> <span style="font-weight: bold; text-decoration: underline;">70</span>
  <span style="font-style: italic;">"Maximum width of a tab in characters."</span>)
</pre>
</div>

<p>
It might look an exaggeration to use the values I chose, but since I will use a variable pitch face to draw the tabs, these numbers become more realistic.
</p>

<p>
So let&rsquo;s configure the faces used on my tabs:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 115: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-tabs--setup-faces-h</span> ()
  <span style="font-style: italic;">"Configure the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">tab-line-mode</span><span style="font-style: italic;">' user interface."</span>
  (<span style="font-weight: bold;">let*</span> ((base (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">facep</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">solaire-default-face</span>)
                        (<span style="font-weight: bold; text-decoration: underline;">not</span> (<span style="font-weight: bold; text-decoration: underline;">eq</span> (<span style="font-weight: bold;">face-attribute</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">solaire-default-face</span> <span style="font-weight: bold;">:background</span>) <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">unspecified</span>)))
                   (<span style="font-weight: bold;">face-attribute</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">default</span> <span style="font-weight: bold;">:background</span>)
                 (<span style="font-weight: bold;">face-attribute</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">mode-line</span> <span style="font-weight: bold;">:background</span>)))
         (bg (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">facep</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">solaire-default-face</span>)
                      (<span style="font-weight: bold; text-decoration: underline;">not</span> (<span style="font-weight: bold; text-decoration: underline;">eq</span> (<span style="font-weight: bold;">face-attribute</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">solaire-default-face</span> <span style="font-weight: bold;">:background</span>) <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">unspecified</span>)))
                 (<span style="font-weight: bold;">face-attribute</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">solaire-default-face</span> <span style="font-weight: bold;">:background</span>)
               (<span style="font-weight: bold;">face-attribute</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">default</span> <span style="font-weight: bold;">:background</span>)))
         (fg (<span style="font-weight: bold;">face-attribute</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">default</span> <span style="font-weight: bold;">:foreground</span>))
         (dark-fg (<span style="font-weight: bold;">face-attribute</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">shadow</span> <span style="font-weight: bold;">:foreground</span>))
         (overline (<span style="font-weight: bold;">face-attribute</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">highlight</span> <span style="font-weight: bold;">:background</span>))
         (box-width (<span style="font-weight: bold; text-decoration: underline;">/</span> my-line-pixel-height <span style="font-weight: bold; text-decoration: underline;">2</span>))
         (box-base (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold; text-decoration: underline;">&gt;</span> box-width <span style="font-weight: bold; text-decoration: underline;">0</span>) (<span style="font-weight: bold; text-decoration: underline;">list</span> <span style="font-weight: bold;">:line-width</span> box-width <span style="font-weight: bold;">:color</span> base)))
         (box-bg (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold; text-decoration: underline;">&gt;</span> box-width <span style="font-weight: bold; text-decoration: underline;">0</span>) (<span style="font-weight: bold; text-decoration: underline;">list</span> <span style="font-weight: bold;">:line-width</span> box-width <span style="font-weight: bold;">:color</span> bg))))
    (<span style="font-weight: bold;">set-face-attribute</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">tab-line</span> nil
                        <span style="font-weight: bold;">:background</span> base
                        <span style="font-weight: bold;">:foreground</span> dark-fg
                        <span style="font-weight: bold;">:overline</span> base
                        <span style="font-weight: bold;">:inherit</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-default-ui</span>
                        <span style="font-weight: bold;">:box</span> box-base)
    (<span style="font-weight: bold;">set-face-attribute</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">tab-line-tab</span> nil
                        <span style="font-weight: bold;">:foreground</span> dark-fg
                        <span style="font-weight: bold;">:background</span> bg
                        <span style="font-weight: bold;">:inherit</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-default-ui</span>
                        <span style="font-weight: bold;">:box</span> box-bg)
    (<span style="font-weight: bold;">set-face-attribute</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">tab-line-tab-inactive</span> nil
                        <span style="font-weight: bold;">:foreground</span> dark-fg
                        <span style="font-weight: bold;">:background</span> base
                        <span style="font-weight: bold;">:inherit</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-default-ui</span>
                        <span style="font-weight: bold;">:box</span> box-base)
    (<span style="font-weight: bold;">set-face-attribute</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">tab-line-tab-current</span> nil
                        <span style="font-weight: bold;">:foreground</span> fg
                        <span style="font-weight: bold;">:background</span> bg
                        <span style="font-weight: bold;">:inherit</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-default-ui</span>
                        <span style="font-weight: bold;">:overline</span> overline
                        <span style="font-weight: bold;">:box</span> box-bg)
    (<span style="font-weight: bold;">set-face-attribute</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">tab-line-highlight</span> nil
                        <span style="font-weight: bold;">:foreground</span> fg
                        <span style="font-weight: bold;">:background</span> nil
                        <span style="font-weight: bold;">:inherit</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">tab-line-tab</span>
                        <span style="font-weight: bold;">:overline</span> overline
                        <span style="font-weight: bold;">:box</span> box-bg)
    (<span style="font-weight: bold;">set-face-attribute</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">tab-line-close-highlight</span> nil
                        <span style="font-weight: bold;">:foreground</span> overline
                        <span style="font-weight: bold;">:overline</span> overline
                        <span style="font-weight: bold;">:background</span> nil
                        <span style="font-weight: bold;">:inherit</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">tab-line-tab</span>
                        <span style="font-weight: bold;">:box</span> box-bg)))
</pre>
</div>

<p>
And I need to make sure I call this function after Doom loads the editor&rsquo;s theme:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 116: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">add-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">doom-load-theme-hook</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-tabs--setup-faces-h</span>)
</pre>
</div>

<p>
To configure the look and feel of <i>non-tab</i> elements of the <code>tab-line</code>, I need to set the <code>tab-line-right-button</code>, <code>tab-line-left-button</code>, <code>tab-line-new-button-show</code>, and <code>tab-line-separator</code> variables:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 117: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> tab-line
  (<span style="font-weight: bold;">setq</span> tab-line-right-button (<span style="font-weight: bold; text-decoration: underline;">propertize</span> (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">char-displayable-p</span> ?&#9656;) <span style="font-style: italic;">" &#9656; "</span> <span style="font-style: italic;">" &gt; "</span>)
                                          <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">keymap</span> tab-line-right-map
                                          <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">mouse-face</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">tab-line-highlight</span>
                                          <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">help-echo</span> <span style="font-style: italic;">"Click to scroll right"</span>)
        tab-line-left-button (<span style="font-weight: bold; text-decoration: underline;">propertize</span> (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">char-displayable-p</span> ?&#9666;) <span style="font-style: italic;">" &#9666; "</span> <span style="font-style: italic;">" &lt; "</span>)
                                         <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">keymap</span> tab-line-left-map
                                         <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">mouse-face</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">tab-line-highlight</span>
                                         <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">help-echo</span> <span style="font-style: italic;">"Click to scroll left"</span>)
        tab-line-new-button-show nil
        tab-line-separator <span style="font-style: italic;">""</span>))
</pre>
</div>

<p>
And to configure the tab itself, I need to set the <code>tab-line-close-button-show</code>, <code>tab-line-close-button</code>, and the <code>tab-line-tab-name-function</code> variables:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 118: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> tab-line
  (<span style="font-weight: bold;">setq</span> tab-line-close-button-show t
        tab-line-close-button (<span style="font-weight: bold; text-decoration: underline;">propertize</span> (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"%s "</span> (<span style="font-weight: bold;">all-the-icons-material</span> <span style="font-style: italic;">"close"</span>))
                                          <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">keymap</span> tab-line-tab-close-map
                                          <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">mouse-face</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">tab-line-close-highlight</span>
                                          <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">face</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">tab-line-tab-curent</span>
                                          <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">help-echo</span> <span style="font-style: italic;">"Click to close tab"</span>)
        tab-line-tab-name-function <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-tabs-name-buffer</span>))
</pre>
</div>

<p>
While the <code>tab-line-close-button-show</code> and the <code>tab-line-close-button</code> variables control the appearance of the tab close button, the <code>tab-line-tab-name-function</code> is responsible for everything else on the tab. The <code>my-tabs-name-buffer</code> function will return a string representing the tab name for each tab, and is also this function&rsquo;s responsibility to return the normalized tab size in form of blank spaces:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 119: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-tabs-name-buffer</span> (buffer <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> _buffers)
  <span style="font-style: italic;">"Create name for tab with padding and truncation.</span>

<span style="font-style: italic;">If buffer name is shorter than `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">tab-line-tab-max-width</span><span style="font-style: italic;">' it gets centered with</span>
<span style="font-style: italic;">spaces, otherwise it gets truncated, to preserve equal width for all tabs. This</span>
<span style="font-style: italic;">function also tries to fit as many tabs in window as possible, so if there are</span>
<span style="font-style: italic;">no room for tabs with maximum width, it calculates new width for each tab and</span>
<span style="font-style: italic;">truncates text if needed. You can set the minimal width with</span>
<span style="font-style: italic;">`</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">tab-line-tab-min-width</span><span style="font-style: italic;">' variable."</span>
  (<span style="font-weight: bold;">with-current-buffer</span> buffer
    (<span style="font-weight: bold;">let*</span> ((<span style="font-weight: bold; text-decoration: underline;">window-width</span> (<span style="font-weight: bold; text-decoration: underline;">window-width</span> (<span style="font-weight: bold; text-decoration: underline;">get-buffer-window</span>)))
           (close-button-size (<span style="font-weight: bold;">if</span> tab-line-close-button-show
                                  (<span style="font-weight: bold; text-decoration: underline;">length</span> (<span style="font-weight: bold; text-decoration: underline;">substring-no-properties</span> tab-line-close-button))
                                <span style="font-weight: bold; text-decoration: underline;">0</span>))
           (tab-amount (<span style="font-weight: bold; text-decoration: underline;">length</span> (<span style="font-weight: bold; text-decoration: underline;">funcall</span> tab-line-tabs-function)))
           (window-max-tab-width (<span style="font-weight: bold; text-decoration: underline;">/</span> window-width tab-amount))
           (<span style="font-weight: bold; font-style: italic;">tab-width</span> (<span style="font-weight: bold; text-decoration: underline;">-</span> (<span style="font-weight: bold;">cond</span> ((<span style="font-weight: bold; text-decoration: underline;">&gt;=</span> window-max-tab-width tab-line-tab-max-width)
                                tab-line-tab-max-width)
                               ((<span style="font-weight: bold; text-decoration: underline;">&lt;</span> window-max-tab-width tab-line-tab-min-width)
                                tab-line-tab-min-width)
                               (t window-max-tab-width))
                         close-button-size))
           (<span style="font-weight: bold; text-decoration: underline;">buffer-name</span> (<span style="font-weight: bold;">string-trim</span> (<span style="font-weight: bold; text-decoration: underline;">buffer-name</span>)))
           (name-width (<span style="font-weight: bold; text-decoration: underline;">length</span> buffer-name)))
      (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">&gt;=</span> name-width (<span style="font-weight: bold; text-decoration: underline;">-</span> <span style="font-weight: bold; font-style: italic;">tab-width</span> <span style="font-weight: bold; text-decoration: underline;">3</span>))
          (<span style="font-weight: bold; text-decoration: underline;">concat</span>  <span style="font-style: italic;">" "</span> (<span style="font-weight: bold;">truncate-string-to-width</span> buffer-name (<span style="font-weight: bold; text-decoration: underline;">-</span> <span style="font-weight: bold; font-style: italic;">tab-width</span> <span style="font-weight: bold; text-decoration: underline;">3</span>)) <span style="font-style: italic;">"&#8230; "</span>)
        (<span style="font-weight: bold;">let*</span> ((padding (<span style="font-weight: bold; text-decoration: underline;">make-string</span> (<span style="font-weight: bold; text-decoration: underline;">/</span> (<span style="font-weight: bold; text-decoration: underline;">-</span> <span style="font-weight: bold; font-style: italic;">tab-width</span> name-width) <span style="font-weight: bold; text-decoration: underline;">2</span>) ?\s))
               (<span style="font-weight: bold; text-decoration: underline;">buffer-name</span> (<span style="font-weight: bold; text-decoration: underline;">concat</span> padding buffer-name))
               (name-width (<span style="font-weight: bold; text-decoration: underline;">length</span> buffer-name)))
          (<span style="font-weight: bold; text-decoration: underline;">concat</span> buffer-name (<span style="font-weight: bold; text-decoration: underline;">make-string</span> (<span style="font-weight: bold; text-decoration: underline;">-</span> <span style="font-weight: bold; font-style: italic;">tab-width</span> name-width) ?\s)))))))
</pre>
</div>

<p>
The reader might have noticed I use the size of the list returned by the function <code>tab-line-tabs-function</code> to calculate single tab size, and as you imagine, the function symbol used in this variable is responsible to return a list of tabs on the current window, so I will also use such function to filter some unwanted buffers on the tab bar. The function docstring, explains these exceptional cases in a bit more detail:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 120: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-tabs-mode-persp-window</span> ()
  <span style="font-style: italic;">"Return a list of buffer tabs of the current window.</span>

<span style="font-style: italic;">This function take in account the active perspective (or workspace) so it does</span>
<span style="font-style: italic;">not display tabs from other perspectives on the current one.</span>

<span style="font-style: italic;">There are 4 types of buffer that this function handles:</span>

<span style="font-style: italic;">1. Real buffers</span>

<span style="font-style: italic;">   These buffers are the normal buffers that have a tab associated with them. To</span>
<span style="font-style: italic;">   be a real buffer, the function `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">doom-real-buffer-p</span><span style="font-style: italic;">' must return t for the</span>
<span style="font-style: italic;">   buffer.</span>

<span style="font-style: italic;">2. Popup buffers (or non-real buffers)</span>

<span style="font-style: italic;">   These are the inverse of real buffers.</span>

<span style="font-style: italic;">3. Org capture buffers</span>

<span style="font-style: italic;">   These buffers are the ones created to perform the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-capture</span><span style="font-style: italic;">'. Such buffers</span>
<span style="font-style: italic;">   should never have a tab associated with them.</span>

<span style="font-style: italic;">4. Dired buffers</span>

<span style="font-style: italic;">   These are real buffers that should never exist in more than one per window.</span>
<span style="font-style: italic;">   When jumping from one Dired buffer to another, Emacs creates one buffer per</span>
<span style="font-style: italic;">   directory, but the tab bar should not display any other then the current</span>
<span style="font-style: italic;">   buffer."</span>
  (<span style="font-weight: bold;">let</span> ((win-buffs (tab-line-tabs-window-buffers))
        (last-dired-buf (<span style="font-weight: bold;">seq-find</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">doom-dired-buffer-p</span> (<span style="font-weight: bold; text-decoration: underline;">buffer-list</span> (<span style="font-weight: bold; text-decoration: underline;">selected-frame</span>)))))
    (<span style="font-weight: bold; text-decoration: underline;">reverse</span> (<span style="font-weight: bold;">seq-filter</span> (<span style="font-weight: bold;">lambda</span> (buf)
                           (<span style="font-weight: bold;">let</span> ((buf-name (<span style="font-weight: bold; text-decoration: underline;">buffer-name</span> buf)))
                             (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold; text-decoration: underline;">member</span> buf win-buffs)
                                  (<span style="font-weight: bold; font-style: italic;">doom-real-buffer-p</span> buf)
                                  (<span style="font-weight: bold; text-decoration: underline;">not</span> (<span style="font-weight: bold;">string-prefix-p</span> buf-name <span style="font-style: italic;">"CAPTURE-"</span>))
                                  (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold; text-decoration: underline;">not</span> (<span style="font-weight: bold;">doom-dired-buffer-p</span> buf))
                                      (<span style="font-weight: bold; text-decoration: underline;">eq</span> buf last-dired-buf)))))
                         (<span style="font-weight: bold; text-decoration: underline;">funcall</span> tab-line-tabs-buffer-list-function)))))
</pre>
</div>

<p>
And as with the <code>tab-line-tabs-function</code>, the <code>tab-line-tabs-buffer-list-function</code> holds a symbol of a function that returns all buffers to consider during <code>tab-line-tabs-function</code> execution, and I should set them to their proper functions, unfortunately the <code>persp-current-buffers</code> (which is the function we need to call), is a macro, and according to the Emacs <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Calling-Functions.html">documentation</a>, we can&rsquo;t pass macros to <code>funcall</code> or <code>apply</code>.
</p>

<p>
To workaround this problem, I will create an alias function to call the same functions the <code>persp-current-buffers</code> macro do:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 121: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold; text-decoration: underline;">defalias</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold;">my-persp-current-buffers</span>
  (<span style="font-weight: bold;">lambda</span> () (persp-buffers (persp-curr)))
  <span style="font-style: italic;">"Wrapper for the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">persp-current-buffers</span><span style="font-style: italic;">' macro."</span>)
</pre>
</div>

<p>
Now we can properly define the two variables we need to make <code>tab-line</code> find the tab buffers:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 122: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> tab-line
  (<span style="font-weight: bold;">setq</span> tab-line-tabs-function <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-tabs-mode-persp-window</span>
        tab-line-tabs-buffer-list-function <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-persp-current-buffers</span>))
</pre>
</div>

<p>
The last variable to configure is the <code>tab-line-exclude-modes</code>. This variable holds a list of modes that will not have <code>tab-line-mode</code> enabled on them, even when <code>global-tab-line-mode</code> gets enabled:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 123: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> tab-line
  (<span style="font-weight: bold;">setq</span> tab-line-exclude-modes <span style="font-weight: bold;">'</span>(+doom-dashboard-mode
                                 cfw:calendar-mode
                                 Info-mode
                                 calendar-mode
                                 ediff-mode
                                 eshell-mode
                                 help-mode
                                 helpful-mode
                                 imenu-list-major-mode
                                 lexic-mode
                                 process-menu-mode
                                 Man-mode
                                 WoMan-mode
                                 term-mode
                                 treemacs-mode
                                 vterm-mode
                                 wordnut-mode
                                 <span style="font-weight: bold; font-style: italic;">reb-mode</span>)))
</pre>
</div>

<p>
Even with the <code>tab-line-exclude-modes</code> list, some <i>non-real</i> buffers get displayed. I need to create an extra function to help me get rid of the <code>tab-line</code> when I load such buffers:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 124: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-tabs-hide-tab-line-maybe-h</span> ()
  <span style="font-style: italic;">"Disable `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">tab-line-mode</span><span style="font-style: italic;">' for non-real buffers.</span>

<span style="font-style: italic;">For a definition of what is a non-real buffer, check the documentation of</span>
<span style="font-style: italic;">`</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">doom-real-buffer-p</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold; text-decoration: underline;">not</span> (<span style="font-weight: bold; font-style: italic;">doom-real-buffer-p</span> (<span style="font-weight: bold; text-decoration: underline;">current-buffer</span>)))
    (<span style="font-weight: bold;">tab-line-mode</span> <span style="font-weight: bold; text-decoration: underline;">-1</span>)))
</pre>
</div>

<p>
With the helper function defined, I need to make sure I call it when I switch buffers. The reason for that is that I could explicitly request to load a <i>non-real</i> buffer, which would create the <code>tab-line</code> on such buffer:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 125: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">add-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">doom-switch-buffer-hook</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-tabs-hide-tab-line-maybe-h</span>)
</pre>
</div>

<p>
Also, when Emacs calls the <code>window-configuration-change-hook</code> hooks, I need to clean all <code>tab-line</code> cache to make sure Emacs will re-consider all the proper buffers when re-displaying it:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 126: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">add-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">window-configuration-change-hook</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-tabs--drop-caches-h</span>)
</pre>
</div>

<p>
The implementation of <code>my-tabs--drop-caches-h</code> simply <i>nullify</i> the value of the <code>tab-line-cache</code> window parameter for all windows:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 127: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-tabs--drop-caches-h</span> ()
  <span style="font-style: italic;">"Drops `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">tab-line</span><span style="font-style: italic;">' cache in every window."</span>
  (<span style="font-weight: bold;">dolist</span> (window (<span style="font-weight: bold; text-decoration: underline;">window-list</span>))
    (<span style="font-weight: bold; text-decoration: underline;">set-window-parameter</span> window <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">tab-line-cache</span> nil)))
</pre>
</div>

<p>
With all that in place, we can make sure the <code>tab-line</code> gets loaded when Emacs start:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 128: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> tab-line
  <span style="font-weight: bold;">:when</span> <span style="font-weight: bold; font-style: italic;">window-system</span>
  <span style="font-weight: bold;">:hook</span> ((after-init . <span style="font-weight: bold; font-style: italic;">global-tab-line-mode</span>)))
</pre>
</div>
</div>

<div id="outline-container-org8cbc4c2" class="outline-4">
<h4 id="org8cbc4c2"><span class="section-number-4">3.4.1</span> Tab actions</h4>
<div class="outline-text-4" id="text-3-4-1">
<p>
There are two main actions that I need to address here: selection and closing.
</p>

<p>
I would like to start talking about the later. Unfortunately, the Emacs implementation of <code>tab-line-close-tab</code> does not leave room to customize its behavior the way I want it. Instead, I will implement my own version (more like &ldquo;I&rsquo;ll copy Andrey&rsquo;s version and change it a bit&rdquo;):
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 129: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-tabs-close-buffer-tab</span> (buffer-or-name <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> window)
  (<span style="font-weight: bold;">let</span> ((buffer (<span style="font-weight: bold; text-decoration: underline;">get-buffer</span> buffer-or-name))
        (window (<span style="font-weight: bold;">or</span> window (<span style="font-weight: bold; text-decoration: underline;">get-buffer-window</span>))))
    (<span style="font-weight: bold;">if</span> window
        (<span style="font-weight: bold;">with-selected-window</span> window
          (<span style="font-weight: bold;">let</span> ((<span style="font-weight: bold;">tab-list</span> (my-tabs-mode-persp-window))
                (<span style="font-weight: bold; text-decoration: underline;">buffer-list</span> (<span style="font-weight: bold;">flatten-list</span>
                              (<span style="font-weight: bold;">seq-reduce</span> (<span style="font-weight: bold;">lambda</span> (<span style="font-weight: bold; text-decoration: underline;">list</span> window)
                                            (<span style="font-weight: bold; text-decoration: underline;">select-window</span> window t)
                                            (<span style="font-weight: bold; text-decoration: underline;">cons</span> (my-tabs-mode-persp-window) list))
                                          (<span style="font-weight: bold; text-decoration: underline;">window-list</span>) nil))))
            (<span style="font-weight: bold; text-decoration: underline;">select-window</span> window)
            (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">&gt;</span> (<span style="font-weight: bold;">seq-count</span> (<span style="font-weight: bold;">lambda</span> (b) (<span style="font-weight: bold; text-decoration: underline;">eq</span> b buffer)) buffer-list) <span style="font-weight: bold; text-decoration: underline;">1</span>)
                (<span style="font-weight: bold;">progn</span>
                  (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">eq</span> buffer (<span style="font-weight: bold; text-decoration: underline;">current-buffer</span>))
                      (<span style="font-weight: bold;">bury-buffer</span>)
                    (<span style="font-weight: bold; text-decoration: underline;">set-window-prev-buffers</span> window (<span style="font-weight: bold;">assq-delete-all</span> buffer (<span style="font-weight: bold; text-decoration: underline;">window-prev-buffers</span>)))
                    (<span style="font-weight: bold; text-decoration: underline;">set-window-next-buffers</span> window (<span style="font-weight: bold; text-decoration: underline;">delq</span> buffer (<span style="font-weight: bold; text-decoration: underline;">window-next-buffers</span>))))
                  (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold; text-decoration: underline;">cdr</span> tab-list)
                    (<span style="font-weight: bold;">ignore-errors</span> (<span style="font-weight: bold;">delete-window</span> window))))
              (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold; text-decoration: underline;">kill-buffer</span> buffer)
                   (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold; text-decoration: underline;">cdr</span> tab-list)
                     (<span style="font-weight: bold;">ignore-errors</span> (<span style="font-weight: bold;">delete-window</span> window)))))))
      (<span style="font-weight: bold;">if</span> (persp-buffer-in-other-p buffer)
          (persp-remove-buffer buffer)
        (<span style="font-weight: bold; text-decoration: underline;">kill-buffer</span> buffer)))))
</pre>
</div>

<p>
With the function implemented, I need to override the original one with it using an advice:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 130: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defadvice!</span> my-tabs-close-tab-a (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> mouse-event)
  <span style="font-style: italic;">"Close the selected tab.</span>

<span style="font-style: italic;">If buffer on tab is present in another window, close the tab by using</span>
<span style="font-style: italic;">`</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">bury-buffer</span><span style="font-style: italic;">' function. If buffer on tab is unique to all existing windows, kill</span>
<span style="font-style: italic;">the buffer with `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">kill-buffer</span><span style="font-style: italic;">' function. Lastly, if no tabs left in the window,</span>
<span style="font-style: italic;">it will delete it with `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">delete-window</span><span style="font-style: italic;">' function."</span>
  <span style="font-weight: bold;">:override</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">tab-line-close-tab</span>
  (<span style="font-weight: bold;">let*</span> ((<span style="font-weight: bold;">posnp</span> (<span style="font-weight: bold;">and</span> mouse-event (<span style="font-weight: bold;">event-start</span> mouse-event)))
         (window (<span style="font-weight: bold;">and</span> posnp (<span style="font-weight: bold;">posn-window</span> posnp)))
         (buffer (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">and</span> posnp (<span style="font-weight: bold; text-decoration: underline;">get-pos-property</span> <span style="font-weight: bold; text-decoration: underline;">1</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">tab</span> (<span style="font-weight: bold; text-decoration: underline;">car</span> (<span style="font-weight: bold;">posn-string</span> posnp))))
                     (<span style="font-weight: bold; text-decoration: underline;">current-buffer</span>)))
         (window (<span style="font-weight: bold;">or</span> window (<span style="font-weight: bold; text-decoration: underline;">get-buffer-window</span> buffer))))
    (my-tabs-close-buffer-tab buffer window)
    (<span style="font-weight: bold; text-decoration: underline;">force-mode-line-update</span>)))
</pre>
</div>

<p>
Now, any code calling the <code>tab-line-close-tab</code> will use the algorithm defined in this section.
</p>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
The next and final action to handle is actually a group of actions related to <i>switching between tabs</i>.
</p>

<p>
The first step to configure tab switching, is to create a function that allows me to switch to any tab, by passing a tab to it. The only special thing about this function is that you can pass a buffer or an association list representing a tab. Other than that, this function behaves much like the <code>switch-to-buffer</code> one:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 131: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-tab-line-switch-to-tab</span> (tab)
  <span style="font-style: italic;">"Switch to the buffer associated with TAB."</span>
  (<span style="font-weight: bold;">let</span> ((buffer (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">bufferp</span> tab) tab (<span style="font-weight: bold; text-decoration: underline;">cdr</span> (<span style="font-weight: bold; text-decoration: underline;">assq</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">buffer</span> tab)))))
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold; text-decoration: underline;">bufferp</span> buffer)
        (<span style="font-weight: bold;">switch-to-buffer</span> buffer))))
</pre>
</div>

<p>
Next, I need a way to select a tab by its position of the displayed tabs:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 132: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-tab-line-switch-to</span> (pos)
  <span style="font-style: italic;">"Switch to the tab on position POS.</span>

<span style="font-style: italic;">If POS is negative, access the tab on the reverse order.</span>

<span style="font-style: italic;">If POS is bigger than the number of tabs, return nil. The same is valid for</span>
<span style="font-style: italic;">negative numbers, so if POS is negative and its absolute value minus 1 is bigger</span>
<span style="font-style: italic;">than the number of tabs, return nil."</span>
  (<span style="font-weight: bold;">let*</span> ((tabs (<span style="font-weight: bold; text-decoration: underline;">funcall</span> tab-line-tabs-function))
         (tabs (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">&lt;</span> pos <span style="font-weight: bold; text-decoration: underline;">0</span>) (<span style="font-weight: bold; text-decoration: underline;">reverse</span> tabs) tabs))
         (pos (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">&lt;</span> pos <span style="font-weight: bold; text-decoration: underline;">0</span>) (<span style="font-weight: bold; text-decoration: underline;">1-</span> (<span style="font-weight: bold; text-decoration: underline;">-</span> pos)) pos))
         (tab (<span style="font-weight: bold; text-decoration: underline;">nth</span> pos tabs)))
    (<span style="font-weight: bold;">unless</span> (my-tab-line-switch-to-tab tab)
      (<span style="font-weight: bold;">user-error</span> <span style="font-style: italic;">"There is no tab on position %s"</span> (<span style="font-weight: bold; text-decoration: underline;">1+</span> pos)))))
</pre>
</div>

<p>
And a helper function to select the last tab on the list:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 133: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-tab-line-switch-to-final</span> ()
  <span style="font-style: italic;">"Switch to the last tab."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((tab (<span style="font-weight: bold; text-decoration: underline;">car</span> (<span style="font-weight: bold;">last</span> (<span style="font-weight: bold; text-decoration: underline;">funcall</span> tab-line-tabs-function)))))
    (<span style="font-weight: bold;">unless</span> (my-tab-line-switch-to-tab tab)
      (<span style="font-weight: bold;">user-error</span> <span style="font-style: italic;">"Tab line is not visible to go to the last tab"</span>))))
</pre>
</div>

<p>
These functions should be enough to allow me to switch tabs on any way I defined here. To get a good set of key bindings, I need to create aliases for calling <code>my-tab-line-switch-to</code> from 1 to 9:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 134: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">dotimes</span> (i <span style="font-weight: bold; text-decoration: underline;">9</span>)
  (<span style="font-weight: bold; text-decoration: underline;">defalias</span> (<span style="font-weight: bold; text-decoration: underline;">intern</span> (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"my-tab-line-switch-to-%d"</span> i))
    (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">interactive</span>) (my-tab-line-switch-to i))
    (<span style="font-weight: bold; text-decoration: underline;">format</span>
     <span style="font-style: italic;">"Thin wrapper around `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">+workspace/switch-to</span><span style="font-style: italic;">' function where we pass #%d as the INDEX parameter."</span>
     (<span style="font-weight: bold; text-decoration: underline;">1+</span> i))))
</pre>
</div>

<p>
And my keymap for all these functions should allow me to switch tabs using <code>Cmd</code> plus a number from <code>1</code> to <code>9</code>. The <code>Cmd-0</code> shortcut will call the <code>my-tab-line-switch-to-final</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 135: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">map!</span> <span style="font-weight: bold;">:after</span> tab-line
      <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"s-1"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-tab-line-switch-to-0</span>
      <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"s-2"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-tab-line-switch-to-1</span>
      <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"s-3"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-tab-line-switch-to-2</span>
      <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"s-4"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-tab-line-switch-to-3</span>
      <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"s-5"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-tab-line-switch-to-4</span>
      <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"s-6"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-tab-line-switch-to-5</span>
      <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"s-7"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-tab-line-switch-to-6</span>
      <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"s-8"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-tab-line-switch-to-7</span>
      <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"s-9"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-tab-line-switch-to-8</span>
      <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"s-0"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-tab-line-switch-to-final</span>

      (<span style="font-weight: bold;">:prefix</span> <span style="font-style: italic;">"g"</span>
       <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Go to tab on the right"</span> <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"t"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">tab-line-switch-to-next-tab</span>
       <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Go to tab on the left"</span>  <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"T"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">tab-line-switch-to-prev-tab</span>))
</pre>
</div>

<p>
One final configuration I need to do is to make sure Emacs selects the correct tab when I click on it with the mouse:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 136: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defadvice!</span> my-tabs-select-tab-a (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> e)
  <span style="font-style: italic;">"Advice to select the buffer window of a tab when clicking on the tab."</span>
  <span style="font-weight: bold;">:after</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">tab-line-select-tab</span>
  (<span style="font-weight: bold; text-decoration: underline;">select-window</span> (<span style="font-weight: bold;">posn-window</span> (<span style="font-weight: bold;">event-start</span> e))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgabfbca4" class="outline-4">
<h4 id="orgabfbca4"><span class="section-number-4">3.4.2</span> Windows</h4>
<div class="outline-text-4" id="text-3-4-2">
<p>
It&rsquo;s impossible to get the tab configuration right without adjusting the Emacs window behavior.
</p>

<p>
The main behavior I want to guarantee, is that Emacs should close a window if there are no buffers left on the list of previous buffers:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 137: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-close-window-when-kill-buffer-h</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> buffer-or-name)
  (<span style="font-weight: bold;">let*</span> ((buf (<span style="font-weight: bold; text-decoration: underline;">get-buffer</span> (<span style="font-weight: bold;">or</span> buffer-or-name (<span style="font-weight: bold; text-decoration: underline;">current-buffer</span>))))
         (win (<span style="font-weight: bold; text-decoration: underline;">get-buffer-window</span> buf)))
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> win (my-window-single-buffer-p win))
      (<span style="font-weight: bold;">delete-window</span> win))))
</pre>
</div>

<p>
Because this function needs to know if there are no buffer lefts on the list of buffers associated with the window, I will implement a helper function for that:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 138: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defsubst</span> <span style="font-weight: bold;">my-window-single-buffer-p</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> win)
  (<span style="font-weight: bold;">let</span> ((win (<span style="font-weight: bold;">or</span> win (<span style="font-weight: bold; text-decoration: underline;">selected-window</span>))))
    (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold; text-decoration: underline;">window-dedicated-p</span> win)
        (<span style="font-weight: bold; text-decoration: underline;">not</span> (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold; text-decoration: underline;">window-next-buffers</span> win)
                 (<span style="font-weight: bold; text-decoration: underline;">window-prev-buffers</span> win))))))
</pre>
</div>

<p>
Now I just need to make sure Emacs calls the <code>my-close-window-when-kill-buffer-h</code> function when I kill a buffer:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 139: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">add-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">kill-buffer-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-close-window-when-kill-buffer-h</span>)
</pre>
</div>

<p>
These covers most of the closing behavior regarding windows. The one exception is the <code>kill-current-buffer</code> that needs to not switch buffers as we kill the current buffer. I will implement this behavior as a <i>before</i> advice to the <code>kill-current-buffer</code> function:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 140: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defadvice!</span> my-close-window-when-no-buffer-a (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> _)
  <span style="font-weight: bold;">:before-until</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">kill-current-buffer</span>
  (my-save-all-buffers-a)
  (<span style="font-weight: bold;">let</span> ((buf (<span style="font-weight: bold; text-decoration: underline;">current-buffer</span>))
        (tabs (my-tabs-mode-persp-window)))
    (<span style="font-weight: bold;">cond</span>
     ((<span style="font-weight: bold; text-decoration: underline;">window-dedicated-p</span>) (<span style="font-weight: bold;">delete-window</span>) t)
     ((<span style="font-weight: bold; text-decoration: underline;">eq</span> buf (<span style="font-weight: bold;">doom-fallback-buffer</span>)) (<span style="font-weight: bold; text-decoration: underline;">message</span> <span style="font-style: italic;">"Can't kill the fallback buffer."</span>) t)
     ((<span style="font-weight: bold; font-style: italic;">doom-real-buffer-p</span> buf)
      (<span style="font-weight: bold;">let</span> ((doom-inhibit-switch-buffer-hooks-original <span style="font-weight: bold; font-style: italic;">doom-inhibit-switch-buffer-hooks</span>)
            (<span style="font-weight: bold; font-style: italic;">inhibit-redisplay</span> t)
            <span style="font-weight: bold; font-style: italic;">buffer-list-update-hook</span>)
        (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">memq</span> buf tabs)
            (<span style="font-weight: bold;">progn</span>
              (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold; font-style: italic;">doom-real-buffer-p</span> buf)
                         (<span style="font-weight: bold; font-style: italic;">buffer-file-name</span> buf)
                         (<span style="font-weight: bold; text-decoration: underline;">buffer-modified-p</span> buf)
                         (<span style="font-weight: bold; text-decoration: underline;">not</span> (<span style="font-weight: bold;">y-or-n-p</span> (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"Buffer %s has unsaved changes; kill it anyway?"</span> buf))))
                (<span style="font-weight: bold;">user-error</span> <span style="font-style: italic;">"Aborted"</span>))
              (tab-line-close-tab))
          (<span style="font-weight: bold;">with-current-buffer</span> buf
            (<span style="font-weight: bold; text-decoration: underline;">restore-buffer-modified-p</span> nil))
          (<span style="font-weight: bold; text-decoration: underline;">kill-buffer</span> buf))
        (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">doom-inhibit-switch-buffer-hooks</span> doom-inhibit-switch-buffer-hooks-original))
      (<span style="font-weight: bold; text-decoration: underline;">run-hooks</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">buffer-list-update-hook</span>)
      t))))
</pre>
</div>

<p>
To finish the window changes, I need to make sure Doom does not switch to the fallback buffer (a.k.a. the Dashboard buffer) when there are no more buffers left on the window:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 141: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">advice-remove</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">kill-current-buffer</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">doom--switch-to-fallback-buffer-maybe-a</span>)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2ba7082" class="outline-3">
<h3 id="org2ba7082"><span class="section-number-3">3.5</span> Special modes</h3>
<div class="outline-text-3" id="text-3-5">
<p>
The configuration in this section, belongs to some modes that I use all over the place or that are not big enough to justify their own section in this document.
</p>

<p>
In practice, most of the configurations here are about the mode&rsquo;s appearance, and where they show their content.
</p>
</div>

<div id="outline-container-orgdd1ea81" class="outline-4">
<h4 id="orgdd1ea81"><span class="section-number-4">3.5.1</span> Info mode</h4>
<div class="outline-text-4" id="text-3-5-1">
<p>
The Info mode is where all user manuals exist. Up to now, I&rsquo;m not used to read and search through the manuals, but I feel this is a habit I must acquire.
</p>

<p>
First I need to make the manuals to <i>look</i> nicer (if you&rsquo;re rolling your eyes right now, have a remembering read into the section <a href="#org9b1d559">3.3</a>).
</p>

<p>
Although this is not a radical change, there are two font lock additions I want to do. The first is a symbol to represent the <i>menu</i> for the current info page, and the second is to replace the <code>*</code> character as the list item markup, by the character I will use on all other modes that deal with lists:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 142: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> info
  (<span style="font-weight: bold;">font-lock-add-keywords</span>
   <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">Info-mode</span>
   <span style="font-weight: bold;">`</span>((<span style="font-style: italic;">"^</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">\\*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;"> "</span>
      (<span style="font-weight: bold; text-decoration: underline;">0</span> (<span style="font-weight: bold;">prog1</span> () (<span style="font-weight: bold;">compose-region</span> (<span style="font-weight: bold; text-decoration: underline;">match-beginning</span> <span style="font-weight: bold; text-decoration: underline;">1</span>) (<span style="font-weight: bold; text-decoration: underline;">match-end</span> <span style="font-weight: bold; text-decoration: underline;">1</span>) <span style="font-style: italic;">"&#8226;"</span>))))
     (<span style="font-style: italic;">"^[\t ]*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">\\*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;"> Menu</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">:</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span>
      (<span style="font-weight: bold; text-decoration: underline;">0</span> (<span style="font-weight: bold;">prog1</span> ()
           (<span style="font-weight: bold;">compose-region</span> (<span style="font-weight: bold; text-decoration: underline;">match-beginning</span> <span style="font-weight: bold; text-decoration: underline;">1</span>) (<span style="font-weight: bold; text-decoration: underline;">match-end</span> <span style="font-weight: bold; text-decoration: underline;">1</span>) <span style="font-style: italic;">"&#9776;"</span>)
           (<span style="font-weight: bold; text-decoration: underline;">put-text-property</span> (<span style="font-weight: bold; text-decoration: underline;">match-beginning</span> <span style="font-weight: bold; text-decoration: underline;">2</span>) (<span style="font-weight: bold; text-decoration: underline;">match-end</span> <span style="font-weight: bold; text-decoration: underline;">2</span>) <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">invisible</span> t)
           )))) <span style="font-weight: bold;">t</span><span style="font-weight: bold;">)</span><span style="font-weight: bold;">)</span>
</pre>
</div>

<p>
There is a package called <code>info+.el</code>, available through the Emacs Wiki, that fontify the <code>Info-mode</code> buffer to make it look nicer.
</p>

<p>
Unfortunately the latest changes introduced in March broke the package on Emacs 27 and 28, so in order to still have the nice feature it provides with a version that still works on my Emacs, I need to <i>pin</i> the package to the version that still works:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 143: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">package!</span> info-plus <span style="font-weight: bold;">:pin</span> <span style="font-style: italic;">"5ecd4c1e3f..."</span>)
</pre>
</div>

<p>
Due to the nature of this package, we need to load it only when we need to fontify the buffer:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 144: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> info-plus <span style="font-weight: bold;">:commands</span> Info-toggle-fontify-all)
</pre>
</div>

<p>
But when this actually happens? The best place to add this, is the hook <code>Info-selection-hook</code>. First I need to define a function that will configure the mode when any info page gets selected:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 145: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-info--fontify-info-h</span> ()
  <span style="font-style: italic;">"Hook called to fontify the Info buffer.</span>

<span style="font-style: italic;">This function lexically bind some configuration for the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">into-plus</span><span style="font-style: italic;">' package,</span>
<span style="font-style: italic;">and call the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">Info-toggle-fontify-all</span><span style="font-style: italic;">' to perform the fontification work.</span>

<span style="font-style: italic;">Notice we need to update the font lock overlays after this call to guarantee</span>
<span style="font-style: italic;">the fontification didn't remove any important overlay."</span>
  (<span style="font-weight: bold;">let</span> ((Info-fontify-angle-bracketed-flag nil)
        (Info-fontify-bookmarked-xrefs-flag nil)
        (Info-fontify-emphasis-flag nil)
        (Info-fontify-glossary-words nil)
        (Info-fontify-isolated-quote-flag nil)
        (Info-fontify-quotations nil)
        (Info-fontify-reference-items-flag nil)
        (Info-fontify-visited-nodes nil))
    (<span style="font-weight: bold; text-decoration: underline;">call-interactively</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">Info-toggle-fontify-all</span>)
    (font-lock-update)))
</pre>
</div>

<p>
Then, I can hook it to the <code>Info-selection-hook</code> hook:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 146: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">add-hook!</span> Info-selection <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-info--fontify-info-h</span>)
</pre>
</div>

<p>
The next step is to make sure the <code>Info-mode</code> respects the typography I defined earlier. First we clean up any outstanding setup to the faces that need to get adjusted:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 147: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(my-typography-reset (<span style="font-weight: bold;">cl-loop</span> for i from <span style="font-weight: bold; text-decoration: underline;">1</span> to <span style="font-weight: bold; text-decoration: underline;">4</span> collect (<span style="font-weight: bold; text-decoration: underline;">intern</span> (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"info-title-%d"</span> i))))
(my-typography-reset <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">info-menu-header</span>)
</pre>
</div>

<p>
And then, we modify all the faces to match my particular configuration:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 148: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">custom-set-faces!</span>
  <span style="font-weight: bold;">'</span>(info-title-1 <span style="font-weight: bold;">:inherit</span> outline-1 <span style="font-weight: bold;">:weight</span> unspecified <span style="font-weight: bold;">:extend</span> unspecified)
  <span style="font-weight: bold;">'</span>(info-title-2 <span style="font-weight: bold;">:inherit</span> outline-2 <span style="font-weight: bold;">:weight</span> unspecified <span style="font-weight: bold;">:extend</span> unspecified)
  <span style="font-weight: bold;">'</span>(info-title-3 <span style="font-weight: bold;">:inherit</span> outline-3 <span style="font-weight: bold;">:weight</span> unspecified <span style="font-weight: bold;">:extend</span> unspecified)
  <span style="font-weight: bold;">'</span>(info-title-4 <span style="font-weight: bold;">:inherit</span> outline-4 <span style="font-weight: bold;">:weight</span> unspecified <span style="font-weight: bold;">:extend</span> unspecified)
  <span style="font-weight: bold;">'</span>(info-menu-header <span style="font-weight: bold;">:inherit</span> outline-5 <span style="font-weight: bold;">:weight</span> unspecified <span style="font-weight: bold;">:extend</span> unspecified)
  <span style="font-weight: bold;">`</span>(info-quoted-name <span style="font-weight: bold;">:inherit</span> <span style="font-weight: bold; font-style: italic;">font-lock-constant-face</span>)
  <span style="font-weight: bold;">`</span>(info-isolated-quote <span style="font-weight: bold;">:inherit</span> info-quoted-name)
  <span style="font-weight: bold;">`</span>(info-isolated-backquote <span style="font-weight: bold;">:inherit</span> info-quoted-name)
  <span style="font-weight: bold;">`</span>(info-glossary-word <span style="font-weight: bold;">:foreground</span> ,(<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">type</span> <span style="font-weight: bold; text-decoration: underline;">256</span>)
                       <span style="font-weight: bold;">:background</span> ,(<span style="font-weight: bold;">doom-darken</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">type</span> <span style="font-weight: bold; text-decoration: underline;">0.7</span>)
                       <span style="font-weight: bold;">:box</span> (<span style="font-weight: bold;">:line-width</span> (<span style="font-weight: bold; text-decoration: underline;">4</span> . <span style="font-weight: bold; text-decoration: underline;">1</span>) <span style="font-weight: bold;">:color</span> ,(<span style="font-weight: bold;">doom-darken</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">type</span> <span style="font-weight: bold; text-decoration: underline;">0.7</span>) <span style="font-weight: bold;">:style</span> nil)
                       <span style="font-weight: bold;">:inherit</span> fixed-pitch)
  <span style="font-weight: bold;">`</span>(link-visited <span style="font-weight: bold;">:foreground</span> ,(<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">violet</span> <span style="font-weight: bold; text-decoration: underline;">256</span>))
  <span style="font-weight: bold;">`</span>(info-double-quoted-name <span style="font-weight: bold;">:inherit</span> <span style="font-weight: bold; font-style: italic;">font-lock-string-face</span>)
  <span style="font-weight: bold;">`</span>(info-string <span style="font-weight: bold;">:inherit</span> <span style="font-weight: bold; font-style: italic;">font-lock-string-face</span>)
  <span style="font-weight: bold;">`</span>(info-header-node <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">160</span>
                     <span style="font-weight: bold;">:inherit</span> info-node)
  <span style="font-weight: bold;">`</span>(info-header-xref <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">160</span>
                     <span style="font-weight: bold;">:inherit</span> info-xref))
</pre>
</div>

<p>
There are two remaining configurations. The first one is to make the <code>Info-mode</code> buffer to match how it gets displayed on the editor. I will use <code>writeroom</code> to make the buffer centralized on the window, and will turn on <code>variable-pitch-mode</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 149: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-info-buffer-config-h</span> ()
  (<span style="font-weight: bold;">setq</span> writeroom-width <span style="font-weight: bold; text-decoration: underline;">75</span>)
  (<span style="font-weight: bold;">let</span> ((<span style="font-weight: bold; font-style: italic;">+zen-text-scale</span> <span style="font-weight: bold; text-decoration: underline;">0</span>))
    (<span style="font-weight: bold;">+zen/toggle</span>))
  (<span style="font-weight: bold;">variable-pitch-mode</span> <span style="font-weight: bold; text-decoration: underline;">1</span>)
  (<span style="font-weight: bold; font-style: italic;">visual-line-mode</span> <span style="font-weight: bold; text-decoration: underline;">1</span>))
</pre>
</div>

<p>
With the function that will configure my buffer in place, I need to hook it to the mode initialization:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 150: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">add-hook!</span> Info-mode <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-info-buffer-config-h</span>)
</pre>
</div>

<p>
The last configuration for the <code>Info-mode</code> is <b>where</b> its buffer gets displayed. For me, it should show up on the right side of my screen. I can achieve that with a popup rule for the buffer:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 151: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">set-popup-rule!</span> <span style="font-style: italic;">"^\\*info\\*$"</span>
  <span style="font-weight: bold;">:slot</span> <span style="font-weight: bold; text-decoration: underline;">2</span>   <span style="font-weight: bold;">:vslot</span> <span style="font-weight: bold; text-decoration: underline;">-1</span>     <span style="font-weight: bold;">:side</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">right</span>  <span style="font-weight: bold;">:width</span> <span style="font-weight: bold; text-decoration: underline;">85</span> <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.4</span>
  <span style="font-weight: bold;">:select</span> t <span style="font-weight: bold;">:modeline</span> nil <span style="font-weight: bold;">:autosave</span> nil <span style="font-weight: bold;">:ttl</span> <span style="font-weight: bold; text-decoration: underline;">0</span>    <span style="font-weight: bold;">:quit</span> t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org557868b" class="outline-4">
<h4 id="org557868b"><span class="section-number-4">3.5.2</span> Help mode and Man mode</h4>
<div class="outline-text-4" id="text-3-5-2">
<p>
I want to give a similar treatment I did to the <code>Info-mode</code> to both these modes, and like the <code>Info-mode</code>, the first thing to do is to create the functions that will configure these modes:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 152: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-help-man-buffer-config-h</span> ()
  (<span style="font-weight: bold;">setq</span> writeroom-width <span style="font-weight: bold; text-decoration: underline;">75</span>)
  (<span style="font-weight: bold;">let</span> ((<span style="font-weight: bold; font-style: italic;">+zen-text-scale</span> <span style="font-weight: bold; text-decoration: underline;">0</span>))
    (<span style="font-weight: bold;">+zen/toggle</span>))
  (<span style="font-weight: bold; font-style: italic;">visual-line-mode</span> <span style="font-weight: bold; text-decoration: underline;">1</span>))
</pre>
</div>

<p>
And then, hook them up to their modes hooks:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 153: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">add-hook!</span> (<span style="font-weight: bold;">help-mode</span>
            helpful-mode
            Man-mode
            WoMan-mode)
           <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-help-man-buffer-config-h</span>)
</pre>
</div>

<p>
The last step on these configuration is to add a popup rule for each mode to make their buffers to open on the right side of the editor:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 154: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">set-popup-rule!</span> <span style="font-style: italic;">"^\\*[Hh]elp"</span>
  <span style="font-weight: bold;">:slot</span> <span style="font-weight: bold; text-decoration: underline;">2</span>   <span style="font-weight: bold;">:vslot</span> <span style="font-weight: bold; text-decoration: underline;">-1</span>     <span style="font-weight: bold;">:side</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">right</span>  <span style="font-weight: bold;">:width</span> <span style="font-weight: bold; text-decoration: underline;">85</span> <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.4</span>
  <span style="font-weight: bold;">:select</span> t <span style="font-weight: bold;">:modeline</span> nil <span style="font-weight: bold;">:autosave</span> nil <span style="font-weight: bold;">:ttl</span> <span style="font-weight: bold; text-decoration: underline;">0</span>    <span style="font-weight: bold;">:quit</span> t)

(<span style="font-weight: bold;">set-popup-rule!</span> <span style="font-style: italic;">"^\\*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(?:</span><span style="font-style: italic;">Wo</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">?Man "</span>
  <span style="font-weight: bold;">:slot</span> <span style="font-weight: bold; text-decoration: underline;">2</span>   <span style="font-weight: bold;">:vslot</span> <span style="font-weight: bold; text-decoration: underline;">-1</span>     <span style="font-weight: bold;">:side</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">right</span>  <span style="font-weight: bold;">:width</span> <span style="font-weight: bold; text-decoration: underline;">88</span> <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.4</span>
  <span style="font-weight: bold;">:select</span> t <span style="font-weight: bold;">:modeline</span> nil <span style="font-weight: bold;">:autosave</span> nil <span style="font-weight: bold;">:ttl</span> <span style="font-weight: bold; text-decoration: underline;">0</span>     <span style="font-weight: bold;">:quit</span> t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orge6f9cf3" class="outline-4">
<h4 id="orge6f9cf3"><span class="section-number-4">3.5.3</span> Rainbow mode</h4>
<div class="outline-text-4" id="text-3-5-3">
<p>
The Rainbow mode is a small visual helper to display colors on the buffer, whenever it finds a string that can be a color.
</p>

<p>
I already configured a key binding (<code>SPC t R</code>) to toggle this mode.
</p>

<p>
What I still need to do, is to make sure that I use a fixed font when displaying the color text, unfortunately, the <code>rainbow-mode</code> uses an anonymous face to display the colors, so the only way for me to customize it, is to override the <code>rainbow-colorize-match</code> with a function that add any property I want to the face (in this case, to inherit from the <code>fixed-pitch</code> face):
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 155: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defadvice!</span> my-fontify-rainbow-colorize-match-a (color <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> match)
  <span style="font-style: italic;">"Return a matched string propertized with a face whose background is COLOR.</span>

<span style="font-style: italic;">This function computes the foreground using `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">rainbow-color-luminance</span><span style="font-style: italic;">', and is</span>
<span style="font-style: italic;">either white or black."</span>
  <span style="font-weight: bold;">:override</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">rainbow-colorize-match</span>
  (<span style="font-weight: bold;">let</span> ((match (<span style="font-weight: bold;">or</span> match <span style="font-weight: bold; text-decoration: underline;">0</span>)))
    (<span style="font-weight: bold; text-decoration: underline;">put-text-property</span>
     (<span style="font-weight: bold; text-decoration: underline;">match-beginning</span> match) (<span style="font-weight: bold; text-decoration: underline;">match-end</span> match)
     <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">face</span> <span style="font-weight: bold;">`</span>((<span style="font-weight: bold;">:foreground</span> ,(<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">&gt;</span> <span style="font-weight: bold; text-decoration: underline;">0.5</span> (rainbow-x-color-luminance color))
                               <span style="font-style: italic;">"white"</span> <span style="font-style: italic;">"black"</span>))
             (<span style="font-weight: bold;">:background</span> ,color)
             (<span style="font-weight: bold;">:inherit</span> fixed-pitch)))))
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf4d224a" class="outline-2">
<h2 id="orgf4d224a"><span class="section-number-2">4</span> Temporary workarounds</h2>
<div class="outline-text-2" id="text-4">
<p>
This section contain configurations that will get integrated on Doom on a relative short period of time. This means that sooner or later, sections here will get replaced by a better module from Doom.
</p>
</div>

<div id="outline-container-orgacfad41" class="outline-3">
<h3 id="orgacfad41"><span class="section-number-3">4.1</span> <span class="todo TODO">TODO</span> Completion framework</h3>
<div class="outline-text-3" id="text-4-1">
<p>
What I call the completion framework, is what we use to incrementally select an input when using the interactive mode.
</p>

<p>
We call the standard interactive mode on Emacs <a href="https://www.gnu.org/software/emacs/manual/html_mono/ido.html">Ido</a> (<a href="https://www.emacswiki.org/emacs/InteractivelyDoThings">Interactively Do Things</a>), and users have been building packages to improve or replace it for ages. Among the most famous package are:
</p>

<dl class="org-dl">
<dt>Icomplete</dt><dd>Bundled with Emacs;</dd>
<dt>Helm</dt><dd>One of the first heavy weight contender to replace Ido;</dd>
<dt>Ivy</dt><dd>Created as a lightweight version of Helm, with the goal to achieve parity with Help at a minimum;</dd>
</dl>

<p>
When I was writing this document, one of the <i>new kids on the block</i> for completion framework was a set of packages that I kindly named <i>Selectrum and Friends</i>. The list of packages that compose this set are:
</p>

<dl class="org-dl">
<dt><a href="https://github.com/raxod502/selectrum">Selectrum</a></dt><dd>A better solution for incremental narrowing in Emacs, replacing Helm, Ivy, and Ido;</dd>
<dt><a href="https://github.com/minad/marginalia">Marginalia</a></dt><dd>Marginalia are marks or annotations placed at the margin of the page of a book or in this case helpful colorful annotations placed at the margin of the minibuffer for your completion candidates;</dd>
<dt><a href="https://github.com/oantolin/orderless">Orderless</a></dt><dd>A completion style that divides the pattern into space-separated components, and matches candidates that match all of the components in any order;</dd>
<dt><a href="https://github.com/raxod502/prescient.el">Prescient</a></dt><dd>A library which sorts and filters lists of candidates, such as appear when you use a package like Ivy or Company;</dd>
<dt><a href="https://github.com/oantolin/embark/">Embark</a></dt><dd>A sort of right-click contextual menu for Emacs, accessed through the embark-act command, offering you relevant actions to use on a target determined by the current context;</dd>
<dt><a href="https://github.com/minad/consult">Consult</a></dt><dd>Provides handy commands based on the Emacs completion function completing-read, which allows to quickly select an item from a list of candidates with completion;</dd>
</dl>

<p>
Unfortunately, these packages are not yet bundled in Doom, so I have to install and configure them here until the Pull Request <a href="https://github.com/hlissner/doom-emacs/pull/4664">#4664</a> gets merged.
</p>

<p>
The appeal of <i>Selectrum and Friends</i>, is the fact they use the standard Emacs features to achieve their goals, this way, there is a better chance to not need to change my configuration in the future, even if I decide to use a different package for the completion UI.
</p>

<p>
To configure all these packages on Doom, I have to do it in the following order:
</p>

<ul class="org-ul">
<li>Configure result filtering and mach highlights;</li>
<li>Configure result sorting;</li>
<li>Configure result item annotations (to display extra information for each completion candidate);</li>
<li>Configure the completion UI;</li>
<li>Configure contextual menu;</li>
<li>Configure extra commands;</li>
<li>Alter the standard behavior of Doom Emacs, to fit my preferences;</li>
</ul>
</div>

<div id="outline-container-org1891f24" class="outline-4">
<h4 id="org1891f24"><span class="section-number-4">4.1.1</span> Filtering and highlighting</h4>
<div class="outline-text-4" id="text-4-1-1">
<p>
The first package I want to install is <code>orderless</code>. This package augment the standard Emacs completion system providing multiple matches for your input.
</p>

<p>
First, we need to add it to <code>packages.el</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 156: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">package!</span> orderless)
</pre>
</div>

<p>
And then configure it with <code>use-package!</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 157: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> orderless
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">setq</span> orderless-component-separator <span style="font-style: italic;">"[ &amp;]"</span>
        orderless-matching-styles <span style="font-weight: bold;">'</span>(orderless-prefixes
                                    orderless-initialism
                                    orderless-regexp))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">completion-styles</span> <span style="font-weight: bold;">'</span>(orderless))
  (<span style="font-weight: bold;">setq</span> orderless-skip-highlighting (<span style="font-weight: bold;">lambda</span> () selectrum-active-p))
  (<span style="font-weight: bold;">setq</span> selectrum-highlight-candidates-function <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">orderless-highlight-matches</span>)
  (<span style="font-weight: bold;">setq</span> orderless-matching-styles <span style="font-weight: bold;">'</span>(orderless-regexp)
        orderless-style-dispatchers <span style="font-weight: bold;">'</span>(flex-if-twiddle
                                      without-if-bang)))
</pre>
</div>

<p>
You might have noticed that the last configuration we perform on <code>orderless</code>, uses two functions not implemented by default. The idea on these two functions is to create extra dispatchers to allow us more control on our searches.
</p>

<p>
The first of the functions is <code>flex-if-twiddle</code>. This dispatcher allows one to type a <code>~</code> on the input to trigger the <i>flex</i> search style (which is a resemblance of fuzzy finder).
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 158: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">flex-if-twiddle</span> (pattern _index _total)
  <span style="font-style: italic;">"Return the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">orderless-flex</span><span style="font-style: italic;">' dispatcher if the search contains a ~ character."</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">string-suffix-p</span> <span style="font-style: italic;">"~"</span> pattern)
    <span style="font-weight: bold;">`</span>(orderless-flex . ,(<span style="font-weight: bold; text-decoration: underline;">substring</span> pattern <span style="font-weight: bold; text-decoration: underline;">0</span> <span style="font-weight: bold; text-decoration: underline;">-1</span>))))
</pre>
</div>

<p>
And the second one is <code>without-if-bang</code> which allow us to have a negation operator on our searches.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 159: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">without-if-bang</span> (pattern _index _total)
  <span style="font-style: italic;">"Define a '!not' exclusion prefix for literal strings."</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">string-prefix-p</span> <span style="font-style: italic;">"!"</span> pattern)
    <span style="font-weight: bold;">`</span>(orderless-without-literal . ,(<span style="font-weight: bold; text-decoration: underline;">substring</span> pattern <span style="font-weight: bold; text-decoration: underline;">1</span>))))
</pre>
</div>

<p>
On company, the matching portions of candidates are not highlighted. That’s because <code>company-capf</code> is hard-coded to look for the <code>completions-common-part</code> face, and it only use one face (<code>company-echo-common</code>) to highlight candidates.
</p>

<p>
So, while you can’t get different faces for different components, you can at least get the matches highlighted in the sole available face with this configuration:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 160: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defadvice!</span> my-orderless-match-with-one-face-a (fn <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> args)
  <span style="font-style: italic;">"Function to help company to highlight all candidates with just one face."</span>
  <span style="font-weight: bold;">:around</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">company-capf--candidates</span>
  (<span style="font-weight: bold;">let</span> ((orderless-match-faces [completions-common-part]))
    (<span style="font-weight: bold; text-decoration: underline;">apply</span> fn args)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9680082" class="outline-4">
<h4 id="org9680082"><span class="section-number-4">4.1.2</span> Sorting</h4>
<div class="outline-text-4" id="text-4-1-2">
<p>
<code>orderless</code> works pretty well, but there is one aspect of it that bothers me: the lack of a sorting system. I couldn&rsquo;t decide if I should use <code>prescient</code> (recommended by the <code>selectrum</code> author) and lose the nice things I like about <code>orderless</code>, or use <code>orderless</code> and lose the sorting and remembering mechanism of <code>prescient</code>.
</p>

<p>
Then it hit me: why not use both?
</p>

<p>
The idea is to install <code>prescient</code> but not call <code>(selectrum-prescient-mode 1)</code>. Instead, setup the two required hooks for remembering, and the one variable, later on <code>selectum</code>, to use the <i>preprocessing</i> from <code>prescient</code>. So let&rsquo;s start with <code>packages.el</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 161: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">package!</span> selectrum-prescient)
</pre>
</div>

<p>
Then, let&rsquo;s configure it, and set the persistent mode:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 162: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> selectrum-prescient
  <span style="font-weight: bold;">:hook</span> (selectrum-mode . selectrum-prescient-mode)
  <span style="font-weight: bold;">:hook</span> (selectrum-mode . prescient-persist-mode)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> selectrum-preprocess-candidates-function <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">selectrum-prescient--preprocess</span>)
  (<span style="font-weight: bold;">add-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">selectrum-candidate-selected-hook</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">selectrum-prescient--remember</span>)
  (<span style="font-weight: bold;">add-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">selectrum-candidate-inserted-hook</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">selectrum-prescient--remember</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9d58d21" class="outline-4">
<h4 id="org9d58d21"><span class="section-number-4">4.1.3</span> Candidates annotations</h4>
<div class="outline-text-4" id="text-4-1-3">
<p>
The next package is <code>marginalia</code>. This package will add annotations on candidates depending on the context of it. Think about it as a sort of <code>ivy-rich</code>, but more organized and use to customize.
</p>

<p>
As with <code>ordeless</code>, we need to first, add it to the <code>packages.el</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 163: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">package!</span> marginalia)
</pre>
</div>

<p>
Then, configure it using <code>use-packages!</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 164: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> marginalia
  <span style="font-weight: bold;">:hook</span> (doom-first-input . marginalia-mode)
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">setq-default</span> marginalia-annotators <span style="font-weight: bold;">'</span>(marginalia-annotators-heavy))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">add-to-list</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">marginalia-command-categories</span> <span style="font-weight: bold;">'</span>(persp-switch-to-buffer . buffer)))
</pre>
</div>

<p>
At this point, our completion system can filter its candidates (<code>orderless</code>) and display extra information for each one of them (<code>marginalia</code>), all that using the Emacs default completion system and UI, which is not up to my taste, so let&rsquo;s get the main package of this section.
</p>
</div>
</div>

<div id="outline-container-orgb338d30" class="outline-4">
<h4 id="orgb338d30"><span class="section-number-4">4.1.4</span> Completion UI</h4>
<div class="outline-text-4" id="text-4-1-4">
<p>
I like to have a vertical and more dynamic completion UI. Here is where <code>selectrum</code> comes in play. So let&rsquo;s install it.
</p>

<p>
First add <code>selectrum</code> itself to <code>packages.el</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 165: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">package!</span> selectrum)
</pre>
</div>

<p>
And set it up with <code>use-packages!</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 166: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> selectrum
  <span style="font-weight: bold;">:hook</span> (doom-first-input . selectrum-mode)
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">setq</span> selectrum-display-action nil
        selectrum-num-candidates-displayed <span style="font-weight: bold; text-decoration: underline;">15</span>
        selectrum-extend-current-candidate-highlight t)
  (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">featurep!</span> +orderless)
    (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">completion-styles</span> <span style="font-weight: bold;">'</span>(substring partial-completion)))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> selectrum-fix-vertical-window-height <span style="font-weight: bold; text-decoration: underline;">17</span>
        selectrum-max-window-height <span style="font-weight: bold; text-decoration: underline;">17</span>)

  (<span style="font-weight: bold;">map!</span>
   <span style="font-weight: bold;">:g</span> <span style="font-style: italic;">"C-s-r"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">selectrum-repeat</span>
   (<span style="font-weight: bold;">:map</span> selectrum-minibuffer-map
    <span style="font-weight: bold;">:geni</span> <span style="font-style: italic;">"M-RET"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">selectrum-submit-exact-input</span>
    <span style="font-weight: bold;">:geni</span> <span style="font-style: italic;">"C-j"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">selectrum-next-candidate</span>
    <span style="font-weight: bold;">:geni</span> <span style="font-style: italic;">"C-S-j"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">selectrum-next-page</span>
    <span style="font-weight: bold;">:geni</span> <span style="font-style: italic;">"C-s-j"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">selectrum-goto-end</span>
    <span style="font-weight: bold;">:geni</span> <span style="font-style: italic;">"C-k"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">selectrum-previous-candidate</span>
    <span style="font-weight: bold;">:geni</span> <span style="font-style: italic;">"C-S-k"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">selectrum-previous-page</span>
    <span style="font-weight: bold;">:geni</span> <span style="font-style: italic;">"C-s-k"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">selectrum-goto-beginning</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 167: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defadvice!</span> my-selectrum-refresh-on-cycle-a (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> _)
  <span style="font-weight: bold;">:after</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">marginalia-cycle</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">bound-and-true-p</span> selectrum-mode) (selectrum-exhibit)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfac8863" class="outline-4">
<h4 id="orgfac8863"><span class="section-number-4">4.1.5</span> Contextual Menu</h4>
<div class="outline-text-4" id="text-4-1-5">
<p>
The next package is a kind of gem I read about. It will allow you to select different actions on a completion candidate based on its context. This package is <code>embark</code>. And again, let&rsquo;s start with <code>packages.el</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 168: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">package!</span> embark)
(<span style="font-weight: bold;">package!</span> embark-consult)
</pre>
</div>

<p>
Now we can configure <code>embark</code> with <code>use-package!</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 169: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> embark
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">setq</span> embark-action-indicator <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-embark-which-key-action-indicator</span>
        embark-become-indicator embark-action-indicator)
  (<span style="font-weight: bold;">map!</span>
    <span style="font-weight: bold;">:g</span> <span style="font-style: italic;">"C-s-e"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">embark-act</span>
    (<span style="font-weight: bold;">:map</span> <span style="font-weight: bold; font-style: italic;">minibuffer-local-completion-map</span>
          <span style="font-style: italic;">"C-c C-o"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">embark-export</span>)
    (<span style="font-weight: bold;">:map</span> embark-file-map
          <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Open Dired on target"</span> <span style="font-weight: bold;">:g</span> <span style="font-style: italic;">"j"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">ffap-dired</span>
          <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Open target with sudo"</span> <span style="font-weight: bold;">:g</span> <span style="font-style: italic;">"s"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">sudo-edit</span>
          <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Open target with vlf"</span> <span style="font-weight: bold;">:g</span> <span style="font-style: italic;">"l"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">vlf</span>)
    (<span style="font-weight: bold;">:map</span> embark-file-map
          <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Cycle marginalia views"</span> <span style="font-weight: bold;">:g</span> <span style="font-style: italic;">"A"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">marginalia-cycle</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 170: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-embark-which-key-action-indicator</span> (map)
  <span style="font-style: italic;">"Helper function to display the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">whichey</span><span style="font-style: italic;">' help buffer for embark."</span>
  (which-key--show-keymap <span style="font-style: italic;">"Embark"</span> map nil nil <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">no-paging</span>)
  <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">which-key--hide-popup-ignore-command</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 171: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> embark-consult
  <span style="font-weight: bold;">:after</span> (embark consult)
  <span style="font-weight: bold;">:hook</span>
  (embark-collect-mode . embark-consult-preview-minor-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org6808766" class="outline-4">
<h4 id="org6808766"><span class="section-number-4">4.1.6</span> Extra commands</h4>
<div class="outline-text-4" id="text-4-1-6">
<p>
In order to be a full replacement for <code>ivy</code> + <code>counsel</code>, we need to install <code>consult</code>, which comes with a bundle of useful helper commands. Let&rsquo;s start with <code>packages.el</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 172: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">package!</span> consult)
</pre>
</div>

<p>
Now we need to configure each one of this packages. Let&rsquo;s start with the main <code>consult</code> package:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 173: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> consult
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">define-key!</span>
    [remap apropos]                       <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">consult-apropos</span>
    [remap bookmark-jump]                 <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">consult-bookmark</span>
    [remap <span style="font-weight: bold; font-style: italic;">command-history</span>]               <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">consult-complex-command</span>
    [remap evil-show-marks]               <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">consult-mark</span>
    [remap goto-line]                     <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">consult-goto-line</span>
    [remap grep]                          <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">consult-grep</span>
    [remap imenu]                         <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">consult-imenu</span>
    [remap isearch]                       <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">consult-isearch</span>
    [remap locate]                        <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">consult-locate</span>
    [remap load-theme]                    <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">consult-theme</span>
    [remap man]                           <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">consult-man</span>
    [remap multi-occur]                   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">consult-multi-occur</span>
    [remap projectile-ripgrep]            <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">consult-ripgrep</span>
    [remap recentf-open-files]            <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">consult-recent-file</span>
    [remap switch-to-buffer]              <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">consult-buffer</span>
    [remap switch-to-buffer-other-window] <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">consult-buffer-other-window</span>
    [remap switch-to-buffer-other-frame]  <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">consult-buffer-other-frame</span>
    [remap view-register]                 <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">consult-register</span>
    [remap yank-pop]                      <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">consult-yank-pop</span>)

  (<span style="font-weight: bold;">map!</span> (<span style="font-weight: bold;">:leader</span>
         <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Show mode commands"</span> <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"M-x"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">consult-mode-command</span>

         (<span style="font-weight: bold;">:prefix</span> (<span style="font-style: italic;">"s"</span> . <span style="font-style: italic;">"search"</span>)
          <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Jump to mark globally"</span> <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"R"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">consult-global-mark</span>)

         (<span style="font-weight: bold;">:prefix</span> (<span style="font-style: italic;">"f"</span> . <span style="font-style: italic;">"find"</span>)
          <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Find project file"</span> <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"o"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">consult-find</span>

          (<span style="font-weight: bold;">:prefix</span> (<span style="font-style: italic;">"i"</span> . <span style="font-style: italic;">"inside"</span>)
           <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Find inside file"</span> <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"f"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">consult-lines</span>
           <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Find inside file (focus)"</span> <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"F"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">consult-focus-lines</span>)))

        (<span style="font-weight: bold;">:map</span> <span style="font-weight: bold; font-style: italic;">outline-mode-map</span> <span style="font-weight: bold;">:localleader</span> <span style="font-weight: bold;">:prefix</span> (<span style="font-style: italic;">"s"</span> . <span style="font-style: italic;">"tree/subtree"</span>)
         <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Search outline"</span>  <span style="font-style: italic;">"o"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">consult-outline</span>))

  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> consult-project-root-function <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">doom-project-root</span>)
  (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">completion-in-region-function</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">consult-completion-in-region</span>)
  (<span style="font-weight: bold;">setq</span> consult-narrow-key <span style="font-style: italic;">"&lt;"</span>)
  (<span style="font-weight: bold;">setq</span> consult-line-numbers-widen t)
  (<span style="font-weight: bold;">setq</span> consult-async-input-debounce <span style="font-weight: bold; text-decoration: underline;">0.5</span>)
  (<span style="font-weight: bold;">setq</span> consult-async-input-throttle <span style="font-weight: bold; text-decoration: underline;">0.8</span>))
</pre>
</div>

<p>
We just set couple functions that are not default to <code>consult</code> and some minor tweaks on its options.
</p>

<p>
At this point, our configuration is matching the standard <code>ivy</code> + <code>counsel</code> duo.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 174: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defadvice!</span> my-extended-yank-pop-a (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> _)
  <span style="font-style: italic;">"Interactively select what text to insert from the kill ring."</span>
  <span style="font-weight: bold;">:override</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">+default/yank-pop</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (<span style="font-weight: bold; text-decoration: underline;">call-interactively</span>
   (<span style="font-weight: bold;">cond</span> ((<span style="font-weight: bold; text-decoration: underline;">fboundp</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">counsel-yank-pop</span>)    <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">counsel-yank-pop</span>)
         ((<span style="font-weight: bold; text-decoration: underline;">fboundp</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">consult-yank-pop</span>)    <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">consult-yank-pop</span>)
         ((<span style="font-weight: bold; text-decoration: underline;">fboundp</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">helm-show-kill-ring</span>) <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">helm-show-kill-ring</span>)
         ((<span style="font-weight: bold;">error</span> <span style="font-style: italic;">"No kill-ring search backend available. Enable ivy or helm!"</span>)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 175: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defadvice!</span> my-extended-search-project-a (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
  <span style="font-style: italic;">"Conduct a text search in the current project root.</span>

<span style="font-style: italic;">If prefix ARG is set, include ignored/hidden files."</span>
  <span style="font-weight: bold;">:override</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">+default/search-project</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (<span style="font-weight: bold;">let*</span> ( <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">(projectile-project-root nil)</span>
         (<span style="font-weight: bold; font-style: italic;">disabled-command-function</span> nil)
         (<span style="font-weight: bold; font-style: italic;">current-prefix-arg</span> (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold; text-decoration: underline;">eq</span> arg <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">other</span>) arg))
         (<span style="font-weight: bold; font-style: italic;">default-directory</span>
           (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">eq</span> arg <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">other</span>)
               (<span style="font-weight: bold;">if-let</span> (projects (<span style="font-weight: bold;">projectile-relevant-known-projects</span>))
                   (<span style="font-weight: bold; text-decoration: underline;">completing-read</span> <span style="font-style: italic;">"Search project: "</span> projects nil t)
                 (<span style="font-weight: bold;">user-error</span> <span style="font-style: italic;">"There are no known projects"</span>))
             <span style="font-weight: bold; font-style: italic;">default-directory</span>)))
    (<span style="font-weight: bold; text-decoration: underline;">call-interactively</span>
     (<span style="font-weight: bold;">cond</span> ((<span style="font-weight: bold;">featurep!</span> <span style="font-weight: bold;">:completion</span> ivy)  <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+ivy/project-search</span>)
           ((<span style="font-weight: bold;">featurep!</span> <span style="font-weight: bold;">:completion</span> helm) <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+helm/project-search</span>)
           ((<span style="font-weight: bold; text-decoration: underline;">fboundp</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">consult--grep</span>)     <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-selectrum-project-search</span>)
           (<span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">projectile-ripgrep</span>)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 176: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defadvice!</span> my-extended-search-cwd-a (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
  <span style="font-style: italic;">"Conduct a text search in files under the current folder.</span>

<span style="font-style: italic;">If prefix ARG is set, prompt for a directory to search from."</span>
  <span style="font-weight: bold;">:override</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">+default/search-cwd</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (<span style="font-weight: bold;">let</span> ((<span style="font-weight: bold; font-style: italic;">default-directory</span>
          (<span style="font-weight: bold;">if</span> arg
              (<span style="font-weight: bold;">read-directory-name</span> <span style="font-style: italic;">"Search directory: "</span>)
            <span style="font-weight: bold; font-style: italic;">default-directory</span>)))
    (<span style="font-weight: bold; text-decoration: underline;">call-interactively</span>
     (<span style="font-weight: bold;">cond</span> ((<span style="font-weight: bold;">featurep!</span> <span style="font-weight: bold;">:completion</span> ivy)  <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+ivy/project-search-from-cwd</span>)
           ((<span style="font-weight: bold;">featurep!</span> <span style="font-weight: bold;">:completion</span> helm) <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+helm/project-search-from-cwd</span>)
           ((<span style="font-weight: bold; text-decoration: underline;">fboundp</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">consult--grep</span>) <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-selectrum-project-search-from-cwd</span>)
           (<span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">rgrep</span>)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 177: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">cl-defun</span> <span style="font-weight: bold;">my-selectrum-file-search</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;key</span> query in all-files (recursive t) prompt args)
  <span style="font-style: italic;">"Conduct a file search using ripgrep.</span>

<span style="font-style: italic;">:query STRING</span>
<span style="font-style: italic;">  Determines the initial input to search for.</span>
<span style="font-style: italic;">:in PATH</span>
<span style="font-style: italic;">  Sets what directory to base the search out of. Defaults to the current</span>
<span style="font-style: italic;">  project's root.</span>
<span style="font-style: italic;">:recursive BOOL</span>
<span style="font-style: italic;">  Whether or not to search files recursively from the base directory."</span>
  (<span style="font-weight: bold;">declare</span> (indent defun))
  (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">executable-find</span> <span style="font-style: italic;">"rg"</span>)
    (<span style="font-weight: bold;">user-error</span> <span style="font-style: italic;">"Couldn't find ripgrep in your PATH"</span>))
  (<span style="font-weight: bold; text-decoration: underline;">require</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">consult</span>)
  (<span style="font-weight: bold;">let*</span> ((<span style="font-weight: bold; font-style: italic;">this-command</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">consult-ripgrep</span>)
         (<span style="font-weight: bold;">project-root</span> (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">doom-project-root</span>) <span style="font-weight: bold; font-style: italic;">default-directory</span>))
         (directory (<span style="font-weight: bold;">or</span> in project-root))
         (ripgrep-command (<span style="font-weight: bold; text-decoration: underline;">mapconcat</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">identity</span> (<span style="font-weight: bold;">seq-remove</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">null</span>
                                      (<span style="font-weight: bold; text-decoration: underline;">append</span> (<span style="font-weight: bold;">butlast</span> (<span style="font-weight: bold;">split-string</span> consult-ripgrep-command <span style="font-style: italic;">" +"</span>))
                                              (<span style="font-weight: bold; text-decoration: underline;">list</span>
                                               (<span style="font-weight: bold;">when</span> all-files <span style="font-style: italic;">"-uu"</span>)
                                               (<span style="font-weight: bold;">unless</span> recursive <span style="font-style: italic;">" --maxdepth 1"</span>)
                                               <span style="font-style: italic;">"--hidden"</span>
                                               <span style="font-style: italic;">"-g!.git"</span>)
                                              args
                                              <span style="font-weight: bold;">'</span>(<span style="font-style: italic;">"-e"</span>))) <span style="font-style: italic;">" "</span>))
         (prompt (<span style="font-weight: bold;">or</span> prompt
                     (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"%s [%s]: "</span>
                             ripgrep-command
                             (<span style="font-weight: bold;">cond</span> ((<span style="font-weight: bold; text-decoration: underline;">equal</span> directory <span style="font-weight: bold; font-style: italic;">default-directory</span>) <span style="font-style: italic;">"./"</span>)
                                   ((<span style="font-weight: bold; text-decoration: underline;">equal</span> directory project-root) (<span style="font-weight: bold;">projectile-project-name</span>))
                                   ((<span style="font-weight: bold;">file-relative-name</span> directory project-root))))))
         (query (<span style="font-weight: bold;">or</span> query
                    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">doom-region-active-p</span>)
                      (<span style="font-weight: bold;">replace-regexp-in-string</span>
                       <span style="font-style: italic;">"[! |]"</span> (<span style="font-weight: bold;">lambda</span> (substr)
                                 (<span style="font-weight: bold;">cond</span> ((<span style="font-weight: bold; text-decoration: underline;">string=</span> substr <span style="font-style: italic;">" "</span>) <span style="font-style: italic;">"  "</span>)
                                       ((<span style="font-weight: bold; text-decoration: underline;">string=</span> substr <span style="font-style: italic;">"|"</span>) <span style="font-style: italic;">"\\\\\\\\|"</span>)
                                       ((<span style="font-weight: bold; text-decoration: underline;">concat</span> <span style="font-style: italic;">"\\\\"</span> substr))))
                       (<span style="font-weight: bold;">rxt-quote-pcre</span> (<span style="font-weight: bold;">doom-thing-at-point-or-region</span>))))
                    <span style="font-style: italic;">" "</span>)))
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq deactivate-mark t)</span>
    (consult--grep prompt ripgrep-command directory query)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 178: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-selectrum-project-search</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg initial-query directory)
  <span style="font-style: italic;">"Performs a live project search from the project root using ripgrep.</span>
<span style="font-style: italic;">If ARG (universal argument), include all files, even hidden or compressed ones,</span>
<span style="font-style: italic;">in the search."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (my-selectrum-file-search
    <span style="font-weight: bold;">:prompt</span> (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"Find text on project files </span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">[%s</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">]"</span>
                    (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold; text-decoration: underline;">not</span> directory) (<span style="font-weight: bold;">doom-project-root</span>))
                            (<span style="font-weight: bold;">and</span> directory (<span style="font-weight: bold; text-decoration: underline;">equal</span> directory (<span style="font-weight: bold;">doom-project-root</span>))))
                        (<span style="font-weight: bold;">projectile-project-name</span>)
                      (<span style="font-weight: bold;">file-relative-name</span> (<span style="font-weight: bold;">or</span> directory (<span style="font-weight: bold;">doom-project-root</span>) <span style="font-weight: bold; font-style: italic;">default-directory</span>))))
    <span style="font-weight: bold;">:query</span> initial-query
    <span style="font-weight: bold;">:in</span> directory
    <span style="font-weight: bold;">:all-files</span> arg))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 179: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-selectrum-project-search-from-cwd</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg initial-query)
  <span style="font-style: italic;">"Performs a project search recursively from the current directory.</span>
<span style="font-style: italic;">If ARG (universal argument), include all files, even hidden or compressed ones."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (my-selectrum-project-search arg initial-query <span style="font-weight: bold; font-style: italic;">default-directory</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd795b20" class="outline-4">
<h4 id="orgd795b20"><span class="section-number-4">4.1.7</span> Change Doom&rsquo;s behavior</h4>
<div class="outline-text-4" id="text-4-1-7">
<p>
By default, Doom comes with all its configuration tailored for <code>ivy</code> or <code>helm</code>, this means that some packages will need some help from us to work nicely with <code>selectrum</code> and friends.c
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 180: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defadvice!</span> my-spell-correct-a ()
  <span style="font-style: italic;">"Correct spelling of word at point."</span>
  <span style="font-weight: bold;">:override</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">+spell/correct</span>
  (<span style="font-weight: bold;">interactive</span>)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">spell-fu fails to initialize correctly if it can't find aspell or a similar</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">program. We want to signal the error, not tell the user that every word is</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">spelled correctly.</span>
  (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">This is what spell-fu uses to check for the aspell executable</span>
           or (<span style="font-weight: bold;">and</span> <span style="font-weight: bold; font-style: italic;">ispell-really-aspell</span> <span style="font-weight: bold; font-style: italic;">ispell-program-name</span>)
           (<span style="font-weight: bold;">executable-find</span> <span style="font-style: italic;">"aspell"</span>))
    (<span style="font-weight: bold;">user-error</span> <span style="font-style: italic;">"Aspell is required for spell checking"</span>))

  (<span style="font-weight: bold;">ispell-set-spellchecker-params</span>)
  (<span style="font-weight: bold;">save-current-buffer</span>
    (<span style="font-weight: bold;">ispell-accept-buffer-local-defs</span>))
  (<span style="font-weight: bold;">cl-destructuring-bind</span> (start . end)
      (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">bounds-of-thing-at-point</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">word</span>)
          (<span style="font-weight: bold;">user-error</span> <span style="font-style: italic;">"No word at point"</span>))
    (<span style="font-weight: bold;">let</span> ((word (<span style="font-weight: bold;">thing-at-point</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">word</span> t))
          (orig-pt (<span style="font-weight: bold; text-decoration: underline;">point</span>))
          poss <span style="font-weight: bold; font-style: italic;">ispell-filter</span>)
      (<span style="font-weight: bold;">ispell-send-string</span> <span style="font-style: italic;">"%\n"</span>)
      (<span style="font-weight: bold;">ispell-send-string</span> (<span style="font-weight: bold; text-decoration: underline;">concat</span> <span style="font-style: italic;">"^"</span> word <span style="font-style: italic;">"\n"</span>))
      (<span style="font-weight: bold;">while</span> (<span style="font-weight: bold;">progn</span> (<span style="font-weight: bold; text-decoration: underline;">accept-process-output</span> <span style="font-weight: bold; font-style: italic;">ispell-process</span>)
                    (<span style="font-weight: bold; text-decoration: underline;">not</span> (<span style="font-weight: bold; text-decoration: underline;">string=</span> <span style="font-style: italic;">""</span> (<span style="font-weight: bold; text-decoration: underline;">car</span> <span style="font-weight: bold; font-style: italic;">ispell-filter</span>)))))
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Remove leading empty element</span>
      (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">ispell-filter</span> (<span style="font-weight: bold; text-decoration: underline;">cdr</span> <span style="font-weight: bold; font-style: italic;">ispell-filter</span>))
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">ispell process should return something after word is sent. Tag word as</span>
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">valid (i.e., skip) otherwise</span>
      (<span style="font-weight: bold;">unless</span> <span style="font-weight: bold; font-style: italic;">ispell-filter</span>
        (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">ispell-filter</span> <span style="font-weight: bold;">'</span>(*)))
      (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold; text-decoration: underline;">consp</span> <span style="font-weight: bold; font-style: italic;">ispell-filter</span>)
        (<span style="font-weight: bold;">setq</span> poss (<span style="font-weight: bold;">ispell-parse-output</span> (<span style="font-weight: bold; text-decoration: underline;">car</span> <span style="font-weight: bold; font-style: italic;">ispell-filter</span>))))
      (<span style="font-weight: bold;">cond</span>
       ((<span style="font-weight: bold;">or</span> (<span style="font-weight: bold; text-decoration: underline;">eq</span> poss t) (<span style="font-weight: bold; text-decoration: underline;">stringp</span> poss))
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">don't correct word</span>
        (<span style="font-weight: bold; text-decoration: underline;">message</span> <span style="font-style: italic;">"%s is correct"</span> (<span style="font-weight: bold; text-decoration: underline;">funcall</span> <span style="font-weight: bold; font-style: italic;">ispell-format-word-function</span> word))
        t)
       ((<span style="font-weight: bold; text-decoration: underline;">null</span> poss)
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">ispell error</span>
        (<span style="font-weight: bold;">error</span> <span style="font-style: italic;">"Ispell: error in Ispell process"</span>))
       (t
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">The word is incorrect, we have to propose a replacement.</span>
        (<span style="font-weight: bold;">setq</span> res (<span style="font-weight: bold; text-decoration: underline;">funcall</span> <span style="font-weight: bold; font-style: italic;">+spell-correct-interface</span> (<span style="font-weight: bold; text-decoration: underline;">nth</span> <span style="font-weight: bold; text-decoration: underline;">2</span> poss) word))
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Some interfaces actually eat 'C-g' so it's impossible to stop rapid</span>
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">mode. So when interface returns nil we treat it as a stop.</span>
        (<span style="font-weight: bold;">unless</span> res (<span style="font-weight: bold;">setq</span> res (<span style="font-weight: bold; text-decoration: underline;">cons</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">break</span> word)))
        (<span style="font-weight: bold;">cond</span>
         ((<span style="font-weight: bold; text-decoration: underline;">stringp</span> res)
          (+spell--correct res poss word orig-pt start end))
         ((<span style="font-weight: bold;">let</span> ((cmd (<span style="font-weight: bold; text-decoration: underline;">car</span> res))
                (wrd (<span style="font-weight: bold; text-decoration: underline;">cdr</span> res)))
            (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold; text-decoration: underline;">eq</span> cmd <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">skip</span>)
                        (<span style="font-weight: bold; text-decoration: underline;">eq</span> cmd <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">break</span>)
                        (<span style="font-weight: bold; text-decoration: underline;">eq</span> cmd <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">stop</span>))
              (+spell--correct cmd poss wrd orig-pt start end)
              (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold; text-decoration: underline;">string-equal</span> wrd word)
                (+spell--correct wrd poss word orig-pt start end))))))
        (<span style="font-weight: bold;">ispell-pdict-save</span> t))))))

</pre>
</div>

<p>
The first module we have to change, is <i>workspaces</i>.
</p>
</div>
</div>
</div>

<div id="outline-container-org29cc02c" class="outline-3">
<h3 id="org29cc02c"><span class="section-number-3">4.2</span> <span class="todo TODO">TODO</span> Workspaces</h3>
<div class="outline-text-3" id="text-4-2">
<p>
There is one module on Doom that don&rsquo;t play nice with <code>selectrum</code>: <i>Workspace</i> (based on <code>persp-mode</code>).
</p>

<p>
The problem with <i>Workspace</i> is that its base package is buggy, and requires Doom to do a lot of work in order to get it more or less working.
</p>

<p>
Instead of trying to replace functions from this package, we will disable the module entirely and add <code>perspective.el</code>, which is the package <code>persp-mode</code> forked.
</p>

<p>
We already disable the module on our <code>init.el</code> by commenting the line referent to it (you can check it on the <a href="#org7a74285">1</a> section). But there is another package Doom uses to synchronize its workspaces that conflicts with <code>perspective.el</code>: <code>treemacs-persp</code>.
</p>

<p>
Since we will install another package to sync with <code>treemacs</code>, we can disable this one on our <code>packages.el</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 181: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">package!</span> treemacs-persp <span style="font-weight: bold;">:disable</span> t)
</pre>
</div>

<p>
The next step is to add the three packages we will use to replace <code>persp-mode</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 182: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">package!</span> perspective)
(<span style="font-weight: bold;">package!</span> persp-projectile)
(<span style="font-weight: bold;">package!</span> treemacs-perspective)
</pre>
</div>

<p>
With that we can start configuring these packages with <code>use-package!</code>. Let&rsquo;s begin with the main package since it is the most complex:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 183: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> perspective
</pre>
</div>

<p>
Add the trigger to let Doom knows when to actually load the package:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 184: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">  <span style="font-weight: bold;">:hook</span> (doom-first-input . persp-mode)
</pre>
</div>

<p>
<code>perspective.el</code> allows different styles of sorting for its workspaces, the one that is closer to what Doom offers by default is to sort them by the order we create them.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 185: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">  <span style="font-weight: bold;">:custom</span>
  (persp-sort <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">created</span>)
</pre>
</div>

<p>
It still print the perspectives on the inverse order that we want, but we will fix that behavior when we implement the <i>workspace tab bar</i> later.
</p>

<p>
And since we will implement the default Doom <i>workspace tab bar</i>, we don&rsquo;t need <code>perspective.el</code> to print its perspective on the modeline:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 186: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">  (persp-show-modestring nil)
</pre>
</div>

<p>
This change is something particular to my taste. Doom set the name of the workspace that never closes to &ldquo;main&rdquo;. Although this is a good name, I would rater something even more generic:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 187: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">  (persp-initial-frame-name <span style="font-style: italic;">"default"</span>)
</pre>
</div>

<p>
With these configurations we can turn <code>perspective.el</code> on when Doom loads the module:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 188: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">  <span style="font-weight: bold;">:config</span>
  (persp-mode <span style="font-weight: bold; text-decoration: underline;">1</span>)
</pre>
</div>

<p>
As mentioned before, Doom has the <i>workspaces</i> module tight coupled with other ares. The problem we have is <code>persp-mode</code>, uses the same mode name of <code>perspective.el</code>, and when some Doom configuration tries to retrieve an information from <i>workspaces</i>, it can&rsquo;t detect we disabled the module.
</p>

<p>
To workaround this, we need to define or alias some functions that Doom expects to be available when <i>workspaces</i> is on:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 189: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">persp-parameter</span> (param-name <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> persp)
  (<span style="font-weight: bold;">alist-get</span> param-name (persp-local-variables (<span style="font-weight: bold;">or</span> persp (persp-curr)))))

<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold; text-decoration: underline;">defalias</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold;">get-current-persp</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">persp-current-name</span>)

<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold; text-decoration: underline;">defalias</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold;">safe-persp-name</span> (<span style="font-weight: bold;">lambda</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> _) (persp-current-name)))
</pre>
</div>

<p>
Don&rsquo;t forget to close the <code>use-package!</code> sexp:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 190: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp"><span style="color: #88090B;">)</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">use-package! perspective</span>
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 191: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">project-bookmark-alist</span> ()
  (<span style="font-weight: bold;">seq-filter</span>
   (<span style="font-weight: bold;">lambda</span> (bm)
     (<span style="font-weight: bold;">when-let</span> ((proj-root (<span style="font-weight: bold;">doom-project-root</span>)))
       (<span style="font-weight: bold; text-decoration: underline;">not</span> (<span style="font-weight: bold;">cl-search</span> <span style="font-style: italic;">".."</span> (<span style="font-weight: bold;">file-relative-name</span> (bookmark-get-filename bm) proj-root)))))
   bookmark-alist))


<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">project-bookmark-completing-read</span> (prompt <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> default)
  <span style="font-style: italic;">"Prompting with PROMPT, read a bookmark name in completion.</span>

<span style="font-style: italic;">PROMPT will get a \": \" stuck on the end no matter what, so you probably don't</span>
<span style="font-style: italic;">want to include one yourself. Optional arg DEFAULT is a string to return if the</span>
<span style="font-style: italic;">user input is empty. If DEFAULT is nil then return empty string for empty</span>
<span style="font-style: italic;">input."</span>
  (bookmark-maybe-load-default-file)    <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">paranoia</span>
  (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">listp</span> <span style="font-weight: bold; font-style: italic;">last-nonmenu-event</span>)
      (bookmark-menu-popup-paned-menu t prompt
                                      (<span style="font-weight: bold;">if</span> bookmark-sort-flag
                                          (<span style="font-weight: bold; text-decoration: underline;">sort</span> (bookmark-all-names)
                                                <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">string-lessp</span>)
                                        (bookmark-all-names)))
    (<span style="font-weight: bold;">let*</span> ((<span style="font-weight: bold; font-style: italic;">completion-ignore-case</span> bookmark-completion-ignore-case)
           (default (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold; text-decoration: underline;">equal</span> <span style="font-style: italic;">""</span> default) default))
           (prompt (<span style="font-weight: bold; text-decoration: underline;">concat</span> prompt (<span style="font-weight: bold;">if</span> default
                                      (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">" (%s): "</span> default)
                                    <span style="font-style: italic;">": "</span>))))
      (<span style="font-weight: bold; text-decoration: underline;">completing-read</span> prompt
                       (<span style="font-weight: bold;">lambda</span> (<span style="font-weight: bold; text-decoration: underline;">string</span> pred action)
                         (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">eq</span> action <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">metadata</span>)
                             <span style="font-weight: bold;">'</span>(metadata (category . bookmark))
                           (<span style="font-weight: bold;">complete-with-action</span>
                            action
                            (project-bookmar-alist)
                            string
                            pred)))
                       nil <span style="font-weight: bold; text-decoration: underline;">0</span> nil <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">bookmark-history</span> default))))


<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">project-bookmark-jump</span> (bookmark <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> display-func)
  <span style="font-style: italic;">"Jump to bookmark BOOKMARK (a point in some file).</span>

<span style="font-style: italic;">You may have a problem using this function if the value of variable</span>
<span style="font-style: italic;">`</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">bookmark-alist</span><span style="font-style: italic;">' is nil. If that happens, you need to load in some bookmarks.</span>
<span style="font-style: italic;">See help on function `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">bookmark-load</span><span style="font-style: italic;">' for more about this.</span>

<span style="font-style: italic;">If the file pointed to by BOOKMARK no longer exists, you will be asked if you</span>
<span style="font-style: italic;">wish to give the bookmark a new location, and `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">bookmark-jump</span><span style="font-style: italic;">' will then jump to</span>
<span style="font-style: italic;">the new location, as well as recording it in place of the old one in the</span>
<span style="font-style: italic;">permanent bookmark record.</span>

<span style="font-style: italic;">BOOKMARK is usually a bookmark name (a string).  It can also be a</span>
<span style="font-style: italic;">bookmark record, but this is usually only done by programmatic callers.</span>

<span style="font-style: italic;">If DISPLAY-FUNC is non-nil, it is a function to invoke to display the</span>
<span style="font-style: italic;">bookmark.  It defaults to `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">pop-to-buffer-same-window</span><span style="font-style: italic;">'.  A typical value for</span>
<span style="font-style: italic;">DISPLAY-FUNC would be `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">switch-to-buffer-other-window</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">interactive</span>
   (<span style="font-weight: bold; text-decoration: underline;">list</span> (project-bookmark-completing-read <span style="font-style: italic;">"Jump to bookmark"</span>
                                           bookmark-current-bookmark)))
  (<span style="font-weight: bold;">unless</span> bookmark
    (<span style="font-weight: bold;">error</span> <span style="font-style: italic;">"No bookmark specified"</span>))
  (bookmark-maybe-historicize-string bookmark)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Don't use `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">switch-to-buffer</span><span style="font-weight: bold; font-style: italic;">' because it would let the</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">window-point override the bookmark's point when</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">`</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">switch-to-buffer-preserve-window-point</span><span style="font-weight: bold; font-style: italic;">' is non-nil.</span>
  (bookmark--jump-via bookmark (<span style="font-weight: bold;">or</span> display-func <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">pop-to-buffer-same-window</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 192: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">project-recentf-list</span> ()
  (<span style="font-weight: bold;">seq-filter</span>
   (<span style="font-weight: bold;">lambda</span> (fname)
     (<span style="font-weight: bold;">when-let</span> ((proj-root (<span style="font-weight: bold;">doom-project-root</span>)))
       (<span style="font-weight: bold; text-decoration: underline;">not</span> (<span style="font-weight: bold;">cl-search</span> <span style="font-style: italic;">".."</span> (<span style="font-weight: bold;">file-relative-name</span> fname proj-root)))))
   <span style="font-weight: bold; font-style: italic;">recentf-list</span>))

<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">persp-current-real-buffers</span> ()
  <span style="font-style: italic;">"Return a list of names of all living buffers in the current perspective."</span>
  (<span style="font-weight: bold;">let</span> ((ignore-rx (persp--make-ignore-buffer-rx)))
    (<span style="font-weight: bold;">cl-loop</span> for buf in (persp-current-buffers)
             if (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold; font-style: italic;">doom-real-buffer-p</span> buf)
                     (<span style="font-weight: bold; text-decoration: underline;">not</span> (<span style="font-weight: bold;">string-match-p</span> ignore-rx (<span style="font-weight: bold; text-decoration: underline;">buffer-name</span> buf))))
             collect buf)))

<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">persp-current-real-buffer-names</span> ()
  <span style="font-style: italic;">"Return a list of names of all living buffers in the current perspective."</span>
  (<span style="font-weight: bold;">let</span> ((ignore-rx (persp--make-ignore-buffer-rx)))
    (<span style="font-weight: bold;">cl-loop</span> for buf in (persp-current-buffers)
             if (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold; font-style: italic;">doom-real-buffer-p</span> buf)
                     (<span style="font-weight: bold; text-decoration: underline;">not</span> (<span style="font-weight: bold;">string-match-p</span> ignore-rx (<span style="font-weight: bold; text-decoration: underline;">buffer-name</span> buf))))
             collect (<span style="font-weight: bold; text-decoration: underline;">buffer-name</span> buf))))

<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">persp-switch-to-real-buffer*</span> (buffer-or-name)
  <span style="font-style: italic;">"Like `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">switch-to-buffer</span><span style="font-style: italic;">', restricted to the current perspective.</span>
<span style="font-style: italic;">This respects ido-ignore-buffers, since we automatically add buffer filtering to</span>
<span style="font-style: italic;">ido-mode already (see use of PERSP-SET-IDO-BUFFERS)."</span>
  (<span style="font-weight: bold;">interactive</span>
   (<span style="font-weight: bold; text-decoration: underline;">list</span>
    (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">or</span> <span style="font-weight: bold; font-style: italic;">current-prefix-arg</span> (<span style="font-weight: bold; text-decoration: underline;">not</span> persp-mode))
        (<span style="font-weight: bold;">let</span> ((<span style="font-weight: bold; font-style: italic;">read-buffer-function</span> nil))
          (<span style="font-weight: bold;">read-buffer-to-switch</span> <span style="font-style: italic;">"Switch to buffer"</span>))
      (<span style="font-weight: bold;">let*</span> ((candidates (persp-current-real-buffer-names))
             (other (<span style="font-weight: bold; text-decoration: underline;">buffer-name</span> (persp-other-buffer))))
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">NB: This intentionally calls completing-read instead of</span>
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">persp-interactive-completion-function, since it is expected to have</span>
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">been replaced by a completion framework.</span>
        (<span style="font-weight: bold; text-decoration: underline;">completing-read</span> (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"Switch to buffer%s: "</span>
                                 (<span style="font-weight: bold;">if</span> other
                                     (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">" (default %s)"</span> other)
                                   <span style="font-style: italic;">""</span>))
                         candidates
                         nil nil nil nil
                         (<span style="font-weight: bold; text-decoration: underline;">buffer-name</span> (persp-other-buffer)))))))
  (<span style="font-weight: bold;">let</span> ((buffer (<span style="font-weight: bold;">window-normalize-buffer-to-switch-to</span> buffer-or-name)))
    (<span style="font-weight: bold;">switch-to-buffer</span> buffer)))
</pre>
</div>


<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 193: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">persp-consult-buffer</span> ()
  <span style="font-style: italic;">"Enhanced `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">switch-to-buffer</span><span style="font-style: italic;">' command with support for perspectives.</span>

<span style="font-style: italic;">The command supports recent files, bookmarks, views and project files as virtual</span>
<span style="font-style: italic;">buffers. Buffers are previewed. Furthermore narrowing to buffers (b), files (f),</span>
<span style="font-style: italic;">bookmarks (m), views (v) and project files (p) is supported via the</span>
<span style="font-style: italic;">corresponding keys. In order to determine the project-specific files and</span>
<span style="font-style: italic;">buffers, the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">consult-project-root-function</span><span style="font-style: italic;">' is used. The list of available</span>
<span style="font-style: italic;">views is obtained by calling `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">consult-view-list-function</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold; text-decoration: underline;">require</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">consult</span>)
  (persp-consult--buffer <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">switch-to-buffer</span>
                         <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">find-file</span>
                         <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">bookmark-jump</span>))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">persp-consult--buffer</span> (open-buffer open-file open-bookmark)
  <span style="font-style: italic;">"Backend implementation of `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">consult-buffer</span><span style="font-style: italic;">'.</span>

<span style="font-style: italic;">Depending on the selected item OPEN-BUFFER, OPEN-FILE or OPEN-BOOKMARK will be</span>
<span style="font-style: italic;">used to display the item."</span>
  (<span style="font-weight: bold;">let*</span> ((curr-buf (<span style="font-weight: bold; text-decoration: underline;">current-buffer</span>))
         (all-bufs (<span style="font-weight: bold; text-decoration: underline;">append</span> (<span style="font-weight: bold; text-decoration: underline;">delq</span> curr-buf (persp-current-real-buffers)) (<span style="font-weight: bold; text-decoration: underline;">list</span> curr-buf)))
         (buf-file-hash (<span style="font-weight: bold;">let</span> ((ht (<span style="font-weight: bold; text-decoration: underline;">make-hash-table</span> <span style="font-weight: bold;">:test</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">equal</span> <span style="font-weight: bold;">:size</span> (<span style="font-weight: bold; text-decoration: underline;">length</span> all-bufs))))
                          (<span style="font-weight: bold;">dolist</span> (buf all-bufs ht)
                            (<span style="font-weight: bold;">when-let</span> (file (<span style="font-weight: bold; font-style: italic;">buffer-file-name</span> buf))
                              (<span style="font-weight: bold; text-decoration: underline;">puthash</span> file t ht)))))
         (buf-filter (consult--regexp-filter consult-buffer-filter))
         (bufs (<span style="font-weight: bold; text-decoration: underline;">mapcar</span> (<span style="font-weight: bold;">lambda</span> (x)
                         (<span style="font-weight: bold;">let</span> ((name (<span style="font-weight: bold; text-decoration: underline;">buffer-name</span> x)))
                           (consult--buffer-candidate
                            (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">string-match-p</span> buf-filter name) ?h ?b)
                            name <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">consult-buffer</span>)))
                       all-bufs))
         (views (<span style="font-weight: bold;">when</span> consult-view-list-function
                  (<span style="font-weight: bold; text-decoration: underline;">mapcar</span> (<span style="font-weight: bold;">lambda</span> (x)
                            (consult--buffer-candidate ?v x <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">consult-view</span>))
                          (<span style="font-weight: bold; text-decoration: underline;">funcall</span> consult-view-list-function))))
         (bookmarks (<span style="font-weight: bold;">progn</span>
                      (bookmark-maybe-load-default-file)
                      (<span style="font-weight: bold; text-decoration: underline;">mapcar</span> (<span style="font-weight: bold;">lambda</span> (x)
                                (consult--buffer-candidate ?m (<span style="font-weight: bold; text-decoration: underline;">car</span> x) <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">consult-bookmark</span>))
                              (project-bookmark-alist))))
         (all-files (<span style="font-weight: bold;">seq-remove</span> (<span style="font-weight: bold;">lambda</span> (x) (<span style="font-weight: bold; text-decoration: underline;">gethash</span> x buf-file-hash)) (project-recentf-list)))
         (files (<span style="font-weight: bold; text-decoration: underline;">mapcar</span> (<span style="font-weight: bold;">lambda</span> (x)
                          (consult--buffer-candidate ?f (<span style="font-weight: bold;">abbreviate-file-name</span> x) <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">consult-file</span>))
                        all-files))
         (proj-root (<span style="font-weight: bold;">and</span> consult-project-root-function (<span style="font-weight: bold; text-decoration: underline;">funcall</span> consult-project-root-function)))
         (proj-bufs (<span style="font-weight: bold;">when</span> proj-root
                      (<span style="font-weight: bold; text-decoration: underline;">mapcar</span> (<span style="font-weight: bold;">lambda</span> (x)
                                (consult--buffer-candidate ?p (<span style="font-weight: bold; text-decoration: underline;">buffer-name</span> x) <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">consult-buffer</span>))
                              (<span style="font-weight: bold;">seq-filter</span> (<span style="font-weight: bold;">lambda</span> (x)
                                            (<span style="font-weight: bold;">when-let</span> (file (<span style="font-weight: bold; font-style: italic;">buffer-file-name</span> x))
                                              (<span style="font-weight: bold;">string-prefix-p</span> proj-root file)))
                                          all-bufs))))
         (proj-files (<span style="font-weight: bold;">when</span> proj-root
                       (<span style="font-weight: bold;">let</span> ((len (<span style="font-weight: bold; text-decoration: underline;">length</span> proj-root))
                             (hidden-root (<span style="font-weight: bold; text-decoration: underline;">propertize</span> proj-root <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">invisible</span> t)))
                         (<span style="font-weight: bold; text-decoration: underline;">mapcar</span> (<span style="font-weight: bold;">lambda</span> (x)
                                   (consult--buffer-candidate
                                    ?q
                                    (<span style="font-weight: bold; text-decoration: underline;">concat</span> hidden-root (<span style="font-weight: bold; text-decoration: underline;">substring</span> x len))
                                    <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">consult-file</span>))
                                 (<span style="font-weight: bold;">seq-filter</span> (<span style="font-weight: bold;">lambda</span> (x) (<span style="font-weight: bold;">string-prefix-p</span> proj-root x)) all-files)))))
         (selected
          (consult--read
           <span style="font-style: italic;">"Switch to: "</span> (<span style="font-weight: bold; text-decoration: underline;">append</span> bufs files proj-bufs proj-files views bookmarks)
           <span style="font-weight: bold;">:history</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">consult--buffer-history</span>
           <span style="font-weight: bold;">:sort</span> nil
           <span style="font-weight: bold;">:predicate</span>
           (<span style="font-weight: bold;">lambda</span> (cand)
             (<span style="font-weight: bold;">let</span> ((type (<span style="font-weight: bold; text-decoration: underline;">-</span> (<span style="font-weight: bold; text-decoration: underline;">aref</span> cand <span style="font-weight: bold; text-decoration: underline;">0</span>) consult--tofu-char)))
               (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold; text-decoration: underline;">=</span> type ?q) (<span style="font-weight: bold;">setq</span> type ?p)) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">q=project files</span>
               (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">eq</span> consult--narrow <span style="font-weight: bold; text-decoration: underline;">32</span>) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">narrowed to hidden buffers</span>
                   (<span style="font-weight: bold; text-decoration: underline;">=</span> type ?h)
                 (<span style="font-weight: bold;">and</span>
                  (<span style="font-weight: bold; text-decoration: underline;">/=</span> type ?h) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">non-hidden buffers</span>
                  (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold; text-decoration: underline;">not</span> consult--narrow) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">narrowed</span>
                      (<span style="font-weight: bold; text-decoration: underline;">=</span> type consult--narrow))))))
           <span style="font-weight: bold;">:narrow</span> <span style="font-weight: bold;">`</span>((<span style="font-weight: bold; text-decoration: underline;">32</span> . <span style="font-style: italic;">"Hidden"</span>)
                     (?b . <span style="font-style: italic;">"Buffer"</span>)
                     (?f . <span style="font-style: italic;">"File"</span>)
                     (?m . <span style="font-style: italic;">"Bookmark"</span>)
                     ,@(<span style="font-weight: bold;">when</span> proj-root <span style="font-weight: bold;">'</span>((?p . <span style="font-style: italic;">"Project"</span>)))
                     ,@(<span style="font-weight: bold;">when</span> consult-view-list-function <span style="font-weight: bold;">'</span>((?v . <span style="font-style: italic;">"View"</span>))))
           <span style="font-weight: bold;">:category</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">consult-buffer</span>
           <span style="font-weight: bold;">:lookup</span>
           (<span style="font-weight: bold;">lambda</span> (_ candidates cand)
             (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">member</span> cand candidates)
                 (<span style="font-weight: bold; text-decoration: underline;">cons</span> (<span style="font-weight: bold;">pcase-exhaustive</span> (<span style="font-weight: bold; text-decoration: underline;">-</span> (<span style="font-weight: bold; text-decoration: underline;">aref</span> cand <span style="font-weight: bold; text-decoration: underline;">0</span>) consult--tofu-char)
                         (?b open-buffer)
                         (?h open-buffer)
                         (?m open-bookmark)
                         (?v consult-view-open-function)
                         (?p open-buffer)
                         (?q open-file)
                         (?f open-file))
                       (<span style="font-weight: bold; text-decoration: underline;">substring</span> cand <span style="font-weight: bold; text-decoration: underline;">1</span>))
               <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">When candidate is not found in the alist,</span>
               <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">default to creating a new buffer.</span>
               (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold; text-decoration: underline;">not</span> (<span style="font-weight: bold;">string-blank-p</span> cand)) (<span style="font-weight: bold; text-decoration: underline;">cons</span> open-buffer cand))))
           <span style="font-weight: bold;">:preview</span>
           (<span style="font-weight: bold;">lambda</span> (cand restore)
             (<span style="font-weight: bold;">cond</span>
              (restore)
              <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">In order to avoid slowness and unnecessary complexity, we</span>
              <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">only preview buffers. Loading recent files, bookmarks or</span>
              <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">views can result in expensive operations.</span>
              ((<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold; text-decoration: underline;">eq</span> (<span style="font-weight: bold; text-decoration: underline;">car</span> cand) <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">switch-to-buffer</span>)
                        (<span style="font-weight: bold; text-decoration: underline;">eq</span> (<span style="font-weight: bold; text-decoration: underline;">car</span> cand) <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">switch-to-buffer-other-window</span>))
                    (<span style="font-weight: bold; text-decoration: underline;">get-buffer</span> (<span style="font-weight: bold; text-decoration: underline;">cdr</span> cand)))
               (<span style="font-weight: bold; text-decoration: underline;">funcall</span> (<span style="font-weight: bold; text-decoration: underline;">car</span> cand) (<span style="font-weight: bold; text-decoration: underline;">cdr</span> cand) <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">norecord</span>)))))))
    (<span style="font-weight: bold;">when</span> selected (<span style="font-weight: bold; text-decoration: underline;">funcall</span> (<span style="font-weight: bold; text-decoration: underline;">car</span> selected) (<span style="font-weight: bold; text-decoration: underline;">cdr</span> selected)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 194: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">map!</span> <span style="font-weight: bold;">:leader</span>
      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Switch buffer"</span> <span style="font-weight: bold;">:nvm</span> <span style="font-style: italic;">","</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">persp-consult-buffer</span>
      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Switch to any buffer"</span> <span style="font-weight: bold;">:nvm</span> <span style="font-style: italic;">"&lt;"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">consult-buffer</span>)
</pre>
</div>


<p>
Now we can install the <code>projectile</code> extension for <code>perspective.el</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 195: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> persp-projectile <span style="font-weight: bold;">:after</span> (projectile perspective))
</pre>
</div>

<p>
And the one for <code>treemacs</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 196: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> treemacs-perspective <span style="font-weight: bold;">:after</span> (<span style="font-weight: bold;">treemacs</span> perspective)
</pre>
</div>

<p>
The <code>treemacs</code> integration, also needs some tweaks to functions and hooks that Doom installs in order to guarantee a better behavior from <code>treemacs</code> and <code>persp-mode</code>.
</p>

<p>
Once Doom loads the <code>treemacs</code> package, we set its scope to <code>'Perspectives</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 197: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">  <span style="font-weight: bold;">:config</span>
  (treemacs-set-scope-type <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">Perspectives</span>)
</pre>
</div>

<p>
Next, we need to change the <code>treemacs--on-scope-kill</code> function signature. <code>persp-mode</code> calls all hooks from <code>persp-killed-hook</code> with the current perspective as an argument. <code>perspective.el</code> changed this behavior to not send any information when calling hooks.
</p>

<p>
The easiest way to fix this is to create a thin wrapper function for <code>treemacs--on-scope-kill</code> that will call the correct function passing the result of <code>(persp-curr)</code> as an argument:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 198: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">  (<span style="font-weight: bold; text-decoration: underline;">defalias</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold;">treemacs--new-on-scope-kill</span>
    (<span style="font-weight: bold;">lambda</span> () (treemacs--on-scope-kill (persp-curr))))
</pre>
</div>

<p>
Then, we can swap the functions on the <code>persp-killed-hook</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 199: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">  (<span style="font-weight: bold;">remove-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">persp-killed-hook</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">treemacs--on-scope-kill</span>)
  (<span style="font-weight: bold;">add-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">persp-killed-hook</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">treemacs--new-on-scope-kill</span>)
</pre>
</div>

<p>
And finish it by closing the sexp for <code>use-package!</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 200: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">  <span style="color: #88090B;">)</span>
</pre>
</div>

<p>
The configuration we have so far will get <code>perspective.el</code> working, but not as conveniently as the standard feature on Doom. To achieve the whole functionality, there are two changes we still needs: Dashboard integration and keybindings.
</p>

<p>
As with other keybindings in my configuration, I will get new functions to live on an <i>autoload</i> file, and call them on the mapping.
</p>

<p>
The main idea is to mimic Doom&rsquo;s keybindings, so let&rsquo;s look what binds are available for workspaces:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Action</th>
<th scope="col" class="org-left">Keybinding</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Display tab bar</td>
<td class="org-left"><code>SPC TAB TAB</code></td>
</tr>

<tr>
<td class="org-left">Switch workspace</td>
<td class="org-left"><code>SPC TAB .</code></td>
</tr>

<tr>
<td class="org-left">Switch to N<sup>th</sup> workspace</td>
<td class="org-left"><code>SPC TAB</code> <i>N</i></td>
</tr>

<tr>
<td class="org-left">Switch to final workspace</td>
<td class="org-left"><code>SPC TAB 0</code></td>
</tr>

<tr>
<td class="org-left">Switch to last used workspace</td>
<td class="org-left"><code>SPC TAB `</code></td>
</tr>

<tr>
<td class="org-left">Previous workspace</td>
<td class="org-left"><code>SPC TAB [</code></td>
</tr>

<tr>
<td class="org-left">Next workspace</td>
<td class="org-left"><code>SPC TAB ]</code></td>
</tr>

<tr>
<td class="org-left">New workspace</td>
<td class="org-left"><code>SPC TAB n</code></td>
</tr>

<tr>
<td class="org-left">Rename workspace</td>
<td class="org-left"><code>SPC TAB r</code></td>
</tr>

<tr>
<td class="org-left">Delete this workspace</td>
<td class="org-left"><code>SPC TAB d</code></td>
</tr>

<tr>
<td class="org-left">Delete session</td>
<td class="org-left"><code>SPC TAB x</code></td>
</tr>

<tr>
<td class="org-left">Delete session and quit</td>
<td class="org-left"><code>SPC TAB X</code></td>
</tr>

<tr>
<td class="org-left">Save session to file</td>
<td class="org-left"><code>SPC TAB s</code></td>
</tr>

<tr>
<td class="org-left">Load session from file</td>
<td class="org-left"><code>SPC TAB l</code></td>
</tr>

<tr>
<td class="org-left">Restore last session</td>
<td class="org-left"><code>SPC TAB R</code></td>
</tr>
</tbody>
</table>

<p>
The next sections will cover each one of these commands, but before we begin, let&rsquo;s prepare our mapping functions:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 201: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">map!</span> (<span style="font-weight: bold;">:leader</span>
      (<span style="font-weight: bold;">:prefix</span> (<span style="font-style: italic;">"TAB"</span> . <span style="font-style: italic;">"workspace"</span>)
</pre>
</div>

<p>
Now we can start with the <i>Display tab bar</i> binding, since it is the foundation of Doom&rsquo;s workspace system.
</p>
</div>

<div id="outline-container-org63a17eb" class="outline-4">
<h4 id="org63a17eb"><span class="section-number-4">4.2.1</span> Display tab bar</h4>
<div class="outline-text-4" id="text-4-2-1">
<p>
We know Doom uses two special font faces to draw the workspace tab bar (<code>+workspace-tab-selected-face</code> and <code>+workspace-tab-face</code>), but we removed the <code>workspace</code> module from our <code>init.el</code>. To keep our configuration as close to Doom as possible we need to redefine these faces. Let&rsquo;s use our <i>autoload</i> file <code>autoload/workspace.el</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 202: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">+workspace-tab-selected-face</span> <span style="font-weight: bold;">'</span>((t (<span style="font-weight: bold;">:inherit</span> highlight)))
  <span style="font-style: italic;">"The face for selected tabs displayed by `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">+workspace/display</span><span style="font-style: italic;">'"</span>
  <span style="font-weight: bold;">:group</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">persp-mode</span>)


<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">+workspace-tab-face</span> <span style="font-weight: bold;">'</span>((t (<span style="font-weight: bold;">:inherit</span> default)))
  <span style="font-style: italic;">"The face for selected tabs displayed by `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">+workspace/display</span><span style="font-style: italic;">'"</span>
  <span style="font-weight: bold;">:group</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">persp-mode</span>)
</pre>
</div>

<p>
With the faces defined, we can create a helper function to build the tab bar string using a propertized string so we can simply use it when we need it:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 203: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace--tabline</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> names)
  <span style="font-style: italic;">"Returns the given NAMES list as a propertied string representing each name as a</span>
<span style="font-style: italic;">tab for the current workspace session. If an item on the NAMES list matches the</span>
<span style="font-style: italic;">current workspace name, it will represent this item as a selected item."</span>
  (<span style="font-weight: bold;">let</span> ((names (<span style="font-weight: bold;">or</span> names (<span style="font-weight: bold; text-decoration: underline;">reverse</span> (persp-names))))
        (current-name (persp-current-name)))
    (<span style="font-weight: bold; text-decoration: underline;">mapconcat</span>
     <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">identity</span>
     (<span style="font-weight: bold;">cl-loop</span> for name in names
              for i to (<span style="font-weight: bold; text-decoration: underline;">length</span> names)
              collect
              (<span style="font-weight: bold; text-decoration: underline;">propertize</span> (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">" [%d] %s "</span> (<span style="font-weight: bold; text-decoration: underline;">1+</span> i) name)
                          <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">face</span> (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">equal</span> current-name name)
                                    <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">+workspace-tab-selected-face</span>
                                  <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">+workspace-tab-face</span>)))
     <span style="font-style: italic;">" "</span>)))
</pre>
</div>

<p>
Notice that we use <code>reverse</code> when we call <code>(persp-names)</code>. This is to fix the order of tabs that Doom uses.
</p>

<p>
This helper function allows us to build the interactive function we need:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 204: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace/display</span> ()
  <span style="font-style: italic;">"Display a list of workspaces (like tabs) in the echo area."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">bound-and-true-p</span> persp-mode)
    (<span style="font-weight: bold;">let</span> (<span style="font-weight: bold; font-style: italic;">message-log-max</span>)
      (<span style="font-weight: bold; text-decoration: underline;">message</span> <span style="font-style: italic;">"%s"</span> (+workspace--tabline)))))
</pre>
</div>

<p>
And we can simply bind it to our shortcut key:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 205: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Display tab bar"</span>           <span style="font-style: italic;">"TAB"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/display</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga1f3695" class="outline-4">
<h4 id="orga1f3695"><span class="section-number-4">4.2.2</span> Switch workspace</h4>
<div class="outline-text-4" id="text-4-2-2">
<p>
The <code>persp-projectile</code> package will take care of creating a new workspace for each project we open, but we still need to switch to those workspaces, so let&rsquo;s take care of the <i>Switch workspace</i> binding.
</p>

<p>
Let&rsquo;s list the requirements for such function:
</p>

<ul class="org-ul">
<li>This function needs to be interactive, and if I call it with <code>M-x</code>, it should request the name of the workspace I want to switch to;</li>
<li>I can refer to a workspace when calling this function in two ways:
<ul class="org-ul">
<li>Passing a string representing the workspace name;</li>
<li>Passing a number representing the 1-based index for the workspace on the <i>workspace tab bar</i>;</li>
</ul></li>
<li>If I pass a negative number to the function, it should get the workspace from end to start (e.g. a <code>-3</code> on a <code>10</code> workspaces session would represent workspace <code>8</code>);</li>
<li>If an error happens, we should warn the user;</li>
<li>When the switch is complete, we should display the <i>workspace tab bar</i>;</li>
</ul>

<p>
And here is the implementation for such function:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 206: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace/switch-to</span> (index <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> auto-create-p)
  <span style="font-style: italic;">"Switch to a workspace at a given INDEX. A negative number will start from the</span>
<span style="font-style: italic;">end of the workspace list."</span>
  (<span style="font-weight: bold;">interactive</span>
   (<span style="font-weight: bold;">let</span> ((last-used-workspace (+workspace-last-name)))
     (<span style="font-weight: bold; text-decoration: underline;">list</span> (<span style="font-weight: bold; text-decoration: underline;">completing-read</span> <span style="font-style: italic;">"Switch to workspace: "</span>
                            (persp-names)            <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">lis t</span>
                            nil                      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">filter</span>
                            (<span style="font-weight: bold; text-decoration: underline;">not</span> <span style="font-weight: bold; font-style: italic;">current-prefix-arg</span>) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">required</span>
                            nil                      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">initial input</span>
                            nil                      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">history</span>
                            last-used-workspace))))  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">default value</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">bound-and-true-p</span> persp-mode)
    (<span style="font-weight: bold;">condition-case</span> err
        (<span style="font-weight: bold;">let</span> ((target (+workspace-name-from-reference index))
              (old-name (persp-current-name)))
          (<span style="font-weight: bold;">unless</span> target
            (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">numberp</span> index)
                (+workspace-error <span style="font-style: italic;">"No workspace on index #%s"</span> (<span style="font-weight: bold; text-decoration: underline;">1+</span> index))
              (+workspace-error <span style="font-style: italic;">"Invalid workspace '%s'"</span> index)))
          (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">equal</span> target old-name)
              (+workspace-warn <span style="font-style: italic;">"Already in %s"</span> old-name)
            (+workspace-switch target (<span style="font-weight: bold;">or</span> <span style="font-weight: bold; font-style: italic;">current-prefix-arg</span> auto-create-p))
            (+workspace/display)))
      (t (<span style="font-weight: bold;">minibuffer-message</span> <span style="font-style: italic;">"%s"</span> (+workspace--message-body (<span style="font-weight: bold; text-decoration: underline;">error-message-string</span> err) <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">error</span>))))))
</pre>
</div>

<p>
If you analyze this function, you&rsquo;ll realize we don&rsquo;t have some of the functions used here. They are:
</p>

<ul class="org-ul">
<li><code>+workspace-last-name</code> to get the name of the last used workspace;</li>
<li><code>+workspace-name-from-reference</code> to get a workspace name from a reference variable;</li>
<li><code>+workspace-switch</code> to call the lower level API to switch the workspace;</li>
<li><code>+workspace-error</code> called when we need to present an error to the user;</li>
<li><code>+workspace-warn</code> called when we need to present a less problematic error to the user;</li>
<li><code>+workspace-internal-error</code> when we find a failure on the internal APIs of <code>perspective.el</code>;</li>
</ul>

<p>
We can start with the last workspace name:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 207: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace-last-name</span> ()
  (<span style="font-weight: bold;">when-let</span> ((last-used-persp (persp-last)))
    (persp-name last-used-persp)))
</pre>
</div>

<p>
Then we can add the function to resolve a workspace name from any type of reference:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 208: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace-name-from-reference</span> (ref)
  <span style="font-style: italic;">"Returns the name of a workspace referenced by REF.</span>

<span style="font-style: italic;">REF can be a perspective object, a string name, a string number, a positive</span>
<span style="font-style: italic;">number, or a negative number. How it retrieves the workspace name depends on the</span>
<span style="font-style: italic;">value of REF:</span>

<span style="font-style: italic;">Perspective object - it access the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">CL-X-&gt;name</span><span style="font-style: italic;">' from the object;</span>

<span style="font-style: italic;">String name - return the same value if a workspace with that name exists;</span>

<span style="font-style: italic;">String number - parse the number and get the workspace name from the index</span>
<span style="font-style: italic;">  representing the parsed number;</span>

<span style="font-style: italic;">Positive number - get the workspace name from the index representing the giving</span>
<span style="font-style: italic;">  number;</span>

<span style="font-style: italic;">Negative number - Access the workspace index from the end to the start too</span>
<span style="font-style: italic;">  retrieve the correct workspace;</span>

<span style="font-style: italic;">If REF does not match a current workspace in any way, it returns nil."</span>
  (<span style="font-weight: bold;">cond</span> ((perspective-p ref) (persp-name ref))
        ((<span style="font-weight: bold; text-decoration: underline;">numberp</span> ref) (+workspace-name-from-index ref t))
        ((<span style="font-weight: bold; text-decoration: underline;">stringp</span> ref) (<span style="font-weight: bold;">cond</span> ((+workspace-exists-p ref) ref)
                             ((<span style="font-weight: bold;">string-match-p</span> <span style="font-style: italic;">"^[0-9]+$"</span> ref) (+workspace-name-from-index (<span style="font-weight: bold; text-decoration: underline;">string-to-number</span> ref)
                                                                                          t))))))
</pre>
</div>

<p>
This last function needs another helper one, to make sure it returns the correct name for a session on a given index:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 209: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace-name-from-index</span> (index <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> noerror)
  <span style="font-style: italic;">"Return the workspace name on INDEX.</span>

<span style="font-style: italic;">This function throw an error if there is no workspace on INDEX. If you pass a</span>
<span style="font-style: italic;">non-nil value to NOERROR, it will return nil when it can't find a workspace.</span>

<span style="font-style: italic;">When INDEX is negative, it access the workspace on the reverse order (e.g. on a</span>
<span style="font-style: italic;">4 workspaces session, -1 access the workspace on index 3)."</span>
  (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">when-let</span> ((is-number (<span style="font-weight: bold; text-decoration: underline;">numberp</span> index))
                 (names (<span style="font-weight: bold; text-decoration: underline;">reverse</span> (persp-names)))
                 (len (<span style="font-weight: bold; text-decoration: underline;">length</span> names))
                 (index (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">&lt;</span> index <span style="font-weight: bold; text-decoration: underline;">0</span>) (<span style="font-weight: bold; text-decoration: underline;">+</span> len index) index))
                 (inbounds (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold; text-decoration: underline;">&gt;=</span> index <span style="font-weight: bold; text-decoration: underline;">0</span>) (<span style="font-weight: bold; text-decoration: underline;">&lt;</span> index len))))
        (<span style="font-weight: bold; text-decoration: underline;">nth</span> index names))
      (<span style="font-weight: bold;">unless</span> noerror
        (+workspace-error <span style="font-style: italic;">"There is no workspace on index #%s!"</span> index))))
</pre>
</div>

<p>
And then we can add the low-level API:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 210: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace-switch</span> (name <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> auto-create-p)
  <span style="font-style: italic;">"Switch to another workspace named NAME (a string).</span>

<span style="font-style: italic;">If AUTO-CREATE-P is non-nil, create the workspace if it doesn't exist, otherwise</span>
<span style="font-style: italic;">throws an error."</span>
  (<span style="font-weight: bold;">unless</span> (+workspace-exists-p name)
    (<span style="font-weight: bold;">if</span> auto-create-p
        (+workspace-new name)
      (+workspace-error <span style="font-style: italic;">"%s is not an available workspace"</span> name)))
  (<span style="font-weight: bold;">let</span> ((old-name (persp-current-name)))
    (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold; text-decoration: underline;">equal</span> old-name name)
      (persp-switch name))
    (<span style="font-weight: bold; text-decoration: underline;">equal</span> (persp-current-name) name)))
</pre>
</div>

<p>
This function can brings an existent workspace to the front, or create a new workspace if the given name does not exist and the <code>auto-create-p</code> flag is a non-nil value.
</p>

<p>
In this function, there are three functions we still don&rsquo;t have on our configuration:
</p>

<ul class="org-ul">
<li><code>+workspace-exists-p</code> to check if a workspace with the given name exists;</li>
<li><code>+workspace-new</code> to call actual <i>new perspective</i> function;</li>
<li><code>+workspace-error</code> called when we need to present an error to the user;</li>
</ul>

<p>
Let&rsquo;s start with the <code>+workspace-exists-p</code> function:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 211: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace-exists-p</span> (name)
  <span style="font-style: italic;">"Returns t if NAME is the name of an existing workspace."</span>
  (<span style="font-weight: bold; text-decoration: underline;">member</span> name (persp-names)))
</pre>
</div>

<p>
Then, we can implement the <code>workspace-new</code> function:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 212: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace-new</span> (name)
  <span style="font-style: italic;">"Create a new workspace named NAME. If one already exists, return nil.</span>
<span style="font-style: italic;">otherwise return t on success, nil otherwise."</span>
  (<span style="font-weight: bold;">when</span> (+workspace--protected-p name)
    (+workspace-error <span style="font-style: italic;">"Can't create a new '%s' workspace"</span> name))
  (<span style="font-weight: bold;">when</span> (+workspace-exists-p name)
    (+workspace-error <span style="font-style: italic;">"A workspace named '%s' already exists"</span> name))
  (persp-new name))
</pre>
</div>

<p>
The <code>+workspace-new</code> function have to block the creation of a workspace if the given name is the one used by the main workspace, or if it is the same used on the auto-save feature. These workspace names are what we consider <i>protected</i> names. So let&rsquo;s create a function to check it:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 213: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace--protected-p</span> (name)
  <span style="font-style: italic;">"Return non nil if the given NAME is the default initial</span>
<span style="font-style: italic;">workspace name."</span>
  (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold; text-decoration: underline;">equal</span> name +workspaces-main)
      (<span style="font-weight: bold; text-decoration: underline;">equal</span> name +workspaces-auto-save-identifier)))
</pre>
</div>

<p>
Let&rsquo;s also define those two variables in case we just want to change them later:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 214: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold; text-decoration: underline;">defvaralias</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspaces-main</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">persp-initial-frame-name</span>)


<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">+workspaces-auto-save-identifier</span> <span style="font-style: italic;">"autosave"</span>
  <span style="font-style: italic;">"Identifier used to auto-save the workspace session."</span>)
</pre>
</div>

<p>
Now we need to define our workspaces messaging API. To stay in parity with Doom, we need display the tab bar on the minibuffer, and then a message on its side with the severity of the message color coded.
</p>

<p>
Since we already have a function to display the tabs for us, lets use that function to build a <i>message body</i> for our API:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 215: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace--message-body</span> (text <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> type)
  <span style="font-style: italic;">"Returns a propertied string representing a workspace</span>
<span style="font-style: italic;">message.</span>

<span style="font-style: italic;">A workspace message consist of a 'tab line' representation of the workspace</span>
<span style="font-style: italic;">session, with the given TEXT concatenated after it.</span>

<span style="font-style: italic;">The text color changes depending of TYPE passed. If we omit the TYPE, the</span>
<span style="font-style: italic;">function assumes this message is an 'info message.</span>

<span style="font-style: italic;">We associate the message color to the respective font faces, which are:</span>

<span style="font-style: italic;">- 'info</span>
<span style="font-style: italic;">- 'success</span>
<span style="font-style: italic;">- 'warn</span>
<span style="font-style: italic;">- 'error</span>

<span style="font-style: italic;">The only TYPE that does not have a direct font face representation is 'info,</span>
<span style="font-style: italic;">which uses the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">font-lock-comment-face</span><span style="font-style: italic;">' font face."</span>
  (<span style="font-weight: bold; text-decoration: underline;">concat</span> (+workspace--tabline)
          (<span style="font-weight: bold; text-decoration: underline;">propertize</span> <span style="font-style: italic;">" | "</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">face</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">font-lock-comment-face</span>)
          (<span style="font-weight: bold; text-decoration: underline;">propertize</span> (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"%s"</span> text)
                      <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">face</span> (<span style="font-weight: bold;">pcase</span> type
                              (<span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">error</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">error</span>)
                              (<span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">warn</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">warning</span>)
                              (<span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">success</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">success</span>)
                              (<span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">info</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">font-lock-comment-face</span>)
                              (_ <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">font-lock-comment-face</span>)))))
</pre>
</div>

<p>
With this last function we can implement a generic message function that we can associate to the right calls later:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 216: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace-message</span> (text <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> type)
  <span style="font-style: italic;">"Displays the given TEXT message on the echo area, formatted as a workspace</span>
<span style="font-style: italic;">message (see `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">+workspace--message-body</span><span style="font-style: italic;">' for details on the formatting) of the</span>
<span style="font-style: italic;">given TYPE. When type is 'error, if thee INTERNAL argument is a non-nil value,</span>
<span style="font-style: italic;">the message will use the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">persp-error</span><span style="font-style: italic;">' function print it, and when it is nil, it</span>
<span style="font-style: italic;">uses the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">error</span><span style="font-style: italic;">' function. Otherwise, it uses the normal `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">message</span><span style="font-style: italic;">' function."</span>
  (<span style="font-weight: bold;">cond</span> ((<span style="font-weight: bold; text-decoration: underline;">eq</span> type <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">error</span>) (<span style="font-weight: bold;">error</span> text))
        ((<span style="font-weight: bold; text-decoration: underline;">eq</span> type <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">user-error</span>) (<span style="font-weight: bold;">user-error</span> text))
        ((<span style="font-weight: bold; text-decoration: underline;">eq</span> type <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">internal-error</span>) (persp-error text))
        (t (<span style="font-weight: bold; text-decoration: underline;">message</span> <span style="font-style: italic;">"%s"</span> (+workspace--message-body text type)))))
</pre>
</div>

<p>
And now we can define all the <i>end functions</i> for the messaging API.
</p>

<p>
All these functions have the same pattern. Instead of us defining each one of them, we can loop through the list of possible message types, and create a function for each one:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 217: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold; text-decoration: underline;">mapc</span> (<span style="font-weight: bold;">lambda</span> (type)
        (<span style="font-weight: bold; text-decoration: underline;">defalias</span> (<span style="font-weight: bold; text-decoration: underline;">intern</span> (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"+workspace-%s"</span> type))
          (<span style="font-weight: bold;">lambda</span> (text <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> args)
            (+workspace-message (<span style="font-weight: bold; text-decoration: underline;">apply</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">format</span> (<span style="font-weight: bold; text-decoration: underline;">cons</span> text args)) (<span style="font-weight: bold; text-decoration: underline;">intern</span> type)))
          (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"Wrapper function around `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">+workspace-message</span><span style="font-style: italic;">' with the arg TYPE set to '%s."</span> type)))
      <span style="font-weight: bold;">'</span>(<span style="font-style: italic;">"info"</span> <span style="font-style: italic;">"success"</span> <span style="font-style: italic;">"warn"</span> <span style="font-style: italic;">"error"</span> <span style="font-style: italic;">"user-error"</span> <span style="font-style: italic;">"internal-error"</span>))
</pre>
</div>

<p>
With all the functions necessary to switch between workspaces, I can bind it to their correct key:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 218: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Switch workspace"</span>          <span style="font-style: italic;">"."</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/switch-to</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org37b967a" class="outline-4">
<h4 id="org37b967a"><span class="section-number-4">4.2.3</span> Switch to N<sup>th</sup> workspace</h4>
<div class="outline-text-4" id="text-4-2-3">
<p>
Doom allows you to switch workspaces by their index numbers, and since we already have the main function to do the switch, we can just create the others.
</p>

<p>
As  with the message API, the <i>switch to workspace N</i> is repetitive, and we can automate the creation of every one of these functions:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 219: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">dotimes</span> (i <span style="font-weight: bold; text-decoration: underline;">9</span>)
  (<span style="font-weight: bold; text-decoration: underline;">defalias</span> (<span style="font-weight: bold; text-decoration: underline;">intern</span> (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"+workspace/switch-to-%d"</span> i))
    (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">interactive</span>) (+workspace/switch-to i))
    (<span style="font-weight: bold; text-decoration: underline;">format</span>
     <span style="font-style: italic;">"Thin wrapper around `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">+workspace/switch-to</span><span style="font-style: italic;">' function where we pass #%d as the INDEX parameter."</span>
     (<span style="font-weight: bold; text-decoration: underline;">1+</span> i))))
</pre>
</div>

<p>
This will create 9 functions to switch to their respective workspace, so let&rsquo;s bind them:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 220: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Switch to 1st workspace"</span>   <span style="font-style: italic;">"1"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/switch-to-0</span>
      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Switch to 2nd workspace"</span>   <span style="font-style: italic;">"2"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/switch-to-1</span>
      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Switch to 3rd workspace"</span>   <span style="font-style: italic;">"3"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/switch-to-2</span>
      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Switch to 4th workspace"</span>   <span style="font-style: italic;">"4"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/switch-to-3</span>
      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Switch to 5th workspace"</span>   <span style="font-style: italic;">"5"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/switch-to-4</span>
      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Switch to 6th workspace"</span>   <span style="font-style: italic;">"6"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/switch-to-5</span>
      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Switch to 7th workspace"</span>   <span style="font-style: italic;">"7"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/switch-to-6</span>
      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Switch to 8th workspace"</span>   <span style="font-style: italic;">"8"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/switch-to-7</span>
      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Switch to 9th workspace"</span>   <span style="font-style: italic;">"9"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/switch-to-8</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org613fdd2" class="outline-4">
<h4 id="org613fdd2"><span class="section-number-4">4.2.4</span> Switch to final workspace</h4>
<div class="outline-text-4" id="text-4-2-4">
<p>
Doom also provides a shortcut to get to the last opened workspace (last in the sense of order we created them):
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 221: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace/switch-to-final</span> ()
  <span style="font-style: italic;">"Switch to the final workspace in open workspaces."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (+workspace/switch-to (<span style="font-weight: bold; text-decoration: underline;">car</span> (persp-names))))
</pre>
</div>

<p>
Now we just need to bind this function:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 222: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Switch to final workspace"</span> <span style="font-style: italic;">"0"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/switch-to-final</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org82a9694" class="outline-4">
<h4 id="org82a9694"><span class="section-number-4">4.2.5</span> Switch to last used workspace</h4>
<div class="outline-text-4" id="text-4-2-5">
<p>
The next binding is the <i>Switch to last workspace</i>, which luckily has a function defined on <code>perspective.el</code> for it:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 223: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Switch to last used workspace"</span>  <span style="font-style: italic;">"`"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">persp-switch-last</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbba2965" class="outline-4">
<h4 id="orgbba2965"><span class="section-number-4">4.2.6</span> Previous and next workspace</h4>
<div class="outline-text-4" id="text-4-2-6">
<p>
I&rsquo;m bundling these two commands together because usually in emacs, you have a function that move to any direction, and then you define different functions for different directions that just call the <i>move</i> function with different parameters.
</p>

<p>
Let&rsquo;s create our <i>cycle</i> function:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 224: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace/cycle</span> (n)
  <span style="font-style: italic;">"Cycle n workspaces to the right (default) or left."</span>
  (<span style="font-weight: bold;">interactive</span> (<span style="font-weight: bold; text-decoration: underline;">list</span> <span style="font-weight: bold; text-decoration: underline;">1</span>))
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">bound-and-true-p</span> persp-mode)
    (<span style="font-weight: bold;">let</span> ((current-name (persp-current-name)))
      (<span style="font-weight: bold;">condition-case-unless-debug</span> err
          (<span style="font-weight: bold;">let*</span> ((persps (<span style="font-weight: bold; text-decoration: underline;">reverse</span> (persp-names)))
                 (perspc (<span style="font-weight: bold; text-decoration: underline;">length</span> persps))
                 (index (<span style="font-weight: bold;">cl-position</span> current-name persps)))
            (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold; text-decoration: underline;">=</span> perspc <span style="font-weight: bold; text-decoration: underline;">1</span>)
              (+workspace-user-error <span style="font-style: italic;">"No other workspaces"</span>))
            (+workspace/switch-to (<span style="font-weight: bold; font-style: italic;">%</span> (<span style="font-weight: bold; text-decoration: underline;">+</span> index n perspc) perspc))
            (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">called-interactively-p</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">interactive</span>)
              (+workspace/display)))
        (t (<span style="font-weight: bold;">minibuffer-message</span> <span style="font-style: italic;">"%s"</span>
                             (+workspace--message-body
                              (<span style="font-weight: bold; text-decoration: underline;">error-message-string</span> err)
                              <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">error</span>)))))))
</pre>
</div>

<p>
Then, we just need to create a function to move to the previous workspace:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 225: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace/switch-previous</span> ()  (<span style="font-weight: bold;">interactive</span>) (+workspace/cycle <span style="font-weight: bold; text-decoration: underline;">-1</span>))
</pre>
</div>

<p>
And one for next one:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 226: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace/switch-next</span> () (<span style="font-weight: bold;">interactive</span>) (+workspace/cycle <span style="font-weight: bold; text-decoration: underline;">+1</span>))
</pre>
</div>

<p>
Then, we can bind both functions to their proper keys:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 227: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Previous workspace"</span>        <span style="font-style: italic;">"["</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/switch-previous</span>
      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Next workspace"</span>            <span style="font-style: italic;">"]"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/switch-next</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org034ec8f" class="outline-4">
<h4 id="org034ec8f"><span class="section-number-4">4.2.7</span> New workspace</h4>
<div class="outline-text-4" id="text-4-2-7">
<p>
On the sequence, we have the <i>New workspace</i>. We already created a helper low-level function to spun new workspaces, now we need a command to call that function:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 228: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace/new</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> name)
  <span style="font-style: italic;">"Create a new blank workspace named NAME."</span>
  (<span style="font-weight: bold;">interactive</span>
   (<span style="font-weight: bold; text-decoration: underline;">list</span> (<span style="font-weight: bold;">when</span> <span style="font-weight: bold; font-style: italic;">current-prefix-arg</span>
           (<span style="font-weight: bold; text-decoration: underline;">read-from-minibuffer</span> <span style="font-style: italic;">"Name for the new workspace: "</span>))))
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">bound-and-true-p</span> persp-mode)
    (<span style="font-weight: bold;">unless</span> name
      (<span style="font-weight: bold;">setq</span> name (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"Unnamed %s"</span> (+workspace--generate-id))))
    (<span style="font-weight: bold;">condition-case</span> err
        (<span style="font-weight: bold;">cond</span> ((+workspace-exists-p name) (+workspace-user-error <span style="font-style: italic;">"%s already exists"</span> name))
              (t (+workspace-switch name t)
                 (+workspace/display)))
      (t (<span style="font-weight: bold;">minibuffer-message</span> <span style="font-style: italic;">"%s"</span> (+workspace--message-body (<span style="font-weight: bold; text-decoration: underline;">error-message-string</span> err) <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">error</span>))))))
</pre>
</div>

<p>
Notice how we use the <code>auto-create-p</code> functionality on the <code>+workspace-switch</code> function. Also, you might have noticed we use a helper function to get a sequential number when we don&rsquo;t provide a name to the new workspace, and we didn&rsquo;t implement it yet, so let&rsquo;s do it now:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 229: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace--generate-id</span> ()
  <span style="font-style: italic;">"Returns the next sequential number that a new perspective</span>
<span style="font-style: italic;">could use on its name."</span>
  (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">cl-loop</span> for name in (persp-names)
               when (<span style="font-weight: bold;">string-match-p</span> <span style="font-style: italic;">"^Unnamed </span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[0-9]+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">$"</span> name)
               maximize (<span style="font-weight: bold; text-decoration: underline;">string-to-number</span> (<span style="font-weight: bold; text-decoration: underline;">substring</span> name
                                                     (<span style="font-weight: bold; text-decoration: underline;">match-beginning</span> <span style="font-weight: bold; text-decoration: underline;">1</span>)
                                                     (<span style="font-weight: bold; text-decoration: underline;">match-end</span> <span style="font-weight: bold; text-decoration: underline;">1</span>))) <span style="font-weight: bold;">into max</span>
               finally return (<span style="font-weight: bold;">if</span> max (<span style="font-weight: bold; text-decoration: underline;">1+</span> max)))
      <span style="font-weight: bold; text-decoration: underline;">1</span>))
</pre>
</div>

<p>
This function will iterate over all workspaces and if it finds one called <code>Unnamed N</code>, <code>N</code> becomes the maximum number found. In the end, it returns the maximum number plus one.
</p>

<p>
Now, we just need to bind the main function with its keys:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 230: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"New workspace"</span>             <span style="font-style: italic;">"n"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/new</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga59a16c" class="outline-4">
<h4 id="orga59a16c"><span class="section-number-4">4.2.8</span> Rename workspace</h4>
<div class="outline-text-4" id="text-4-2-8">
<p>
Going through our list of commands, we need to provide a way for us to rename a giving workspace, specially if we create an empty and unnamed workspace.
</p>

<p>
Let&rsquo;s start with the command function:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 231: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace/rename</span> (new-name)
  <span style="font-style: italic;">"Rename the current workspace."</span>
  (<span style="font-weight: bold;">interactive</span> (<span style="font-weight: bold; text-decoration: underline;">list</span> (<span style="font-weight: bold; text-decoration: underline;">read-from-minibuffer</span> <span style="font-style: italic;">"New workspace name: "</span>)))
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">bound-and-true-p</span> persp-mode)
    (<span style="font-weight: bold;">condition-case-unless-debug</span> err
        (<span style="font-weight: bold;">let*</span> ((current (persp-current-name))
               (current (<span style="font-weight: bold;">if</span> <span style="font-weight: bold; font-style: italic;">current-prefix-arg</span>
                            (<span style="font-weight: bold; text-decoration: underline;">completing-read</span> (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"Select a workspace to rename (default: %s): "</span> current)
                                             (persp-names)           <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">list</span>
                                             (<span style="font-weight: bold;">lambda</span> (ws-name)       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">filter</span>
                                               (<span style="font-weight: bold; text-decoration: underline;">not</span> (<span style="font-weight: bold; text-decoration: underline;">string=</span> ws-name +workspaces-main)))
                                             t                       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">required</span>
                                             nil                     <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">initial input</span>
                                             nil                     <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">history</span>
                                             current)                <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">default value</span>
                          current))
               (old-name (+workspace-rename current new-name)))
          (<span style="font-weight: bold;">unless</span> old-name
            (+workspace-error <span style="font-style: italic;">"Failed to rename %s"</span> current))
          (+workspace-success (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"Renamed '%s'-&gt;'%s'"</span> old-name new-name)))
      (t (<span style="font-weight: bold;">minibuffer-message</span> <span style="font-style: italic;">"%s"</span> (+workspace--message-body (<span style="font-weight: bold; text-decoration: underline;">error-message-string</span> err) <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">error</span>))))))
</pre>
</div>

<p>
Pretty straightforward, but we still need the low-level function that actually renames the workspace:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 232: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace-rename</span> (name new-name)
  <span style="font-style: italic;">"Rename the current workspace named NAME to NEW-NAME. Returns old name on</span>
<span style="font-style: italic;">success, nil otherwise."</span>
  (<span style="font-weight: bold;">cond</span> ((+workspace--protected-p name) (+workspace-error <span style="font-style: italic;">"Can't rename `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">%s</span><span style="font-style: italic;">' workspace"</span> name))
        ((<span style="font-weight: bold; text-decoration: underline;">not</span> (+workspace-get name)) (+workspace-error <span style="font-style: italic;">"Perspective `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">%s</span><span style="font-style: italic;">' does not exists"</span> name))
        ((+workspace-get new-name) (+workspace-error <span style="font-style: italic;">"Perspective `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">%s</span><span style="font-style: italic;">' already exists"</span> new-name))
        (t (<span style="font-weight: bold;">progn</span>
             (persp-rename new-name)
             name))))
</pre>
</div>

<p>
This function do 3 validations on the given arguments:
</p>

<ol class="org-ol">
<li>Is the new name one of the protected names?
<i>Should fail if yes</i>;</li>
<li>Is there a real workspace with the given name?
<i>Should fail if no</i>;</li>
<li>Is there a real workspace with the new name?
<i>Should fail if yes</i>;</li>
</ol>

<p>
And to make these validations we still need a function we didn&rsquo;t implement yet:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 233: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace-get</span> (name <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> noerror)
  <span style="font-style: italic;">"return a workspace named name. Unless NOERROR is non-nil, this throws an error</span>
<span style="font-style: italic;">if name doesn't exist."</span>
  (<span style="font-weight: bold;">cl-check-type</span> name string)
  (<span style="font-weight: bold;">when-let</span> (persp (<span style="font-weight: bold; text-decoration: underline;">gethash</span> name (perspectives-hash)))
    (<span style="font-weight: bold;">cond</span> ((perspective-p persp) persp)
          ((<span style="font-weight: bold; text-decoration: underline;">not</span> noerror) (+workspace-error <span style="font-style: italic;">"There is no workspace called '%s'"</span> name)))))
</pre>
</div>

<p>
Now, with all the functions in place, we can bind the main command to its key:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 234: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Rename workspace"</span>               <span style="font-style: italic;">"r"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/rename</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org61019da" class="outline-4">
<h4 id="org61019da"><span class="section-number-4">4.2.9</span> Delete this workspace</h4>
<div class="outline-text-4" id="text-4-2-9">
<p>
There are two main tasks still missing in our refactor of Doom Workspaces and this next three sections will cover one of them: Delete (or kill if you want).
</p>

<p>
We will start with the ability to delete a single workspace:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 235: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace/delete</span> (name)
  <span style="font-style: italic;">"Delete workspace named NAME. If called with C-U, prompts you for the name of</span>
<span style="font-style: italic;">the workspace to delete."</span>
  (<span style="font-weight: bold;">interactive</span>
   (<span style="font-weight: bold;">let</span> ((current-name (persp-current-name)))
     (<span style="font-weight: bold; text-decoration: underline;">list</span> (<span style="font-weight: bold;">if</span> <span style="font-weight: bold; font-style: italic;">current-prefix-arg</span>
               (<span style="font-weight: bold; text-decoration: underline;">completing-read</span> (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"Delete workspace (default: %s): "</span> current-name)
                                (persp-names)           <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">list</span>
                                (<span style="font-weight: bold;">lambda</span> (ws-name)       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">filter</span>
                                  (<span style="font-weight: bold; text-decoration: underline;">not</span> (<span style="font-weight: bold; text-decoration: underline;">string=</span> ws-name +workspaces-main)))
                                t                       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">required</span>
                                nil                     <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">initial input</span>
                                nil                     <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">history</span>
                                current-name)           <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">default value</span>
             current-name))))
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">bound-and-true-p</span> persp-mode)
    (<span style="font-weight: bold;">condition-case</span> err
        (+workspace-delete name)
      (t (<span style="font-weight: bold;">minibuffer-message</span> <span style="font-style: italic;">"%s"</span> (+workspace--message-body (<span style="font-weight: bold; text-decoration: underline;">error-message-string</span> err) <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">error</span>))))))
</pre>
</div>

<p>
The command function simply allows us to select which workspace to delete, or it deletes the current one. As with the other commands, we still need the low-level function that actually deletes the workspace:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 236: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace-delete</span> (workspace)
  <span style="font-style: italic;">"Delete the workspace denoted by WORKSPACE, which can be the name of a</span>
<span style="font-style: italic;">workspace, its index, or the workspace object itself."</span>
  (<span style="font-weight: bold;">let</span> ((ws-name (+workspace-name-from-reference workspace)))
    (<span style="font-weight: bold;">unless</span> ws-name
      (+workspace-error <span style="font-style: italic;">"Can't find a workspace for the reference '%s'"</span> workspace))
    (<span style="font-weight: bold;">if</span> (+workspace--protected-p ws-name)
        t
      (persp-kill ws-name)
      (+workspace-success (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"Deleted '%s' workspace"</span> workspace))
      (<span style="font-weight: bold; text-decoration: underline;">not</span> (+workspace-exists-p ws-name)))))
</pre>
</div>

<p>
Now we can bind the command to its proper key:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 237: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Delete this workspace"</span>          <span style="font-style: italic;">"d"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/delete</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb40ac3f" class="outline-4">
<h4 id="orgb40ac3f"><span class="section-number-4">4.2.10</span> Delete session</h4>
<div class="outline-text-4" id="text-4-2-10">
<p>
The next command on the <i>delete</i> series is to delete all workspaces.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 238: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace/delete-session</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> interactive)
  <span style="font-style: italic;">"Delete the current session, all workspaces, windows and their buffers."</span>
  (<span style="font-weight: bold;">interactive</span> (<span style="font-weight: bold; text-decoration: underline;">list</span> t))
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">bound-and-true-p</span> persp-mode)
    (<span style="font-weight: bold;">condition-case</span> err
        (<span style="font-weight: bold;">let</span> ((windows (<span style="font-weight: bold; text-decoration: underline;">length</span> (<span style="font-weight: bold; text-decoration: underline;">window-list</span>)))
              (persps (<span style="font-weight: bold; text-decoration: underline;">length</span> (persp-names)))
              (buffers <span style="font-weight: bold; text-decoration: underline;">0</span>))
          (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">cl-every</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace-delete</span> (persp-names))
            (+workspace-error <span style="font-style: italic;">"Could not clear session"</span>))
          (+workspace/switch-to +workspaces-main t)
          (<span style="font-weight: bold;">setq</span> buffers (<span style="font-weight: bold;">doom/kill-all-buffers</span> (<span style="font-weight: bold; text-decoration: underline;">buffer-list</span>)))
          (<span style="font-weight: bold;">when</span> interactive
            (+workspace-success <span style="font-style: italic;">"Killed %s workspace(s), %s window(s) &amp; %s buffer(s)"</span> persps windows buffers)))
        (t (<span style="font-weight: bold;">minibuffer-message</span> <span style="font-style: italic;">"%s"</span> (+workspace--message-body (<span style="font-weight: bold; text-decoration: underline;">error-message-string</span> err) <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">error</span>))))))
</pre>
</div>

<p>
And since we only used functions we already have implemented, we can bind it to its key:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 239: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Delete session"</span>                 <span style="font-style: italic;">"x"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/delete-session</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org91b5b2e" class="outline-4">
<h4 id="org91b5b2e"><span class="section-number-4">4.2.11</span> Delete session and quit</h4>
<div class="outline-text-4" id="text-4-2-11">
<p>
On the next sections in this document, we will configure session persistence, and the time when we will save our sessions, is when we kill Emacs. If we delete all sessions, and then quit, the result is that Emacs will save our <i>empty</i> session before quitting. Although we might desire this behavior some times, we also need a way to tell emacs to <i>discard</i> our current session. To achieve this, let&rsquo;s define a variable to use as a flag for saving the session or not:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 240: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">+workspace--auto-save-session-p</span> t
  <span style="font-style: italic;">"Flag used to determine if Emacs should automatically save the current session</span>
<span style="font-style: italic;">when we quit."</span>)
</pre>
</div>

<p>
And now, we can have our last command on the <i>delete</i> category to flag Emacs to not save current session when quitting. This way, if we wants to quit and save the current session, we simply quit Emacs, and if we want to discard the current session, we invoke the <i>delete session and quit</i> command:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 241: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace/delete-session-and-quit</span> ()
  <span style="font-style: italic;">"Kill emacs without saving anything."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">bound-and-true-p</span> persp-mode)
    (<span style="font-weight: bold; text-decoration: underline;">call-interactively</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/delete-session</span>)
    (<span style="font-weight: bold;">let</span> ((+workspace--auto-save-session-p nil))
      (<span style="font-weight: bold; text-decoration: underline;">kill-emacs</span>))))
</pre>
</div>

<p>
And since we only used functions we already have implemented, we can bind it to its key:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 242: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Delete session and quit"</span>        <span style="font-style: italic;">"X"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/delete-session-and-quit</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org88fd201" class="outline-4">
<h4 id="org88fd201"><span class="section-number-4">4.2.12</span> Save session to file</h4>
<div class="outline-text-4" id="text-4-2-12">
<p>
Our workspace refactor is working as expected, but we still need persistence. <code>perspective.el</code> and <code>persp-mode</code> behave a bit different on this regard. The former can only save your entire session to file, while the latter saves individual workspaces. For me particularly, is not a big issue, but if you rely on such feature, know that you won&rsquo;t have it with my setup.
</p>

<p>
With that out of the way, let&rsquo;s jump right into the first command:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 243: </span>autoload/workspaces.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace/save-session</span> (name)
  <span style="font-style: italic;">"Save the current workspace with the given NAME as its identifier."</span>
  (<span style="font-weight: bold;">interactive</span>
   (<span style="font-weight: bold; text-decoration: underline;">list</span> (<span style="font-weight: bold; text-decoration: underline;">completing-read</span> <span style="font-style: italic;">"Save workspace session to file: "</span>
                          (<span style="font-weight: bold; text-decoration: underline;">mapcar</span>
                           (<span style="font-weight: bold;">lambda</span> (file)
                             (<span style="font-weight: bold;">string-remove-prefix</span>
                              +workspaces-data-file-prefix (<span style="font-weight: bold;">file-name-base</span> file)))
                           (<span style="font-weight: bold;">file-expand-wildcards</span> (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"%s%s*.dws"</span>
                                                          +workspaces-data-dir
                                                          +workspaces-data-file-prefix))))))
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">bound-and-true-p</span> persp-mode)
    (<span style="font-weight: bold;">condition-case</span> err
        (<span style="font-weight: bold;">if</span> (+workspace-session-save name)
            (+workspace-success (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"'%s' workspace saved"</span> name))
          (+workspace-error (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"Could not save workspace %s"</span> name)))
      (t (<span style="font-weight: bold;">minibuffer-message</span> <span style="font-style: italic;">"%s"</span> (+workspace--message-body (<span style="font-weight: bold; text-decoration: underline;">error-message-string</span> err) <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">error</span>))))))
</pre>
</div>

<p>
The only part of this function that is worth mentioning is that we show the list of current saved workspaces so we can see what is there when we&rsquo;re choosing a filename.
</p>

<p>
We still need to code our low level  function to save a workspace:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 244: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace-session-save</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> identifier force interactive?)
  <span style="font-style: italic;">"Saves the workspace session to a file named IDENTIFIER located on the</span>
<span style="font-style: italic;">`</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">+workspaces-data-dir</span><span style="font-style: italic;">' directory. We can load a saved session with</span>
<span style="font-style: italic;">`</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">+workspace-load</span><span style="font-style: italic;">'.</span>

<span style="font-style: italic;">If we call this function without a IDENTIFIER, we will generate a name using the</span>
<span style="font-style: italic;">current time, and the format \"%Y-%0m-%0d-%0H-%0M\".</span>

<span style="font-style: italic;">If FORCE is non nil, this function will overwrite the session file if it is</span>
<span style="font-style: italic;">already present in the system.</span>

<span style="font-style: italic;">Returns t on success, nil otherwise."</span>
  (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold; text-decoration: underline;">file-exists-p</span> +workspaces-data-dir)
    (<span style="font-weight: bold;">make-directory</span> +workspaces-data-dir))
  (<span style="font-weight: bold;">when-let</span> ((fname (+workspace-resolve-session-file-path identifier))
             (should-save (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold; text-decoration: underline;">not</span> (<span style="font-weight: bold; text-decoration: underline;">file-exists-p</span> fname)) force)
                              (<span style="font-weight: bold;">yes-or-no-p</span> (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"Overwrite the '%s' session state?"</span> identifier)))))
    (<span style="font-weight: bold;">let</span> ((<span style="font-weight: bold; font-style: italic;">current-prefix-arg</span> t))
      (persp-state-save fname interactive?))
    (<span style="font-weight: bold; text-decoration: underline;">file-exists-p</span> fname)))
</pre>
</div>

<p>
We will make sure that the most complex part of this function goes to another function to make easy to understand and reusable:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 245: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace-resolve-session-file-path</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> name)
  <span style="font-style: italic;">"Returns the full path for a session filename given a NAME identifier.</span>

<span style="font-style: italic;">If we omit the NAME, we will use the current time with the format</span>
<span style="font-style: italic;">\"%Y-%0m-%0d-%0H-%0M\" (see `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">format-time-string</span><span style="font-style: italic;">' for information about the</span>
<span style="font-style: italic;">format), if NAME is not a string nor nil, we throw an error."</span>
  (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">string-or-null-p</span> name)
    (+workspace-error <span style="font-style: italic;">"Invalid name! Argument '%s' is not string or nil"</span> name))
  (<span style="font-weight: bold; text-decoration: underline;">expand-file-name</span> (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"%s%s.dws"</span>
                            +workspaces-data-file-prefix
                            (<span style="font-weight: bold;">or</span> name (<span style="font-weight: bold; text-decoration: underline;">format-time-string</span> <span style="font-style: italic;">"%Y-%0m-%0d-%0H-%0M"</span>)))
                    +workspaces-data-dir))
</pre>
</div>

<p>
In this function we introduce two new variables that we still didn&rsquo;t define. The <code>+workspaces-data-dir</code> holds the location of our workspace saved files, and <code>+workspaces-data-file-prefix</code> holds a common prefix for workspace files so we can filter them easily.
</p>

<p>
Let&rsquo;s add these variables to our autoload file:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 246: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">+workspaces-data-dir</span> (<span style="font-weight: bold; text-decoration: underline;">concat</span> <span style="font-weight: bold; font-style: italic;">doom-etc-dir</span> <span style="font-style: italic;">"workspaces/"</span>)
  <span style="font-style: italic;">"Directory where we store perspective files."</span>)


<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">+workspaces-data-file-prefix</span> <span style="font-style: italic;">"_workspaces_"</span>
  <span style="font-style: italic;">"The filename prefix of files used to store a workspace session. We will store</span>
<span style="font-style: italic;">these file at `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">+workspaces-data-dir</span><span style="font-style: italic;">'."</span>)
</pre>
</div>

<p>
And now we can add the command to its key:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 247: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Save session to file"</span>           <span style="font-style: italic;">"s"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/save-session</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org545ea73" class="outline-4">
<h4 id="org545ea73"><span class="section-number-4">4.2.13</span> Load session from file</h4>
<div class="outline-text-4" id="text-4-2-13">
<p>
At this point, we can arbitrarily save our sessions to files, but still need a way to load them. Let&rsquo;s create the <i>load</i> command:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 248: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace/load-session</span> (name)
  <span style="font-style: italic;">"Load a workspace session with identifier NAME."</span>
  (<span style="font-weight: bold;">interactive</span>
   (<span style="font-weight: bold; text-decoration: underline;">list</span>
    (<span style="font-weight: bold; text-decoration: underline;">completing-read</span> <span style="font-style: italic;">"Workspace session to load: "</span>
                     (<span style="font-weight: bold; text-decoration: underline;">mapcar</span>
                      (<span style="font-weight: bold;">lambda</span> (file)
                        (<span style="font-weight: bold;">string-remove-prefix</span> +workspaces-data-file-prefix (<span style="font-weight: bold;">file-name-base</span> file)))
                      (<span style="font-weight: bold;">file-expand-wildcards</span> (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"%s%s*.dws"</span>
                                                     +workspaces-data-dir
                                                     +workspaces-data-file-prefix)))
                     (<span style="font-weight: bold;">lambda</span> (identifier)
                       (<span style="font-weight: bold; text-decoration: underline;">not</span> (<span style="font-weight: bold; text-decoration: underline;">string=</span> identifier +workspaces-auto-save-identifier)))
                     t)))
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">bound-and-true-p</span> persp-mode)
    (<span style="font-weight: bold;">condition-case</span> err
        (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">not</span> (+workspace-session-load name))
            (+workspace-error <span style="font-style: italic;">"Could not load workspace session %s"</span> name)
          (+workspace/display))
      (t (<span style="font-weight: bold;">minibuffer-message</span> <span style="font-style: italic;">"%s"</span> (+workspace--message-body (<span style="font-weight: bold; text-decoration: underline;">error-message-string</span> err) <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">error</span>))))))
</pre>
</div>

<p>
The difference between the <i>save</i> and <i>load</i> commands (besides the obvious), is that when we load, we force the user to complete to a valid load file with the 4<sup>th</sup> parameter on <code>completing-read</code>.
</p>

<p>
As usual, lets get our low-level API coded as well:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 249: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace-session-load</span> (name)
  <span style="font-style: italic;">"Loads a workspace session identified by NAME. Can only retrieve workspace</span>
<span style="font-style: italic;">sessions that were explicitly saved with `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">+workspace-session-save</span><span style="font-style: italic;">'.</span>

<span style="font-style: italic;">Returns t if successful, nil otherwise."</span>
  (persp-state-load (+workspace-resolve-session-file-path name))
  (<span style="font-weight: bold; text-decoration: underline;">&gt;</span> (<span style="font-weight: bold; text-decoration: underline;">length</span> (persp-names)) <span style="font-weight: bold; text-decoration: underline;">0</span>))
</pre>
</div>

<p>
And bind this command to its key:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 250: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Load session from file"</span>         <span style="font-style: italic;">"l"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/load-session</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org0c2d0a1" class="outline-4">
<h4 id="org0c2d0a1"><span class="section-number-4">4.2.14</span> Restore last session</h4>
<div class="outline-text-4" id="text-4-2-14">
<p>
Now that we save and load our workspace sessions, is time for us to make this process a bit more automated. Just like Doom&rsquo;s behavior, we want Emacs to save our session when it exits, and we want to be able to restore the last auto-saved session.
</p>

<p>
The first thing we need is a hook function to execute every time Emacs quits:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 251: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace-auto-save-h</span> ()
  (<span style="font-weight: bold;">when</span> +workspace--auto-save-session-p
    (+workspace-session-save +workspaces-auto-save-identifier t nil)))
</pre>
</div>

<p>
And we need a function to restore the last saved session:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 252: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace/restore-last-session</span> ()
  <span style="font-style: italic;">"Tries to load the 'auto-saved' session from last time we used Emacs."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">condition-case</span> err
      (<span style="font-weight: bold;">let</span> ((as-file (+workspace-resolve-session-file-path +workspaces-auto-save-identifier)))
        (<span style="font-weight: bold; text-decoration: underline;">message</span> <span style="font-style: italic;">"Restoring session..."</span>)
        (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">file-exists-p</span> as-file)
            (<span style="font-weight: bold;">unless</span> (+workspace-session-load +workspaces-auto-save-identifier)
              (+workspace-error <span style="font-style: italic;">"Failed to restore previous auto-saved session"</span>))
          (+workspace-warn <span style="font-style: italic;">"There is no session previously saved"</span>))
        (<span style="font-weight: bold; text-decoration: underline;">message</span> <span style="font-style: italic;">"Session restored. Welcome back."</span>))
    (t (<span style="font-weight: bold;">minibuffer-message</span> <span style="font-style: italic;">"%s"</span> (+workspace--message-body (<span style="font-weight: bold; text-decoration: underline;">error-message-string</span> err) <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">error</span>)))))
</pre>
</div>

<p>
With the restore command done, we can associate it with its key:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 253: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Restore last session"</span>           <span style="font-style: italic;">"R"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/restore-last-session</span>
</pre>
</div>

<p>
Now that we defined all <i>leader</i> keys, we can close our <i>leader</i> mapping:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 254: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">      <span style="color: #88090B;">)</span>  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">:prefix ("TAB" . "workspace")</span>
      <span style="color: #88090B;">)</span>  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">:leader</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5570c94" class="outline-4">
<h4 id="org5570c94"><span class="section-number-4">4.2.15</span> Other shortcuts</h4>
<div class="outline-text-4" id="text-4-2-15">
<p>
Doom also offers nice shortcuts for us to access our workspace. They&rsquo;re all bound to <code>Meta</code> plus a number:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 255: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">      <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"C-t"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/new</span>
      <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"C-S-t"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/display</span>
      <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"M-1"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/switch-to-0</span>
      <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"M-2"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/switch-to-1</span>
      <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"M-3"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/switch-to-2</span>
      <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"M-4"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/switch-to-3</span>
      <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"M-5"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/switch-to-4</span>
      <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"M-6"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/switch-to-5</span>
      <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"M-7"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/switch-to-6</span>
      <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"M-8"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/switch-to-7</span>
      <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"M-9"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/switch-to-8</span>
      <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"M-0"</span>   <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/switch-to-final</span>
</pre>
</div>

<p>
These shortcuts close the majority of workspace binding we may need:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 256: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp"><span style="color: #88090B;">)</span>  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">map!</span>
</pre>
</div>

<p>
There are couple shortcuts that are not defined with the <code>map!</code> function, so we can tackle them here:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 257: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">define-key!</span> persp-mode-map
  [remap delete-window] <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/close-window-or-workspace</span>
  [remap evil-window-delete] <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace/close-window-or-workspace</span>)
</pre>
</div>

<p>
This will delete the current workspace if closing the last open window. But we still need to implement the target function here:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 258: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">+workspace/close-window-or-workspace</span> ()
  <span style="font-style: italic;">"Close the selected window. If it's the last window in the workspace, either</span>
<span style="font-style: italic;">close the workspace (as well as its associated frame, if one exists) and move to</span>
<span style="font-style: italic;">the next."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">condition-case</span> err
      (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">cdr</span> (my-tabs-mode-persp-window))
          (tab-line-close-tab)
        (<span style="font-weight: bold;">let</span> ((delete-window-fn (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">featurep</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">evil</span>)
                                    <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">evil-window-delete</span>
                                  <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">delete-window</span>))
              (buf (<span style="font-weight: bold; text-decoration: underline;">current-buffer</span>)))
          (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">window-dedicated-p</span>)
              (<span style="font-weight: bold; text-decoration: underline;">funcall</span> delete-window-fn)
            (<span style="font-weight: bold;">let</span> ((current-persp-name (persp-current-name)))
              (<span style="font-weight: bold;">cond</span> ((<span style="font-weight: bold;">or</span> (+workspace--protected-p current-persp-name)
                         (<span style="font-weight: bold; text-decoration: underline;">cdr</span> (<span style="font-weight: bold;">doom-visible-windows</span>)))
                     (<span style="font-weight: bold; text-decoration: underline;">funcall</span> delete-window-fn))
                    ((<span style="font-weight: bold; text-decoration: underline;">cdr</span> (persp-names))
                     (+workspace/delete current-persp-name))
                    ((+workspace-error <span style="font-style: italic;">"Can't delete last workspace"</span>)))))))
    (t (<span style="font-weight: bold;">minibuffer-message</span> <span style="font-style: italic;">"%s"</span> (+workspace--message-body (<span style="font-weight: bold; text-decoration: underline;">error-message-string</span> err) <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">error</span>)))))
</pre>
</div>

<p>
When we have the feature <code>workspaces</code> on our <code>init.el</code>, Doom will add an option on its dashboard to allow us to recover the last saved session. Since we disabled that feature, we need to add this option again:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 259: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">add-to-list</span>
 <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">+doom-dashboard-menu-sections</span>
 <span style="font-weight: bold;">'</span>(<span style="font-style: italic;">"Reload last session"</span>
   <span style="font-weight: bold;">:icon</span> (<span style="font-weight: bold;">all-the-icons-octicon</span> <span style="font-style: italic;">"history"</span>
                                <span style="font-weight: bold;">:face</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">doom-dashboard-menu-title</span>)
   <span style="font-weight: bold;">:face</span> (<span style="font-weight: bold;">:inherit</span> (doom-dashboard-menu-title bold))
   <span style="font-weight: bold;">:action</span> +workspace/restore-last-session))
</pre>
</div>

<p>
The only thing remaining on our refactor, is to connect our auto-save function to the hook <code>kill-emacs-hook</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 260: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">add-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">kill-emacs-hook</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+workspace-auto-save-h</span>)
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org0ac477e" class="outline-2">
<h2 id="org0ac477e"><span class="section-number-2">5</span> Writing</h2>
<div class="outline-text-2" id="text-5">
<p>
Unfortunately, my main job at work is to do mobile development for the Android platform. While Emacs is OK handling Java, Kotlin, and friends, compared to IDEs like IntelliJ and Android Studio, there are way more configuration and adjustments I would need to do on Emacs to get a distance resemblance of those IDEs. Because of this reason, my main usage for Emacs is writing and scripting.
</p>

<p>
My intention is to do any writing I need, using Org mode. And that is the reason this section of my setup is as big as it can be.
</p>

<p>
I come up with a directory infrastructure for my writings that will hold all type of text I need to produce:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 261: </span>My org directory structure</label><pre class="src src-text">  &#61717; org
  &#9500;&#9472;&#9472; &#61717; .archives
  &#9500;&#9472;&#9472; &#61717; .attach
  &#9500;&#9472;&#9472; &#61717; agenda
  &#9474;  &#9500;&#9472;&#9472; &#61717; calendars
  &#9474;  &#9474;  &#9500;&#9472;&#9472; &#61462; personal.org
  &#9474;  &#9474;  &#9492;&#9472;&#9472; &#61462; work.org
  &#9474;  &#9500;&#9472;&#9472; &#61717; tasks
  &#9474;  &#9474;  &#9500;&#9472;&#9472; &#61462; someday.org
  &#9474;  &#9474;  &#9492;&#9472;&#9472; &#61462; todo.org
  &#9474;  &#9500;&#9472;&#9472; &#61462; contacts.org
  &#9474;  &#9492;&#9472;&#9472; &#61462; habits.org
  &#9500;&#9472;&#9472; &#61717; documents
  &#9500;&#9472;&#9472; &#61717; journal
  &#9500;&#9472;&#9472; &#61717; notes
  &#9492;&#9472;&#9472; &#61717; presentations
</pre>
</div>

<p>
Most of these directories are straightforward to understand their purpose, but I still want to go through them to document my need.
</p>

<dl class="org-dl">
<dt><code>.archives</code></dt><dd>Any Org task archived on my system will end up in this directory. After a while, this directory should be a shadow copy of the root <code>org</code> directory, but containing only files with archived tasks;</dd>
<dt><code>.attach</code></dt><dd>This is the Doom&rsquo;s directory to store attached files;</dd>
<dt><code>agenda</code></dt><dd>The root folder for task management:
<dl class="org-dl">
<dt><code>calendars</code></dt><dd>Here is where I will add the events for my calendars. Each calendar I have will have its own file here. These files are not intended to manage my calendars, and I will consider them as <i>read-only files</i>. Outside Emacs, I will have process running and synchronizing these files;</dd>
<dt><code>tasks</code></dt><dd>Directory to store Org files with tasks. The main file, which I will track on Org Agenda is thee <code>todo.org</code>, but I have this extra file called <code>someday.org</code> as a dump for tasks I wish to accomplish but are not essentials;</dd>
<dt><code>contacts.org</code></dt><dd>The Org file used to record my contacts. I still need to find a good way to synchronize this file with my phone contacts, but this is out of the scope of this document;</dd>
<dt><code>habits.org</code></dt><dd>Once I&rsquo;m ready to try tracking my habits, this is the file I should use;</dd>
</dl></dd>
<dt><code>documents</code></dt><dd>This is the dumping ground for any type of document (articles, design architecture, blog posts, wiki entries, etc.). Inside of it, I will have one directory per area (work, home, personal site, etc.);</dd>
<dt><code>journal</code></dt><dd>I need to have one work journal and one personal journal, but I still don&rsquo;t know how to do this separation effectively. For now, I will have all my journaling stored here;</dd>
<dt><code>notes</code></dt><dd>My curated notes. All files in this directory have no name (I use UUID as their name), and I can access their content by using the Zettelkasten method on my system;</dd>
<dt><code>presentations</code></dt><dd>The directory for my presentation projects using <code>reveal.js</code>;</dd>
</dl>

<p>
Regarding my configuration for Org mode, I will split it into 6 distinct sections, one per usage I will have for Org:
</p>

<ul class="org-ul">
<li>Prose writing</li>
<li>Reading or reviewing</li>
<li>Publishing</li>
<li>Presenting</li>
<li>Note Taking</li>
<li>Time Management</li>
</ul>
</div>

<div id="outline-container-org5b79e86" class="outline-3">
<h3 id="org5b79e86"><span class="section-number-3">5.1</span> <span class="todo TODO">TODO</span> Requirements</h3>
</div>
<div id="outline-container-org8495c71" class="outline-3">
<h3 id="org8495c71"><span class="section-number-3">5.2</span> <span class="todo TODO">TODO</span> Common Org configurations</h3>
<div class="outline-text-3" id="text-5-2">
<p>
But before we dive in each one of these usages, there are some things I like to configure on Org that will affect all the other areas, so I will start with them here.
</p>

<p>
The first thing I like to do, is to create some variables pointing to key locations and files on my directory structure:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 262: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">unpin!</span> org-mode)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 263: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> writeroom-mode-line       t
      <span style="font-weight: bold; font-style: italic;">+zen-window-divider-size</span>  <span style="font-weight: bold; text-decoration: underline;">2</span>
      <span style="font-weight: bold; font-style: italic;">+zen-text-scale</span>           <span style="font-weight: bold; text-decoration: underline;">1</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 264: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">org-html-htmlize-output-type</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">css</span>
      <span style="font-weight: bold; font-style: italic;">org-html-head-include-default-style</span> nil
      <span style="font-weight: bold; font-style: italic;">org-html-doctype</span> <span style="font-style: italic;">"html5"</span>
      <span style="font-weight: bold; font-style: italic;">org-html-html5-fancy</span> t)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 265: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">org-directory</span> (<span style="font-weight: bold; text-decoration: underline;">expand-file-name</span> <span style="font-style: italic;">"~/depot/Dropbox/org"</span>))

(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">my-journal-directory</span> (<span style="font-weight: bold; text-decoration: underline;">expand-file-name</span> <span style="font-style: italic;">"journal"</span> <span style="font-weight: bold; font-style: italic;">org-directory</span>)
  <span style="font-style: italic;">"Path to directory holding all journal files"</span>)

(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">my-docs-directory</span> (<span style="font-weight: bold; text-decoration: underline;">expand-file-name</span> <span style="font-style: italic;">"documents"</span> <span style="font-weight: bold; font-style: italic;">org-directory</span>)
  <span style="font-style: italic;">"Path to directory used to store non specific documents."</span>)

(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">my-agenda-directory</span> (<span style="font-weight: bold; text-decoration: underline;">expand-file-name</span> <span style="font-style: italic;">"agenda"</span> <span style="font-weight: bold; font-style: italic;">org-directory</span>)
  <span style="font-style: italic;">"Path to the base directory for the agenda system."</span>)

(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">my-calendars-directory</span> (<span style="font-weight: bold; text-decoration: underline;">expand-file-name</span> <span style="font-style: italic;">"calendars"</span> my-agenda-directory)
  <span style="font-style: italic;">"Path to directory used to store calendar files."</span>)

(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">my-tasks-directory</span> (<span style="font-weight: bold; text-decoration: underline;">expand-file-name</span> <span style="font-style: italic;">"tasks"</span> my-agenda-directory)
  <span style="font-style: italic;">"Path to directory used to store task files."</span>)

(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">my-notes-directory</span> (<span style="font-weight: bold; text-decoration: underline;">expand-file-name</span> <span style="font-style: italic;">"notes"</span> <span style="font-weight: bold; font-style: italic;">org-directory</span>)
  <span style="font-style: italic;">"Path to directory used to store note files."</span>)

(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">my-presentations-directory</span> (<span style="font-weight: bold; text-decoration: underline;">expand-file-name</span> <span style="font-style: italic;">"presentations"</span> <span style="font-weight: bold; font-style: italic;">org-directory</span>)
  <span style="font-style: italic;">"Path to directory used to store presentation files."</span>)
</pre>
</div>

<p>
Notice that we crated these variables before loading anything related to Org. The <code>org-directory</code> variable needs to have the correct value when Org mode is initializing, and the others are just grouped close to the main Org one.
</p>

<p>
Now we can wait Org to load to  continue our configuration:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 266: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(my-typography-reset (<span style="font-weight: bold;">cl-loop</span> for i from <span style="font-weight: bold; text-decoration: underline;">1</span> to <span style="font-weight: bold; text-decoration: underline;">8</span> collect (<span style="font-weight: bold; text-decoration: underline;">intern</span> (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"outline-%d"</span> i))))
(<span style="font-weight: bold;">custom-set-faces!</span>
  <span style="font-weight: bold;">`</span>(outline-1 <span style="font-weight: bold;">:inherit</span> my-headline-1 <span style="font-weight: bold;">:weight</span> unspecified <span style="font-weight: bold;">:extend</span> unspecified)
  <span style="font-weight: bold;">`</span>(outline-2 <span style="font-weight: bold;">:inherit</span> my-headline-2 <span style="font-weight: bold;">:weight</span> unspecified <span style="font-weight: bold;">:extend</span> unspecified)
  <span style="font-weight: bold;">`</span>(outline-3 <span style="font-weight: bold;">:inherit</span> my-headline-3 <span style="font-weight: bold;">:weight</span> unspecified <span style="font-weight: bold;">:extend</span> unspecified)
  <span style="font-weight: bold;">`</span>(outline-4 <span style="font-weight: bold;">:inherit</span> my-headline-4 <span style="font-weight: bold;">:weight</span> unspecified <span style="font-weight: bold;">:extend</span> unspecified)
  <span style="font-weight: bold;">`</span>(outline-5 <span style="font-weight: bold;">:inherit</span> my-headline-5 <span style="font-weight: bold;">:weight</span> unspecified <span style="font-weight: bold;">:extend</span> unspecified)
  <span style="font-weight: bold;">`</span>(outline-6 <span style="font-weight: bold;">:inherit</span> my-headline-6 <span style="font-weight: bold;">:weight</span> unspecified <span style="font-weight: bold;">:extend</span> unspecified)
  <span style="font-weight: bold;">`</span>(outline-7 <span style="font-weight: bold;">:inherit</span> my-headline-7 <span style="font-weight: bold;">:weight</span> unspecified <span style="font-weight: bold;">:extend</span> unspecified)
  <span style="font-weight: bold;">`</span>(outline-8 <span style="font-weight: bold;">:inherit</span> my-headline-8 <span style="font-weight: bold;">:weight</span> unspecified <span style="font-weight: bold;">:extend</span> unspecified))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 267: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">my-org-font-lock-beautify-keywords</span>
  <span style="font-weight: bold;">`</span>((<span style="font-style: italic;">"^#\\+TITLE: *"</span>
     (<span style="font-weight: bold; text-decoration: underline;">0</span> (<span style="font-weight: bold;">prog1</span> nil (<span style="font-weight: bold; text-decoration: underline;">put-text-property</span> (<span style="font-weight: bold; text-decoration: underline;">match-beginning</span> <span style="font-weight: bold; text-decoration: underline;">0</span>) (<span style="font-weight: bold; text-decoration: underline;">match-end</span> <span style="font-weight: bold; text-decoration: underline;">0</span>) <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">invisible</span> t))))
    (<span style="font-style: italic;">"^\\*+ "</span>
     (<span style="font-weight: bold; text-decoration: underline;">0</span> (<span style="font-weight: bold;">prog1</span> nil (<span style="font-weight: bold; text-decoration: underline;">put-text-property</span> (<span style="font-weight: bold; text-decoration: underline;">match-beginning</span> <span style="font-weight: bold; text-decoration: underline;">0</span>) (<span style="font-weight: bold; text-decoration: underline;">match-end</span> <span style="font-weight: bold; text-decoration: underline;">0</span>) <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">invisible</span> t))))
    (<span style="font-style: italic;">"^ *</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[-+*] \\[ \\]</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;"> "</span>
     (<span style="font-weight: bold; text-decoration: underline;">0</span> (<span style="font-weight: bold;">prog1</span> nil (<span style="font-weight: bold;">compose-region</span> (<span style="font-weight: bold; text-decoration: underline;">match-beginning</span> <span style="font-weight: bold; text-decoration: underline;">1</span>) (<span style="font-weight: bold; text-decoration: underline;">match-end</span> <span style="font-weight: bold; text-decoration: underline;">1</span>) <span style="font-style: italic;">"&#9744; "</span>))))
    (<span style="font-style: italic;">"^ *</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[-+*] \\[</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">-\\</span><span style="font-style: italic;">]</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;"> "</span>
     (<span style="font-weight: bold; text-decoration: underline;">0</span> (<span style="font-weight: bold;">prog1</span> nil (<span style="font-weight: bold;">compose-region</span> (<span style="font-weight: bold; text-decoration: underline;">match-beginning</span> <span style="font-weight: bold; text-decoration: underline;">1</span>) (<span style="font-weight: bold; text-decoration: underline;">match-end</span> <span style="font-weight: bold; text-decoration: underline;">1</span>) <span style="font-style: italic;">"&#8865; "</span>))))
    (<span style="font-style: italic;">"^ *</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[-+*] \\[[xX]\\]</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;"> "</span>
     (<span style="font-weight: bold; text-decoration: underline;">0</span> (<span style="font-weight: bold;">prog1</span> nil (<span style="font-weight: bold;">compose-region</span> (<span style="font-weight: bold; text-decoration: underline;">match-beginning</span> <span style="font-weight: bold; text-decoration: underline;">1</span>) (<span style="font-weight: bold; text-decoration: underline;">match-end</span> <span style="font-weight: bold; text-decoration: underline;">1</span>) <span style="font-style: italic;">"&#9745; "</span>))))
    (<span style="font-style: italic;">"^ *</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">-</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">\\[]</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">\\[[</span><span style="font-style: italic;">^</span><span style="font-style: italic;"> xX-]</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span>
     (<span style="font-weight: bold; text-decoration: underline;">0</span> (<span style="font-weight: bold;">prog1</span> nil (<span style="font-weight: bold;">compose-region</span> (<span style="font-weight: bold; text-decoration: underline;">match-beginning</span> <span style="font-weight: bold; text-decoration: underline;">1</span>) (<span style="font-weight: bold; text-decoration: underline;">match-end</span> <span style="font-weight: bold; text-decoration: underline;">1</span>) <span style="font-style: italic;">"&#8226;"</span>))))
    (<span style="font-style: italic;">"^ *</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">\\+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">\\[]</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">\\[[</span><span style="font-style: italic;">^</span><span style="font-style: italic;"> xX-]</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span>
     (<span style="font-weight: bold; text-decoration: underline;">0</span> (<span style="font-weight: bold;">prog1</span> nil (<span style="font-weight: bold;">compose-region</span> (<span style="font-weight: bold; text-decoration: underline;">match-beginning</span> <span style="font-weight: bold; text-decoration: underline;">1</span>) (<span style="font-weight: bold; text-decoration: underline;">match-end</span> <span style="font-weight: bold; text-decoration: underline;">1</span>) <span style="font-style: italic;">"&#8227;"</span>))))
    (<span style="font-style: italic;">"^ *</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">\\*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">\\[]</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">\\[[</span><span style="font-style: italic;">^</span><span style="font-style: italic;"> xX-]</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span>
     (<span style="font-weight: bold; text-decoration: underline;">0</span> (<span style="font-weight: bold;">prog1</span> nil (<span style="font-weight: bold;">compose-region</span> (<span style="font-weight: bold; text-decoration: underline;">match-beginning</span> <span style="font-weight: bold; text-decoration: underline;">1</span>) (<span style="font-weight: bold; text-decoration: underline;">match-end</span> <span style="font-weight: bold; text-decoration: underline;">1</span>) <span style="font-style: italic;">"&#8269;"</span>)))))
  <span style="font-style: italic;">"This is a list of text elements fontification for Org. It</span>
<span style="font-style: italic;">beautifies title, check-boxes, and list bullets."</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 268: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> org
</pre>
</div>

<p>
I like to <i>beautify</i> Org buffers with some tweaks. First I want header tags to be close to the header text:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 269: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">  (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">org-tags-column</span> <span style="font-weight: bold; text-decoration: underline;">0</span>)
</pre>
</div>

<p>
Then I like to have some indentation indicating which header level I am:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 270: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">  (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">org-startup-indented</span> nil)
</pre>
</div>

<p>
I also like to display text formatting as close to WYSIWYG as I can have. This means that if I mark a word as italic, instead of showing <code>/word/</code>, I want to display <i>word</i>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 271: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">  (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">org-hide-emphasis-markers</span> t
        <span style="font-weight: bold; font-style: italic;">org-pretty-entities</span> t)
</pre>
</div>

<p>
When Org collapse a header, it displays an ellipsis right after the header text. Although this is not &ldquo;bad&rdquo;, I like to have a better indication of a collapsed header:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 272: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">  (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">org-ellipsis</span> <span style="font-style: italic;">" &#61703; "</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 273: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">  (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">org-adapt-indentation</span> nil)
</pre>
</div>


<p>
In some documents, I need to write math formulas and Org can render them pretty well using LaTeX, but I like to adjust their render to use SVG instead of image, and use a transparent background to match the overall theme of Emacs
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 274: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">  (<span style="font-weight: bold;">plist-put!</span> <span style="font-weight: bold; font-style: italic;">org-format-latex-options</span>
              <span style="font-weight: bold;">:scale</span> <span style="font-weight: bold; text-decoration: underline;">1.55</span>
              <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"White"</span>
              <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"Transparent"</span>)

  (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">org-preview-latex-default-process</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">dvisvgm</span>
        <span style="font-weight: bold; font-style: italic;">org-startup-with-latex-preview</span> t)

  (<span style="font-weight: bold;">pushnew!</span> <span style="font-weight: bold; font-style: italic;">org-link-abbrev-alist</span>
            <span style="font-weight: bold;">'</span>(<span style="font-style: italic;">"sim"</span>   . <span style="font-style: italic;">"https://sim.amazon.com/issues/%s"</span>)
            <span style="font-weight: bold;">'</span>(<span style="font-style: italic;">"tt"</span>    . <span style="font-style: italic;">"https://t.corp.amazon.com/%s"</span>)
            <span style="font-weight: bold;">'</span>(<span style="font-style: italic;">"pkg"</span>   . <span style="font-style: italic;">"https://code.amazon.com/packages/%s"</span>)
            <span style="font-weight: bold;">'</span>(<span style="font-style: italic;">"ptool"</span> . <span style="font-style: italic;">"https://phonetool.amazon.com/users/%s"</span>)
            <span style="font-weight: bold;">'</span>(<span style="font-style: italic;">"crux"</span>  . <span style="font-style: italic;">"https://code.amazon.com/reviews/%s"</span>)
            <span style="font-weight: bold;">'</span>(<span style="font-style: italic;">"vs"</span>    . <span style="font-style: italic;">"https://code.amazon.com/version-sets/%s"</span>)
            <span style="font-weight: bold;">'</span>(<span style="font-style: italic;">"coe"</span>   . <span style="font-style: italic;">"https://www.coe.a2z.com/coe/%s/content"</span>)
            <span style="font-weight: bold;">'</span>(<span style="font-style: italic;">"xwiki"</span> . <span style="font-style: italic;">"https://w.amazon.com/bin/view/%(+org-xwiki--translate-path)"</span>))
</pre>
</div>

<p>
I need to adjust some of the Org fonts to use fixed pitch regardless if I&rsquo;m using variable pitch. This will guarantee that tables, source blocks, and some other formatting will render properly on the UI, so let&rsquo;s create a function for it:
</p>

<p>
Once we create the function, we can attach it to a hook or execute it right away depending on Emacs running as a daemon or not:
</p>

<p>
And to close out my <i>beautification</i>, I want to render some unicode characters instead of some Org elements:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Org element</th>
<th scope="col" class="org-left">Unicode character</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>- [ ]</code></td>
<td class="org-left">☐</td>
</tr>

<tr>
<td class="org-left"><code>- [-]</code></td>
<td class="org-left">⊡</td>
</tr>

<tr>
<td class="org-left"><code>- [X]</code></td>
<td class="org-left">☑</td>
</tr>
</tbody>
</table>

<p>
And I also want to have better bullet marks:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 275: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">  (<span style="font-weight: bold;">font-lock-add-keywords</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">org-mode</span> my-org-font-lock-beautify-keywords)
</pre>
</div>

<p>
Besides <i>beautification</i>, there are some configurations I like to have as a default behavior. The first one is how I can edit a code block on a separate buffer. By default, Org will edit it using <code>switch-to-buffer-other-window</code>. While this seams to be a popular choice, I just can&rsquo;t stand the two buffers together when I can&rsquo;t touch on the Org file while I have the source block opened.
</p>

<p>
I will use the <code>'current-window</code> option to have the source block behaving like a normal buffer:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 276: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">  (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">org-src-window-setup</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">split-window-right</span>)
</pre>
</div>

<p>
After all these tweaks, we can close our parenthesis:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 277: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp"><span style="color: #88090B;">)</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">after! org</span>
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 278: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">custom-set-faces!</span>
  <span style="font-weight: bold;">'</span>((org-document-info
     org-document-info-keyword
     org-property-value
     org-drawer
     org-table
     org-block
     org-verbatim
     org-code
     org-date
     org-block-begin-line)
    <span style="font-weight: bold;">:inherit</span> fixed-pitch))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 279: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(my-typography-reset <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">org-document-title</span>)

(<span style="font-weight: bold;">custom-set-faces!</span>
  <span style="font-weight: bold;">'</span>(org-document-title <span style="font-weight: bold;">:inherit</span> my-document-title <span style="font-weight: bold;">:weight</span> unspecified <span style="font-weight: bold;">:extend</span> unspecified)
  <span style="font-weight: bold;">'</span>(org-meta-line <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.8</span> <span style="font-weight: bold;">:inherit</span> <span style="font-weight: bold; font-style: italic;">font-lock-comment-face</span>)
  <span style="font-weight: bold;">'</span>(org-special-keyword <span style="font-weight: bold;">:inherit</span> <span style="font-weight: bold; font-style: italic;">font-lock-comment-face</span>)
  <span style="font-weight: bold;">`</span>(org-drawer <span style="font-weight: bold;">:foreground</span> ,(<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">doc-comments</span>))
  <span style="font-weight: bold;">'</span>(org-formula <span style="font-weight: bold;">:inherit</span> org-table)
  <span style="font-weight: bold;">'</span>(org-block-begin-line <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.8</span>)
  <span style="font-weight: bold;">'</span>(org-block-end-line <span style="font-weight: bold;">:inherit</span> org-block-begin-line)
  <span style="font-weight: bold;">'</span>(org-tag <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">150</span>)
  <span style="font-weight: bold;">'</span>(org-indent <span style="font-weight: bold;">:inherit</span> (org-hide fixed-pitch)))
</pre>
</div>

<p>
Even though our configuration can renders math formulas nicely, it&rsquo;s still awkward to edit them once you write them. To help us with this task, I&rsquo;ll install a plugin called <code>org-fragtog</code>. This plugin will show the math formula with the LaTeX syntax if the cursor is inside the formula area, and will render the formula when the cursor leaves it.
</p>

<p>
First we add the plugin on our <code>packages.el</code> file:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 280: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">package!</span> org-fragtog)
</pre>
</div>

<p>
Then, we use <code>use-package!</code> to defer its loading (we will load it manually later):
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 281: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> org-fragtog <span style="font-weight: bold;">:defer</span> t)
</pre>
</div>

<p>
Another nice plugin to have is the <code>valign</code> plugin. It will align your Org tables nicely, even when you have formulas and images on them.
</p>

<p>
As with the <code>org-fragtog</code>, let&rsquo;s first add it to our <code>packages.el</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 282: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">package!</span> valign)
</pre>
</div>

<p>
Then, we use <code>use-package!</code> to defer its loading as we did with <code>org-fragtog</code>, but for this plugin, we want to set the <code>valign-fancy-bar</code> to <code>t</code>, to have even nicer renders of tables:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 283: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> valign
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:init</span> (<span style="font-weight: bold;">setq</span> valign-fancy-bar t))
</pre>
</div>

<p>
So far, with our configuration, we will use the entire size of the frame as our text canvas before wrapping it. This is far from ideal when you&rsquo;re reading a text (specially for me). I want to have narrower text to reduce the amount of focus I need to read a line.
</p>

<p>
We could configure the left and right gutter to achieve a narrower text area, or we could use another plugin for it. I tried both methods, and find out that the plugin has a better response and is easier to install and maintain.
</p>

<p>
Let&rsquo;s add it to our <code>packages.el</code>:
</p>

<p>
Defer its loading on our configuration, and as with the <code>valign</code> package, we will use this time to also set the maximum width for our text:
</p>

<p>
Now that I have a narrower width, the text will wrap more often, but the normal navigation keys will make the cursor jump from one line to the other, even if I have other <i>visual</i> lines displayed.
</p>

<p>
To fix this behavior, we just need to re-bind some of the movement keys to the <i>visual</i> version of their original command, for instance, while we have <code>j</code> bound to <code>evil-next-line</code>, in <code>org-moode</code>, we want it bound to <code>evil-next-visual-line</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 284: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(map! :after org</span>
<span style="font-weight: bold; font-style: italic;">;;       </span><span style="font-weight: bold; font-style: italic;">(:map org-mode-map</span>
<span style="font-weight: bold; font-style: italic;">;;        </span><span style="font-weight: bold; font-style: italic;">:nvm "j" #'evil-next-visual-line</span>
<span style="font-weight: bold; font-style: italic;">;;        </span><span style="font-weight: bold; font-style: italic;">:nvm "k" #'evil-previous-visual-line</span>
<span style="font-weight: bold; font-style: italic;">;;        </span><span style="font-weight: bold; font-style: italic;">:nv "0" #'evil-beginning-of-visual-line</span>
<span style="font-weight: bold; font-style: italic;">;;        </span><span style="font-weight: bold; font-style: italic;">:nvm "^" #'evil-first-non-blank-of-visual-line</span>
<span style="font-weight: bold; font-style: italic;">;;        </span><span style="font-weight: bold; font-style: italic;">:nvm "$" #'evil-end-of-visual-line</span>

<span style="font-weight: bold; font-style: italic;">;;        </span><span style="font-weight: bold; font-style: italic;">(:prefix ("g" . "goto")</span>
<span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">:desc "Next real line" :nvm "j" #'evil-next-line</span>
<span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">:desc "Previous real line" :nvm "k" #'evil-previous-line</span>
<span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">:desc "Beginning of real line" :nvm "0" #'evil-beginning-of-line</span>
<span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">:desc "First non blank of line" :nvm "^" #'evil-first-non-blank</span>
<span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">:desc "End of real line" :nvm "$" #'evil-end-of-line)))</span>
</pre>
</div>

<p>
While I&rsquo;m sure I&rsquo;m missing a command or two, these will get me started.
</p>

<p>
I also need to adjust the window navigation keys that clash with default Org bindings:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 285: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">map!</span> <span style="font-weight: bold;">:after</span> org
      <span style="font-weight: bold;">:map</span> <span style="font-weight: bold; font-style: italic;">org-mode-map</span>
      <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"s-j"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">org-next-visible-heading</span>
      <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"s-k"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">org-previous-visible-heading</span>
      <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"C-s-j"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">org-forward-heading-same-level</span>
      <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"C-s-k"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">org-backward-heading-same-level</span>
      <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"C-j"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">evil-window-down</span>
      <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"C-k"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">evil-window-up</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 286: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">map!</span> <span style="font-weight: bold;">:after</span> org
      <span style="font-weight: bold;">:map</span> <span style="font-weight: bold; font-style: italic;">org-mode-map</span>
      <span style="font-weight: bold;">:g</span> <span style="font-style: italic;">"s-RET"</span>     <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">org-edit-special</span>
      <span style="font-weight: bold;">:g</span> [s-return]  <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">org-edit-special</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 287: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">map!</span> <span style="font-weight: bold;">:after</span> org
      <span style="font-weight: bold;">:map</span> <span style="font-weight: bold; font-style: italic;">org-src-mode-map</span>
      <span style="font-weight: bold;">:in</span> [s-escape] <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">org-edit-src-abort</span>
      <span style="font-weight: bold;">:gin</span> <span style="font-style: italic;">"s-RET"</span>     <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">org-edit-src-exit</span>
      <span style="font-weight: bold;">:gin</span> [s-return]  <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">org-edit-src-exit</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 288: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-link-snippet-in-place</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">yas-expand-snippet</span> (<span style="font-weight: bold;">yas-lookup-snippet</span> <span style="font-style: italic;">"Link"</span>)
                      (<span style="font-weight: bold; text-decoration: underline;">region-beginning</span>)
                      (<span style="font-weight: bold; text-decoration: underline;">region-end</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 289: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">map!</span> <span style="font-weight: bold;">:after</span> org
      (<span style="font-weight: bold;">:map</span> <span style="font-weight: bold; font-style: italic;">org-mode-map</span>
       <span style="font-weight: bold;">:v</span> <span style="font-style: italic;">"s-k"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-link-snippet-in-place</span>))
</pre>
</div>

<p>
At this point we can tight up everything and setup our buffer when we open an org file.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 290: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">package!</span> org-appear
  <span style="font-weight: bold;">:recipe</span> (<span style="font-weight: bold;">:host</span> github
           <span style="font-weight: bold;">:repo</span> <span style="font-style: italic;">"awth13/org-appear"</span>))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 291: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> org-appear
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">setq</span> org-appear-autolinks t
        org-appear-autosubmarkers t))
</pre>
</div>

<p>
To separate my configuration from initialization logic, let&rsquo;s create another autoload function, but this time on a file used for <i>Org things</i> (<code>autoload/org.el</code>):
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 292: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-org-buffer-config-h</span> ()
  <span style="font-style: italic;">"Configure all aspects of an Org buffer right before we display it to the user."</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Enable minor modes</span>
  (<span style="font-weight: bold;">+zen/toggle</span>)
  (valign-mode <span style="font-weight: bold; text-decoration: underline;">1</span>)
  (<span style="font-weight: bold;">variable-pitch-mode</span> <span style="font-weight: bold; text-decoration: underline;">1</span>)
  (<span style="font-weight: bold; font-style: italic;">visual-line-mode</span> <span style="font-weight: bold; text-decoration: underline;">1</span>)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Call org configuration functions</span>
  (<span style="font-weight: bold;">org-display-inline-images</span>)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Ignore flycheck errors on source blocks</span>
  (my-noflycheck-h)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Force a buffer refresh to guarantee all setup is in use</span>
  (<span style="font-weight: bold; text-decoration: underline;">set-window-buffer</span> nil (<span style="font-weight: bold; text-decoration: underline;">current-buffer</span>))

  (<span style="font-weight: bold;">add-hook!</span> evil-insert-state-entry <span style="font-weight: bold;">:local</span>
    (org-fragtog-mode <span style="font-weight: bold; text-decoration: underline;">1</span>)
    (org-appear-mode <span style="font-weight: bold; text-decoration: underline;">1</span>))
  (<span style="font-weight: bold;">add-hook!</span> evil-insert-state-exit <span style="font-weight: bold;">:local</span>
    (org-fragtog-mode <span style="font-weight: bold; text-decoration: underline;">-1</span>)
    (org-appear-mode <span style="font-weight: bold; text-decoration: underline;">-1</span>)))
</pre>
</div>

<p>
With this function in place, we can <i>hook</i> it to our Org major mode:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 293: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">add-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">org-mode-hook</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-org-buffer-config-h</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 294: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">getenv</span> <span style="font-style: italic;">"GITHUB_WORKFLOW"</span>)
    (<span style="font-weight: bold;">package!</span> org-ol-tree
      <span style="font-weight: bold;">:recipe</span> (<span style="font-weight: bold;">:host</span> github
               <span style="font-weight: bold;">:repo</span> <span style="font-style: italic;">"Townk/org-ol-tree"</span>))
  (<span style="font-weight: bold;">package!</span> org-ol-tree
    <span style="font-weight: bold;">:recipe</span> (<span style="font-weight: bold;">:local-repo</span> <span style="font-style: italic;">"~/workplace/personal/emacs/org-ol-tree"</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 295: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> org-ol-tree
  <span style="font-weight: bold;">:commands</span> org-ol-tree
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">map!</span> <span style="font-weight: bold;">:map</span> <span style="font-weight: bold; font-style: italic;">org-mode-map</span>
        <span style="font-weight: bold;">:localleader</span> <span style="font-weight: bold;">:prefix</span> (<span style="font-style: italic;">"g"</span> . <span style="font-style: italic;">"goto"</span>)
        <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Open outline"</span>  <span style="font-style: italic;">"o"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">org-ol-tree</span>)

  (<span style="font-weight: bold;">setq</span> org-ol-tree-ui-window-header-format
        <span style="font-weight: bold;">'</span>((<span style="font-weight: bold;">:eval</span> (<span style="font-weight: bold; text-decoration: underline;">concat</span> <span style="font-style: italic;">" &#9776; "</span> (<span style="font-weight: bold; text-decoration: underline;">propertize</span> <span style="font-style: italic;">"Outline"</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">face</span> <span style="font-weight: bold;">'</span>(<span style="font-weight: bold;">:inherit</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-default-ui</span> <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.8</span>)))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc7921ec" class="outline-3">
<h3 id="orgc7921ec"><span class="section-number-3">5.3</span> <span class="todo TODO">TODO</span> Prose writing</h3>
<div class="outline-text-3" id="text-5-3">
<p>
I don&rsquo;t like to write. After reading this page or any other text I published you might think this is a lie, but it&rsquo;s not. I say way more then I need at any given moment. Suffice to say that this takes a big chunk of my energy, and on top of that, I&rsquo;m not really good at it. This means that for my crazy brain, there is not much reward when I write, and in some times, there is actually anxiety and discomfort.
</p>

<p>
With that out of the way, I need to acknowledge that, currently in my career, there is no way I can get away with <i>not writing</i>. There are too much design, architecture, plans, and projects involved on my day to day work, that my team and I need some form of record of our decisions. And if writing is inevitable, I should, at least, try to make it less painful.
</p>

<p>
For me, this means I should have a tool that offers me the power required to do any kind of writing, but in the same time, makes my life easier when doing the <i>writing thing</i>.
</p>

<p>
Emacs and Org Mode fulfill the <i>power</i> part of my goal, and this configuration will try to tackle the second.
</p>

<p>
Let&rsquo;s look into my list of requirements for writing:
</p>

<dl class="org-dl">
<dt>File templates</dt><dd>My setup should have a set of file templates that would help me start writing something faster. At any time while using Emacs, I can start a new document and select one of these templates, and Emacs will create the file on the right location, using the selected template;</dd>
<dt>No hard line wrap</dt><dd>While I can&rsquo;t stand soft-wraps on code, I&rsquo;m getting used to it when I&rsquo;m writing text, specially now that I can navigate using <i>visual lines</i> on Org Mode. So, this requirement is to make sure I use soft wraps while editing an Org file;</dd>
<dt>Inline images</dt><dd>If I add an image to a text, I want the image to show up right away. Also, if I open a file containing an image, Emacs should display the image automatically. I also want to auto-split the image into chunks so when navigate the text with the cursor, the screen does not jump over the image.</dd>
<dt>Inline formulas</dt><dd>As with images, I want to render math formulas automatically;</dd>
<dt>Formatted tables</dt><dd>Tables on my Org files should stay aligned all the time, and render with proper borders;</dd>
<dt>Focus writing</dt><dd>When I need to dive deep into creating a document, it&rsquo;s useful to remove distractions from my writing environment. Besides getting rid of UI elements, I would like to have the same <i>Focus Mode</i> behavior from <a href="https://ia.net/writer">iA Writer</a>;</dd>
<dt>Snippets</dt><dd>I like to have a snippet system to help me with boilerplate writing for Org;</dd>
</dl>

<p>
Although we already covered most of this list of the previous section, we still need to configure <i>File templates,</i> some personal <i>Snippets</i>, and <i>Focus Writing</i>, so let&rsquo;s get to it.
</p>
</div>

<div id="outline-container-org3b8d6d2" class="outline-4">
<h4 id="org3b8d6d2"><span class="section-number-4">5.3.1</span> Dictionary and writing helpers</h4>
<div class="outline-text-4" id="text-5-3-1">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 296: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">package!</span> lexic
  <span style="font-weight: bold;">:recipe</span> (<span style="font-weight: bold;">:host</span> github
           <span style="font-weight: bold;">:repo</span> <span style="font-style: italic;">"tecosaur/lexic"</span>))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 297: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> lexic
  <span style="font-weight: bold;">:commands</span> lexic-search lexic-list-dictionary
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">set-popup-rule!</span> <span style="font-style: italic;">"^\\*lexic\\*$"</span>
    <span style="font-weight: bold;">:slot</span> <span style="font-weight: bold; text-decoration: underline;">2</span>   <span style="font-weight: bold;">:vslot</span> <span style="font-weight: bold; text-decoration: underline;">-1</span>     <span style="font-weight: bold;">:side</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">right</span>  <span style="font-weight: bold;">:width</span> <span style="font-weight: bold; text-decoration: underline;">100</span> <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.4</span>
    <span style="font-weight: bold;">:select</span> t <span style="font-weight: bold;">:modeline</span> nil <span style="font-weight: bold;">:autosave</span> nil <span style="font-weight: bold;">:ttl</span> <span style="font-weight: bold; text-decoration: underline;">0</span>     <span style="font-weight: bold;">:quit</span> t)

  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">cl-delete-if</span> (<span style="font-weight: bold;">lambda</span> (spec)
                  (<span style="font-weight: bold; text-decoration: underline;">equal</span> (<span style="font-weight: bold; text-decoration: underline;">car-safe</span> spec) <span style="font-style: italic;">"Online Etymology Dictionary"</span>))
                lexic-dictionary-specs)

  (<span style="font-weight: bold;">pushnew!</span> lexic-dictionary-specs
            <span style="font-weight: bold;">'</span>(<span style="font-style: italic;">"GNU Collaborative International Dictionary of English"</span>
              <span style="font-weight: bold;">:short</span> <span style="font-style: italic;">"Meaning"</span>
              <span style="font-weight: bold;">:formatter</span> lexic-format-webster
              <span style="font-weight: bold;">:priority</span> <span style="font-weight: bold; text-decoration: underline;">1</span>)
            <span style="font-weight: bold;">'</span>(<span style="font-style: italic;">"English - Portuguese"</span>
              <span style="font-weight: bold;">:short</span> <span style="font-style: italic;">"Portuguese"</span>
              <span style="font-weight: bold;">:formatter</span> lexic-format-online-etym
              <span style="font-weight: bold;">:priority</span> <span style="font-weight: bold; text-decoration: underline;">2</span>)
            <span style="font-weight: bold;">'</span>(<span style="font-style: italic;">"Online Etymology Dictionary"</span>
              <span style="font-weight: bold;">:short</span> <span style="font-style: italic;">"Origin"</span>
              <span style="font-weight: bold;">:formatter</span> lexic-format-online-etym
              <span style="font-weight: bold;">:priority</span> <span style="font-weight: bold; text-decoration: underline;">4</span>))

  (<span style="font-weight: bold;">map!</span> <span style="font-weight: bold;">:map</span> lexic-mode-map
        <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"q"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">lexic-return-from-lexic</span>
        <span style="font-weight: bold;">:nv</span> <span style="font-style: italic;">"RET"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">lexic-search-word-at-point</span>
        <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"a"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">outline-show-all</span>
        <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"o"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">lexic-toggle-entry</span>
        <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"n"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">lexic-next-entry</span>
        <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"N"</span> (<span style="font-weight: bold;">cmd!</span> (lexic-next-entry t))
        <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"p"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">lexic-previous-entry</span>
        <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"P"</span> (<span style="font-weight: bold;">cmd!</span> (lexic-previous-entry t))
        <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"E"</span> (<span style="font-weight: bold;">cmd!</span> (lexic-return-from-lexic) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">expand</span>
                     (<span style="font-weight: bold;">switch-to-buffer</span> (lexic-get-buffer)))
        <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"M"</span> (<span style="font-weight: bold;">cmd!</span> (lexic-return-from-lexic) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">minimise</span>
                     (lexic-goto-lexic))
        <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"C-p"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">lexic-search-history-backwards</span>
        <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"C-n"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">lexic-search-history-forwards</span>
        <span style="font-weight: bold;">:n</span> <span style="font-style: italic;">"/"</span> (<span style="font-weight: bold;">cmd!</span> (<span style="font-weight: bold; text-decoration: underline;">call-interactively</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">lexic-search</span>))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 298: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-lexic-buffer-config-h</span> ()
  (<span style="font-weight: bold;">setq</span> writeroom-width <span style="font-weight: bold; text-decoration: underline;">75</span>)
  (<span style="font-weight: bold;">let</span> ((<span style="font-weight: bold; font-style: italic;">+zen-text-scale</span> <span style="font-weight: bold; text-decoration: underline;">0</span>))
    (<span style="font-weight: bold;">+zen/toggle</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 299: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">add-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">lexic-mode-hook</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-lexic-buffer-config-h</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 300: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defadvice!</span> my-dictionary-definition-lexic-a (identifier <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> _)
  <span style="font-style: italic;">"Look up the definition of the word at point (or selection) using `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">lexic-search</span><span style="font-style: italic;">'."</span>
  <span style="font-weight: bold;">:override</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+lookup/dictionary-definition</span>
  (<span style="font-weight: bold;">interactive</span>
   (<span style="font-weight: bold; text-decoration: underline;">list</span> (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">doom-thing-at-point-or-region</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">word</span>)
             (<span style="font-weight: bold; text-decoration: underline;">read-string</span> <span style="font-style: italic;">"Look up in dictionary: "</span>))
         <span style="font-weight: bold; font-style: italic;">current-prefix-arg</span>))
  (lexic-search identifier nil nil t))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 301: </span>Commands to install custom aspell dictionary</label><pre class="src src-shell"><span style="font-weight: bold; text-decoration: underline;">cd</span> $<span style="font-weight: bold; font-style: italic;">TMPDIR</span>
<span style="font-weight: bold; text-decoration: underline;">curl</span> -o <span style="font-style: italic;">"aspell6-en-custom.tar.bz2"</span> <span style="font-style: italic;">'http://app.aspell.net/create?max_size=95&amp;spelling=GBs&amp;spelling=AU&amp;max_variant=0&amp;diacritic=keep&amp;special=hacker&amp;special=roman-numerals&amp;encoding=utf-8&amp;format=inline&amp;download=aspell'</span>
tar -xjf <span style="font-style: italic;">"aspell6-en-custom.tar.bz2"</span>
<span style="font-weight: bold; text-decoration: underline;">cd</span> aspell6-en-custom
./configure &amp;&amp; <span style="font-weight: bold; text-decoration: underline;">make</span> &amp;&amp; <span style="font-weight: bold; text-decoration: underline;">sudo</span> <span style="font-weight: bold; text-decoration: underline;">make</span> install
<span style="font-weight: bold; text-decoration: underline;">cd</span> ..
<span style="font-weight: bold; text-decoration: underline;">rm</span> -rf aspell6-en-custom*
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 302: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">my-aspell-local-data-dir</span> (<span style="font-weight: bold; text-decoration: underline;">expand-file-name</span> <span style="font-style: italic;">"~/.local/share/aspell"</span>)
  <span style="font-style: italic;">"Directory of Aspell dictionaries."</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 303: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">my-aspell--personal-dictionary</span> (<span style="font-weight: bold; text-decoration: underline;">expand-file-name</span> <span style="font-style: italic;">"personal.en.pws"</span> my-aspell-local-data-dir)
  <span style="font-style: italic;">"File path for my personal word dictionaries."</span>)

(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold; text-decoration: underline;">not</span> (<span style="font-weight: bold; text-decoration: underline;">file-exists-p</span> my-aspell--personal-dictionary))
  (<span style="font-weight: bold;">append-to-file</span> <span style="font-style: italic;">"personal_ws-1.1 en 0 utf-8"</span> nil my-aspell--personal-dictionary))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 304: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-aspell-cmd-flags</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> camel-case <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> extra-args)
  <span style="font-style: italic;">"Return the list of arguments Emacs should use to run aspell.</span>

<span style="font-style: italic;">You can use this list of arguments directly as the value of `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">ispell-extra-args</span><span style="font-style: italic;">'.</span>
<span style="font-style: italic;">If CAMEL-CASE is a non-nil value, the list of arguments will include the</span>
<span style="font-style: italic;">\"--camel-case\" option.</span>

<span style="font-style: italic;">If EXTRA-ARGS is not nil, this function will append its value to the result."</span>
  (<span style="font-weight: bold; text-decoration: underline;">append</span> <span style="font-weight: bold;">'</span>(<span style="font-style: italic;">"--sug-mode=ultra"</span>) extra-args (<span style="font-weight: bold;">when</span> camel-case <span style="font-weight: bold;">'</span>(<span style="font-style: italic;">"--camel-case"</span>))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 305: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> ispell
  (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">ispell-personal-dictionary</span> my-aspell--personal-dictionary)
  (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">ispell-really-aspell</span> t)
  (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">ispell-extra-args</span> (my-aspell-cmd-flags t))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(add-hook! org-mode</span>
  <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(defun my-spell-add-extra-ignores-to-org-h ()</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">"Configure `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">ispell-skip-region-alist</span><span style="font-weight: bold; font-style: italic;">' for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-mode</span><span style="font-weight: bold; font-style: italic;">'."</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(make-local-variable 'ispell-skip-region-alist)</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(add-to-list 'ispell-skip-region-alist '(org-property-drawer-re))</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(add-to-list 'ispell-skip-region-alist '("~" "~"))</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(add-to-list 'ispell-skip-region-alist '("=" "="))</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(add-to-list 'ispell-skip-region-alist '("\\[\\[" . "]\\["))</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(add-to-list 'ispell-skip-region-alist '("#\\+begin_example" . "#\\+end_example"))</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(add-to-list 'ispell-skip-region-alist '("#\\+begin_src" . "#\\+end_src"))</span>

  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(setq-local ispell-extra-args (my-aspell-cmd-flags nil</span>
  <span style="font-weight: bold; font-style: italic;">;;                                                            </span><span style="font-weight: bold; font-style: italic;">"--lset-filter=url:email:context"</span>
  <span style="font-weight: bold; font-style: italic;">;;                                                            </span><span style="font-weight: bold; font-style: italic;">"--context-visible-first=true"</span>
  <span style="font-weight: bold; font-style: italic;">;;                                                            </span><span style="font-weight: bold; font-style: italic;">"--add-context-delimiters=~ ~"</span>
  <span style="font-weight: bold; font-style: italic;">;;                                                            </span><span style="font-weight: bold; font-style: italic;">"--add-context-delimiters== ="</span>
  <span style="font-weight: bold; font-style: italic;">;;                                                            </span><span style="font-weight: bold; font-style: italic;">"--add-context-delimiters=[[ ]["))))</span>
  )
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 306: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-spell-fu-find-urls</span> (point-start point-end)
  (<span style="font-weight: bold;">let</span> ((url-ranges (<span style="font-weight: bold; text-decoration: underline;">list</span>)))
    (<span style="font-weight: bold;">save-match-data</span>
      (<span style="font-weight: bold;">save-excursion</span>
        (<span style="font-weight: bold; text-decoration: underline;">goto-char</span> point-start)
        (<span style="font-weight: bold;">while</span> (<span style="font-weight: bold; text-decoration: underline;">re-search-forward</span> <span style="font-weight: bold; font-style: italic;">browse-url-button-regexp</span> point-end t)
          (<span style="font-weight: bold;">push</span> (<span style="font-weight: bold; text-decoration: underline;">cons</span> (<span style="font-weight: bold; text-decoration: underline;">match-beginning</span> <span style="font-weight: bold; text-decoration: underline;">0</span>) (<span style="font-weight: bold; text-decoration: underline;">match-end</span> <span style="font-weight: bold; text-decoration: underline;">0</span>)) url-ranges))
        url-ranges))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 307: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-spell-fu-check-range</span> (point-start point-end)
  <span style="font-style: italic;">"Check spelling for POINT-START &amp; POINT-END ignoring urls."</span>
  (spell-fu--remove-overlays point-start point-end)
  (<span style="font-weight: bold;">with-syntax-table</span> spell-fu-syntax-table
    (<span style="font-weight: bold;">save-match-data</span>
      (<span style="font-weight: bold;">save-excursion</span>
        (<span style="font-weight: bold; text-decoration: underline;">goto-char</span> point-start)
        (<span style="font-weight: bold;">while</span> (<span style="font-weight: bold; text-decoration: underline;">re-search-forward</span> spell-fu-word-regexp point-end t)
          (<span style="font-weight: bold;">let</span> ((url-ranges (my-spell-fu-find-urls point-start point-end))
                (word-start (<span style="font-weight: bold; text-decoration: underline;">match-beginning</span> <span style="font-weight: bold; text-decoration: underline;">0</span>))
                (word-end (<span style="font-weight: bold; text-decoration: underline;">match-end</span> <span style="font-weight: bold; text-decoration: underline;">0</span>)))
            (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">seq-some</span> (<span style="font-weight: bold;">lambda</span> (range)
                                (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold; text-decoration: underline;">&gt;</span> word-start (<span style="font-weight: bold; text-decoration: underline;">car</span> range))
                                         (<span style="font-weight: bold; text-decoration: underline;">&lt;</span> word-start (<span style="font-weight: bold; text-decoration: underline;">cdr</span> range)))
                                    (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold; text-decoration: underline;">&gt;</span> word-end (<span style="font-weight: bold; text-decoration: underline;">car</span> range))
                                         (<span style="font-weight: bold; text-decoration: underline;">&lt;</span> word-end (<span style="font-weight: bold; text-decoration: underline;">cdr</span> range)))))
                              url-ranges)
              (<span style="font-weight: bold;">when</span> (spell-fu--check-faces-at-point
                     word-start
                     spell-fu-faces-include
                     spell-fu-faces-exclude)
                (spell-fu-check-word word-start word-end (<span style="font-weight: bold;">match-string-no-properties</span> <span style="font-weight: bold; text-decoration: underline;">0</span>))))))))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 308: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> spell-fu
  (<span style="font-weight: bold;">setq</span> spell-fu-check-range <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-spell-fu-check-range</span>))
</pre>
</div>

<p>
Rules:
</p>
<ul class="org-ul">
<li><a href="https://github.com/textlint-rule/textlint-rule-no-start-duplicated-conjunction">https://github.com/textlint-rule/textlint-rule-no-start-duplicated-conjunction</a></li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 309: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> flycheck
  (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">flycheck-textlint-config</span> <span style="font-style: italic;">"~/.config/textlint/config.json"</span>))
</pre>
</div>

<ul class="org-ul">
<li><a href="https://emacs.stackexchange.com/questions/48587/have-flycheck-skip-certain-regions">https://emacs.stackexchange.com/questions/48587/have-flycheck-skip-certain-regions</a></li>
<li><a href="https://emacs.stackexchange.com/questions/47878/how-can-i-disable-a-specific-lint-error-for-emacs-lisp-using-flycheck">https://emacs.stackexchange.com/questions/47878/how-can-i-disable-a-specific-lint-error-for-emacs-lisp-using-flycheck</a></li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 310: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-noflycheck-region-alist</span>
  <span style="font-weight: bold;">'</span>((<span style="font-weight: bold;">org-mode</span> (<span style="font-style: italic;">"^[ \\t]*?#\\+begin_</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(?:</span><span style="font-style: italic;">src</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">quote</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> . <span style="font-style: italic;">"^[ \\t]*?#\\+end_</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(?:</span><span style="font-style: italic;">src</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">quote</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span>)))
  <span style="font-style: italic;">"An association list between major modes and a noflycheck region delimiters.</span>

<span style="font-style: italic;">The region delimiters are two regular expressions that should match the</span>
<span style="font-style: italic;">beginning and the end of the region respectively."</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 311: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-noflycheck-should-skip-error-h</span> (err)
  <span style="font-style: italic;">"Ignore flycheck ERR if it happens inside a 'no flycheck' region."</span>
  (<span style="font-weight: bold;">when-let</span> ((region (<span style="font-weight: bold; text-decoration: underline;">car</span> (<span style="font-weight: bold;">alist-get</span> <span style="font-weight: bold; font-style: italic;">major-mode</span> my-noflycheck-region-alist)))
             (_ (<span style="font-weight: bold;">save-excursion</span>
                  (<span style="font-weight: bold;">save-match-data</span>
                    (<span style="font-weight: bold;">let*</span> ((start (<span style="font-weight: bold; text-decoration: underline;">car</span> region))
                           (end (<span style="font-weight: bold; text-decoration: underline;">cdr</span> region))
                           (both (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(?:</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">%s</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">%s</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> start end)))
                      (<span style="font-weight: bold; text-decoration: underline;">goto-char</span> (<span style="font-weight: bold;">flycheck-error-pos</span> err))
                      (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold; text-decoration: underline;">re-search-backward</span> both nil t)
                           (<span style="font-weight: bold; text-decoration: underline;">match-beginning</span> <span style="font-weight: bold; text-decoration: underline;">1</span>)))))))
    (<span style="font-weight: bold;">setq-local</span> <span style="font-weight: bold; font-style: italic;">flycheck-current-errors</span> (<span style="font-weight: bold;">remove</span> err <span style="font-weight: bold; font-style: italic;">flycheck-current-errors</span>))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 312: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-noflycheck-should-skip-urls-h</span> (err)
  <span style="font-style: italic;">"Ignore flycheck ERR if it happens inside a 'no flycheck' region."</span>
  (<span style="font-weight: bold;">when-let</span> ((_ (<span style="font-weight: bold;">save-excursion</span>
                  (<span style="font-weight: bold;">save-match-data</span>
                    (<span style="font-weight: bold;">when-let</span> ((err-pos (<span style="font-weight: bold;">flycheck-error-pos</span> err)))
                      (<span style="font-weight: bold; text-decoration: underline;">goto-char</span> err-pos)
                      (<span style="font-weight: bold;">thing-at-point</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">url</span>))))))
    (<span style="font-weight: bold;">setq-local</span> <span style="font-weight: bold; font-style: italic;">flycheck-current-errors</span> (<span style="font-weight: bold;">remove</span> err <span style="font-weight: bold; font-style: italic;">flycheck-current-errors</span>))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 313: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-noflycheck-h</span> ()
  <span style="font-style: italic;">"Add a skip flycheck for regions defined at `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my-noflycheck-region-alist</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold; text-decoration: underline;">require</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">flycheck</span>)
  (<span style="font-weight: bold;">add-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">flycheck-process-error-functions</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-noflycheck-should-skip-error-h</span> nil t)
  (<span style="font-weight: bold;">add-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">flycheck-process-error-functions</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-noflycheck-should-skip-urls-h</span> nil t))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 314: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">package!</span> flycheck-posframe)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 315: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">custom-set-faces!</span>
  <span style="font-weight: bold;">'</span>(flycheck-posframe-border-face <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#000000"</span>)
  <span style="font-weight: bold;">'</span>(flycheck-posframe-face <span style="font-weight: bold;">:inherit</span> my-default-ui))

(<span style="font-weight: bold;">use-package!</span> flycheck-posframe
  <span style="font-weight: bold;">:hook</span> ((<span style="font-weight: bold; font-style: italic;">flycheck-mode</span> . flycheck-posframe-mode))
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">setq</span> flycheck-posframe-border-width <span style="font-weight: bold; text-decoration: underline;">1</span>
        flycheck-posframe-prefix
        (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"%s\t"</span> (<span style="font-weight: bold;">all-the-icons-material</span> <span style="font-style: italic;">"close"</span> <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.7</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">-0.1</span>))
        flycheck-posframe-info-prefix
        (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"%s\t"</span> (<span style="font-weight: bold;">all-the-icons-material</span> <span style="font-style: italic;">"info"</span> <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.7</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">-0.1</span>))
        flycheck-posframe-warning-prefix
        (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"%s\t"</span> (<span style="font-weight: bold;">all-the-icons-material</span> <span style="font-style: italic;">"warning"</span> <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.7</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">-0.1</span>))
        flycheck-posframe-error-prefix
        (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"%s\t"</span> (<span style="font-weight: bold;">all-the-icons-material</span> <span style="font-style: italic;">"error"</span> <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.7</span> <span style="font-weight: bold;">:v-adjust</span> <span style="font-weight: bold; text-decoration: underline;">-0.1</span>)))
)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 316: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defadvice!</span> my-flycheck-posframe-format-errors-a (fun <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> args)
  <span style="font-style: italic;">"Advice to add a top and bottom padding to the error message."</span>
  <span style="font-weight: bold;">:around</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">flycheck-posframe-format-errors</span>
  (<span style="font-weight: bold; text-decoration: underline;">concat</span> (<span style="font-weight: bold; text-decoration: underline;">propertize</span> <span style="font-style: italic;">"  \n"</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">face</span> <span style="font-weight: bold;">'</span>(<span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">60</span>))
          (<span style="font-weight: bold; text-decoration: underline;">apply</span> fun args)
          (<span style="font-weight: bold; text-decoration: underline;">propertize</span> <span style="font-style: italic;">"\n  "</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">face</span> <span style="font-weight: bold;">'</span>(<span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">60</span>))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 317: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defadvice!</span> my-flycheck-posframe-show-posframe-a (errors)
  <span style="font-style: italic;">"Display ERRORS, using posframe.el library."</span>
  <span style="font-weight: bold;">:override</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">flycheck-posframe-show-posframe</span>
  (posframe-hide flycheck-posframe-buffer)
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> errors
             (<span style="font-weight: bold; text-decoration: underline;">not</span> (<span style="font-weight: bold; text-decoration: underline;">run-hook-with-args-until-success</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">flycheck-posframe-inhibit-functions</span>)))
    (<span style="font-weight: bold;">let</span> ((poshandler (<span style="font-weight: bold; text-decoration: underline;">intern</span> (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"posframe-poshandler-%s"</span> flycheck-posframe-position))))
      (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold; text-decoration: underline;">functionp</span> poshandler)
        (<span style="font-weight: bold;">setq</span> poshandler nil))
      (flycheck-posframe-check-position)
      (<span style="font-weight: bold;">posframe-show</span>
       flycheck-posframe-buffer
       <span style="font-weight: bold;">:string</span> (flycheck-posframe-format-errors errors)
       <span style="font-weight: bold;">:background-color</span> (<span style="font-weight: bold;">face-background</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">flycheck-posframe-background-face</span> nil t)
       <span style="font-weight: bold;">:position</span> (<span style="font-weight: bold; text-decoration: underline;">point</span>)
       <span style="font-weight: bold;">:internal-border-width</span> flycheck-posframe-border-width
       <span style="font-weight: bold;">:internal-border-color</span> (<span style="font-weight: bold;">face-foreground</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">flycheck-posframe-border-face</span> nil t)
       <span style="font-weight: bold;">:poshandler</span> poshandler
       <span style="font-weight: bold;">:hidehandler</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">flycheck-posframe-hidehandler</span>
       <span style="font-weight: bold;">:left-fringe</span> <span style="font-weight: bold; text-decoration: underline;">10</span>
       <span style="font-weight: bold;">:right-fringe</span> <span style="font-weight: bold; text-decoration: underline;">10</span>))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf419a2b" class="outline-4">
<h4 id="orgf419a2b"><span class="section-number-4">5.3.2</span> Templates</h4>
<div class="outline-text-4" id="text-5-3-2">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 318: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">my-file-templates-yasnippet-dir</span> (<span style="font-weight: bold; text-decoration: underline;">expand-file-name</span> <span style="font-style: italic;">"share/templates"</span> <span style="font-weight: bold; font-style: italic;">doom-private-dir</span>))
(<span style="font-weight: bold;">pushnew!</span> <span style="font-weight: bold; font-style: italic;">yas-snippet-dirs</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-file-templates-yasnippet-dir</span>)
</pre>
</div>


<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 319: </span>$DOOMDIR/share/templates/org-mode/__</label><pre class="src src-snippet"><span style="font-weight: bold; font-style: italic;"># name: Blank Org File</span>
<span style="font-weight: bold; font-style: italic;"># key: __</span>
<span style="font-weight: bold; font-style: italic;"># --</span>
#+TITLE: ${<span style="font-weight: bold;">1</span>:`(s-titleized-words (file-name-sans-extension (buffer-name)))`<span style="font-weight: bold;">}</span>
<span style="font-weight: bold; font-style: italic;">#+AUTHOR: `user-full-name`</span>
<span style="font-weight: bold; font-style: italic;">#+EMAIL: `user-mail-address`</span>
#+DATE: `(format (format-time-string <span style="font-style: italic;">"%B %%s, %Y"</span>) (string-to-number (format-time-string <span style="font-style: italic;">"%d"</span>)))`
#+LANGUAGE: ${<span style="font-weight: bold;">2</span>:en<span style="font-weight: bold;">}</span>

`%`<span style="font-weight: bold;">$</span><span style="font-style: italic;">0</span>
</pre>
</div>
</div>


<ol class="org-ol">
<li><a id="orge7fbec4"></a><span class="todo TODO">TODO</span> Define a Hydra for <i>new documents</i> to use my templates<br /></li>
</ol>
</div>

<div id="outline-container-orgea7d2a9" class="outline-4">
<h4 id="orgea7d2a9"><span class="section-number-4">5.3.3</span> Focus Writing</h4>
<div class="outline-text-4" id="text-5-3-3">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 320: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">package!</span> focus)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 321: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> focus <span style="font-weight: bold;">:defer</span> t)

(<span style="font-weight: bold;">map!</span> <span style="font-weight: bold;">:leader</span> <span style="font-weight: bold;">:prefix</span> (<span style="font-style: italic;">"t"</span> . <span style="font-style: italic;">"toggle"</span>)
      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Focus mode"</span> <span style="font-weight: bold;">:mvn</span> <span style="font-style: italic;">"o"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">focus-mode</span>
      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Focus mode (RO)"</span> <span style="font-weight: bold;">:mvn</span> <span style="font-style: italic;">"O"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">focus-read-only-mode</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org294ee17" class="outline-4">
<h4 id="org294ee17"><span class="section-number-4">5.3.4</span> Snippets</h4>
<div class="outline-text-4" id="text-5-3-4">
<p>
Even though writing does not have boilerplate typing <i>per-se</i>, Org mode still has a formal syntax to follow. Most of the syntax are straightforward, but some could use a snippet help to make it easier and faster to type them.
</p>

<p>
This section shows the snippets I decide to use for writing.
</p>

<p>
Before defining the snippets though, I need to adjust the <code>yas-keymap</code> to behave properly with evil:
</p>
</div>


<ol class="org-ol">
<li><a id="orgb4bfe9e"></a>Source blocks<br />
<div class="outline-text-5" id="text-5-3-4-1">
<p>
This journey of literate configuration made me realize how much faster is to <i>prepare</i> source blocks using snippets.
</p>

<p>
The first snippet, is a simple <code>emacs-lisp</code> snippet that I use all the time:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 322: </span>$DOOMDIR/snippets/org-mode/src-emacs-lisp</label><pre class="src src-snippet"><span style="font-weight: bold; font-style: italic;"># name: #+begin_src emacs-lisp</span>
<span style="font-weight: bold; font-style: italic;"># uuid: emacs-lisp</span>
<span style="font-weight: bold; font-style: italic;"># key: &lt;el</span>
<span style="font-weight: bold; font-style: italic;"># --</span>
`(<span style="font-weight: bold;">when</span> buffer-file-name (format <span style="font-style: italic;">"#+caption: $DOOMDIR/%s.el\n"</span> (file-name-base buffer-file-name)))`#+begin_src emacs-lisp
`%`<span style="font-weight: bold;">$</span><span style="font-style: italic;">0</span>
<span style="font-weight: bold; font-style: italic;">#+end_src</span>
</pre>
</div>

<p>
Then I have the same snippet, but allowing me to add a <code>:tangle</code> header to it:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 323: </span>$DOOMDIR/snippets/org-mode/src-emacs-lisp-tangled</label><pre class="src src-snippet"><span style="font-weight: bold; font-style: italic;"># name: #+begin_src emacs-lisp :tangle</span>
<span style="font-weight: bold; font-style: italic;"># uuid: emacs-lisp-tangle</span>
<span style="font-weight: bold; font-style: italic;"># key: &lt;elt</span>
<span style="font-weight: bold; font-style: italic;"># --</span>
${<span style="font-weight: bold;">1</span>:<span style="font-weight: bold;">$(</span><span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">or</span> (string-blank-p yas-text) (equal yas-text <span style="font-style: italic;">"no"</span>))
        (format <span style="font-style: italic;">"#+caption: %s\n"</span> yas-text))
<span style="font-weight: bold;">}</span>#+begin_src emacs-lisp `<span style="font-style: italic;">":tangle"</span>` ${<span style="font-weight: bold;">1</span>:$<span style="font-weight: bold;">$(</span><span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">or</span> yas-moving-away-p yas-modified-p)
                            (<span style="font-weight: bold;">yas-auto-next</span>
                              (<span style="font-weight: bold;">condition-case</span> nil
                                  (<span style="font-weight: bold;">let</span> ((fname (read-file-name <span style="font-style: italic;">"Tangle to file: "</span>)))
                                    (<span style="font-weight: bold;">if</span> fname
                                        (file-relative-name fname (file-name-directory (<span style="font-weight: bold;">or</span> buffer-file-name <span style="font-style: italic;">"."</span>)))
                                      <span style="font-style: italic;">"no"</span>))
                                ('quit <span style="font-style: italic;">"no"</span>))))<span style="font-weight: bold;">}</span>
<span style="font-weight: bold;">`%`$</span><span style="font-style: italic;">0</span>
<span style="font-weight: bold; font-style: italic;">#+end_src</span>
</pre>
</div>

<p>
And for a more generic approach, I have this snippet where you can define the language, if you want a tangle header, and if you do, allows you to select the file:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 324: </span>$DOOMDIR/snippets/org-mode/src-tangled</label><pre class="src src-snippet"><span style="font-weight: bold; font-style: italic;"># name: #+begin_src on steroids</span>
<span style="font-weight: bold; font-style: italic;"># uuid: src_block</span>
<span style="font-weight: bold; font-style: italic;"># key: &lt;st</span>
<span style="font-weight: bold; font-style: italic;"># --</span>
${<span style="font-weight: bold;">3</span>:<span style="font-weight: bold;">$(</span><span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">or</span> (string-blank-p yas-text) (equal yas-text <span style="font-style: italic;">"no"</span>))
        (format <span style="font-style: italic;">"#+caption: %s\n"</span> yas-text))
<span style="font-weight: bold;">}</span>#+begin_src ${<span style="font-weight: bold;">1</span>:emacs-lisp<span style="font-weight: bold;">}</span> ${<span style="font-weight: bold;">2</span>:`<span style="font-style: italic;">":tangle"</span>` ${<span style="font-weight: bold;">3</span>:$<span style="font-weight: bold;">$(</span><span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">or</span> yas-moving-away-p
                                                               yas-modified-p)
                            (<span style="font-weight: bold;">yas-auto-next</span>
                              (<span style="font-weight: bold;">condition-case</span> nil
                                  (<span style="font-weight: bold;">let</span> ((fname (read-file-name <span style="font-style: italic;">"Tangle to file: "</span>)))
                                    (<span style="font-weight: bold;">if</span> fname
                                        (file-relative-name fname (file-name-directory (<span style="font-weight: bold;">or</span> (buffer-file-name) <span style="font-style: italic;">"."</span>)))
                                      <span style="font-style: italic;">"no"</span>))
                                ('quit <span style="font-style: italic;">"no"</span>))))<span style="font-weight: bold;">}}</span>
`%`<span style="font-weight: bold;">$</span><span style="font-style: italic;">0</span>
<span style="font-weight: bold; font-style: italic;">#+end_src</span>
</pre>
</div>

<p>
The last snippets I consider useful for source blocks are captions. On the two snippets with tangled files, the capture mark is already there, but if I want to add a caption to the non-tangled snippet I have to do it by hand. So, let&rsquo;s create a snippet to help us with this:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 325: </span>$DOOMDIR/snippets/org-mode/caption</label><pre class="src src-snippet"><span style="font-weight: bold; font-style: italic;"># name: #+caption:</span>
<span style="font-weight: bold; font-style: italic;"># key: cap</span>
<span style="font-weight: bold; font-style: italic;"># --</span>
<span style="font-weight: bold; font-style: italic;">#+caption: $</span><span style="font-style: italic;">0</span>
</pre>
</div>

<p>
This snippet is fine, but we still have to type the filename there. Let&rsquo;s create another one to make this task even easier:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 326: </span>$DOOMDIR/snippets/org-mode/caption-file</label><pre class="src src-snippet"><span style="font-weight: bold; font-style: italic;"># name: #+caption: filename</span>
<span style="font-weight: bold; font-style: italic;"># uuid: caption-file</span>
<span style="font-weight: bold; font-style: italic;"># key: capf</span>
<span style="font-weight: bold; font-style: italic;"># --</span>
#+caption: ${<span style="font-weight: bold;">1</span>:$<span style="font-weight: bold;">$(</span><span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">or</span> yas-moving-away-p yas-modified-p)
                            (<span style="font-weight: bold;">yas-auto-next</span>
                              (file-relative-name
                                (read-file-name <span style="font-style: italic;">"Tangle to file: "</span>)
                                (file-name-directory (<span style="font-weight: bold;">or</span> (buffer-file-name) <span style="font-style: italic;">"."</span>))
                              )))<span style="font-weight: bold;">}$</span><span style="font-style: italic;">0</span>
</pre>
</div>
</div>
</li>

<li><a id="org26bc877"></a>Org elements<br />
<div class="outline-text-5" id="text-5-3-4-2">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 327: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-links-in-kill-ring</span> ()
  <span style="font-style: italic;">"Return a list of links in kill ring."</span>
  (<span style="font-weight: bold; text-decoration: underline;">require</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">goto-addr</span>)
  (<span style="font-weight: bold;">let*</span> ((kill-ring-kills (<span style="font-weight: bold; text-decoration: underline;">mapcar</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">substring-no-properties</span> <span style="font-weight: bold; font-style: italic;">kill-ring</span>))
         (clipboard (<span style="font-weight: bold;">gui-get-selection</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">CLIPBOARD</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">NSStringPboardType</span>))
         (clipboard-url (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold; text-decoration: underline;">string-match</span> goto-address-url-regexp clipboard)
                          (<span style="font-weight: bold; text-decoration: underline;">list</span> (<span style="font-weight: bold;">match-string</span> <span style="font-weight: bold; text-decoration: underline;">0</span> clipboard))))
         (potential-links))
    (<span style="font-weight: bold;">dolist</span> (kill kill-ring-kills)
      (<span style="font-weight: bold;">let</span> (last-match)
        (<span style="font-weight: bold;">while</span>
            (<span style="font-weight: bold;">prog1</span>
                (<span style="font-weight: bold; text-decoration: underline;">string-match</span> goto-address-url-regexp
                              kill last-match)
              (<span style="font-weight: bold;">setq</span> last-match (<span style="font-weight: bold; text-decoration: underline;">match-end</span> <span style="font-weight: bold; text-decoration: underline;">0</span>)))
          (<span style="font-weight: bold;">cl-pushnew</span> (<span style="font-weight: bold;">match-string</span> <span style="font-weight: bold; text-decoration: underline;">0</span> kill) potential-links)
          )))
    (<span style="font-weight: bold; text-decoration: underline;">append</span> clipboard-url (<span style="font-weight: bold;">delete-dups</span> potential-links))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 328: </span>$DOOMDIR/snippets/org-mode/link</label><pre class="src src-snippet"><span style="font-weight: bold; font-style: italic;"># name: Link</span>
<span style="font-weight: bold; font-style: italic;"># key: link</span>
<span style="font-weight: bold; font-style: italic;"># --</span>
[[${<span style="font-weight: bold;">1</span>:$<span style="font-weight: bold;">$(</span><span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">or</span> yas-moving-away-p yas-modified-p)
  (<span style="font-weight: bold;">let</span> ((links (my-links-in-kill-ring)))
    (<span style="font-weight: bold;">if</span> links
        (<span style="font-weight: bold;">yas-auto-next</span>
          (completing-read <span style="font-style: italic;">"Choose the URL to link: "</span> links))
      <span style="font-style: italic;">"url"</span>)))<span style="font-weight: bold;">}</span>][${<span style="font-weight: bold;">2</span>:`(<span style="font-weight: bold;">or</span> yas-selected-text <span style="font-style: italic;">"description"</span>)`<span style="font-weight: bold;">}</span>]]<span style="font-weight: bold;">$</span><span style="font-style: italic;">0</span>
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-org5652e49" class="outline-3">
<h3 id="org5652e49"><span class="section-number-3">5.4</span> <span class="todo TODO">TODO</span> Reading or reviewing</h3>
<div class="outline-text-3" id="text-5-4">
<ul class="org-ul">
<li>Narrower width</li>
<li>Visual motion</li>
<li>Show document structure on sidebar</li>
<li>Annotations
<ul class="org-ul">
<li>Referenceable</li>
<li>Annotate external documents (default to Doom)</li>
</ul></li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 329: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">package!</span> nov)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd0bcd72" class="outline-3">
<h3 id="orgd0bcd72"><span class="section-number-3">5.5</span> <span class="todo TODO">TODO</span> Publishing</h3>
<div class="outline-text-3" id="text-5-5">
<ul class="org-ul">
<li>Blog or site post</li>
<li>Email document</li>
<li>Wiki entry</li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 330: </span>$DOOMDIR/snippets/org-mode/macro</label><pre class="src src-snippet"><span style="font-weight: bold; font-style: italic;"># name: #+BEGIN_MACRO ... block</span>
<span style="font-weight: bold; font-style: italic;"># uuid: macro</span>
<span style="font-weight: bold; font-style: italic;"># key: &lt;m</span>
<span style="font-weight: bold; font-style: italic;"># --</span>
#+attr_block: :macro ${<span style="font-weight: bold;">1</span>:info<span style="font-weight: bold;">}</span> <span style="font-weight: bold;">$</span><span style="font-style: italic;">2</span>
<span style="font-weight: bold; font-style: italic;">#+BEGIN_MACRO</span>
`%`<span style="font-weight: bold;">$</span><span style="font-style: italic;">0</span>
<span style="font-weight: bold; font-style: italic;">#+END_MACRO</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga6bfb2f" class="outline-3">
<h3 id="orga6bfb2f"><span class="section-number-3">5.6</span> <span class="todo TODO">TODO</span> Presenting</h3>
<div class="outline-text-3" id="text-5-6">
<ul class="org-ul">
<li>Use <code>reveal.js</code> inside a WebKit XWidget in full screen</li>
</ul>
</div>
</div>

<div id="outline-container-orgb6f7b16" class="outline-3">
<h3 id="orgb6f7b16"><span class="section-number-3">5.7</span> <span class="todo TODO">TODO</span> Note Taking</h3>
<div class="outline-text-3" id="text-5-7">
<p>
Here in this section I need to come clean to the reader. I&rsquo;m a horrible note taker! I have <a href="https://www.cdc.gov/ncbddd/adhd/facts.html">ADHD</a> and my capacity to keep up with any system to take notes is as short as a <a href="https://www.cdc.gov/ncbddd/adhd/facts.html">fruit fly&rsquo;s attention span</a>. That said, one of the longest streaks of success keeping up with notes I had in the past, was when I tried Org mode for the first time. I believe if I have a setup that makes taking notes effortless, I might be able to finally start taking notes and refer to them when needed.
</p>

<p>
After a lot of reading, consultation, and thinking, I believe I found a system I will enjoy working with. Let me describe it to you.
</p>

<p>
One of the constants I found when searching for a note taking system was the fact that writing down a note (regardless of its type), has to happen in less than two seconds or I don&rsquo;t get motivated to do it all the time. This time is valid to take notes from a computer, as well as on the go. For some individuals, having a small notebook at hand all the time, is crucial for them. Since I&rsquo;m more of a tech guy, my system will use exclusively computer software.
</p>

<p>
To get under these two seconds to take a note when I&rsquo;m on a computer, I defined a single entry point for all notes. This way I can optimize this process inside and outside Emacs if I want.
</p>

<p>
My entry point for notes is <a href="https://github.com/bastibe/org-journal">Org Journal</a>. I will use an entry scheme of one file per year, and create an <a href="https://orgmode.org/manual/Capture.html">org-capture</a> system that will use this single journal file and help me achieve the two seconds mark.
</p>

<p>
Part of my strategy is to have one capture template per type of note to reduce the necessary amount of thinking not related to the note itself. Another artifact I will use is <a href="https://joaotavora.github.io/yasnippet/">Yasnippet</a> instead of <code>org-capture</code> templates. The reason for this decision is to keep a visual track on the entry text. With the standard <code>org-capture</code>, I have to move my eyes from top to bottom of the screen to look between the template text and the input field.
</p>

<p>
I will take notes any time I feel the need, but here are the main topics for my notes:
</p>

<dl class="org-dl">
<dt>Fleet notes</dt><dd>These are the <i>quick notes</i> of the day. I will use fleet notes any time a note does not fit on anyone of the next categories;</dd>
<dt>Journal entries</dt><dd>When need to add an event on my personal journal, I will use this category. I need to clarify though, that a <i>personal journal</i> for me, is anything that happens to myself, regardless if is a work related event or not;</dd>
<dt>Meeting notes</dt><dd>Should happen on any meeting, I must review them no longer than 30 minutes after it,  and must include:
<ul class="org-ul">
<li>List of participants;</li>
<li>Meeting time;</li>
<li>Meeting subjects;</li>
<li>Important points on the meeting;</li>
<li>Action items and their owners;</li>
</ul></dd>
<dt>Support</dt><dd>When I spend some time with a co-worker helping her on any subject, I will have a note about this support containing:
<ul class="org-ul">
<li>Co-worker&rsquo;s name;</li>
<li>Support&rsquo;s subject;</li>
<li>Start and end time;</li>
<li>Action items for me or the co-worker;</li>
</ul></dd>
<dt>Idea</dt><dd>Whenever something interesting pops from my brain, I will try to capture it in this category;</dd>
<dt>Link</dt><dd>When I find something interesting online, or something I should spend some time reading or studying;</dd>
<dt>Past entry</dt><dd>If I remember of something that happens a couple days earlier, or when I want to make a journal entry on the past, I will use this category;</dd>
</dl>

<p>
On the end of each day, I will sit down in front of my computer to review the notes I took on the day. I will think about each note I took and verify if its worth ot keeping it. If it is, I&rsquo;ll try to synthesize the note on my own words and relate it with previous notes.
</p>

<p>
I will be able to search notes using their reference label, title, tags, or content (a great package for this is <a href="https://github.com/jrblevin/deft">Deft</a>).
</p>
</div>

<div id="outline-container-orgb61f824" class="outline-4">
<h4 id="orgb61f824"><span class="section-number-4">5.7.1</span> Capturing</h4>
<div class="outline-text-4" id="text-5-7-1">
<p>
Talk about capture in general:
</p>
<ul class="org-ul">
<li>How am I going to use it?</li>
<li>How am I going to implement it with Yasnippets?</li>
<li>Any goals for this area?</li>
</ul>

<div class="org-src-container">
<pre class="src src-text">[n]     &#9679; Fleet note
[j]...  &#9679; Journal
[t]...  &#9679; Tasks
[c]     &#9679; Contact
[p]...  &#9679; Project
--------------------------------------------------------------------------------
[q]     &#9679; Abort
</pre>
</div>

<p>
Start with the open definition for <code>org-capture</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 331: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">my-capture--note-frame-height</span> <span style="font-weight: bold; text-decoration: underline;">15</span>
  <span style="font-style: italic;">"Number of lines a note frame should have when capturing a long note."</span>)

(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">my-capture--long-note-frame-height</span> <span style="font-weight: bold; text-decoration: underline;">35</span>
  <span style="font-style: italic;">"Number of lines a note frame should have when capturing a long note."</span>)

(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">my-capture--menu-width</span> <span style="font-weight: bold; text-decoration: underline;">50</span>
  <span style="font-style: italic;">"Number of lines a note frame should have when capturing a long note."</span>)

(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">my-capture--yas-prefix</span> <span style="font-style: italic;">"--DOOM-ORG-CAPTURE-YAS-PREFIX--:"</span>
  <span style="font-style: italic;">"String used to identify a yasnippet template on a capture buffer"</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 332: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">my-capture-yasnippet-dir</span> (<span style="font-weight: bold; text-decoration: underline;">expand-file-name</span> <span style="font-style: italic;">"share/capture"</span> <span style="font-weight: bold; font-style: italic;">doom-private-dir</span>)
  <span style="font-style: italic;">"Directory containning all capture snippets."</span>)
(<span style="font-weight: bold;">pushnew!</span> <span style="font-weight: bold; font-style: italic;">yas-snippet-dirs</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-capture-yasnippet-dir</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 333: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> org-capture
  <span style="font-weight: bold;">:after</span> all-the-icons
  <span style="font-weight: bold;">:commands</span> (<span style="font-weight: bold;">org-capture</span> +org-capture/open-frame)
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">add-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">org-capture-mode-hook</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-capture--yas-expand-h</span>)
  (<span style="font-weight: bold;">add-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">org-capture-after-finalize-hook</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-capture--finish-h</span>)
  (<span style="font-weight: bold;">add-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">window-state-change-hook</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-bring-org-capture-to-front-h</span>)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">+org-capture-changelog-file</span> <span style="font-style: italic;">"CHANGELOG.org"</span>)
  (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">org-capture-templates-contexts</span> <span style="font-weight: bold;">'</span>((<span style="font-style: italic;">"p"</span> (my-capture-projects-p))))
  (<span style="font-weight: bold;">setq</span> +org-capture-fn (<span style="font-weight: bold;">lambda</span> ()
                          (<span style="font-weight: bold;">interactive</span>)
                          (<span style="font-weight: bold; text-decoration: underline;">set-window-parameter</span> nil <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">mode-line-format</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">none</span>)
                          (<span style="font-weight: bold; text-decoration: underline;">set-window-parameter</span> nil <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">header-line-format</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">none</span>)
                          (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">default-minibuffer-frame</span> (<span style="font-weight: bold;">org-capture</span>))))

  (<span style="font-weight: bold;">map!</span> (<span style="font-weight: bold;">:map</span> <span style="font-weight: bold; font-style: italic;">org-capture-mode-map</span>
         <span style="font-weight: bold;">:in</span> [s-return] <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">org-capture-finalize</span>
         <span style="font-weight: bold;">:in</span> [s-escape] <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">org-capture-kill</span>)
        (<span style="font-weight: bold;">:leader</span>
         <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Org Capture"</span>           <span style="font-style: italic;">"X"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+org-capture</span>
         (<span style="font-weight: bold;">:prefix</span> (<span style="font-style: italic;">"n"</span> . <span style="font-style: italic;">"notes"</span>)
          <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Org capture"</span>          <span style="font-style: italic;">"n"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+org-capture/open-frame</span>))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 334: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> org-capture
  (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">org-capture-templates</span> <span style="font-weight: bold;">'</span>()))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 335: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-bring-org-capture-to-front-h</span> ()
  (<span style="font-weight: bold;">when-let</span> ((captur-buffer (<span style="font-weight: bold;">seq-find</span> (<span style="font-weight: bold;">lambda</span> (buf) (<span style="font-weight: bold;">string-prefix-p</span> <span style="font-style: italic;">"CAPTURE"</span> (<span style="font-weight: bold; text-decoration: underline;">buffer-name</span> buf)))
                                      (<span style="font-weight: bold; text-decoration: underline;">buffer-list</span>))))
    (my-bring-buffer-to-front captur-buffer)
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold; text-decoration: underline;">eq</span> (<span style="font-weight: bold;">org-roam-buffer--visibility</span>) <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">visible</span>)
      (<span style="font-weight: bold;">org-roam-buffer-deactivate</span>))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 336: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-capture--adjust-frame</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> extended-p frame)
  <span style="font-style: italic;">"Dinamically adjust the capture FRAME width to WIDTH and reposition it on the</span>
<span style="font-style: italic;">center of the screen."</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">+org-capture-frame-p</span>)
    (<span style="font-weight: bold; text-decoration: underline;">set-frame-size</span> (<span style="font-weight: bold;">or</span> frame (<span style="font-weight: bold; text-decoration: underline;">selected-frame</span>))
                    (<span style="font-weight: bold; text-decoration: underline;">+</span> <span style="font-weight: bold; font-style: italic;">fill-column</span> <span style="font-weight: bold; text-decoration: underline;">20</span>)
                    (<span style="font-weight: bold;">if</span> extended-p
                        my-capture--long-note-frame-height
                      my-capture--note-frame-height))
    (my-capture--reposition-frame frame)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 337: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-capture--reposition-frame</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> frame)
  <span style="font-style: italic;">"Position FRAME around the center of the screen."</span>
  (<span style="font-weight: bold;">let</span> ((frame-w (<span style="font-weight: bold; text-decoration: underline;">window-pixel-width</span>))
        (frame-h (<span style="font-weight: bold; text-decoration: underline;">window-pixel-height</span>)))
    (<span style="font-weight: bold; text-decoration: underline;">set-frame-position</span> (<span style="font-weight: bold;">or</span> frame (<span style="font-weight: bold; text-decoration: underline;">selected-frame</span>))
                        (<span style="font-weight: bold; text-decoration: underline;">/</span> (<span style="font-weight: bold; text-decoration: underline;">-</span> (<span style="font-weight: bold;">display-pixel-width</span>) frame-w) <span style="font-weight: bold; text-decoration: underline;">2</span>)     <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">X</span>
                        (<span style="font-weight: bold; text-decoration: underline;">/</span> (<span style="font-weight: bold; text-decoration: underline;">-</span> (<span style="font-weight: bold;">display-pixel-height</span>) frame-h) <span style="font-weight: bold; text-decoration: underline;">3</span>)))) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Y</span>
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 338: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-capture--yas-expand-h</span> ()
  <span style="font-style: italic;">"Expand `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my-capture--yas-prefix</span><span style="font-style: italic;">' on the template."</span>
  (<span style="font-weight: bold;">setq</span> +org-capture--auto-align-tags-store <span style="font-weight: bold; font-style: italic;">org-auto-align-tags</span>)
  (<span style="font-weight: bold;">let</span> ((saved-point (<span style="font-weight: bold; text-decoration: underline;">point</span>)))
    (<span style="font-weight: bold; text-decoration: underline;">goto-char</span> (<span style="font-weight: bold; text-decoration: underline;">point-min</span>))
    (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">search-forward-regexp</span> (<span style="font-weight: bold; text-decoration: underline;">concat</span> my-capture--yas-prefix <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">:]*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">:"</span>) nil t)
        (<span style="font-weight: bold;">progn</span>
          (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">org-auto-align-tags</span> nil)
          (<span style="font-weight: bold; text-decoration: underline;">goto-char</span> (<span style="font-weight: bold; text-decoration: underline;">match-end</span> <span style="font-weight: bold; text-decoration: underline;">0</span>))
          (<span style="font-weight: bold; text-decoration: underline;">replace-match</span> (<span style="font-weight: bold;">match-string</span> <span style="font-weight: bold; text-decoration: underline;">1</span>))
          (<span style="font-weight: bold;">yas-expand</span>))
      (<span style="font-weight: bold; text-decoration: underline;">goto-char</span> saved-point)))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(org-num-mode -1)</span>
  (<span style="font-weight: bold;">tab-line-mode</span> <span style="font-weight: bold; text-decoration: underline;">-1</span>)
  (<span style="font-weight: bold; font-style: italic;">ws-butler-mode</span> <span style="font-weight: bold; text-decoration: underline;">-1</span>)
  (<span style="font-weight: bold;">setq-local</span> <span style="font-weight: bold; font-style: italic;">org-startup-folded</span> nil))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 339: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-capture-yasnippet</span> (snippet)
  <span style="font-style: italic;">"Returns a snippet mark with the given SNIPPET used to expand it with yasnippet</span>
<span style="font-style: italic;">when the capture finishes.</span>

<span style="font-style: italic;">SNIPPET can be a string or a symbol.</span>

<span style="font-style: italic;">The snippet mark will have the format:</span>

<span style="font-style: italic;">\"--DOOM-ORG-CAPTURE-YAS-PREFIX--:&lt;snippet name&gt;:\""</span>
  (<span style="font-weight: bold; text-decoration: underline;">concat</span> my-capture--yas-prefix
          (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">stringp</span> snippet)
              snippet
            (<span style="font-weight: bold; text-decoration: underline;">symbol-name</span> snippet))
          <span style="font-style: italic;">":"</span>))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 340: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-capture--finish-h</span> ()
  <span style="font-style: italic;">"Clean up any outstanding variable and values set when capture</span>
<span style="font-style: italic;">starts."</span>
  (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">org-auto-align-tags</span> +org-capture--auto-align-tags-store)
  (<span style="font-weight: bold;">setq</span> +org-capture--auto-align-tags-store nil))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 341: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-capture-template-selection</span> ()
  <span style="font-style: italic;">"Returns the text selected on the buffer that originated the capture. If the</span>
<span style="font-style: italic;">selection is the entire buffer, return an org link to buffer."</span>
  (<span style="font-weight: bold;">with-current-buffer</span> (<span style="font-weight: bold;">org-capture-get</span> <span style="font-weight: bold;">:original-buffer</span>)
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">region-active-p</span>)
      (<span style="font-weight: bold;">or</span> (my-capture--mu4e-headers-selected)
          (my-capture--mu4e-view-selected)
          (my-capture--buffer-selected)
          <span style="font-style: italic;">""</span>))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 342: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-capture--mu4e-headers-selected</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> buf-name)
  <span style="font-style: italic;">"When on a mu4e-headers buffer, store an org link to each one of the selected</span>
<span style="font-style: italic;">messages and return them all as a string."</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold; text-decoration: underline;">boundp</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">mu4e~headers-buffer-name</span>)
             (<span style="font-weight: bold; text-decoration: underline;">string=</span> (<span style="font-weight: bold;">or</span> buf-name (<span style="font-weight: bold; text-decoration: underline;">buffer-name</span>)) mu4e~headers-buffer-name))
    (<span style="font-weight: bold;">let*</span> ((beg (<span style="font-weight: bold; text-decoration: underline;">region-beginning</span>))
           (end (<span style="font-weight: bold; text-decoration: underline;">region-end</span>))
           (lines (<span style="font-weight: bold;">count-lines</span> beg end)))
      (<span style="font-weight: bold;">save-excursion</span>
        (<span style="font-weight: bold; text-decoration: underline;">goto-char</span> beg)
        (<span style="font-weight: bold;">while</span> (<span style="font-weight: bold; text-decoration: underline;">&lt;</span> (<span style="font-weight: bold; text-decoration: underline;">point</span>) end)
          (<span style="font-weight: bold;">org-store-link</span> t t)
          (<span style="font-weight: bold; text-decoration: underline;">forward-line</span> <span style="font-weight: bold; text-decoration: underline;">1</span>)))
      (<span style="font-weight: bold;">with-temp-buffer</span>
        (<span style="font-weight: bold;">org-insert-all-links</span> lines)
        (<span style="font-weight: bold; text-decoration: underline;">buffer-string</span>)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 343: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-capture--mu4e-view-selected</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> buf-name)
  <span style="font-style: italic;">"When on a mu4e-view buffer, store an org link to the message and return it as a</span>
<span style="font-style: italic;">string with the selected text as a block-quote. If the selection is the entire</span>
<span style="font-style: italic;">buffer, just return the org link."</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold; text-decoration: underline;">boundp</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">mu4e~view-buffer-name</span>)
             (<span style="font-weight: bold; text-decoration: underline;">string=</span> (<span style="font-weight: bold;">or</span> buf-name (<span style="font-weight: bold; text-decoration: underline;">buffer-name</span>)) mu4e~view-buffer-name))
    (<span style="font-weight: bold;">let*</span> ((beg (<span style="font-weight: bold; text-decoration: underline;">region-beginning</span>))
           (end (<span style="font-weight: bold; text-decoration: underline;">region-end</span>))
           (full-buf-sel-p (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold; text-decoration: underline;">=</span> beg (<span style="font-weight: bold; text-decoration: underline;">point-min</span>))
                                (<span style="font-weight: bold; text-decoration: underline;">=</span> end (<span style="font-weight: bold; text-decoration: underline;">point-max</span>))))
           (buf-quote (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold; text-decoration: underline;">not</span> full-buf-sel-p) (<span style="font-weight: bold; text-decoration: underline;">buffer-substring</span> beg end))))
      (<span style="font-weight: bold;">org-store-link</span> t t)
      (<span style="font-weight: bold;">with-temp-buffer</span>
        (<span style="font-weight: bold; text-decoration: underline;">insert</span> <span style="font-style: italic;">"- "</span>)
        (<span style="font-weight: bold;">org-insert-last-stored-link</span> <span style="font-weight: bold; text-decoration: underline;">1</span>)
        (<span style="font-weight: bold;">when</span> buf-quote
          (<span style="font-weight: bold; text-decoration: underline;">insert</span> <span style="font-style: italic;">"#+BEGIN_QUOTE\n"</span>)
          (<span style="font-weight: bold; text-decoration: underline;">insert</span> buf-quote)
          (<span style="font-weight: bold; text-decoration: underline;">insert</span> <span style="font-style: italic;">"#+END_QUOTE\n"</span>))
        (<span style="font-weight: bold; text-decoration: underline;">buffer-string</span>)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 344: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-capture--buffer-selected</span> ()
  <span style="font-style: italic;">"When there is an active selection in the current buffer,</span>
<span style="font-style: italic;">returns an org link to the current buffer with the selection as a blockquote. If</span>
<span style="font-style: italic;">the selection is the entire buffer, just return the org link."</span>
  (<span style="font-weight: bold;">let</span> ((sel-text (<span style="font-weight: bold;">let*</span> ((beg (<span style="font-weight: bold; text-decoration: underline;">region-beginning</span>))
                         (end (<span style="font-weight: bold; text-decoration: underline;">region-end</span>))
                         (full-buf-sel-p (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold; text-decoration: underline;">=</span> beg (<span style="font-weight: bold; text-decoration: underline;">point-min</span>))
                                              (<span style="font-weight: bold; text-decoration: underline;">=</span> end (<span style="font-weight: bold; text-decoration: underline;">point-max</span>))))
                         (buf-file (<span style="font-weight: bold; text-decoration: underline;">expand-file-name</span> (<span style="font-weight: bold; font-style: italic;">buffer-file-name</span>)))
                         (buf-name (<span style="font-weight: bold; text-decoration: underline;">buffer-name</span>))
                         (buf-linum (<span style="font-weight: bold;">line-number-at-pos</span> beg t))
                         (buf-quote (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold; text-decoration: underline;">not</span> full-buf-sel-p) (<span style="font-weight: bold; text-decoration: underline;">buffer-substring</span> beg end)))
                         (quote-what (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> buf-quote (<span style="font-weight: bold;">derived-mode-p</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">prog-mode</span>))
                                         (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"SOURCE %s"</span>
                                                 (<span style="font-weight: bold;">s-chop-suffix</span> <span style="font-style: italic;">"-mode"</span> (<span style="font-weight: bold; text-decoration: underline;">symbol-name</span> <span style="font-weight: bold; font-style: italic;">major-mode</span>)))
                                       <span style="font-style: italic;">"QUOTE"</span>)))
                    (<span style="font-weight: bold;">with-temp-buffer</span>
                      (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold; text-decoration: underline;">file-exists-p</span> buf-file)
                        (<span style="font-weight: bold; text-decoration: underline;">insert</span> (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"- [[file:%s::%d][%s]]\n"</span> buf-file buf-linum buf-name)))
                      (<span style="font-weight: bold;">when</span> buf-quote
                        (<span style="font-weight: bold; text-decoration: underline;">insert</span> (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"#+BEGIN_%s\n"</span> quote-what))
                        (<span style="font-weight: bold; text-decoration: underline;">insert</span> buf-quote)
                        (<span style="font-weight: bold; text-decoration: underline;">insert</span> (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"#+END_%s\n"</span> quote-what)))
                      (<span style="font-weight: bold; text-decoration: underline;">buffer-string</span>)))))
    (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">s-blank-str-p</span> sel-text) sel-text)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 345: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-capture-projects-p</span> ()
  <span style="font-style: italic;">"Retuns true when current buffer belongs to current open project."</span>
  (<span style="font-weight: bold;">with-current-buffer</span> (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">org-capture-get</span> <span style="font-weight: bold;">:original-buffer</span>) (<span style="font-weight: bold; text-decoration: underline;">current-buffer</span>))
    (<span style="font-weight: bold;">let*</span> ((proj-root (<span style="font-weight: bold;">doom-project-root</span>))
           (proj-root (<span style="font-weight: bold;">when</span> proj-root (<span style="font-weight: bold; text-decoration: underline;">expand-file-name</span> proj-root)))
           (buf-path (<span style="font-weight: bold; font-style: italic;">buffer-file-name</span>))
           (buf-path (<span style="font-weight: bold;">when</span> buf-path (<span style="font-weight: bold; text-decoration: underline;">expand-file-name</span> buf-path))))
      (<span style="font-weight: bold;">and</span> proj-root
           buf-path
           (<span style="font-weight: bold;">string-prefix-p</span> proj-root buf-path)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 346: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-capture-description</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> args)
  <span style="font-style: italic;">"Returns a formatted capture description.</span>

<span style="font-style: italic;">ARGS is a declarative builder for the new description:</span>

<span style="font-style: italic;">`</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">:text</span><span style="font-style: italic;">' (required) - The string displayed on the capture item.</span>
<span style="font-style: italic;">`</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">:icon</span><span style="font-style: italic;">' (optional) - A cons cell with the icon symbol (check</span>
<span style="font-style: italic;">    `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">+org-capture-supported-icons</span><span style="font-style: italic;">' for supported symbols).</span>

<span style="font-style: italic;">Example:</span>

<span style="font-style: italic;">  (my-capture-description :text \"Add journal entry\"</span>
<span style="font-style: italic;">                            :icon '(journal . \"#ff00ff\"))"</span>
  (<span style="font-weight: bold;">let</span> ((text (<span style="font-weight: bold; text-decoration: underline;">plist-get</span> args <span style="font-weight: bold;">:text</span>))
        (icon (<span style="font-weight: bold; text-decoration: underline;">plist-get</span> args <span style="font-weight: bold;">:icon</span>)))
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold; text-decoration: underline;">null</span> text)
                (<span style="font-weight: bold;">string-blank-p</span> text))
      (<span style="font-weight: bold;">error</span> <span style="font-style: italic;">"A capture description requires a text."</span>))
    (<span style="font-weight: bold;">if</span> icon
        (<span style="font-weight: bold;">progn</span>
          <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(unless (and (consp icon)</span>
          <span style="font-weight: bold; font-style: italic;">;;              </span><span style="font-weight: bold; font-style: italic;">(my-supported-icons-p (car-safe icon))</span>
          <span style="font-weight: bold; font-style: italic;">;;              </span><span style="font-weight: bold; font-style: italic;">(stringp (cdr-safe icon)))</span>
          <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(error (concat "A capture description icon must be a cons cell with"</span>
          <span style="font-weight: bold; font-style: italic;">;;                  </span><span style="font-weight: bold; font-style: italic;">" one of my-supported-icons symbol and a string color.")))</span>
          (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"%s %s"</span> (my-icon (<span style="font-weight: bold; text-decoration: underline;">car</span> icon) (<span style="font-weight: bold; text-decoration: underline;">cdr</span> icon)) text))
      text)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 347: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-capture-heading-template</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> args)
  <span style="font-style: italic;">"Returns a formatted capture template for a heading.</span>

<span style="font-style: italic;">ARGS should all be string that will get concatenated with no spaces between</span>
<span style="font-style: italic;">them. Default to \"%?\"."</span>
  (<span style="font-weight: bold;">let*</span> ((content (<span style="font-weight: bold;">when</span> args (<span style="font-weight: bold;">s-join</span> <span style="font-style: italic;">""</span> args)))
         (content (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">s-matches-p</span> content <span style="font-style: italic;">"%|</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">|]*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">|"</span>)
                      (<span style="font-weight: bold;">s-trim</span> (<span style="font-weight: bold;">s-replace-all</span> <span style="font-weight: bold;">'</span>((<span style="font-style: italic;">" %? "</span> . <span style="font-style: italic;">" "</span>) (<span style="font-style: italic;">"%?"</span> . <span style="font-style: italic;">""</span>)) content))
                    (<span style="font-weight: bold;">or</span> content <span style="font-style: italic;">"%?"</span>))))
    (<span style="font-weight: bold; text-decoration: underline;">concat</span> (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold; text-decoration: underline;">not</span> (<span style="font-weight: bold;">s-starts-with-p</span> <span style="font-style: italic;">"*"</span> content))
              <span style="font-style: italic;">"%(my-capture-heading-prefix) "</span>)
            (<span style="font-weight: bold;">replace-regexp-in-string</span> <span style="font-style: italic;">"%|</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">|]*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">|"</span>
                                      <span style="font-style: italic;">"%(my-capture-yasnippet 'capture-\\1)%?"</span>
                                      content)
            <span style="font-style: italic;">"\n%(my-capture-template-selection)"</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 348: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-capture-heading-prefix</span> ()
  <span style="font-style: italic;">"Returns a string of `*` characters representing an org header level. The number</span>
<span style="font-style: italic;">of characters is the one on the org-capture `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">:heading-level</span><span style="font-style: italic;">' property or</span>
<span style="font-style: italic;">calculated by the org-capture `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">:olp</span><span style="font-style: italic;">' property size."</span>
  (<span style="font-weight: bold;">let</span> ((level (<span style="font-weight: bold;">org-capture-get</span> <span style="font-weight: bold;">:heading-level</span>))
        (olp-size (<span style="font-weight: bold; text-decoration: underline;">1+</span> (<span style="font-weight: bold; text-decoration: underline;">length</span> (<span style="font-weight: bold;">org-capture-get</span> <span style="font-weight: bold;">:olp</span>)))))
    (<span style="font-weight: bold;">s-repeat</span> (<span style="font-weight: bold; text-decoration: underline;">max</span> <span style="font-weight: bold; text-decoration: underline;">1</span> (<span style="font-weight: bold;">or</span> level olp-size)) <span style="font-style: italic;">"*"</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 349: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-capture-position-cursor</span> ()
  <span style="font-style: italic;">"Asks user for a timestamp and store it for template use. It also position the</span>
<span style="font-style: italic;">cursor on the correct place for a new entry, and adjust the capture frame width</span>
<span style="font-style: italic;">to `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">fill-column</span><span style="font-style: italic;">' before start editing."</span>
  (my-capture--adjust-frame (<span style="font-weight: bold;">org-capture-get</span> <span style="font-weight: bold;">:clock-in</span>))
  (<span style="font-weight: bold;">let*</span> ((read-time (<span style="font-weight: bold;">org-capture-get</span> <span style="font-weight: bold;">:read-time</span>))
         (read-time-labal (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">org-capture-get</span> <span style="font-weight: bold;">:read-time-label</span>) <span style="font-style: italic;">"Timestamp"</span>))
         (olp (<span style="font-weight: bold;">org-capture-get</span> <span style="font-weight: bold;">:olp</span>))
         (header-point (<span style="font-weight: bold;">org-roam-capture-find-or-create-olp</span> olp))
         existent-olp)
    (<span style="font-weight: bold;">when</span> read-time
      (<span style="font-weight: bold;">org-capture-put</span> <span style="font-weight: bold;">:time-read</span> (<span style="font-weight: bold;">org-read-date</span> t t nil read-time-labal)))
    (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">not</span> olp)
        (<span style="font-weight: bold; text-decoration: underline;">goto-char</span> (<span style="font-weight: bold; text-decoration: underline;">point-max</span>))
      (<span style="font-weight: bold; text-decoration: underline;">goto-char</span> header-point)
      (<span style="font-weight: bold;">org-end-of-subtree</span>)
      (<span style="font-weight: bold;">move-end-of-line</span> nil))
    (<span style="font-weight: bold;">newline</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 350: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-capture-file</span>()
  (<span style="font-weight: bold;">let*</span> ((file-name-format (<span style="font-weight: bold;">org-capture-get</span> <span style="font-weight: bold;">:file-name-format</span>))
         (file-name (<span style="font-weight: bold;">s-trim</span> (<span style="font-weight: bold;">org-capture-fill-template</span> file-name-format)))
         (file-path (<span style="font-weight: bold; text-decoration: underline;">expand-file-name</span> file-name (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold; text-decoration: underline;">not</span> (<span style="font-weight: bold;">s-starts-with-p</span> <span style="font-style: italic;">"/"</span> file-name)) <span style="font-weight: bold; font-style: italic;">org-directory</span>)))
         (file-header (<span style="font-weight: bold;">org-capture-get</span> <span style="font-weight: bold;">:file-header</span>)))
    (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">file-exists-p</span> file-path)
        (<span style="font-weight: bold;">find-file</span> file-path)
      (<span style="font-weight: bold;">make-directory</span> (<span style="font-weight: bold; text-decoration: underline;">file-name-directory</span> file-path) t)
      (<span style="font-weight: bold;">find-file</span> file-path)
      (<span style="font-weight: bold;">when</span> file-header
        (<span style="font-weight: bold; text-decoration: underline;">insert</span> (<span style="font-weight: bold;">org-capture-fill-template</span> file-header)))
      (<span style="font-weight: bold; text-decoration: underline;">set-buffer-modified-p</span> nil))
    (my-capture-position-cursor)
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold; text-decoration: underline;">eq</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">visible</span> (<span style="font-weight: bold;">org-roam-buffer--visibility</span>))
      (<span style="font-weight: bold;">org-roam-buffer-deactivate</span>))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 351: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-capture-time-read</span> ()
  <span style="font-style: italic;">"Returns the last timestamp captured, formatted with the format specified on</span>
<span style="font-style: italic;">`</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-time-stamp-formats</span><span style="font-style: italic;">'. If user didn't capture any date, returns current</span>
<span style="font-style: italic;">time."</span>
  (<span style="font-weight: bold; text-decoration: underline;">format-time-string</span> (<span style="font-weight: bold; text-decoration: underline;">cdr-safe</span> <span style="font-weight: bold; font-style: italic;">org-time-stamp-formats</span>) (<span style="font-weight: bold;">org-capture-get</span> <span style="font-weight: bold;">:time-read</span>)))
</pre>
</div>
</div>

<ol class="org-ol">
<li><a id="org56423d8"></a>Dailies<br />
<div class="outline-text-5" id="text-5-7-1-1">
<div class="org-src-container">
<pre class="src src-text">[s]     &#9679; Support
[m]     &#9679; Meeting
[c]     &#9679; Code review
[i]     &#9679; Idea
[l]     &#9679; Interesting link
--------------------------------------------------------------------------------
[q]     &#9679; Abort
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 352: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">my-roam-dailies-file-name</span> <span style="font-style: italic;">"notes/daily/daily-notes-%&lt;%Y-%m-%d&gt;.org"</span>
  <span style="font-style: italic;">"Filename format for the Daily Notes file."</span>)

(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">my-roam-dailies-header</span> (<span style="font-weight: bold; text-decoration: underline;">concat</span> <span style="font-style: italic;">"#+TITLE: Daily notes for %&lt;%A, %B %-e, %Y&gt;\n"</span>
                                           <span style="font-style: italic;">"#+STARTUP: overview\n"</span>
                                           <span style="font-style: italic;">"#+CATEGORY: dailies\n"</span>
                                           <span style="font-style: italic;">"\n"</span>)
  <span style="font-style: italic;">"Template used to create new Daily Notes files."</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 353: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> org-capture
  (<span style="font-weight: bold;">appendq!</span> <span style="font-weight: bold; font-style: italic;">org-capture-templates</span>
            <span style="font-weight: bold;">`</span>((<span style="font-style: italic;">"d"</span>  ,(my-capture-description <span style="font-weight: bold;">:text</span> <span style="font-style: italic;">"Daily notes"</span> <span style="font-weight: bold;">:icon</span> <span style="font-weight: bold;">`</span>(notes . ,(<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">green</span>)))))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 354: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> org-capture
  (<span style="font-weight: bold;">appendq!</span> <span style="font-weight: bold; font-style: italic;">org-capture-templates</span>
            <span style="font-weight: bold;">`</span>((<span style="font-style: italic;">"dd"</span>  ,(my-capture-description <span style="font-weight: bold;">:text</span> <span style="font-style: italic;">"Fleet note"</span> <span style="font-weight: bold;">:icon</span> <span style="font-weight: bold;">`</span>(notes . ,(<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">blue</span> <span style="font-weight: bold; text-decoration: underline;">256</span>)))
               plain (<span style="font-weight: bold;">function</span> my-capture-file)
               ,(my-capture-heading-template <span style="font-style: italic;">"%&lt;%H:%M%#p&gt; - %?"</span>)
               <span style="font-weight: bold;">:file-name-format</span> ,my-roam-dailies-file-name
               <span style="font-weight: bold;">:file-header</span> ,my-roam-dailies-header
               <span style="font-weight: bold;">:kill-buffer</span> t
               <span style="font-weight: bold;">:empty-lines-after</span> <span style="font-weight: bold; text-decoration: underline;">2</span>
               <span style="font-weight: bold;">:olp</span> (<span style="font-style: italic;">"Fleet notes"</span>)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 355: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> org-capture
  (<span style="font-weight: bold;">appendq!</span> <span style="font-weight: bold; font-style: italic;">org-capture-templates</span>
            <span style="font-weight: bold;">`</span>((<span style="font-style: italic;">"ds"</span> ,(my-capture-description <span style="font-weight: bold;">:text</span> <span style="font-style: italic;">"Support"</span> <span style="font-weight: bold;">:icon</span> <span style="font-weight: bold;">`</span>(help . ,(<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">orange</span> <span style="font-weight: bold; text-decoration: underline;">256</span>)))
               plain (<span style="font-weight: bold;">function</span> my-capture-file)
               ,(my-capture-heading-template <span style="font-style: italic;">"%&lt;%H:%M%#p&gt; - %|support|"</span>)
               <span style="font-weight: bold;">:file-name-format</span> ,my-roam-dailies-file-name
               <span style="font-weight: bold;">:file-header</span> ,my-roam-dailies-header
               <span style="font-weight: bold;">:clock-in</span> t
               <span style="font-weight: bold;">:kill-buffer</span> t
               <span style="font-weight: bold;">:empty-lines-after</span> <span style="font-weight: bold; text-decoration: underline;">2</span>
               <span style="font-weight: bold;">:olp</span> (<span style="font-style: italic;">"Meeting notes"</span>)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 356: </span>$DOOMDIR/share/capture/org-mode/capture-support</label><pre class="src src-snippet"><span style="font-weight: bold; font-style: italic;"># name: Notes for new support request</span>
<span style="font-weight: bold; font-style: italic;"># key: capture-support</span>
<span style="font-weight: bold; font-style: italic;"># --</span>
Support about ${<span style="font-weight: bold;">1</span>:Support topic<span style="font-weight: bold;">}</span>  `<span style="font-style: italic;">":support:"</span>`
- Requested by ${<span style="font-weight: bold;">2</span>:Coworker Name<span style="font-weight: bold;">}</span>
- <span style="font-weight: bold;">$</span><span style="font-style: italic;">0</span>
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 357: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> org-capture
  (<span style="font-weight: bold;">appendq!</span> <span style="font-weight: bold; font-style: italic;">org-capture-templates</span>
            <span style="font-weight: bold;">`</span>((<span style="font-style: italic;">"dm"</span> ,(my-capture-description <span style="font-weight: bold;">:text</span> <span style="font-style: italic;">"Meeting"</span> <span style="font-weight: bold;">:icon</span> <span style="font-weight: bold;">`</span>(meeting . ,(<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">cyan</span> <span style="font-weight: bold; text-decoration: underline;">256</span>)))
               plain (<span style="font-weight: bold;">function</span> my-capture-file)
               ,(my-capture-heading-template <span style="font-style: italic;">"%&lt;%H:%M%#p&gt; - %|meeting|"</span>)
               <span style="font-weight: bold;">:file-name-format</span> ,my-roam-dailies-file-name
               <span style="font-weight: bold;">:file-header</span> ,my-roam-dailies-header
               <span style="font-weight: bold;">:clock-in</span> t
               <span style="font-weight: bold;">:kill-buffer</span> t
               <span style="font-weight: bold;">:empty-lines-after</span> <span style="font-weight: bold; text-decoration: underline;">2</span>
               <span style="font-weight: bold;">:olp</span> (<span style="font-style: italic;">"Meeting notes"</span>)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 358: </span>$DOOMDIR/share/capture/org-mode/capture-meeting</label><pre class="src src-snippet"><span style="font-weight: bold; font-style: italic;"># name: Notes from meetings</span>
<span style="font-weight: bold; font-style: italic;"># key: capture-meeting</span>
<span style="font-weight: bold; font-style: italic;"># --</span>
${<span style="font-weight: bold;">1</span>:Meeting topic<span style="font-weight: bold;">}</span>  `<span style="font-style: italic;">":meeting:"</span>`

*** Attendees
-`<span style="font-style: italic;">" "</span>`

*** Notes
- <span style="font-weight: bold;">$</span><span style="font-style: italic;">0</span>
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 359: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> org-capture
  (<span style="font-weight: bold;">appendq!</span> <span style="font-weight: bold; font-style: italic;">org-capture-templates</span>
            <span style="font-weight: bold;">`</span>((<span style="font-style: italic;">"dc"</span> ,(my-capture-description <span style="font-weight: bold;">:text</span> <span style="font-style: italic;">"Code review"</span> <span style="font-weight: bold;">:icon</span> <span style="font-weight: bold;">`</span>(review . ,(<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">green</span> <span style="font-weight: bold; text-decoration: underline;">256</span>)))
               plain (<span style="font-weight: bold;">function</span> my-capture-file)
               ,(my-capture-heading-template <span style="font-style: italic;">"%&lt;%H:%M%#p&gt; - %|cr|"</span>)
               <span style="font-weight: bold;">:file-name-format</span> ,my-roam-dailies-file-name
               <span style="font-weight: bold;">:file-header</span> ,my-roam-dailies-header
               <span style="font-weight: bold;">:clock-in</span> t
               <span style="font-weight: bold;">:kill-buffer</span> t
               <span style="font-weight: bold;">:empty-lines-after</span> <span style="font-weight: bold; text-decoration: underline;">2</span>
               <span style="font-weight: bold;">:olp</span> (<span style="font-style: italic;">"Meeting notes"</span>)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 360: </span>$DOOMDIR/share/capture/org-mode/capture-cr</label><pre class="src src-snippet"><span style="font-weight: bold; font-style: italic;"># name: New code review started</span>
<span style="font-weight: bold; font-style: italic;"># key: capture-cr</span>
<span style="font-weight: bold; font-style: italic;"># --</span>
Started code review for ${<span style="font-weight: bold;">1</span>:Coworker Name<span style="font-weight: bold;">}</span>  `<span style="font-style: italic;">":cr:"</span>`
- Review link: [[${<span style="font-weight: bold;">2</span>:url<span style="font-weight: bold;">}</span>][${<span style="font-weight: bold;">2</span>:$<span style="font-weight: bold;">$(</span>file-name-base yas-text)<span style="font-weight: bold;">}</span>]]
- <span style="font-weight: bold;">$</span><span style="font-style: italic;">0</span>
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 361: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> org-capture
  (<span style="font-weight: bold;">appendq!</span> <span style="font-weight: bold; font-style: italic;">org-capture-templates</span>
            <span style="font-weight: bold;">`</span>((<span style="font-style: italic;">"dv"</span> ,(my-capture-description <span style="font-weight: bold;">:text</span> <span style="font-style: italic;">"Interview"</span> <span style="font-weight: bold;">:icon</span> <span style="font-weight: bold;">`</span>(review . ,(<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">green</span> <span style="font-weight: bold; text-decoration: underline;">256</span>)))
               plain (<span style="font-weight: bold;">function</span> my-capture-file)
               ,(my-capture-heading-template <span style="font-style: italic;">"%&lt;%H:%M%#p&gt; - %|interview|"</span>)
               <span style="font-weight: bold;">:file-name-format</span> ,my-roam-dailies-file-name
               <span style="font-weight: bold;">:file-header</span> ,my-roam-dailies-header
               <span style="font-weight: bold;">:clock-in</span> t
               <span style="font-weight: bold;">:kill-buffer</span> t
               <span style="font-weight: bold;">:empty-lines-after</span> <span style="font-weight: bold; text-decoration: underline;">2</span>
               <span style="font-weight: bold;">:olp</span> (<span style="font-style: italic;">"Meeting notes"</span>)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 362: </span>$DOOMDIR/share/capture/org-mode/capture-interview</label><pre class="src src-snippet"><span style="font-weight: bold; font-style: italic;"># name: Notes for interview</span>
<span style="font-weight: bold; font-style: italic;"># key: capture-interview</span>
<span style="font-weight: bold; font-style: italic;"># --</span>
Interview with ${<span style="font-weight: bold;">1</span>:Candidate Name<span style="font-weight: bold;">}</span>  `<span style="font-style: italic;">":interview:"</span>`
:PROPERTIES:
:INTERVIEW_ID: ${<span style="font-weight: bold;">1</span>:<span style="font-weight: bold;">$(</span>file-name-base (car (s-split <span style="font-style: italic;">"?"</span> (url-filename (url-generic-parse-url yas-text)))))<span style="font-weight: bold;">}</span>
:URL: [[${<span style="font-weight: bold;">1</span>:$<span style="font-weight: bold;">$(</span><span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">or</span> yas-moving-away-p yas-modified-p)
  (<span style="font-weight: bold;">let</span> ((links (my-links-in-kill-ring)))
    (<span style="font-weight: bold;">if</span> links
        (<span style="font-weight: bold;">yas-auto-next</span>
          (completing-read <span style="font-style: italic;">"Choose the URL to link: "</span> links))
      <span style="font-style: italic;">"url"</span>)))<span style="font-weight: bold;">}</span>][Interview page]]
:FEEDBACK_URL: [[https://hire.amazon.com/interviews/${<span style="font-weight: bold;">1</span>:<span style="font-weight: bold;">$(</span>file-name-base (car (s-split <span style="font-style: italic;">"?"</span> (url-filename (url-generic-parse-url yas-text)))))<span style="font-weight: bold;">}</span>/feedback_vote][Feedback page]]
:END:

*** Notes
- <span style="font-weight: bold;">$</span><span style="font-style: italic;">0</span>

*** Evaluation
- Data points evaluated:
  | &#9744; Customer Obsession              | &#9744; Ownership            | &#9744; Invent and Simplify       |
  | &#9744; Are Right, A Lot                | &#9744; Learn and Be Curious | &#9744; Hire and Develop the Best |
  | &#9744; Insist on the Highest Standards | &#9744; Think Big            | &#9744; Bias for Action           |
  | &#9744; Frugality                       | &#9744; Earn Trust           | &#9744; Dive Deep                 |
  | &#9744; Have Backbone                   | &#9744; Disagree and Commit  | &#9744; Deliver Results           |
- Inclined:
  + [ ] Yes
    + [ ] Strongly inclined
  + [ ] No
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 363: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> org-capture
  (<span style="font-weight: bold;">appendq!</span> <span style="font-weight: bold; font-style: italic;">org-capture-templates</span>
            <span style="font-weight: bold;">`</span>((<span style="font-style: italic;">"di"</span> ,(my-capture-description <span style="font-weight: bold;">:text</span> <span style="font-style: italic;">"Idea"</span> <span style="font-weight: bold;">:icon</span> <span style="font-weight: bold;">`</span>(idea . ,(<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">yellow</span> <span style="font-weight: bold; text-decoration: underline;">256</span>)))
               plain (<span style="font-weight: bold;">function</span> my-capture-file)
               ,(my-capture-heading-template <span style="font-style: italic;">"%&lt;%H:%M%#p&gt; - %|idea|"</span>)
               <span style="font-weight: bold;">:file-name-format</span> ,my-roam-dailies-file-name
               <span style="font-weight: bold;">:file-header</span> ,my-roam-dailies-header
               <span style="font-weight: bold;">:kill-buffer</span> t
               <span style="font-weight: bold;">:empty-lines-after</span> <span style="font-weight: bold; text-decoration: underline;">1</span>
               <span style="font-weight: bold;">:olp</span> (<span style="font-style: italic;">"Ideas"</span>)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 364: </span>$DOOMDIR/share/capture/org-journal-mode/capture-idea</label><pre class="src src-snippet"><span style="font-weight: bold; font-style: italic;"># name: New Idea</span>
<span style="font-weight: bold; font-style: italic;"># key: capture-idea</span>
<span style="font-weight: bold; font-style: italic;"># --</span>
${<span style="font-weight: bold;">1</span>:Idea!<span style="font-weight: bold;">}</span>  :idea:
<span style="font-weight: bold;">$</span><span style="font-style: italic;">0</span>
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 365: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> org-capture
  (<span style="font-weight: bold;">appendq!</span> <span style="font-weight: bold; font-style: italic;">org-capture-templates</span>
            <span style="font-weight: bold;">`</span>((<span style="font-style: italic;">"dl"</span> ,(my-capture-description <span style="font-weight: bold;">:text</span> <span style="font-style: italic;">"Interesting link"</span> <span style="font-weight: bold;">:icon</span> <span style="font-weight: bold;">`</span>(globe . ,(<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">blue</span> <span style="font-weight: bold; text-decoration: underline;">256</span>)))
               plain (<span style="font-weight: bold;">function</span> my-capture-file)
               ,(my-capture-heading-template <span style="font-style: italic;">"%&lt;%H:%M%#p&gt; - %|link|"</span>)
               <span style="font-weight: bold;">:file-name-format</span> ,my-roam-dailies-file-name
               <span style="font-weight: bold;">:file-header</span> ,my-roam-dailies-header
               <span style="font-weight: bold;">:kill-buffer</span> t
               <span style="font-weight: bold;">:empty-lines-after</span> <span style="font-weight: bold; text-decoration: underline;">1</span>
               <span style="font-weight: bold;">:olp</span> (<span style="font-style: italic;">"Links"</span>)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 366: </span>$DOOMDIR/share/capture/org-journal-mode/capture-link</label><pre class="src src-snippet"><span style="font-weight: bold; font-style: italic;"># name: Interesting link</span>
<span style="font-weight: bold; font-style: italic;"># key: capture-link</span>
<span style="font-weight: bold; font-style: italic;"># --</span>
Check out ${<span style="font-weight: bold;">1</span>:Title<span style="font-weight: bold;">}</span>
- Link: ${<span style="font-weight: bold;">2</span>:url<span style="font-weight: bold;">}</span>
${<span style="font-weight: bold;">3</span>:- ${<span style="font-weight: bold;">4</span>:note<span style="font-weight: bold;">}}</span>
<span style="font-weight: bold;">$</span><span style="font-style: italic;">0</span>
</pre>
</div>
</div>
</li>

<li><a id="orgd9fdca2"></a>Journal entries<br />
<div class="outline-text-5" id="text-5-7-1-2">
<div class="org-src-container">
<pre class="src src-text">[s]     &#9679; New entry
[p]     &#9679; Past entry
--------------------------------------------------------------------------------
[q]     &#9679; Abort
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 367: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> org-capture
  (<span style="font-weight: bold;">appendq!</span> <span style="font-weight: bold; font-style: italic;">org-capture-templates</span>
            <span style="font-weight: bold;">`</span>((<span style="font-style: italic;">"j"</span>  ,(my-capture-description <span style="font-weight: bold;">:text</span> <span style="font-style: italic;">"Journal"</span> <span style="font-weight: bold;">:icon</span> <span style="font-weight: bold;">`</span>(journal . ,(<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">blue</span> <span style="font-weight: bold; text-decoration: underline;">256</span>))))
              (<span style="font-style: italic;">"jj"</span>  ,(my-capture-description <span style="font-weight: bold;">:text</span> <span style="font-style: italic;">"New entry"</span> <span style="font-weight: bold;">:icon</span> <span style="font-weight: bold;">`</span>(journal . ,(<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">green</span>)))
               plain (<span style="font-weight: bold;">function</span> my-capture-journal-file)
               ,(my-capture-heading-template <span style="font-style: italic;">"%&lt;%H:%M%#p&gt; - %?"</span>)
               <span style="font-weight: bold;">:empty-lines-after</span> <span style="font-weight: bold; text-decoration: underline;">1</span>
               <span style="font-weight: bold;">:kill-buffer</span> t)
              (<span style="font-style: italic;">"jp"</span> ,(my-capture-description <span style="font-weight: bold;">:text</span> <span style="font-style: italic;">"Past entry"</span> <span style="font-weight: bold;">:icon</span> <span style="font-weight: bold;">`</span>(history . ,(<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">violet</span> <span style="font-weight: bold; text-decoration: underline;">256</span>)))
               plain (<span style="font-weight: bold;">function</span> my-capture-journal-file-for-timestamp)
               ,(my-capture-heading-template <span style="font-style: italic;">"%&lt;%H:%M%#p&gt; - %?"</span>)
               <span style="font-weight: bold;">:time</span>
               <span style="font-weight: bold;">:empty-lines-after</span> <span style="font-weight: bold; text-decoration: underline;">1</span>
               <span style="font-weight: bold;">:kill-buffer</span> t))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 368: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-capture-journal-file-for-timestamp</span> ()
  <span style="font-style: italic;">"Asks user for a specific timestamp and returns the journal file for it. It also</span>
<span style="font-style: italic;">position the cursor on the correct place for a new entry, and adjust the capture</span>
<span style="font-style: italic;">frame width to `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">fill-column</span><span style="font-style: italic;">' before start editing."</span>
  (my-capture--adjust-frame)
  (my-journal/new-entry t nil <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-capture-timestamp</span>))
</pre>
</div>
</div>
</li>

<li><a id="org10d1ca3"></a>Tasks<br />
<div class="outline-text-5" id="text-5-7-1-3">
<div class="org-src-container">
<pre class="src src-text">[t]     &#9679; General task
[d]     &#9679; Task with deadline
[s]     &#9679; Scheduled task
--------------------------------------------------------------------------------
[q]     &#9679; Abort
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 369: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> org-capture
  (<span style="font-weight: bold;">appendq!</span> <span style="font-weight: bold; font-style: italic;">org-capture-templates</span>
            <span style="font-weight: bold;">`</span>((<span style="font-style: italic;">"t"</span>  ,(my-capture-description <span style="font-weight: bold;">:text</span> <span style="font-style: italic;">"Tasks"</span> <span style="font-weight: bold;">:icon</span> <span style="font-weight: bold;">`</span>(inbox . ,(<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">orange</span> <span style="font-weight: bold; text-decoration: underline;">256</span>))))
              (<span style="font-style: italic;">"tt"</span> ,(my-capture-description <span style="font-weight: bold;">:text</span> <span style="font-style: italic;">"New task"</span> <span style="font-weight: bold;">:icon</span> <span style="font-weight: bold;">`</span>(inbox . ,(<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">green</span> <span style="font-weight: bold; text-decoration: underline;">256</span>)))
               plain (file+function +org-tasks-file my-capture-position-cursor)
               ,(my-capture-heading-template <span style="font-style: italic;">"</span><span style="font-weight: bold;">TODO</span><span style="font-style: italic;"> %?"</span>)
               <span style="font-weight: bold;">:olp</span> (<span style="font-style: italic;">"To do /this week/"</span>)
               <span style="font-weight: bold;">:empty-lines-after</span> <span style="font-weight: bold; text-decoration: underline;">1</span>
               <span style="font-weight: bold;">:kill-buffer</span> t)
              (<span style="font-style: italic;">"td"</span> ,(my-capture-description <span style="font-weight: bold;">:text</span> <span style="font-style: italic;">"Task with deadline"</span> <span style="font-weight: bold;">:icon</span> <span style="font-weight: bold;">`</span>(timer . ,(<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">yellow</span> <span style="font-weight: bold; text-decoration: underline;">256</span>)))
               plain (file+function +org-tasks-file my-capture-position-cursor)
               ,(my-capture-heading-template <span style="font-style: italic;">"</span><span style="font-weight: bold;">TODO</span><span style="font-style: italic;"> %?\nDEADLINE: %(my-capture-time-read)"</span>)
               <span style="font-weight: bold;">:read-time</span> t
               <span style="font-weight: bold;">:read-time-label</span> <span style="font-style: italic;">"Deadline"</span>
               <span style="font-weight: bold;">:olp</span> (<span style="font-style: italic;">"Time bound tasks"</span>)
               <span style="font-weight: bold;">:empty-lines-after</span> <span style="font-weight: bold; text-decoration: underline;">1</span>
               <span style="font-weight: bold;">:kill-buffer</span> t)
              (<span style="font-style: italic;">"ts"</span> ,(my-capture-description <span style="font-weight: bold;">:text</span> <span style="font-style: italic;">"Scheduled task"</span> <span style="font-weight: bold;">:icon</span> <span style="font-weight: bold;">`</span>(calendar . ,(<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">orange</span> <span style="font-weight: bold; text-decoration: underline;">256</span>)))
               plain (file+function +org-tasks-file my-capture-position-cursor)
               ,(my-capture-heading-template <span style="font-style: italic;">"</span><span style="font-weight: bold;">TODO</span><span style="font-style: italic;"> %?\nSCHEDULED: %(my-capture-time-read)"</span>)
               <span style="font-weight: bold;">:read-time</span> t
               <span style="font-weight: bold;">:read-time-label</span> <span style="font-style: italic;">"Start time"</span>
               <span style="font-weight: bold;">:olp</span> (<span style="font-style: italic;">"Time bound tasks"</span>)
               <span style="font-weight: bold;">:empty-lines-after</span> <span style="font-weight: bold; text-decoration: underline;">1</span>
               <span style="font-weight: bold;">:kill-buffer</span> t))))
</pre>
</div>
</div>
</li>

<li><a id="orgfd87e65"></a>Contacts<br />
<div class="outline-text-5" id="text-5-7-1-4">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 370: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(after! org-capture</span>
<span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(appendq! org-capture-templates</span>
<span style="font-weight: bold; font-style: italic;">;;             </span><span style="font-weight: bold; font-style: italic;">`(("c" ,(my-capture-description :text "Contact" :icon `(contact-add . ,(doom-color 'yellow 256)))</span>
<span style="font-weight: bold; font-style: italic;">;;                </span><span style="font-weight: bold; font-style: italic;">plain (file+function +org-contacts-file my-capture-position-cursor)</span>
<span style="font-weight: bold; font-style: italic;">;;                </span><span style="font-weight: bold; font-style: italic;">,(my-capture-heading-template "* %|contact|\n\n")</span>
<span style="font-weight: bold; font-style: italic;">;;                </span><span style="font-weight: bold; font-style: italic;">:empty-lines-after 1</span>
<span style="font-weight: bold; font-style: italic;">;;                </span><span style="font-weight: bold; font-style: italic;">:kill-buffer t))))</span>
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 371: </span>$DOOMDIR/share/capture/org-mode/capture-contact</label><pre class="src src-snippet"><span style="font-weight: bold; font-style: italic;"># name: New Contact</span>
<span style="font-weight: bold; font-style: italic;"># key: capture-contact</span>
<span style="font-weight: bold; font-style: italic;"># --</span>
${<span style="font-weight: bold;">1</span>:Name<span style="font-weight: bold;">}</span>
:PROPERTIES:
:TYPE: ${<span style="font-weight: bold;">2</span>:$<span style="font-weight: bold;">$(</span><span style="font-weight: bold;">yas-auto-next</span> (yas-choose-value '(<span style="font-style: italic;">" person"</span> <span style="font-style: italic;">" company"</span>)))<span style="font-weight: bold;">}</span>
:${<span style="font-weight: bold;">2</span>:<span style="font-weight: bold;">$(</span><span style="font-weight: bold;">if</span> (string= yas-text <span style="font-style: italic;">" company"</span>) <span style="font-style: italic;">"CONTACT"</span> <span style="font-style: italic;">"COMPANY"</span>)<span style="font-weight: bold;">}</span>: ${<span style="font-weight: bold;">3</span>:Name<span style="font-weight: bold;">}</span>
${<span style="font-weight: bold;">2</span>:<span style="font-weight: bold;">$(</span><span style="font-weight: bold;">if</span> (string= yas-text <span style="font-style: italic;">" company"</span>) <span style="font-style: italic;">":TITLE: \n"</span> <span style="font-style: italic;">""</span>)<span style="font-weight: bold;">}</span>:PHONE: ${<span style="font-weight: bold;">4</span>:phone<span style="font-weight: bold;">}</span>
${<span style="font-weight: bold;">2</span>:<span style="font-weight: bold;">$(</span><span style="font-weight: bold;">if</span> (string= yas-text <span style="font-style: italic;">" company"</span>) <span style="font-style: italic;">""</span> <span style="font-style: italic;">":PHONE-W: \n"</span>)<span style="font-weight: bold;">}</span>:EMAIL: ${<span style="font-weight: bold;">5</span>:email<span style="font-weight: bold;">}</span>
:URL:
:ADDRESS:
:PICTURE:
:BIRTHDAY:
:LAST_READ_MAIL:
:END:

<span style="font-weight: bold;">$</span><span style="font-style: italic;">0</span>
</pre>
</div>
</div>
</li>

<li><a id="orgc8c1dc1"></a>Project notes<br />
<div class="outline-text-5" id="text-5-7-1-5">
<div class="org-src-container">
<pre class="src src-text">[t]     &#9679; New task
[d]     &#9679; Quick note
[s]     &#9679; New changelog
--------------------------------------------------------------------------------
[q]     &#9679; Abort
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 372: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> org-capture
  (<span style="font-weight: bold;">appendq!</span> <span style="font-weight: bold; font-style: italic;">org-capture-templates</span>
            <span style="font-weight: bold;">`</span>((<span style="font-style: italic;">"p"</span>  ,(my-capture-description <span style="font-weight: bold;">:text</span> <span style="font-style: italic;">"Projct"</span> <span style="font-weight: bold;">:icon</span> <span style="font-weight: bold;">`</span>(project . ,(<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">violet</span> <span style="font-weight: bold; text-decoration: underline;">256</span>))))
              (<span style="font-style: italic;">"pt"</span> ,(my-capture-description <span style="font-weight: bold;">:text</span> <span style="font-style: italic;">"New task"</span> <span style="font-weight: bold;">:icon</span> <span style="font-weight: bold;">`</span>(checklist . ,(<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">green</span> <span style="font-weight: bold; text-decoration: underline;">256</span>)))
               entry (file+headline my-capture-project-notes-file-wrapper <span style="font-style: italic;">"Tasks"</span>)
               ,(<span style="font-weight: bold; text-decoration: underline;">concat</span> <span style="font-style: italic;">"* </span><span style="font-weight: bold;">TODO</span><span style="font-style: italic;"> %?\n"</span>
                        <span style="font-style: italic;">"%(my-capture-template-selection)"</span>)
               <span style="font-weight: bold;">:empty-lines-after</span> <span style="font-weight: bold; text-decoration: underline;">1</span>
               <span style="font-weight: bold;">:kill-buffer</span> t)
              (<span style="font-style: italic;">"pn"</span> ,(my-capture-description <span style="font-weight: bold;">:text</span> <span style="font-style: italic;">"Quick note"</span> <span style="font-weight: bold;">:icon</span> <span style="font-weight: bold;">`</span>(postit . ,(<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">yellow</span> <span style="font-weight: bold; text-decoration: underline;">256</span>)))
               entry (file+headline my-capture-project-notes-file-wrapper <span style="font-style: italic;">"Notes"</span>)
               ,(<span style="font-weight: bold; text-decoration: underline;">concat</span> <span style="font-style: italic;">"* %U %?\n"</span>
                        <span style="font-style: italic;">"%(my-capture-template-selection)"</span>)
               <span style="font-weight: bold;">:empty-lines-after</span> <span style="font-weight: bold; text-decoration: underline;">1</span>
               <span style="font-weight: bold;">:kill-buffer</span> t)
              (<span style="font-style: italic;">"pc"</span> ,(my-capture-description <span style="font-weight: bold;">:text</span> <span style="font-style: italic;">"New changelog"</span> <span style="font-weight: bold;">:icon</span> <span style="font-weight: bold;">`</span>(list . ,(<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">violet</span> <span style="font-weight: bold; text-decoration: underline;">256</span>)))
               item (<span style="font-weight: bold;">function</span> my-capture-project-changelog-file-with-headings)
               <span style="font-style: italic;">"- %?"</span>
               <span style="font-weight: bold;">:prepend</span> t
               <span style="font-weight: bold;">:empty-lines-before</span> <span style="font-weight: bold; text-decoration: underline;">1</span>
               <span style="font-weight: bold;">:kill-buffer</span> t))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 373: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-capture-project-notes-file-wrapper</span> ()
  <span style="font-style: italic;">"Returns an org file to hold notes and tasks for the current</span>
<span style="font-style: italic;">  project."</span>
  (my-capture--adjust-frame)
  (<span style="font-weight: bold;">+org-capture-project-notes-file</span>))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 374: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-capture-project-changelog-file-with-headings</span> ()
  (<span style="font-weight: bold;">let</span> ((entry-path (<span style="font-weight: bold;">+org-capture-project-changelog-file</span>))
        (<span style="font-weight: bold; font-style: italic;">org-complex-heading-regexp-format</span> <span style="font-style: italic;">"\\* %s"</span>))
    (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold; text-decoration: underline;">file-exists-p</span> entry-path)
      (<span style="font-weight: bold;">make-empty-file</span> entry-path t))
    (<span style="font-weight: bold;">find-file</span> entry-path)
    (<span style="font-weight: bold; text-decoration: underline;">goto-char</span> (<span style="font-weight: bold; text-decoration: underline;">point-min</span>))
    (my-capture--ensure-heading-prepend (my-capture-project-target-heading))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 375: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-capture-project-target-heading</span> ()
  <span style="font-weight: bold;">`</span>(<span style="font-style: italic;">"Unreleased"</span> ,(<span style="font-weight: bold; text-decoration: underline;">format-time-string</span> <span style="font-style: italic;">"%A, %B %-e, %Y"</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 376: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-capture--ensure-heading-prepend</span> (headings <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> initial-level)
  (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">not</span> headings)
      (<span style="font-weight: bold; text-decoration: underline;">widen</span>)
    (<span style="font-weight: bold;">let</span> ((initial-level (<span style="font-weight: bold;">or</span> initial-level <span style="font-weight: bold; text-decoration: underline;">1</span>)))
      (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold; text-decoration: underline;">re-search-forward</span> (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-weight: bold; font-style: italic;">org-complex-heading-regexp-format</span>
                                          (<span style="font-weight: bold; text-decoration: underline;">regexp-quote</span> (<span style="font-weight: bold; text-decoration: underline;">car</span> headings)))
                                  nil t)
               (<span style="font-weight: bold; text-decoration: underline;">=</span> (<span style="font-weight: bold;">org-current-level</span>) initial-level))
          (<span style="font-weight: bold;">progn</span>
            (<span style="font-weight: bold; text-decoration: underline;">message</span> <span style="font-style: italic;">"Found heading '%s'"</span> (<span style="font-weight: bold; text-decoration: underline;">car</span> headings))
            (<span style="font-weight: bold; text-decoration: underline;">beginning-of-line</span>)
            (<span style="font-weight: bold;">org-narrow-to-subtree</span>))
        (<span style="font-weight: bold; text-decoration: underline;">message</span> <span style="font-style: italic;">"Could not find heading '%s'"</span> (<span style="font-weight: bold; text-decoration: underline;">car</span> headings))
        (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">=</span> initial-level <span style="font-weight: bold; text-decoration: underline;">1</span>)
            (<span style="font-weight: bold; text-decoration: underline;">goto-char</span> (<span style="font-weight: bold; text-decoration: underline;">point-max</span>))
          (<span style="font-weight: bold; text-decoration: underline;">end-of-line</span>))
        (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold; text-decoration: underline;">bolp</span>) (<span style="font-weight: bold; text-decoration: underline;">eolp</span>)) (<span style="font-weight: bold; text-decoration: underline;">insert</span> <span style="font-style: italic;">"\n"</span>))
        (<span style="font-weight: bold; text-decoration: underline;">insert</span> (<span style="font-weight: bold; text-decoration: underline;">make-string</span> initial-level ?*) <span style="font-style: italic;">" "</span> (<span style="font-weight: bold; text-decoration: underline;">car</span> headings) <span style="font-style: italic;">"\n"</span>))
      (my-capture--ensure-heading-prepend (<span style="font-weight: bold; text-decoration: underline;">cdr</span> headings) (<span style="font-weight: bold; text-decoration: underline;">1+</span> initial-level)))))
</pre>
</div>
</div>
</li>

<li><a id="org88500be"></a>Finalize capture templates<br />
<div class="outline-text-5" id="text-5-7-1-6">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 377: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defadvice!</span> my-org-capture-select-template-prettier-a (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> keys)
  <span style="font-style: italic;">"Select a capture template, in a prettier way than default Lisp programs can</span>
<span style="font-style: italic;">force the template by setting KEYS to a string."</span>
  <span style="font-weight: bold;">:override</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">org-capture-select-template</span>
  (<span style="font-weight: bold;">let</span> ((<span style="font-weight: bold; font-style: italic;">org-capture-templates</span>
         (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">org-contextualize-keys</span> (<span style="font-weight: bold;">org-capture-upgrade-templates</span> <span style="font-weight: bold; font-style: italic;">org-capture-templates</span>)
                                     <span style="font-weight: bold; font-style: italic;">org-capture-templates-contexts</span>)
             <span style="font-weight: bold;">'</span>((<span style="font-style: italic;">"t"</span> <span style="font-style: italic;">"Task"</span>
                entry (file+headline <span style="font-style: italic;">""</span> <span style="font-style: italic;">"Tasks"</span>)
                <span style="font-style: italic;">"* </span><span style="font-weight: bold;">TODO</span><span style="font-style: italic;"> %?\n  %u\n  %a"</span>)))))
    (<span style="font-weight: bold;">if</span> keys
        (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold; text-decoration: underline;">assoc</span> keys <span style="font-weight: bold; font-style: italic;">org-capture-templates</span>)
            (<span style="font-weight: bold;">error</span> <span style="font-style: italic;">"No capture template referred to by \"%s\" keys"</span> keys))
      (<span style="font-weight: bold;">org-mks</span> <span style="font-weight: bold; font-style: italic;">org-capture-templates</span>
               (<span style="font-weight: bold; text-decoration: underline;">propertize</span> (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">+org-capture-frame-p</span>)
                               (<span style="font-weight: bold; text-decoration: underline;">concat</span> (<span style="font-weight: bold;">s-center</span> <span style="font-weight: bold; text-decoration: underline;">50</span> <span style="font-style: italic;">"Doom Capture"</span>) <span style="font-style: italic;">"\n"</span>
                                       (<span style="font-weight: bold;">s-center</span> <span style="font-weight: bold; text-decoration: underline;">50</span> <span style="font-style: italic;">"&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;"</span>))
                             (<span style="font-weight: bold; text-decoration: underline;">concat</span> <span style="font-style: italic;">"Doom Capture\n"</span>
                                     <span style="font-style: italic;">"&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;"</span>))
                           <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">face</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">font-lock-type-face</span>)
               <span style="font-style: italic;">" "</span>
               <span style="font-weight: bold;">`</span>((<span style="font-style: italic;">"q"</span> ,(my-capture-description <span style="font-weight: bold;">:text</span> <span style="font-style: italic;">"Abort"</span> <span style="font-weight: bold;">:icon</span> <span style="font-weight: bold;">`</span>(stop . ,(<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">red</span> <span style="font-weight: bold; text-decoration: underline;">256</span>)))))))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 378: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defadvice!</span> my-org-capture-mks-prettier-a (table title <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> prompt specials)
  <span style="font-style: italic;">"Select a member of an alist with multiple keys. Prettified.</span>

<span style="font-style: italic;">TABLE is the alist which should contain entries where the car is a string. There</span>
<span style="font-style: italic;">should be two types of entries.</span>

<span style="font-style: italic;">1. prefix descriptions like (\"a\" \"Description\") This indicates that `a' is a</span>
<span style="font-style: italic;">   prefix key for multi-letter selection, and that there are entries following</span>
<span style="font-style: italic;">   with keys like \"ab\", \"ax\"&#8230;</span>

<span style="font-style: italic;">2. Select-able members must have more than two elements, with the first being</span>
<span style="font-style: italic;">   the string of keys that lead to selecting it, and the second a short</span>
<span style="font-style: italic;">   description string of the item.</span>

<span style="font-style: italic;">The command will then make a temporary buffer listing all entries that can be</span>
<span style="font-style: italic;">selected with a single key, and all the single key prefixes. When you press the</span>
<span style="font-style: italic;">key for a single-letter entry, it is selected. When you press a prefix key, the</span>
<span style="font-style: italic;">commands (and maybe further prefixes) under this key will be shown and offered</span>
<span style="font-style: italic;">for selection.</span>

<span style="font-style: italic;">TITLE will be placed over the selection in the temporary buffer, PROMPT will be</span>
<span style="font-style: italic;">used when prompting for a key. SPECIALS is an alist with (\"key\"</span>
<span style="font-style: italic;">\"description\") entries. When one of these is selected, only the bare key is</span>
<span style="font-style: italic;">returned."</span>
  <span style="font-weight: bold;">:override</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">org-mks</span>
  (<span style="font-weight: bold;">save-window-excursion</span>
    (<span style="font-weight: bold;">let</span> ((<span style="font-weight: bold; font-style: italic;">inhibit-quit</span> t)
          (buffer (<span style="font-weight: bold;">org-switch-to-buffer-other-window</span> <span style="font-style: italic;">"*Org Select*"</span>))
          (prompt (<span style="font-weight: bold;">or</span> prompt <span style="font-style: italic;">"Select: "</span>))
          <span style="font-weight: bold; font-style: italic;">case-fold-search</span>
          current)
      (<span style="font-weight: bold;">unwind-protect</span>
          (<span style="font-weight: bold;">catch</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">exit</span>
            (<span style="font-weight: bold;">while</span> t
              (<span style="font-weight: bold; text-decoration: underline;">erase-buffer</span>)
              (<span style="font-weight: bold; text-decoration: underline;">insert</span> title <span style="font-style: italic;">"\n\n"</span>)
              (<span style="font-weight: bold;">let</span> ((original-evil-normal-state-cursor <span style="font-weight: bold; font-style: italic;">evil-normal-state-cursor</span>)
                    (des-keys nil)
                    (allowed-keys <span style="font-weight: bold;">'</span>(<span style="font-style: italic;">"\C-g"</span>))
                    (tab-alternatives <span style="font-weight: bold;">'</span>(<span style="font-style: italic;">"\s"</span> <span style="font-style: italic;">"\t"</span> <span style="font-style: italic;">"\r"</span>))
                    (<span style="font-weight: bold; font-style: italic;">cursor-type</span> nil))
                (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">evil-normal-state-cursor</span> (<span style="font-weight: bold; text-decoration: underline;">list</span> nil))
                <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Populate allowed keys and descriptions keys</span>
                <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">available with CURRENT selector.</span>
                (<span style="font-weight: bold;">let</span> ((re (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"\\`%s</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">\\'"</span>
                                  (<span style="font-weight: bold;">if</span> current (<span style="font-weight: bold; text-decoration: underline;">regexp-quote</span> current) <span style="font-style: italic;">""</span>))))
                  (<span style="font-weight: bold;">dolist</span> (entry table)
                    (<span style="font-weight: bold;">pcase</span> entry
                      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Description.</span>
                      (<span style="font-weight: bold;">`</span>(,(<span style="font-weight: bold;">and</span> key (pred (<span style="font-weight: bold; text-decoration: underline;">string-match</span> re))) ,desc)
                       (<span style="font-weight: bold;">let</span> ((k (<span style="font-weight: bold;">match-string</span> <span style="font-weight: bold; text-decoration: underline;">1</span> key)))
                         (<span style="font-weight: bold;">push</span> k des-keys)
                         <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Keys ending in tab, space or RET are equivalent.</span>
                         (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">member</span> k tab-alternatives)
                             (<span style="font-weight: bold;">push</span> <span style="font-style: italic;">"\t"</span> allowed-keys)
                           (<span style="font-weight: bold;">push</span> k allowed-keys))
                         (<span style="font-weight: bold; text-decoration: underline;">insert</span> (my-capture--item-entry k desc current t) <span style="font-style: italic;">"\n"</span>)))
                      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Usable entry.</span>
                      (<span style="font-weight: bold;">`</span>(,(<span style="font-weight: bold;">and</span> key (pred (<span style="font-weight: bold; text-decoration: underline;">string-match</span> re))) ,desc . ,_)
                       (<span style="font-weight: bold;">let</span> ((k (<span style="font-weight: bold;">match-string</span> <span style="font-weight: bold; text-decoration: underline;">1</span> key)))
                         (<span style="font-weight: bold; text-decoration: underline;">insert</span> (my-capture--item-entry k desc current) <span style="font-style: italic;">"\n"</span>)
                         (<span style="font-weight: bold;">push</span> k allowed-keys)))
                      (_ nil))))
                <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Insert special entries, if any.</span>
                (<span style="font-weight: bold;">when</span> specials
                  (<span style="font-weight: bold; text-decoration: underline;">insert</span> <span style="font-style: italic;">"\n"</span>)
                  (<span style="font-weight: bold;">pcase-dolist</span> (<span style="font-weight: bold;">`</span>(,key ,description) specials)
                    (<span style="font-weight: bold; text-decoration: underline;">insert</span> (my-capture--item-entry key
                                                      description
                                                      (<span style="font-weight: bold;">when</span> current
                                                        (<span style="font-weight: bold;">s-repeat</span> (<span style="font-weight: bold; text-decoration: underline;">length</span> current) <span style="font-style: italic;">" "</span>))
                                                      nil
                                                      <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">all-the-icons-red</span>))
                    (<span style="font-weight: bold;">push</span> key allowed-keys)))
                <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Display UI and let user select an entry or</span>
                <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">a sub-level prefix.</span>
                (<span style="font-weight: bold; text-decoration: underline;">goto-char</span> (<span style="font-weight: bold; text-decoration: underline;">point-min</span>))
                (my-capture--refresh-capture-frame)
                (<span style="font-weight: bold;">let</span> ((pressed (<span style="font-weight: bold;">org--mks-read-key</span>
                                allowed-keys prompt
                                (<span style="font-weight: bold; text-decoration: underline;">not</span> (<span style="font-weight: bold; text-decoration: underline;">pos-visible-in-window-p</span> (<span style="font-weight: bold; text-decoration: underline;">1-</span> (<span style="font-weight: bold; text-decoration: underline;">point-max</span>)))))))
                  (<span style="font-weight: bold;">set-frame-name</span> (<span style="font-weight: bold;">alist-get</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">name</span> <span style="font-weight: bold; font-style: italic;">+org-capture-frame-parameters</span>))
                  (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">evil-normal-state-cursor</span> original-evil-normal-state-cursor)
                  (<span style="font-weight: bold;">setq</span> current (<span style="font-weight: bold; text-decoration: underline;">concat</span> current pressed))
                  (<span style="font-weight: bold;">cond</span>
                   ((<span style="font-weight: bold; text-decoration: underline;">equal</span> pressed <span style="font-style: italic;">"\C-g"</span>) (<span style="font-weight: bold;">user-error</span> <span style="font-style: italic;">"Abort"</span>))
                   <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Selection is a prefix: open a new menu.</span>
                   ((<span style="font-weight: bold; text-decoration: underline;">member</span> pressed des-keys))
                   <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Selection matches an association: return it.</span>
                   ((<span style="font-weight: bold;">let</span> ((entry (<span style="font-weight: bold; text-decoration: underline;">assoc</span> current table)))
                      (<span style="font-weight: bold;">and</span> entry (<span style="font-weight: bold; text-decoration: underline;">throw</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">exit</span> entry))))
                   <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Selection matches a special entry: return the</span>
                   <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">selection prefix.</span>
                   ((<span style="font-weight: bold; text-decoration: underline;">assoc</span> current specials) (<span style="font-weight: bold; text-decoration: underline;">throw</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">exit</span> current))
                   (t (<span style="font-weight: bold;">error</span> <span style="font-style: italic;">"No entry available"</span>)))))))
        (<span style="font-weight: bold;">when</span> buffer
          (<span style="font-weight: bold; text-decoration: underline;">kill-buffer</span> buffer))))))

</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 379: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-capture--item-entry</span> (key description <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> prefix parent-option-p key-face-extras)
  <span style="font-style: italic;">"Returns a string representing an Org Capture item with the given KEY and</span>
<span style="font-style: italic;">DESCRIPTION.</span>

<span style="font-style: italic;">PREFIX is the character sequences already pressed during the capture process.</span>

<span style="font-style: italic;">If PARENT-OPTION-P is non-nil, it means the this entry has sub-entries and some</span>
<span style="font-style: italic;">sort of indication should be displayed</span>

<span style="font-style: italic;">The KEY-FACE-EXTRAS is one or more simbols to be added to the KEY face on the</span>
<span style="font-style: italic;">entry."</span>
  (<span style="font-weight: bold;">let</span> ((parent-option-p (<span style="font-weight: bold;">when</span> parent-option-p <span style="font-style: italic;">"&#8250;"</span>))
        (prefix (<span style="font-weight: bold;">when</span> prefix (<span style="font-weight: bold; text-decoration: underline;">concat</span> prefix <span style="font-style: italic;">" "</span>))))
    (<span style="font-weight: bold; text-decoration: underline;">concat</span>
     (<span style="font-weight: bold;">when</span> prefix (<span style="font-weight: bold; text-decoration: underline;">propertize</span> prefix <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">face</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">font-lock-comment-face</span>))
     (<span style="font-weight: bold; text-decoration: underline;">propertize</span> key <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">face</span> (<span style="font-weight: bold; text-decoration: underline;">append</span> <span style="font-weight: bold;">'</span>(bold) key-face-extras))
     (<span style="font-weight: bold; text-decoration: underline;">propertize</span> (<span style="font-weight: bold;">or</span> parent-option-p <span style="font-style: italic;">" "</span>) <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">face</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">font-lock-comment-face</span>)
     <span style="font-style: italic;">"  "</span> description (<span style="font-weight: bold;">when</span> parent-option-p <span style="font-style: italic;">"&#8230;"</span>))))

</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 380: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-capture--refresh-capture-frame</span> ()
  <span style="font-style: italic;">"This function is called right after all the capture options were written in the</span>
<span style="font-style: italic;">capture buffer."</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">+org-capture-frame-p</span>)
    (<span style="font-weight: bold;">let</span> ((frame (<span style="font-weight: bold; text-decoration: underline;">selected-frame</span>)))
    (<span style="font-weight: bold;">set-frame-parameter</span> frame <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">left-fringe</span> <span style="font-weight: bold; text-decoration: underline;">30</span>)
    (<span style="font-weight: bold;">set-frame-parameter</span> frame <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">right-fringe</span> <span style="font-weight: bold; text-decoration: underline;">30</span>)
    (<span style="font-weight: bold;">set-frame-name</span> <span style="font-style: italic;">" "</span>)
    (<span style="font-weight: bold; text-decoration: underline;">set-frame-size</span> frame
                    my-capture--menu-width
                    (<span style="font-weight: bold; text-decoration: underline;">+</span> (<span style="font-weight: bold;">line-number-at-pos</span> (<span style="font-weight: bold; text-decoration: underline;">point-max</span>)) <span style="font-weight: bold; text-decoration: underline;">3</span>))
    (my-capture--reposition-frame)
    (<span style="font-weight: bold; text-decoration: underline;">message</span> <span style="font-style: italic;">""</span>))))
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-org05e33df" class="outline-4">
<h4 id="org05e33df"><span class="section-number-4">5.7.2</span> Journal</h4>
<div class="outline-text-4" id="text-5-7-2">
<p>
TBD
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 381: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> my-journal-file-format <span style="font-style: italic;">"journal-%Y.org"</span>)

(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">my-journal-file</span> (<span style="font-weight: bold; text-decoration: underline;">expand-file-name</span> (<span style="font-weight: bold; text-decoration: underline;">format-time-string</span> my-journal-file-format)
                                              my-journal-directory))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 382: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> org-journal
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> org-journal-encrypt-journal nil
        org-journal-carryover-delete-empty-journal <span style="font-weight: bold;">'</span>(ask)
        org-journal-carryover-items <span style="font-style: italic;">"</span><span style="font-weight: bold;">TODO</span><span style="font-style: italic;">=\"STRT\"|</span><span style="font-weight: bold;">TODO</span><span style="font-style: italic;">=\"HOLD\"|</span><span style="font-weight: bold;">TODO</span><span style="font-style: italic;">=\"WAIT\"|</span><span style="font-weight: bold;">TODO</span><span style="font-style: italic;">=\"DELG\""</span>
        <span style="font-weight: bold; font-style: italic;">org-extend-today-until</span> <span style="font-weight: bold; text-decoration: underline;">4</span>
        org-journal-file-type <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">yearly</span>
        org-journal-enable-agenda-integration nil
        org-journal-file-format my-journal-file-format
        org-journal-date-format <span style="font-style: italic;">"%A, %B %-e, %Y"</span>
        org-journal-time-format <span style="font-style: italic;">"%H:%M%#p - "</span>
        org-journal-time-format-post-midnight <span style="font-style: italic;">"+%H:%M%#p - "</span>
                            org-journal-file-header (<span style="font-weight: bold; text-decoration: underline;">concat</span> <span style="font-style: italic;">"#+TITLE: Daily Journal for %Y (%Z)\n"</span>
                                        <span style="font-style: italic;">"#+STARTUP: overview\n"</span>
                                        <span style="font-style: italic;">"#+CATEGORY: journal\n"</span>
                                        <span style="font-style: italic;">"\n"</span>))

  (<span style="font-weight: bold;">font-lock-add-keywords</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">org-journal-mode</span> my-org-font-lock-beautify-keywords)
  (<span style="font-weight: bold; text-decoration: underline;">set-window-buffer</span> nil (<span style="font-weight: bold; text-decoration: underline;">current-buffer</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 383: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-journal/new-entry</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> prefix add-header-p variable make-local)
  <span style="font-style: italic;">"Open a journal file and start a new entry. Without any arguments, this function</span>
<span style="font-style: italic;">is equivalent to calling `(org-journal-new-entry t)'</span>

<span style="font-style: italic;">With PREFIX argumant, request the journal timestamp to the user.</span>

<span style="font-style: italic;">If ADD-HEADER-P is non-nil, fully create the new entry (this is equivalent</span>
<span style="font-style: italic;">to `(not PREFIX)' on the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-journal-new-entry</span><span style="font-style: italic;">').</span>

<span style="font-style: italic;">VARIABLE is a string that, when set, will store the timestamp value selected by</span>
<span style="font-style: italic;">the user. This function ignores this argument if PREFIX is nil.</span>

<span style="font-style: italic;">When MAKE-LOCAL is a non-nil value, this function uses VARIABLE to create a</span>
<span style="font-style: italic;">local variable. If PREFIX or VARIABLE is nil, this argument has no effect."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (<span style="font-weight: bold;">when</span> make-local
    (<span style="font-weight: bold; text-decoration: underline;">make-local-variable</span> variable))
  (<span style="font-weight: bold;">org-journal-new-entry</span> (<span style="font-weight: bold; text-decoration: underline;">not</span> add-header-p)
                         (<span style="font-weight: bold;">when</span> variable
                           (<span style="font-weight: bold; text-decoration: underline;">set</span> variable
                                (<span style="font-weight: bold;">when</span> prefix
                                  (<span style="font-weight: bold;">org-read-date</span> t t nil <span style="font-style: italic;">"New entry"</span>))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org34cd684" class="outline-4">
<h4 id="org34cd684"><span class="section-number-4">5.7.3</span> Zettelkasten</h4>
<div class="outline-text-4" id="text-5-7-3">
<ul class="org-ul">
<li><a href="https://tecosaur.github.io/emacs-config/config.html#basic-settings">https://tecosaur.github.io/emacs-config/config.html#basic-settings</a></li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 384: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">package!</span> org-roam <span style="font-weight: bold;">:disable</span> t)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 385: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> org-roam
  <span style="font-weight: bold;">:commands</span> (<span style="font-weight: bold;">org-roam-capture</span>)
  <span style="font-weight: bold;">:custom</span>
  (<span style="font-weight: bold; font-style: italic;">org-roam-capture-templates</span>
   <span style="font-weight: bold;">'</span>((<span style="font-style: italic;">"d"</span> <span style="font-style: italic;">"default"</span> plain (<span style="font-weight: bold;">function</span> org-roam-capture--get-point)
      <span style="font-style: italic;">"%?"</span>
      <span style="font-weight: bold;">:file-name</span> <span style="font-style: italic;">"%(s-trim-right (shell-command-to-string \"uuidgen\"))"</span>
      <span style="font-weight: bold;">:head</span> <span style="font-style: italic;">"#+TITLE: ${title}\n#+ROAM_TAGS: \n\n"</span>
      <span style="font-weight: bold;">:unnarrowed</span> t)))
  (<span style="font-weight: bold; font-style: italic;">org-roam-capture-ref-templates</span>
   <span style="font-weight: bold;">'</span>((<span style="font-style: italic;">"r"</span> <span style="font-style: italic;">"ref"</span> plain (<span style="font-weight: bold;">function</span> org-roam-capture--get-point)
      <span style="font-style: italic;">"\n#+BEGIN_QUOTE\n${selection}\n#+END_QUOTE\n\n%?\n\n* See Also\n\n- source :: ${ref}\n"</span>
      <span style="font-weight: bold;">:file-name</span> <span style="font-style: italic;">"websites/%(s-trim-right (shell-command-to-string \"uuidgen\"))-${slug}"</span>
      <span style="font-weight: bold;">:head</span> <span style="font-style: italic;">"#+TITLE: ${title}\n#+ROAM_TAGS: \n#+ROAM_KEY: ${ref}\n"</span>
      <span style="font-weight: bold;">:unnarrowed</span> t))))

(<span style="font-weight: bold;">after!</span> org-roam
  (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">org-roam-link-title-format</span> <span style="font-style: italic;">"&#10001; %s"</span>
        <span style="font-weight: bold; font-style: italic;">org-roam-graph-extra-config</span> <span style="font-weight: bold;">'</span>((<span style="font-style: italic;">"overlap"</span> . <span style="font-style: italic;">"false"</span>))
        <span style="font-weight: bold; font-style: italic;">org-roam-encrypt-files</span> nil
        <span style="font-weight: bold; font-style: italic;">org-roam-directory</span> my-notes-directory)

  (<span style="font-weight: bold;">advice-add</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">org-roam-dailies-capture-yesterday</span> <span style="font-weight: bold;">:filter-return</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+org-capture-open-frame-get-info-a</span>)
  (<span style="font-weight: bold;">advice-add</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">org-roam-dailies-capture-today</span> <span style="font-weight: bold;">:filter-return</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+org-capture-open-frame-get-info-a</span>)
  (<span style="font-weight: bold;">advice-add</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">org-roam-dailies-capture-tomorrow</span> <span style="font-weight: bold;">:filter-return</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+org-capture-open-frame-get-info-a</span>)
  (<span style="font-weight: bold;">advice-add</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">org-roam-dailies-capture-date</span> <span style="font-weight: bold;">:filter-return</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+org-capture-open-frame-get-info-a</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org00c9305" class="outline-4">
<h4 id="org00c9305"><span class="section-number-4">5.7.4</span> Deft</h4>
<div class="outline-text-4" id="text-5-7-4">
<p>
TBD
</p>
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 386: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> deft-directory my-notes-directory
      deft-strip-summary-regexp (<span style="font-weight: bold; text-decoration: underline;">concat</span> <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">"</span>
                                        <span style="font-style: italic;">"[\n\t]"</span>                    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">blank</span>
                                        <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">^#\\+[[:upper:]_]+:.*$"</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">org-mode metadata</span>
                                        <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span>)
      deft-time-format <span style="font-style: italic;">"  %A, %B %e %Y (%H:%M)"</span>)

(<span style="font-weight: bold;">add-hook!</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">deft-mode-hook</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-deft-buffer-config-h</span> ()
    (<span style="font-weight: bold; font-style: italic;">hl-line-mode</span> <span style="font-weight: bold; text-decoration: underline;">1</span>)
    (<span style="font-weight: bold;">setq-local</span> <span style="font-weight: bold; font-style: italic;">evil-normal-state-cursor</span> (<span style="font-weight: bold; text-decoration: underline;">list</span> nil)
                <span style="font-weight: bold; font-style: italic;">evil-insert-state-cursor</span> (<span style="font-weight: bold; text-decoration: underline;">list</span> nil))))

(<span style="font-weight: bold;">map!</span> <span style="font-weight: bold;">:after</span> deft
      (<span style="font-weight: bold;">:map</span> deft-mode-map
       <span style="font-weight: bold;">:i</span>   <span style="font-style: italic;">"&lt;escape&gt;"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">kill-current-buffer</span>
       <span style="font-weight: bold;">:i</span>   <span style="font-style: italic;">"C-c C-q"</span>  <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">kill-current-buffer</span>
       <span style="font-weight: bold;">:i</span>   <span style="font-style: italic;">"C-j"</span>      <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">widget-forward</span>
       <span style="font-weight: bold;">:i</span>   <span style="font-style: italic;">"C-k"</span>      <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">widget-backward</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9a069e0" class="outline-4">
<h4 id="org9a069e0"><span class="section-number-4">5.7.5</span> Utilities</h4>
<div class="outline-text-4" id="text-5-7-5">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 387: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-notes-add-action-item</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold; text-decoration: underline;">call-interactively</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">+org/insert-item-below</span>)
  (<span style="font-weight: bold; text-decoration: underline;">insert</span> <span style="font-style: italic;">"Action Items"</span>)
  (<span style="font-weight: bold; text-decoration: underline;">call-interactively</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">org-insert-subheading</span>)
  (<span style="font-weight: bold; text-decoration: underline;">insert</span> <span style="font-style: italic;">"</span><span style="font-weight: bold;">TODO</span><span style="font-style: italic;"> "</span>))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 388: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">map!</span> <span style="font-weight: bold;">:after</span> org
      (<span style="font-weight: bold;">:map</span> <span style="font-weight: bold; font-style: italic;">org-mode-map</span>
       <span style="font-weight: bold;">:leader</span>
       (<span style="font-weight: bold;">:prefix</span> (<span style="font-style: italic;">"n"</span> . <span style="font-style: italic;">"notes"</span>)
        (<span style="font-weight: bold;">:prefix</span> (<span style="font-style: italic;">"i"</span> . <span style="font-style: italic;">"notes-insert"</span>)
         <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Insert action items"</span>  <span style="font-style: italic;">"a"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-notes-add-action-item</span>))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 389: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> plantuml-mode
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">setq</span> plantuml-jar-path <span style="font-style: italic;">"/usr/local/var/homebrew/linked/plantuml/libexec/plantuml.jar"</span>
        org-plantuml-jar-path plantuml-jar-path)
  (<span style="font-weight: bold;">set-popup-rule!</span> <span style="font-style: italic;">"^\\*PLANTUML"</span> <span style="font-weight: bold;">:size</span> <span style="font-weight: bold; text-decoration: underline;">0.4</span> <span style="font-weight: bold;">:side</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">right</span> <span style="font-weight: bold;">:select</span> nil <span style="font-weight: bold;">:ttl</span> <span style="font-weight: bold; text-decoration: underline;">0</span>))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org212c046" class="outline-3">
<h3 id="org212c046"><span class="section-number-3">5.8</span> <span class="todo TODO">TODO</span> Other modes</h3>
<div class="outline-text-3" id="text-5-8">
<p>
Although my writing will be exclusive in <code>org-mode</code>, I&rsquo;m still interaction with other writing modes, and I want the experience using those modes to get <i>as close as possible</i> to the experience with <code>org=mode</code>.
</p>
</div>

<div id="outline-container-orgea0f71f" class="outline-4">
<h4 id="orgea0f71f"><span class="section-number-4">5.8.1</span> Markdown</h4>
<div class="outline-text-4" id="text-5-8-1">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 390: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">markdown-split-window-direction</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">right</span>
      <span style="font-weight: bold; font-style: italic;">markdown-list-item-bullets</span> <span style="font-weight: bold;">'</span>(<span style="font-style: italic;">"&#8226;"</span> <span style="font-style: italic;">"&#8227;"</span> <span style="font-style: italic;">"&#8269;"</span>)
      <span style="font-weight: bold; font-style: italic;">markdown-blockquote-display-char</span> <span style="font-weight: bold;">`</span>(,(<span style="font-weight: bold; text-decoration: underline;">propertize</span> <span style="font-style: italic;">"&#9612;"</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">face</span> <span style="font-weight: bold;">'</span>(<span style="font-weight: bold;">:inherit</span> markdown-blockquote-face
                                                                  <span style="font-weight: bold;">:slant</span> normal))
                                         ,(<span style="font-weight: bold; text-decoration: underline;">propertize</span> <span style="font-style: italic;">"&#9475;"</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">face</span> <span style="font-weight: bold;">'</span>(<span style="font-weight: bold;">:inherit</span> markdown-blockquote-face
                                                                  <span style="font-weight: bold;">:slant</span> normal))
                                         <span style="font-style: italic;">"&gt;"</span>)
      <span style="font-weight: bold; font-style: italic;">markdown-header-scaling</span> t
      <span style="font-weight: bold; font-style: italic;">markdown-header-scaling-values</span> (<span style="font-weight: bold; text-decoration: underline;">list</span> (<span style="font-weight: bold;">face-attribute</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-headline-1</span> <span style="font-weight: bold;">:height</span>)
                                           (<span style="font-weight: bold;">face-attribute</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-headline-2</span> <span style="font-weight: bold;">:height</span>)
                                           (<span style="font-weight: bold;">face-attribute</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-headline-3</span> <span style="font-weight: bold;">:height</span>)
                                           (<span style="font-weight: bold;">face-attribute</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-headline-4</span> <span style="font-weight: bold;">:height</span>)
                                           (<span style="font-weight: bold;">face-attribute</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-headline-5</span> <span style="font-weight: bold;">:height</span>)
                                           (<span style="font-weight: bold;">face-attribute</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-headline-6</span> <span style="font-weight: bold;">:height</span>)))

(my-typography-reset (<span style="font-weight: bold;">cl-loop</span> for i from <span style="font-weight: bold; text-decoration: underline;">1</span> to <span style="font-weight: bold; text-decoration: underline;">6</span> collect (<span style="font-weight: bold; text-decoration: underline;">intern</span> (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"markdown-header-face-%d"</span> i))))
(my-typography-reset <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">markdown-code-face</span>)

(<span style="font-weight: bold;">custom-set-faces!</span>
  <span style="font-weight: bold;">`</span>(markdown-header-face-1 <span style="font-weight: bold;">:inherit</span> outline-1 <span style="font-weight: bold;">:weight</span> unspecified <span style="font-weight: bold;">:extend</span> unspecified)
  <span style="font-weight: bold;">`</span>(markdown-header-face-2 <span style="font-weight: bold;">:inherit</span> outline-2 <span style="font-weight: bold;">:weight</span> unspecified <span style="font-weight: bold;">:extend</span> unspecified)
  <span style="font-weight: bold;">`</span>(markdown-header-face-3 <span style="font-weight: bold;">:inherit</span> outline-3 <span style="font-weight: bold;">:weight</span> unspecified <span style="font-weight: bold;">:extend</span> unspecified)
  <span style="font-weight: bold;">`</span>(markdown-header-face-4 <span style="font-weight: bold;">:inherit</span> outline-4 <span style="font-weight: bold;">:weight</span> unspecified <span style="font-weight: bold;">:extend</span> unspecified)
  <span style="font-weight: bold;">`</span>(markdown-header-face-5 <span style="font-weight: bold;">:inherit</span> outline-5 <span style="font-weight: bold;">:weight</span> unspecified <span style="font-weight: bold;">:extend</span> unspecified)
  <span style="font-weight: bold;">`</span>(markdown-header-face-6 <span style="font-weight: bold;">:inherit</span> outline-6 <span style="font-weight: bold;">:weight</span> unspecified <span style="font-weight: bold;">:extend</span> unspecified)
  <span style="font-weight: bold;">'</span>(markdown-code-face <span style="font-weight: bold;">:inherit</span> my-default-mono <span style="font-weight: bold;">:weight</span> unspecified <span style="font-weight: bold;">:extend</span> unspecified)
  <span style="font-weight: bold;">`</span>(markdown-header-face <span style="font-weight: bold;">:inherit</span> unspecified)
  <span style="font-weight: bold;">`</span>(markdown-list-face <span style="font-weight: bold;">:foreground</span> unspecified <span style="font-weight: bold;">:inherit</span> org-list-dt))

(<span style="font-weight: bold;">add-hook!</span> (<span style="font-weight: bold;">markdown-mode</span> gfm-mode)
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-markdown-buffer-config-h</span> ()
    (<span style="font-weight: bold;">+zen/toggle</span> <span style="font-weight: bold; text-decoration: underline;">1</span>)
    (<span style="font-weight: bold;">variable-pitch-mode</span> <span style="font-weight: bold; text-decoration: underline;">1</span>)
    (<span style="font-weight: bold;">markdown-toggle-markup-hiding</span> <span style="font-weight: bold; text-decoration: underline;">1</span>)))
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org077a878" class="outline-2">
<h2 id="org077a878"><span class="section-number-2">6</span> Development</h2>
<div class="outline-text-2" id="text-6">
<p>
TBD
</p>
</div>

<div id="outline-container-orgc863084" class="outline-3">
<h3 id="orgc863084"><span class="section-number-3">6.1</span> <span class="todo TODO">TODO</span> Requirements</h3>
<div class="outline-text-3" id="text-6-1">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 391: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> lsp-ui
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:custom</span>
  (lsp-ui-sideline-show-hover t)
  (lsp-ui-doc-enable t))
</pre>
</div>
</div>
</div>

<div id="outline-container-org201124a" class="outline-3">
<h3 id="org201124a"><span class="section-number-3">6.2</span> <span class="todo TODO">TODO</span> Common configuration</h3>
<div class="outline-text-3" id="text-6-2">
<p>
TBD
</p>
</div>

<div id="outline-container-org0d9f6e2" class="outline-4">
<h4 id="org0d9f6e2"><span class="section-number-4">6.2.1</span> Version control system</h4>
<div class="outline-text-4" id="text-6-2-1">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 392: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> magit-todo <span style="font-weight: bold;">:defer</span> t)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 393: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">getenv</span> <span style="font-style: italic;">"GITHUB_WORKFLOW"</span>)
    (<span style="font-weight: bold;">package!</span> gitmoji
      <span style="font-weight: bold;">:recipe</span> (<span style="font-weight: bold;">:host</span> github
               <span style="font-weight: bold;">:repo</span> <span style="font-style: italic;">"Townk/gitmoji"</span>))
  (<span style="font-weight: bold;">package!</span> gitmoji
    <span style="font-weight: bold;">:recipe</span> (<span style="font-weight: bold;">:local-repo</span> <span style="font-style: italic;">"~/workplace/personal/emacs/gitmoji"</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 394: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> gitmoji
  <span style="font-weight: bold;">:commands</span> (gitmoji-insert gitmoji-select)
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">setq</span> gitmoji-insert-utf8-emoji t
        gitmoji-display-utf8-emoji t))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 395: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> magit
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(remove-hook 'server-switch-hook 'magit-commit-diff)</span>
  (<span style="font-weight: bold;">add-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">git-commit-setup-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-git-commit-buffer-config-h</span>))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 396: </span>$DOOMDIR/autoload/development.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-git-commit-buffer-config-h</span> ()
  <span style="font-style: italic;">"Configure the Git Commit Message buffer."</span>
  (<span style="font-weight: bold;">setq-local</span> <span style="font-weight: bold; font-style: italic;">display-fill-column-indicator-column</span> <span style="font-weight: bold; text-decoration: underline;">72</span>)
  (<span style="font-weight: bold;">display-fill-column-indicator-mode</span> <span style="font-weight: bold; text-decoration: underline;">1</span>)
  (<span style="font-weight: bold; text-decoration: underline;">goto-char</span> (<span style="font-weight: bold; text-decoration: underline;">point-min</span>))
  (<span style="font-weight: bold;">evil-append-line</span> <span style="font-weight: bold; text-decoration: underline;">1</span>)
  (<span style="font-weight: bold;">yas-expand-snippet</span> (<span style="font-weight: bold;">yas-lookup-snippet</span> <span style="font-style: italic;">"commit-message"</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">git-commit-mode</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 397: </span>$DOOMDIR/snippets/git-commit-mode/commit-message</label><pre class="src src-snippet"><span style="font-weight: bold; font-style: italic;"># name: commit-message</span>
<span style="font-weight: bold; font-style: italic;"># key: msg</span>
<span style="font-weight: bold; font-style: italic;"># --</span>
${<span style="font-weight: bold;">1</span>:$<span style="font-weight: bold;">$(</span><span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">or</span> yas-moving-away-p yas-modified-p)
              (<span style="font-weight: bold;">yas-auto-next</span>
                (<span style="font-weight: bold;">condition-case</span> nil
                    (<span style="font-weight: bold;">or</span> (gitmoji-select) <span style="font-style: italic;">""</span>)
                  ('quit <span style="font-style: italic;">""</span>))))<span style="font-weight: bold;">}</span>${<span style="font-weight: bold;">2</span>:Subject<span style="font-weight: bold;">}</span>

;-------------------------------------------------|
;       Do not pass this column on the subject -&gt; |
;-------------------------------------------------|
${<span style="font-weight: bold;">3</span>:`<span style="font-style: italic;">"## Changes Description\n"</span>`<span style="font-weight: bold;">}$</span><span style="font-style: italic;">0</span>
; <span style="font-weight: bold; text-decoration: underline;">1</span>. Separate subject from body with a blank line
; <span style="font-weight: bold; text-decoration: underline;">2</span>. Limit the subject line to <span style="font-weight: bold; text-decoration: underline;">50</span> characters
; <span style="font-weight: bold; text-decoration: underline;">3</span>. Capitalize the subject line
; <span style="font-weight: bold; text-decoration: underline;">4</span>. Do not end the subject line with a period
; <span style="font-weight: bold; text-decoration: underline;">5</span>. Use the imperative mood in the subject line
; <span style="font-weight: bold; text-decoration: underline;">6</span>. Wrap the body at <span style="font-weight: bold; text-decoration: underline;">72</span> characters
; <span style="font-weight: bold; text-decoration: underline;">7</span>. Use the body to explain what and why vs. how
</pre>
</div>
</div>
</div>

<div id="outline-container-orged8a9c4" class="outline-4">
<h4 id="orged8a9c4"><span class="section-number-4">6.2.2</span> Comments</h4>
<div class="outline-text-4" id="text-6-2-2">
<p>
TBD
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 398: </span>$DOOMDIR/autoload/development.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defadvice!</span> my-comment-and-next-line-a (func <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> args)
  <span style="font-weight: bold;">:around</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">evilnc-comment-or-uncomment-lines</span>
  (<span style="font-weight: bold;">let</span> ((no-selection-p (<span style="font-weight: bold; text-decoration: underline;">not</span> (<span style="font-weight: bold;">region-active-p</span>))))
    (<span style="font-weight: bold; text-decoration: underline;">apply</span> func args)
    (<span style="font-weight: bold;">when</span> no-selection-p
      (<span style="font-weight: bold;">next-line</span>)
      (<span style="font-weight: bold; text-decoration: underline;">goto-char</span> (<span style="font-weight: bold; text-decoration: underline;">point-at-bol</span>))
      (<span style="font-weight: bold; text-decoration: underline;">skip-chars-forward</span> <span style="font-style: italic;">" \t\r"</span>))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org68c4d31" class="outline-3">
<h3 id="org68c4d31"><span class="section-number-3">6.3</span> <span class="todo TODO">TODO</span> Lisp</h3>
<div class="outline-text-3" id="text-6-3">
<p>
TBD
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 399: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">emacs-lisp-docstring-fill-column</span> <span style="font-weight: bold; text-decoration: underline;">80</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org54129d9" class="outline-3">
<h3 id="org54129d9"><span class="section-number-3">6.4</span> <span class="todo TODO">TODO</span> Shell script</h3>
</div>
<div id="outline-container-org151d800" class="outline-3">
<h3 id="org151d800"><span class="section-number-3">6.5</span> <span class="todo TODO">TODO</span> Python</h3>
</div>
<div id="outline-container-orgccdb470" class="outline-3">
<h3 id="orgccdb470"><span class="section-number-3">6.6</span> <span class="todo TODO">TODO</span> Ansible</h3>
<div class="outline-text-3" id="text-6-6">
<p>
TBD
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 400: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">def-project-mode!</span> <span style="font-weight: bold; font-style: italic;">+ansible-yaml-mode</span>
  <span style="font-weight: bold;">:modes</span> <span style="font-weight: bold;">'</span>(yaml-mode)
  <span style="font-weight: bold;">:add-hooks</span> <span style="font-weight: bold;">'</span>(ansible ansible-auto-decrypt-encrypt ansible-doc-mode)
  <span style="font-weight: bold;">:files</span> (<span style="font-weight: bold;">and</span> <span style="font-style: italic;">"ansible.cfg"</span>
              (<span style="font-weight: bold;">or</span> <span style="font-style: italic;">"main.yaml"</span>
                  <span style="font-style: italic;">"main.yml"</span>
                  <span style="font-style: italic;">"tasks/main.yaml"</span>
                  <span style="font-style: italic;">"tasks/main.yml"</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org2e55b98" class="outline-3">
<h3 id="org2e55b98"><span class="section-number-3">6.7</span> <span class="todo TODO">TODO</span> Javascript/TypeScript</h3>
</div>
<div id="outline-container-orgeac7e20" class="outline-3">
<h3 id="orgeac7e20"><span class="section-number-3">6.8</span> <span class="todo TODO">TODO</span> C/C++</h3>
</div>
<div id="outline-container-org69880f7" class="outline-3">
<h3 id="org69880f7"><span class="section-number-3">6.9</span> <span class="todo TODO">TODO</span> Swift</h3>
</div>
<div id="outline-container-org1819cfc" class="outline-3">
<h3 id="org1819cfc"><span class="section-number-3">6.10</span> <span class="todo TODO">TODO</span> Kotlin</h3>
</div>
<div id="outline-container-orgb17754f" class="outline-3">
<h3 id="orgb17754f"><span class="section-number-3">6.11</span> <span class="todo TODO">TODO</span> Java</h3>
</div>
</div>

<div id="outline-container-orgf30b36a" class="outline-2">
<h2 id="orgf30b36a"><span class="section-number-2">7</span> Non-editor features</h2>
<div class="outline-text-2" id="text-7">
<p>
TBD
</p>
</div>

<div id="outline-container-org147e4d1" class="outline-3">
<h3 id="org147e4d1"><span class="section-number-3">7.1</span> <span class="todo TODO">TODO</span> Requirements</h3>
</div>
<div id="outline-container-org11c04e2" class="outline-3">
<h3 id="org11c04e2"><span class="section-number-3">7.2</span> <span class="todo TODO">TODO</span> File management</h3>
<div class="outline-text-3" id="text-7-2">
<p>
Before we start configuring the target packages for this section (<code>dired</code> and <code>eshel</code>), I want to make some small adjustments to Treemacs. Although it is not a full blown file manager, it is a sort of a file manager for my projects, so it fits in this section.
</p>

<p>
The first thing I like to do, is to unpin Treemacs and let Doom use the latest version of it:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 401: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">unpin!</span> treemacs)
</pre>
</div>

<p>
The next change is to use our custom <code>my-default-ui</code> font face. I have to replace the entire <code>doom-themes-enable-treemacs-variable-pitch-labels</code> function with a version that uses my custom font instead. To do that, I&rsquo;ll use Emacs advices:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 402: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defadvice!</span> my-themes-enable-treemacs-variable-pitch-labels-a (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> _)
  <span style="font-style: italic;">"This advice changes the treemacs variable pitch font to one without serif so</span>
<span style="font-style: italic;">the UI looks more polished."</span>
  <span style="font-weight: bold;">:override</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">doom-themes-enable-treemacs-variable-pitch-labels</span>
  (<span style="font-weight: bold;">when</span> doom-themes-treemacs-enable-variable-pitch
    (<span style="font-weight: bold;">dolist</span> (face <span style="font-weight: bold;">'</span>(treemacs-root-face
                    treemacs-git-unmodified-face
                    treemacs-git-modified-face
                    treemacs-git-renamed-face
                    treemacs-git-ignored-face
                    treemacs-git-untracked-face
                    treemacs-git-added-face
                    treemacs-git-conflict-face
                    treemacs-directory-face
                    treemacs-directory-collapsed-face
                    treemacs-file-face
                    treemacs-tags-face))
      (<span style="font-weight: bold;">let</span> ((faces (<span style="font-weight: bold;">face-attribute</span> face <span style="font-weight: bold;">:inherit</span> nil)))
        (<span style="font-weight: bold;">set-face-attribute</span>
         face nil <span style="font-weight: bold;">:inherit</span>
         <span style="font-weight: bold;">`</span>(my-default-ui ,@(<span style="font-weight: bold; text-decoration: underline;">delq</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">unspecified</span> (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">listp</span> faces) faces (<span style="font-weight: bold; text-decoration: underline;">list</span> faces)))))))))
</pre>
</div>

<p>
By default, Treemacs will stay opened after you select a file to visit. Personally I don&rsquo;t like this, I rather have Treemacs closing when I select a file.
</p>

<p>
In order to help me achieve my desired behavior, I&rsquo;ll  create another <i>autoload</i> function that I&rsquo;ll call when I select a file:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 403: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-treemacs-visit-node-and-close-h</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
  <span style="font-style: italic;">"Closes treemacs window after selecting a file to visit."</span>
  (treemacs-visit-node-default arg)
  (<span style="font-weight: bold;">delete-window</span> (treemacs-get-local-window)))
</pre>
</div>

<p>
We can now, configure Treemacs properly:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 404: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> treemacs
</pre>
</div>

<p>
First we need to tell Treemacs to use the new autoload function when I press <code>&lt;ENTER&gt;</code> on a file:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 405: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">  (treemacs-define-RET-action <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">file-node-open</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-treemacs-visit-node-and-close-h</span>)
  (treemacs-define-RET-action <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">file-node-closed</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-treemacs-visit-node-and-close-h</span>)
</pre>
</div>

<p>
Then, I like Treemacs to collapse directory into one when possible:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 406: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">  (<span style="font-weight: bold;">setq</span> treemacs-collapse-dirs (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">executable-find</span> <span style="font-style: italic;">"python3"</span>) <span style="font-weight: bold; text-decoration: underline;">3</span> <span style="font-weight: bold; text-decoration: underline;">0</span>))
</pre>
</div>

<p>
<a href="https://andreyorst.gitlab.io/posts/2020-05-01-dynamic-title-for-treemacs-workspace/">https://andreyorst.gitlab.io/posts/2020-05-01-dynamic-title-for-treemacs-workspace/</a>
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 407: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-treemacs-buffer-config-h</span> ()
  (<span style="font-weight: bold;">let</span> ((bg (<span style="font-weight: bold;">face-attribute</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">default</span> <span style="font-weight: bold;">:background</span>))
        (fg (<span style="font-weight: bold;">face-attribute</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">default</span> <span style="font-weight: bold;">:foreground</span>)))
    (<span style="font-weight: bold;">face-remap-add-relative</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">header-line</span>
                             <span style="font-weight: bold;">:background</span> bg <span style="font-weight: bold;">:foreground</span> fg
                             <span style="font-weight: bold;">:box</span> <span style="font-weight: bold;">`</span>(<span style="font-weight: bold;">:line-width</span> ,(<span style="font-weight: bold; text-decoration: underline;">/</span> my-line-pixel-height <span style="font-weight: bold; text-decoration: underline;">2</span>) <span style="font-weight: bold;">:color</span> ,bg)))
  (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">header-line-format</span>
        <span style="font-weight: bold;">'</span>((<span style="font-weight: bold;">:eval</span>
           (<span style="font-weight: bold; text-decoration: underline;">concat</span>
            <span style="font-style: italic;">" &#9776; "</span>
            (<span style="font-weight: bold; text-decoration: underline;">propertize</span> (<span style="font-weight: bold;">s-titleize</span> (persp-current-name)) <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">face</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">my-ui-window-header</span>))))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 408: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">  (<span style="font-weight: bold;">add-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">treemacs-mode-hook</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-treemacs-buffer-config-h</span>)
</pre>
</div>

<p>
And finally, we can close our Treemacs configuration
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 409: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">  <span style="color: #88090B;">)</span>
</pre>
</div>

<p>
I also like to make sure it behaves as expected if I use the mouse:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 410: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">map!</span>
 (<span style="font-weight: bold;">:after</span> treemacs
  (<span style="font-weight: bold;">:map</span> treemacs-mode-map
   [mouse-1] <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">treemacs-single-click-expand-action</span>))

 (<span style="font-weight: bold;">:after</span> treemacs-evil
  (<span style="font-weight: bold;">:map</span> evil-treemacs-state-map
   <span style="font-style: italic;">"C-h"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">evil-window-left</span>
   <span style="font-style: italic;">"C-l"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">evil-window-right</span>))

 (<span style="font-weight: bold;">:after</span> cfrs
  (<span style="font-weight: bold;">:map</span> cfrs-input-mode-map
   <span style="font-weight: bold;">:n</span> [escape] <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">cfrs-cancel</span>)))
</pre>
</div>

<p>
Treemacs offers a function that adds the current project if it is not on the workspace. That is a nice feature, but because I use workspaces heavily, the fact that this function does not <i>remove</i> projects that do not belong to this workspace bothers me, so I  wrote this advice to do the dirty work for me:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 411: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defadvice!</span> my-treemacs-add-and-display-current-project-a ()
  <span style="font-style: italic;">"Open treemacs with current project. This function removes any project that is</span>
<span style="font-style: italic;">not the current one."</span>
  <span style="font-weight: bold;">:override</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">treemacs-add-and-display-current-project</span>
  (<span style="font-weight: bold;">interactive</span>)

  (<span style="font-weight: bold;">cl-dolist</span> (p (treemacs-workspace-&gt;projects (treemacs-current-workspace)))
    (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold; text-decoration: underline;">string=</span> (<span style="font-weight: bold;">doom-project-name</span>) (treemacs-project-&gt;name p))
      (treemacs-do-remove-project-from-workspace p t)))

  (<span style="font-weight: bold;">when</span> (treemacs-workspace-&gt;is-empty?)
      (treemacs-do-add-project-to-workspace (<span style="font-weight: bold;">doom-project-root</span>) (<span style="font-weight: bold;">doom-project-name</span>)))

  (<span style="font-weight: bold;">treemacs-select-window</span>)
  (treemacs-pulse-on-success))
</pre>
</div>

<p>
And to finalize the Treemacs configuration, let&rsquo;s make it respect my window navigation keys:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 412: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-dired/toggle-git-mode</span> ()
  <span style="font-style: italic;">"Toggle `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">dired-git-info-mode</span><span style="font-style: italic;">' in git repos."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold; text-decoration: underline;">not</span> (<span style="font-weight: bold;">file-remote-p</span> <span style="font-weight: bold; font-style: italic;">default-directory</span>))
             (<span style="font-weight: bold;">locate-dominating-file</span> <span style="font-style: italic;">"."</span> <span style="font-style: italic;">".git"</span>))
    (<span style="font-weight: bold; text-decoration: underline;">call-interactively</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">dired-git-info-mode</span>)))

<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-dired/open-directory</span> ()
  <span style="font-style: italic;">"Enters in the directory at point. If the cursor is not on a directory, do</span>
<span style="font-style: italic;">nothing."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold; text-decoration: underline;">file-directory-p</span> (<span style="font-weight: bold;">dired-get-file-for-visit</span>))
    (<span style="font-weight: bold;">dired-find-file</span>)))

<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-dired/mac-quick-view</span> ()
  <span style="font-style: italic;">"Invoke the macOS Quiclview on the file under point."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">shell-command</span> (<span style="font-weight: bold; text-decoration: underline;">concat</span> <span style="font-style: italic;">"qlmanage -p \""</span>
                         (<span style="font-weight: bold;">dired-get-file-for-visit</span>)
                         <span style="font-style: italic;">"\" &gt; /dev/null 2&gt;&amp;1"</span>)))

<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-dired/widen-or-quit-all</span> ()
  <span style="font-style: italic;">"If `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">dired-narow</span><span style="font-style: italic;">' is on, revert to the normal view. If there is no active</span>
<span style="font-style: italic;">narrow, quit Dired."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">buffer-modified-p</span>)
      (<span style="font-weight: bold;">revert-buffer</span>)
    (<span style="font-weight: bold; text-decoration: underline;">mapc</span> (<span style="font-weight: bold;">lambda</span> (buf)
            (<span style="font-weight: bold;">let</span> ((win (<span style="font-weight: bold; text-decoration: underline;">get-buffer-window</span> buf)))
              (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold; text-decoration: underline;">append</span> (<span style="font-weight: bold; text-decoration: underline;">window-prev-buffers</span> win) (<span style="font-weight: bold; text-decoration: underline;">window-prev-buffers</span> win))
                (<span style="font-weight: bold;">delete-window</span> win))
              (<span style="font-weight: bold; text-decoration: underline;">kill-buffer</span> buf)))
          (<span style="font-weight: bold;">doom-buffers-in-mode</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">dired-mode</span>))))

<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-dired/narrow</span> (narrow-func)
  <span style="font-style: italic;">"Start a dynamic narrowing of files in current view."</span>
  (<span style="font-weight: bold;">interactive</span>
   (<span style="font-weight: bold; text-decoration: underline;">list</span> (<span style="font-weight: bold;">if</span> <span style="font-weight: bold; font-style: italic;">current-prefix-arg</span>
             <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">dired-narrow-fuzzy</span>
           <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">dired-narrow-regexp</span>)))
  (<span style="font-weight: bold; text-decoration: underline;">call-interactively</span> narrow-func))

<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-dired/yank-absolute-path</span> ()
  <span style="font-style: italic;">"Copy the absolute path of file on pointer to kill ring."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">dired-copy-filename-as-kill</span> <span style="font-weight: bold; text-decoration: underline;">0</span>))

<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-dired/yank-relative-path</span> ()
  <span style="font-style: italic;">"Copy the relative path of file on pointer to kill ring."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">dired-copy-filename-as-kill</span>))

<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-dired/open-externally</span> ()
  <span style="font-style: italic;">"Open file with application defined by OS."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">shell-command</span> (<span style="font-weight: bold; text-decoration: underline;">concat</span> <span style="font-style: italic;">"open \""</span>
                         (<span style="font-weight: bold;">dired-get-file-for-visit</span>)
                         <span style="font-style: italic;">"\" &gt; /dev/null 2&gt;&amp;1"</span>)))

<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-dired/reveal-on-finder</span> ()
  <span style="font-style: italic;">"Show current file in Finder."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">shell-command</span> (<span style="font-weight: bold; text-decoration: underline;">concat</span> <span style="font-style: italic;">"open --reveal \""</span>
                         (<span style="font-weight: bold;">dired-get-file-for-visit</span>)
                         <span style="font-style: italic;">"\" &gt; /dev/null 2&gt;&amp;1"</span>)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-dired-marked-file-p</span> ()
  <span style="font-style: italic;">"Return non-nil if we have marked file at point."</span>
  (<span style="font-weight: bold;">dired-file-marker</span> (<span style="font-weight: bold;">dired-get-file-for-visit</span>)))

<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-dired/toggle-mark</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> args)
  <span style="font-style: italic;">"Toggle mark of file at point."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">if</span> (my-dired-marked-file-p)
      (<span style="font-weight: bold;">dired-unmark</span> <span style="font-weight: bold; text-decoration: underline;">1</span>)
    (<span style="font-weight: bold;">dired-mark</span> <span style="font-weight: bold; text-decoration: underline;">1</span>)))

<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-dired/open-split-right</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold; text-decoration: underline;">select-window</span>
   (<span style="font-weight: bold;">window--display-buffer</span> (<span style="font-weight: bold;">find-file-noselect</span> (<span style="font-weight: bold;">dired-get-file-for-visit</span>))
                           (<span style="font-weight: bold;">split-window-right</span>)
                           <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">window</span>)))

<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-dired/open-split-bellow</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold; text-decoration: underline;">select-window</span>
   (<span style="font-weight: bold;">window--display-buffer</span> (<span style="font-weight: bold;">find-file-noselect</span> (<span style="font-weight: bold;">dired-get-file-for-visit</span>))
                           (<span style="font-weight: bold;">split-window-below</span>)
                           <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">window</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 413: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">package!</span> dired-collapse)
(<span style="font-weight: bold;">package!</span> dired-narrow)
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(package! sunrise-commander)</span>
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 414: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> dired
  (<span style="font-weight: bold;">setq</span>
        <span style="font-weight: bold; font-style: italic;">auto-revert-verbose</span> nil
        <span style="font-weight: bold; font-style: italic;">dired-dwim-target</span> t
        <span style="font-weight: bold; font-style: italic;">dired-listing-switches</span> <span style="font-style: italic;">"-lAhvFoG --group-directories-first"</span>
        dired-omit-files <span style="font-style: italic;">"^\\.?#</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">^\\.$</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">^\\.\\.$</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">^\\..+$</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">^.DS_STORE$</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">^.projectile$"</span>
        <span style="font-weight: bold; font-style: italic;">dired-recursive-copies</span> <span style="font-weight: bold;">'</span>(always)
        <span style="font-weight: bold; font-style: italic;">dired-recursive-deletes</span> <span style="font-weight: bold;">'</span>(top)
        <span style="font-weight: bold; font-style: italic;">dired-use-ls-dired</span> t
        <span style="font-weight: bold; font-style: italic;">global-auto-revert-non-file-buffers</span> t
        <span style="font-weight: bold; font-style: italic;">insert-directory-program</span> <span style="font-style: italic;">"gls"</span>
        ))

(<span style="font-weight: bold;">use-package!</span> dired-collapse <span style="font-weight: bold;">:commands</span> (<span style="font-weight: bold;">dired</span> dired-noselect))
(<span style="font-weight: bold;">use-package!</span> dired-narrow <span style="font-weight: bold;">:after</span> (<span style="font-weight: bold;">dired</span> dired-noselect))
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(add-hook 'kill-buffer-hook '+doom--delete-window-if-only-buffer)</span>
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 415: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">map!</span> <span style="font-weight: bold;">:after</span> dired
      (<span style="font-weight: bold;">:map</span> <span style="font-weight: bold; font-style: italic;">dired-mode-map</span>
       <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"t"</span>        nil
       <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"y"</span>        nil
       <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"c"</span>        nil
       <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"o"</span>        nil
       <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"m"</span>        nil
       <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"/"</span>        <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-dired/narrow</span>
       <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"&lt;escape&gt;"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-dired/widen-or-quit-all</span>
       <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"q"</span>        <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-dired/widen-or-quit-all</span>
       <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"RET"</span>      <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">dired-find-file</span>
       <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"TAB"</span>      <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-dired/open-directory</span>
       <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"&lt;tab&gt;"</span>    <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-dired/open-directory</span>
       <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"l"</span>        <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-dired/open-directory</span>
       <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"h"</span>        <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">dired-up-directory</span>
       <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"U"</span>        <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">dired-up-directory</span>
       <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"R"</span>        <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">dired-do-rename</span>
       <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"d"</span>        <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">dired-do-delete</span>
       <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"x"</span>        <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-dired/toggle-mark</span>
       (<span style="font-weight: bold;">:prefix</span> (<span style="font-style: italic;">"t"</span> . <span style="font-style: italic;">"toggle"</span>)
        <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Toggle collapsed dirs"</span> <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"c"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">dired-collapse-mode</span>
        <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Toggle git info"</span>       <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"g"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-dired/toggle-git-mode</span>
        <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Toggle hidden files"</span>   <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"h"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">dired-omit-mode</span>
        <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Toggle all marks"</span>      <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"m"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">dired-toggle-marks</span>)
       (<span style="font-weight: bold;">:prefix</span> (<span style="font-style: italic;">"y"</span> . <span style="font-style: italic;">"yank"</span>)
        <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Copy absolut path"</span>     <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"a"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-dired/yank-absolute-path</span>
        <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Copy file"</span>             <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"f"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">dired-do-copy</span>
        <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Copy with regexp"</span>      <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"r"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">dired-do-copy-regexp</span>
        <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Copy relative path"</span>    <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"y"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-dired/yank-relative-path</span>)
       (<span style="font-weight: bold;">:prefix</span> (<span style="font-style: italic;">"c"</span> . <span style="font-style: italic;">"create"</span>)
        <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Create empty file"</span>     <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"f"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">dired-do-touch</span>
        <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Create directory"</span>      <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"d"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">dired-create-directory</span>
        <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Create project"</span>        <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"p"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">xxx</span>)
       (<span style="font-weight: bold;">:prefix</span> (<span style="font-style: italic;">"o"</span> . <span style="font-style: italic;">"open"</span>)
        <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Open no split"</span>         <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"o"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">dired-find-alternate-file</span>
        <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Quick view"</span>            <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"p"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-dired/mac-quick-view</span>
        <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Reveal on Finder"</span>      <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"f"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-dired/reveal-on-finder</span>
        <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Open vertically"</span>       <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"s"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-dired/open-split-bellow</span>
        <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Open horizontally"</span>     <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"v"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-dired/open-split-right</span>
        <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Open externally"</span>       <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"x"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-dired/open-externally</span>)
       (<span style="font-weight: bold;">:prefix</span> (<span style="font-style: italic;">"m"</span> . <span style="font-style: italic;">"mark"</span>)
        <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"h"</span> nil
        <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Mark directories"</span>  <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"d"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">dired-mark-directories</span>
        <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Mark extension"</span>    <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"e"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">dired-mark-extension</span>
        <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Mark hidden files"</span> <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"h"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">dired-mark-omitted</span>
        <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Mark with regexp"</span>  <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"r"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">dired-mark-files-regexp</span>
        <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Mark subdir files"</span> <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"s"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">dired-mark-omitted</span>
        <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Unmark all files"</span>  <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"u"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">dired-unmark-all-files</span>
        <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Remove all marks"</span>  <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"U"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">dired-unmark-all-marks</span>
        <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Mark executables"</span>  <span style="font-weight: bold;">:ne</span> <span style="font-style: italic;">"x"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">dired-mark-executables</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org41f3367" class="outline-3">
<h3 id="org41f3367"><span class="section-number-3">7.3</span> <span class="todo TODO">TODO</span> Project management</h3>
<div class="outline-text-3" id="text-7-3">
<p>
Projectile is a great package. It usually provides more features that one particular user would need. But I still want to tweak it to make it behave more according my expectations.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 416: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> projectile
</pre>
</div>

<p>
To make <code>projectile</code> work with <code>selectrum</code>, we need to tell it to use the default Emacs completion system:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 417: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">  (<span style="font-weight: bold;">setq</span> projectile-ignored-projects <span style="font-weight: bold;">`</span>(<span style="font-style: italic;">"~/"</span>
                                      <span style="font-style: italic;">"/tmp"</span>
                                      ,(<span style="font-weight: bold; text-decoration: underline;">expand-file-name</span> <span style="font-style: italic;">"straight/repos"</span> <span style="font-weight: bold; font-style: italic;">doom-local-dir</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 418: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">  (<span style="font-weight: bold;">setq</span> projectile-completion-system <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">default</span>)
</pre>
</div>

<p>
Doom sets a function to run when we open a project with <code>projectile</code>, but that function is not calling any <i>open file</i> function for us. Let&rsquo;s create our own version of such function and help projectile to do the appropriate thing when we open a project.
</p>

<p>
The actions I expect are:
</p>

<ul class="org-ul">
<li>Check if the project has one of the recognized files and open it, in this order (we should look for four extensions on each one of the files, also in this order: <code>.org</code>, no extension, <code>.md</code>, and <code>.rst</code>):
<ul class="org-ul">
<li><code>CHANGELOG</code></li>
<li><code>NEWS</code></li>
<li><code>README</code></li>
</ul></li>
<li>If none of the recognizable files is present, run <code>project-find-file</code>;</li>
</ul>

<p>
Let&rsquo;s create such function as an <i>autoload</i> function:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 419: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-after-switch-project-action-h</span> ()
  <span style="font-style: italic;">"A project first action to execute when we switch our current project."</span>
  (<span style="font-weight: bold;">let</span> ((file (<span style="font-weight: bold;">file-exists-p!</span> (<span style="font-weight: bold;">or</span> <span style="font-style: italic;">"README.rst"</span>
                                  <span style="font-style: italic;">"README.md"</span>
                                  <span style="font-style: italic;">"README"</span>
                                  <span style="font-style: italic;">"README.org"</span>
                                  <span style="font-style: italic;">"NEWS.rst"</span>
                                  <span style="font-style: italic;">"NEWS.md"</span>
                                  <span style="font-style: italic;">"NEWS"</span>
                                  <span style="font-style: italic;">"NEWS.org"</span>
                                  <span style="font-style: italic;">"CHANGELOG.rst"</span>
                                  <span style="font-style: italic;">"CHANGELOG.md"</span>
                                  <span style="font-style: italic;">"CHANGELOG"</span>
                                  <span style="font-style: italic;">"CHANGELOG.org"</span>))))
    (<span style="font-weight: bold;">if</span> file
        (<span style="font-weight: bold;">find-file-existing</span> file)
      (<span style="font-weight: bold;">projectile-find-file</span>))))
</pre>
</div>

<p>
And attach it to the <code>projectile</code> hook:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 420: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">  (<span style="font-weight: bold;">setq</span> projectile-switch-project-action <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-after-switch-project-action-h</span>)
</pre>
</div>

<p>
As usual, don&rsquo;t forget to close the <code>after!</code> sexp:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 421: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">   <span style="color: #88090B;">)</span>  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">after! projectile</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2532915" class="outline-3">
<h3 id="org2532915"><span class="section-number-3">7.4</span> <span class="todo TODO">TODO</span> Terminal</h3>
<div class="outline-text-3" id="text-7-4">
<p>
In general, I really like the setup Doom has for the terminal. There are 3 things I like to add there.
</p>

<p>
One are some aliases that I&rsquo;m used to use when working on the terminal:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 422: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> eshell
  (<span style="font-weight: bold;">set-eshell-alias!</span>
   <span style="font-style: italic;">"d"</span>     <span style="font-style: italic;">"dired $1"</span>
   <span style="font-style: italic;">"edit"</span>  <span style="font-style: italic;">"find-file-other-window $1"</span>
   <span style="font-style: italic;">"em"</span>    <span style="font-style: italic;">"find-file-other-window $1"</span>
   <span style="font-style: italic;">"emacs"</span> <span style="font-style: italic;">"find-file-other-window $1"</span>
   <span style="font-style: italic;">"f"</span>     <span style="font-style: italic;">"find-file $1"</span>
   <span style="font-style: italic;">"gc"</span>    <span style="font-style: italic;">"magit-commit $1"</span>
   <span style="font-style: italic;">"gl"</span>    <span style="font-style: italic;">"(call-interactively 'magit-log-current)"</span>
   <span style="font-style: italic;">"gst"</span>   <span style="font-style: italic;">"magit-status $1"</span>
   <span style="font-style: italic;">"ls"</span>    <span style="font-style: italic;">"exa --group-directories-first --color always -F $1"</span>
   <span style="font-style: italic;">"la"</span>    <span style="font-style: italic;">"exa --group-directories-first --color always -F -a $1"</span>
   <span style="font-style: italic;">"ll"</span>    <span style="font-style: italic;">"exa --group-directories-first --color always -F -l -h --git $1"</span>
   <span style="font-style: italic;">"lla"</span>   <span style="font-style: italic;">"exa --group-directories-first --color always -F -a -l -h --git $1"</span>
   <span style="font-style: italic;">"rg"</span>    <span style="font-style: italic;">"rg --color=always $*"</span>
   <span style="font-style: italic;">"up"</span>    <span style="font-style: italic;">"eshell-up $1"</span>
   <span style="font-style: italic;">"pk"</span>    <span style="font-style: italic;">"eshell-up-peek $1"</span>
   <span style="font-style: italic;">"vi"</span>    <span style="font-style: italic;">"find-file-other-window $1"</span>
   <span style="font-style: italic;">"vim"</span>   <span style="font-style: italic;">"find-file-other-window $1"</span>))
</pre>
</div>

<p>
Two is the window navigation mapping:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 423: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">map!</span> <span style="font-weight: bold;">:after</span> eshell
      (<span style="font-weight: bold;">:map</span> <span style="font-weight: bold; font-style: italic;">eshell-mode-map</span>
       <span style="font-weight: bold;">:in</span> <span style="font-style: italic;">"C-h"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">evil-window-left</span>
       <span style="font-weight: bold;">:in</span> <span style="font-style: italic;">"C-j"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">evil-window-down</span>
       <span style="font-weight: bold;">:in</span> <span style="font-style: italic;">"C-k"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">evil-window-up</span>
       <span style="font-weight: bold;">:in</span> <span style="font-style: italic;">"C-l"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">evil-window-right</span>))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 424: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">set-popup-rule!</span> <span style="font-style: italic;">"^\\*doom:</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(?:</span><span style="font-style: italic;">v?term</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">e?shell</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">-popup"</span>
  <span style="font-weight: bold;">:slot</span> <span style="font-weight: bold; text-decoration: underline;">2</span>   <span style="font-weight: bold;">:vslot</span> <span style="font-weight: bold; text-decoration: underline;">-1</span>     <span style="font-weight: bold;">:side</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">bottom</span>  <span style="font-weight: bold;">:width</span> <span style="font-weight: bold; text-decoration: underline;">110</span> <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">0.4</span>
  <span style="font-weight: bold;">:select</span> t <span style="font-weight: bold;">:modeline</span> nil <span style="font-weight: bold;">:autosave</span> nil  <span style="font-weight: bold;">:ttl</span> nil   <span style="font-weight: bold;">:quit</span> nil)
</pre>
</div>

<p>
And three is to fix <code>magit-status</code>. When I&rsquo;m on the terminal, if I open <code>magit-status</code>, everything works as expected, but when I exit back to the terminal, Emacs switch the buffer on my terminal window to something else.
</p>

<p>
The ideal behavior would be to any app launch from the terminal to take over eshell&rsquo;s window until done. Then, revert back to the terminal.
</p>

<p>
I like to have a hint of the next possible completion while I&rsquo;m working on shell. Zsh and Fish have great plugins for such feature, so I decided to add one for eshell as well:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 425: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">package!</span> esh-autosuggest)
</pre>
</div>

<p>
The only configuration we need to get this mode working, is to let Emacs enable it when <code>eshell-mode</code> is up.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 426: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> esh-autosuggest
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:hook</span> ((<span style="font-weight: bold;">eshell-mode</span> . esh-autosuggest-mode)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org2f7d786" class="outline-3">
<h3 id="org2f7d786"><span class="section-number-3">7.5</span> <span class="todo TODO">TODO</span> Emails</h3>
<div class="outline-text-3" id="text-7-5">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 427: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp">
</pre>
</div>
</div>
</div>

<div id="outline-container-org6104f70" class="outline-3">
<h3 id="org6104f70"><span class="section-number-3">7.6</span> <span class="todo TODO">TODO</span> Calendars</h3>
<div class="outline-text-3" id="text-7-6">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 428: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">+work-calendar-personal</span> (<span style="font-weight: bold; text-decoration: underline;">expand-file-name</span> <span style="font-style: italic;">"personal.org"</span> my-calendars-directory)
  <span style="font-style: italic;">"File path for my personal calendar"</span>)

(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">+work-calendar-family</span> (<span style="font-weight: bold; text-decoration: underline;">expand-file-name</span> <span style="font-style: italic;">"family.org"</span> my-calendars-directory)
  <span style="font-style: italic;">"File path for my personal calendar"</span>)

(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">+work-calendar-work</span> (<span style="font-weight: bold; text-decoration: underline;">expand-file-name</span> <span style="font-style: italic;">"work.org"</span> my-calendars-directory)
  <span style="font-style: italic;">"File path for my personal calendar"</span>)

(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">+org-calendars-files</span> (<span style="font-weight: bold; text-decoration: underline;">list</span> +work-calendar-personal
                                     +work-calendar-family
                                     +work-calendar-work)
  <span style="font-style: italic;">"List of directories to find files with appointment events (calendar)"</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 429: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">+doom-calendar-color-table</span> (<span style="font-weight: bold; text-decoration: underline;">make-hash-table</span> <span style="font-weight: bold;">:test</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">equal</span>)
  <span style="font-style: italic;">"A hash table to hold an association between a calendar name (in our org world,</span>
<span style="font-style: italic;">this is the event's category), and its defined color."</span>)

(<span style="font-weight: bold; text-decoration: underline;">puthash</span> <span style="font-style: italic;">"work"</span>     <span style="font-weight: bold;">'</span>(<span style="font-weight: bold;">:color</span> <span style="font-style: italic;">"#a67a63"</span> <span style="font-weight: bold;">:bg</span> <span style="font-style: italic;">"#4f3426"</span> <span style="font-weight: bold;">:fg</span> <span style="font-style: italic;">"#ffc8a9"</span>) +doom-calendar-color-table)
(<span style="font-weight: bold; text-decoration: underline;">puthash</span> <span style="font-style: italic;">"personal"</span> <span style="font-weight: bold;">'</span>(<span style="font-weight: bold;">:color</span> <span style="font-style: italic;">"#19adf8"</span> <span style="font-weight: bold;">:bg</span> <span style="font-style: italic;">"#17445d"</span> <span style="font-weight: bold;">:fg</span> <span style="font-style: italic;">"#a9e3ff"</span>) +doom-calendar-color-table)
(<span style="font-weight: bold; text-decoration: underline;">puthash</span> <span style="font-style: italic;">"family"</span>   <span style="font-weight: bold;">'</span>(<span style="font-weight: bold;">:color</span> <span style="font-style: italic;">"#cd73e1"</span> <span style="font-weight: bold;">:bg</span> <span style="font-style: italic;">"#45285c"</span> <span style="font-weight: bold;">:fg</span> <span style="font-style: italic;">"#f1aeff"</span>) +doom-calendar-color-table)

<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-work-calendar-color</span> (name <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> prop)
  <span style="font-style: italic;">"Returns a string representing the color for PROP for the calendar with the</span>
<span style="font-style: italic;">given NAME.</span>

<span style="font-style: italic;">If color is nil, this function uses the property `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">:color</span><span style="font-style: italic;">'"</span>
  (<span style="font-weight: bold; text-decoration: underline;">plist-get</span> (<span style="font-weight: bold; text-decoration: underline;">gethash</span> name +doom-calendar-color-table) (<span style="font-weight: bold;">or</span> prop <span style="font-weight: bold;">:color</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 430: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">+calendar-open-function</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-work/open-calendar</span>)

(<span style="font-weight: bold;">map!</span> <span style="font-weight: bold;">:leader</span> <span style="font-weight: bold;">:prefix</span> (<span style="font-style: italic;">"o"</span> . <span style="font-style: italic;">"open"</span>)
      <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Open calendar"</span> <span style="font-weight: bold;">:nvm</span> <span style="font-style: italic;">"c"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">=calendar</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 431: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-work/open-calendar</span> ()
  <span style="font-style: italic;">"</span><span style="font-weight: bold;">TODO</span><span style="font-style: italic;">"</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">cfw:open-calendar-buffer</span>
   <span style="font-weight: bold;">:contents-sources</span>
   (<span style="font-weight: bold; text-decoration: underline;">list</span>
    (<span style="font-weight: bold;">cfw:org-create-file-source</span> <span style="font-style: italic;">"Personal"</span> +work-calendar-personal (my-work-calendar-color <span style="font-style: italic;">"personal"</span>))
    (<span style="font-weight: bold;">cfw:org-create-file-source</span> <span style="font-style: italic;">"Family"</span> +work-calendar-family (my-work-calendar-color <span style="font-style: italic;">"family"</span>))
    (<span style="font-weight: bold;">cfw:org-create-file-source</span> <span style="font-style: italic;">"Work"</span> +work-calendar-work (my-work-calendar-color <span style="font-style: italic;">"work"</span>))
    )))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 432: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> calfw
  (<span style="font-weight: bold;">custom-theme-set-faces!</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">doom-one</span>
    <span style="font-weight: bold;">`</span>(cfw:face-today-title <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#FFFFFF"</span>
                           <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#2E475E"</span>)
    <span style="font-weight: bold;">`</span>(cfw:face-today <span style="font-weight: bold;">:foreground</span> ,(<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">fg</span>)
                     <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#1c2b39"</span>)
    <span style="font-weight: bold;">`</span>(cfw:face-grid <span style="font-weight: bold;">:foreground</span> ,(<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">base4</span> <span style="font-weight: bold; text-decoration: underline;">256</span>))
    <span style="font-weight: bold;">`</span>(cfw:face-select <span style="font-weight: bold;">:foreground</span> ,(<span style="font-weight: bold;">doom-darken</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">number</span> <span style="font-weight: bold; text-decoration: underline;">256</span>)
                      <span style="font-weight: bold;">:background</span> ,(<span style="font-weight: bold;">doom-lighten</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">number</span> <span style="font-weight: bold; text-decoration: underline;">256</span>))
    <span style="font-weight: bold;">`</span>(cfw:face-holiday <span style="font-weight: bold;">:foreground</span> ,(<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">green</span> <span style="font-weight: bold; text-decoration: underline;">256</span>))
    <span style="font-weight: bold;">`</span>(cfw:face-saturday <span style="font-weight: bold;">:foreground</span> ,(<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">red</span> <span style="font-weight: bold; text-decoration: underline;">256</span>))
    <span style="font-weight: bold;">`</span>(cfw:face-sunday <span style="font-weight: bold;">:foreground</span> ,(<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">red</span> <span style="font-weight: bold; text-decoration: underline;">256</span>)))

  (<span style="font-weight: bold;">map!</span> <span style="font-weight: bold;">:map</span> cfw:calendar-mode-map
        <span style="font-weight: bold;">:e</span> <span style="font-style: italic;">"q"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">+calendar/quit</span>))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 433: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defadvice!</span> my-work-calendar-open-a ()
  <span style="font-style: italic;">"Activate (or switch to) `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">calendar</span><span style="font-style: italic;">' in its workspace."</span>
  <span style="font-weight: bold;">:override</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">=calendar</span>
  (<span style="font-weight: bold;">interactive</span>)
  (+workspace-switch <span style="font-style: italic;">"Calendar"</span> t)
  (<span style="font-weight: bold;">doom/switch-to-scratch-buffer</span>)
  (+calendar--init)
  (+workspace/display))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 434: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defadvice!</span> my-work-calendar-quit-a ()
  <span style="font-style: italic;">"Activate (or switch to) `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">calendar</span><span style="font-style: italic;">' in its workspace."</span>
  <span style="font-weight: bold;">:override</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">+calendar/quit</span>
  (<span style="font-weight: bold;">interactive</span>)
  (+workspace/delete <span style="font-style: italic;">"Calendar"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgec572b9" class="outline-3">
<h3 id="orgec572b9"><span class="section-number-3">7.7</span> <span class="todo TODO">TODO</span> Contacts</h3>
<div class="outline-text-3" id="text-7-7">
<p>
TBD
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 435: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">+org-contacts-file</span> (<span style="font-weight: bold; text-decoration: underline;">expand-file-name</span> <span style="font-style: italic;">"contacts.org"</span> my-agenda-directory)
  <span style="font-style: italic;">"Path to the org file that will store all contacts."</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 436: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(use-package! org-contacts</span>
<span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">:after (org-capture)</span>
<span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">:init</span>
<span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(setq org-contacts-icon-property "PICTURE"</span>
<span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">org-contacts-icon-use-gravatar t))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1e0232a" class="outline-3">
<h3 id="org1e0232a"><span class="section-number-3">7.8</span> <span class="todo TODO">TODO</span> Time Management</h3>
<div class="outline-text-3" id="text-7-8">
<dl class="org-dl">
<dt>Triage</dt><dd>This process is to mark done tasks as done, and adjust any deadlines or other information on my tasks:
<dl class="org-dl">
<dt>Daily</dt><dd>Should be a quick 5 min check on the tasks done during the day. I will use this time to also add unexpected tasks on my list so I can have a more accurate record of my work day;</dd>
<dt>Weekly</dt><dd>Should be a more in-depth review, where I will evaluate if I need to change or amend any of the tasks I&rsquo;m tracking. This process shouldn&rsquo;t take more than 30 minutes;</dd>
</dl></dd>
</dl>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 437: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">+org-tasks-file</span> (<span style="font-weight: bold; text-decoration: underline;">expand-file-name</span> <span style="font-style: italic;">"todo.org"</span> my-tasks-directory)
  <span style="font-style: italic;">"Path to the org file that will store all habits."</span>)


(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">+org-habits-file</span> (<span style="font-weight: bold; text-decoration: underline;">expand-file-name</span> <span style="font-style: italic;">"habits.org"</span> my-agenda-directory)
  <span style="font-style: italic;">"Path to the org file that will store all habits."</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 438: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> org
  (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">org-archive-location</span> (<span style="font-weight: bold; text-decoration: underline;">concat</span> <span style="font-weight: bold; font-style: italic;">org-directory</span> <span style="font-style: italic;">"/.archives/%s::datetree/* Archived From %s"</span>)
        <span style="font-weight: bold; font-style: italic;">org-archive-tag</span> <span style="font-style: italic;">"ARCHIVED"</span>
        <span style="font-weight: bold; font-style: italic;">org-log-done</span> t
        <span style="font-weight: bold; font-style: italic;">org-todo-keywords</span> <span style="font-weight: bold;">'</span>((sequence
                             <span style="font-style: italic;">"</span><span style="font-weight: bold;">TODO</span><span style="font-style: italic;">(t)"</span>  <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">This task needs to be done.</span>

                             <span style="font-style: italic;">"NEXT(n)"</span>  <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">I committed to work on this task next. This can be used to</span>
                                        <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">plan my next day, or to indicate in a project the next</span>
                                        <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">logical step.</span>

                             <span style="font-style: italic;">"STRT(s)"</span>  <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">This task is actively in progress. Ideally you only have</span>
                                        <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">one task marked as started, but in some cases you can</span>
                                        <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">start a task, and while you wait for something to</span>
                                        <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">complete, you can start another task.</span>

                             <span style="font-style: italic;">"WAIT(w)"</span>  <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">This task is waiting some external condition to happen,</span>
                                        <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">like waiting for an authorization, waiting for account to</span>
                                        <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">be created, etc.</span>

                             <span style="font-style: italic;">"HOLD(h)"</span>  <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">This task is paused. This state can mean many different</span>
                                        <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">things. A task can be paused because I simply don't want</span>
                                        <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">to continue doing it, or it is paused because I want to</span>
                                        <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">make sure I understand I shouldn't be work on this task.</span>

                             <span style="font-style: italic;">"DELG(g)"</span>  <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">This task is delegated to someone else. Usually, a</span>
                                        <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">delegated task has a property indicating to whom it is</span>
                                        <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">delegated and when is the tentative ETA. This state is not</span>
                                        <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">considered final because I want to follow up with the</span>
                                        <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">person about the outcome.</span>
                             <span style="font-style: italic;">"|"</span>
                             <span style="font-style: italic;">"DONE(d)"</span>  <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">Task successfully completed</span>

                             <span style="font-style: italic;">"KILL(k)"</span>  <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">Task was cancelled, aborted or is no longer applicable,</span>
                                        <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">but I want to keep it as a record instead of simply</span>
                                        <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">remove it from the file.</span>
                             ))
        <span style="font-weight: bold; font-style: italic;">org-todo-keyword-faces</span> <span style="font-weight: bold;">'</span>((<span style="font-style: italic;">"STRT"</span> . +org-todo-active)
                                 (<span style="font-style: italic;">"DELG"</span> . +org-todo-active)
                                 (<span style="font-style: italic;">"WAIT"</span> . +org-todo-onhold)
                                 (<span style="font-style: italic;">"HOLD"</span> . +org-todo-onhold))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 439: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-org-agenda-buffer-config-h</span> ()
  (<span style="font-weight: bold;">evil-window-set-width</span> <span style="font-weight: bold; text-decoration: underline;">100</span>)
  (doom-themes-hide-modeline)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(variable-pitch-mode -1)</span>
  (<span style="font-weight: bold;">setq-local</span> <span style="font-weight: bold; font-style: italic;">wrap-prefix</span> (<span style="font-weight: bold;">s-repeat</span> +org-agenda--wrap-prefix <span style="font-style: italic;">" "</span>))
  (<span style="font-weight: bold;">setq</span> writeroom-width <span style="font-weight: bold; text-decoration: underline;">65</span>)
  (<span style="font-weight: bold;">+zen/toggle</span> <span style="font-weight: bold; text-decoration: underline;">1</span>)
  (<span style="font-weight: bold; font-style: italic;">visual-line-mode</span> <span style="font-weight: bold; text-decoration: underline;">1</span>)
  (<span style="font-weight: bold;">tab-line-mode</span> <span style="font-weight: bold; text-decoration: underline;">-1</span>)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(hl-line-mode -1)</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold; text-decoration: underline;">not</span> (<span style="font-weight: bold; text-decoration: underline;">=</span> text-scale-mode-amount <span style="font-weight: bold; text-decoration: underline;">1</span>))
    (<span style="font-weight: bold;">setq-local</span> text-scale-mode-amount <span style="font-weight: bold; text-decoration: underline;">1</span>)
    (text-scale-mode <span style="font-weight: bold; text-decoration: underline;">1</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 440: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-org-agenda-setup-time-grid-h</span> ()
  <span style="font-style: italic;">"Set different line spacing based on clock time duration."</span>
  (<span style="font-weight: bold;">let</span> (first-item)
    (<span style="font-weight: bold;">save-excursion</span>
      (<span style="font-weight: bold;">let</span> (pos duration curr-time blocked-time marker)
        (<span style="font-weight: bold; text-decoration: underline;">goto-char</span> (<span style="font-weight: bold; text-decoration: underline;">point-min</span>))

        (<span style="font-weight: bold;">while</span> (<span style="font-weight: bold;">setq</span> pos (<span style="font-weight: bold; text-decoration: underline;">next-single-property-change</span> (<span style="font-weight: bold; text-decoration: underline;">point</span>) <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">time-of-day</span>))
          (<span style="font-weight: bold; text-decoration: underline;">goto-char</span> pos)
          (<span style="font-weight: bold;">setq</span> curr-time (<span style="font-weight: bold;">org-get-at-bol</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">time-of-day</span>))
          (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold; text-decoration: underline;">not</span> (<span style="font-weight: bold; text-decoration: underline;">equal</span> pos (<span style="font-weight: bold; text-decoration: underline;">point-at-eol</span>)))
                     curr-time)
            (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">setq</span> duration (<span style="font-weight: bold;">org-get-at-bol</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">duration</span>))
                (<span style="font-weight: bold;">progn</span>
                  (<span style="font-weight: bold;">unless</span> first-item (<span style="font-weight: bold;">setq</span> first-item pos))
                  (<span style="font-weight: bold;">setq</span> blocked-time (<span style="font-weight: bold; text-decoration: underline;">max</span> (<span style="font-weight: bold; text-decoration: underline;">+</span> curr-time (<span style="font-weight: bold; text-decoration: underline;">*</span> (<span style="font-weight: bold; text-decoration: underline;">/</span> duration <span style="font-weight: bold; text-decoration: underline;">60.0</span>) <span style="font-weight: bold; text-decoration: underline;">100.0</span>))
                                          (<span style="font-weight: bold;">or</span> blocked-time <span style="font-weight: bold; text-decoration: underline;">0</span>)))

                  (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">&gt;</span> (<span style="font-weight: bold; text-decoration: underline;">+</span> (<span style="font-weight: bold; text-decoration: underline;">point-at-bol</span>) <span style="font-weight: bold; text-decoration: underline;">71</span>) (<span style="font-weight: bold; text-decoration: underline;">point-at-eol</span>))
                      (<span style="font-weight: bold;">progn</span>
                        (<span style="font-weight: bold; text-decoration: underline;">goto-char</span> (<span style="font-weight: bold; text-decoration: underline;">point-at-eol</span>))
                        (<span style="font-weight: bold; text-decoration: underline;">insert-char</span> <span style="font-weight: bold; text-decoration: underline;">#x20</span> (<span style="font-weight: bold; text-decoration: underline;">-</span> <span style="font-weight: bold; text-decoration: underline;">71</span> (<span style="font-weight: bold; text-decoration: underline;">-</span> (<span style="font-weight: bold; text-decoration: underline;">point-at-eol</span>) (<span style="font-weight: bold; text-decoration: underline;">point-at-bol</span>))) t))
                    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold; text-decoration: underline;">&lt;</span> (<span style="font-weight: bold; text-decoration: underline;">+</span> (<span style="font-weight: bold; text-decoration: underline;">point-at-bol</span>) <span style="font-weight: bold; text-decoration: underline;">69</span>) (<span style="font-weight: bold; text-decoration: underline;">point-at-eol</span>))
                      (<span style="font-weight: bold; text-decoration: underline;">goto-char</span> (<span style="font-weight: bold; text-decoration: underline;">+</span> (<span style="font-weight: bold; text-decoration: underline;">point-at-bol</span>) <span style="font-weight: bold; text-decoration: underline;">69</span>))
                      (<span style="font-weight: bold; text-decoration: underline;">delete-region</span> (<span style="font-weight: bold; text-decoration: underline;">point</span>) (<span style="font-weight: bold; text-decoration: underline;">point-at-eol</span>))
                      (<span style="font-weight: bold; text-decoration: underline;">insert-char</span> ?&#8230; <span style="font-weight: bold; text-decoration: underline;">1</span> t)
                      (<span style="font-weight: bold; text-decoration: underline;">insert-char</span> <span style="font-weight: bold; text-decoration: underline;">#x20</span> <span style="font-weight: bold; text-decoration: underline;">1</span> t)))

                  (<span style="font-weight: bold; text-decoration: underline;">remove-text-properties</span> (<span style="font-weight: bold; text-decoration: underline;">point-at-bol</span>) (<span style="font-weight: bold; text-decoration: underline;">point-at-eol</span>) <span style="font-weight: bold;">'</span>(mouse-face nil))

                  (<span style="font-weight: bold;">let*</span> ((line-height (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold; text-decoration: underline;">&lt;</span> duration <span style="font-weight: bold; text-decoration: underline;">15</span>) <span style="font-weight: bold; text-decoration: underline;">1.0</span> (<span style="font-weight: bold; text-decoration: underline;">+</span> <span style="font-weight: bold; text-decoration: underline;">0.5</span> (<span style="font-weight: bold; text-decoration: underline;">/</span> duration <span style="font-weight: bold; text-decoration: underline;">30</span>))))
                         (block-start (<span style="font-weight: bold; text-decoration: underline;">+</span> (<span style="font-weight: bold; text-decoration: underline;">point-at-bol</span>) (<span style="font-weight: bold; text-decoration: underline;">-</span> +org-agenda--category-length <span style="font-weight: bold; text-decoration: underline;">1</span>)))
                         (block-end (<span style="font-weight: bold; text-decoration: underline;">+</span> block-start <span style="font-weight: bold; text-decoration: underline;">59</span>))
                         (ov (<span style="font-weight: bold; text-decoration: underline;">make-overlay</span> (<span style="font-weight: bold; text-decoration: underline;">point-at-bol</span>) (<span style="font-weight: bold; text-decoration: underline;">1+</span> (<span style="font-weight: bold; text-decoration: underline;">point-at-eol</span>))))
                         (color-ov (<span style="font-weight: bold; text-decoration: underline;">make-overlay</span> block-start block-end))
                         (mouse-ov (<span style="font-weight: bold; text-decoration: underline;">make-overlay</span> block-start (<span style="font-weight: bold; text-decoration: underline;">point-at-eol</span>)))
                         (cal (<span style="font-weight: bold;">org-get-at-bol</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">org-category</span>)))
                    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">setq</span> marker (<span style="font-weight: bold;">org-get-at-bol</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">org-marker</span>))
                      (<span style="font-weight: bold; text-decoration: underline;">add-text-properties</span> (<span style="font-weight: bold; text-decoration: underline;">point-at-bol</span>)
                                           (<span style="font-weight: bold; text-decoration: underline;">point-at-eol</span>)
                                           <span style="font-weight: bold;">`</span>(org-target-file ,(<span style="font-weight: bold; text-decoration: underline;">cons</span>
                                                               (<span style="font-weight: bold; font-style: italic;">buffer-file-name</span> (<span style="font-weight: bold; text-decoration: underline;">marker-buffer</span> marker))
                                                               (<span style="font-weight: bold; text-decoration: underline;">marker-position</span> marker)))))

                    (<span style="font-weight: bold; text-decoration: underline;">overlay-put</span> ov <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">priority</span> <span style="font-weight: bold; text-decoration: underline;">1010</span>)
                    (<span style="font-weight: bold; text-decoration: underline;">overlay-put</span> ov <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">line-height</span> line-height)
                    (<span style="font-weight: bold; text-decoration: underline;">overlay-put</span> ov <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">line-spacing</span> (<span style="font-weight: bold; text-decoration: underline;">1-</span> line-height))
                    (<span style="font-weight: bold; text-decoration: underline;">overlay-put</span> color-ov <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">priority</span> <span style="font-weight: bold; text-decoration: underline;">1020</span>)
                    (<span style="font-weight: bold; text-decoration: underline;">overlay-put</span> color-ov <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">face</span> <span style="font-weight: bold;">`</span>(<span style="font-weight: bold;">:background</span> ,(my-work-calendar-color cal <span style="font-weight: bold;">:bg</span>)
                                                  <span style="font-weight: bold;">:foreground</span> ,(my-work-calendar-color cal <span style="font-weight: bold;">:fg</span>)
                                                  <span style="font-weight: bold;">:box</span> (<span style="font-weight: bold;">:line-width</span> <span style="font-weight: bold; text-decoration: underline;">-2</span> <span style="font-weight: bold;">:color</span> ,(<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">bg</span>))))
                    (<span style="font-weight: bold; text-decoration: underline;">overlay-put</span> mouse-ov <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">priority</span> <span style="font-weight: bold; text-decoration: underline;">1030</span>)
                    (<span style="font-weight: bold; text-decoration: underline;">overlay-put</span> mouse-ov <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">mouse-face</span> <span style="font-weight: bold;">`</span>(<span style="font-weight: bold;">:background</span> ,(my-work-calendar-color cal)
                                                        <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"white"</span>
                                                        <span style="font-weight: bold;">:box</span> (<span style="font-weight: bold;">:line-width</span> <span style="font-weight: bold; text-decoration: underline;">-2</span> <span style="font-weight: bold;">:color</span> ,(<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">bg</span>))))))
              (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold; text-decoration: underline;">&lt;</span> curr-time (<span style="font-weight: bold;">or</span> blocked-time <span style="font-weight: bold; text-decoration: underline;">-1</span>))
                (<span style="font-weight: bold; font-style: italic;">kill-whole-line</span>)
                (<span style="font-weight: bold;">previous-line</span>)))))))
    (<span style="font-weight: bold;">when</span> first-item
      (<span style="font-weight: bold; text-decoration: underline;">goto-char</span> first-item))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 441: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defadvice!</span> my-org-agenda-reset-font-a (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> _)
  <span style="font-style: italic;">"Reset text scale before running `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-agenda-redo</span><span style="font-style: italic;">' to prevent messing with</span>
<span style="font-style: italic;">layout."</span>
  <span style="font-weight: bold;">:before</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">org-agenda-redo</span>
  (<span style="font-weight: bold;">setq-local</span> text-scale-mode-amount <span style="font-weight: bold; text-decoration: underline;">0</span>)
  (text-scale-mode <span style="font-weight: bold; text-decoration: underline;">-1</span>))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 442: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">+org-agenda--category-length</span> <span style="font-weight: bold; text-decoration: underline;">14</span>
  <span style="font-style: italic;">"The length of the space categories occupy on org-agenda"</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 443: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">+org-agenda--wrap-prefix</span> (<span style="font-weight: bold; text-decoration: underline;">+</span> +org-agenda--category-length <span style="font-weight: bold; text-decoration: underline;">5</span>)
  <span style="font-style: italic;">"Length that a wrapped text should indent on org-agenda. This</span>
<span style="font-style: italic;">length is the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">+org-agenda--category-length</span><span style="font-style: italic;">' plus 5 characters to</span>
<span style="font-style: italic;">account for the </span><span style="font-weight: bold;">TODO</span><span style="font-style: italic;"> word plus one space."</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 444: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> org
  (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">org-agenda-block-separator</span> <span style="font-style: italic;">" "</span>
        <span style="font-weight: bold; font-style: italic;">org-agenda-compact-blocks</span> nil
        <span style="font-weight: bold; font-style: italic;">org-agenda-current-time-string</span> <span style="font-style: italic;">"&#9664;- now - - - - - - - - - - - - - - - - - - -"</span>
        <span style="font-weight: bold; font-style: italic;">org-agenda-files</span>  (<span style="font-weight: bold; text-decoration: underline;">append</span> (<span style="font-weight: bold; text-decoration: underline;">list</span> +org-tasks-file my-journal-file) +org-calendars-files)
        <span style="font-weight: bold; font-style: italic;">org-agenda-include-deadlines</span> t
        <span style="font-weight: bold; font-style: italic;">org-agenda-skip-deadline-if-done</span> t
        <span style="font-weight: bold; font-style: italic;">org-agenda-skip-scheduled-if-done</span> t
        <span style="font-weight: bold; font-style: italic;">org-agenda-time-grid</span> <span style="font-weight: bold;">'</span>((daily today require-timed remove-match)
                               (<span style="font-weight: bold; text-decoration: underline;">700</span> <span style="font-weight: bold; text-decoration: underline;">800</span> <span style="font-weight: bold; text-decoration: underline;">900</span> <span style="font-weight: bold; text-decoration: underline;">1000</span> <span style="font-weight: bold; text-decoration: underline;">1100</span> <span style="font-weight: bold; text-decoration: underline;">1200</span> <span style="font-weight: bold; text-decoration: underline;">1300</span> <span style="font-weight: bold; text-decoration: underline;">1400</span> <span style="font-weight: bold; text-decoration: underline;">1500</span> <span style="font-weight: bold; text-decoration: underline;">1600</span> <span style="font-weight: bold; text-decoration: underline;">1700</span> <span style="font-weight: bold; text-decoration: underline;">1800</span>)
                               <span style="font-style: italic;">"&#183;&#183;&#183;&#183;&#183;&#183;"</span>
                               <span style="font-style: italic;">"&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;"</span>)
        <span style="font-weight: bold; font-style: italic;">org-agenda-window-setup</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">other-window</span>))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 445: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-contain-buffer-p</span> (lst buf)
  <span style="font-style: italic;">"Return t if th given BUF is in the given LST.</span>

<span style="font-style: italic;">This function searches the buffer in all nested lists containd in LST."</span>
  (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold; text-decoration: underline;">not</span> lst)
    (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">seqp</span> lst)
        (<span style="font-weight: bold;">seq-some</span> (<span style="font-weight: bold;">lambda</span> (elm) (my-contain-buffer-p elm buf)) lst)
      (<span style="font-weight: bold; text-decoration: underline;">eq</span> lst buf))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 446: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-bring-buffer-to-front</span> (buffer-or-name)
  <span style="font-style: italic;">"Make sure buffer is visible on its window.</span>

<span style="font-style: italic;">BUFFER-OR-NAME is the buffer to look for.</span>

<span style="font-style: italic;">Return t if the buffer moved to front."</span>
  (<span style="font-weight: bold;">when-let</span> ((buf (<span style="font-weight: bold;">when</span> buffer-or-name (<span style="font-weight: bold; text-decoration: underline;">get-buffer</span> buffer-or-name)))
             (win (<span style="font-weight: bold;">seq-find</span> (<span style="font-weight: bold;">lambda</span> (window)
                              (<span style="font-weight: bold;">seq-some</span> (<span style="font-weight: bold;">lambda</span> (buf-list) (my-contain-buffer-p buf-list buf))
                                        (<span style="font-weight: bold; text-decoration: underline;">append</span> (<span style="font-weight: bold; text-decoration: underline;">mapcar</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">car</span> (<span style="font-weight: bold; text-decoration: underline;">window-prev-buffers</span> window))
                                                (<span style="font-weight: bold; text-decoration: underline;">list</span> (<span style="font-weight: bold; text-decoration: underline;">window-buffer</span> window))
                                                (<span style="font-weight: bold; text-decoration: underline;">window-next-buffers</span> window))))
                            (<span style="font-weight: bold; text-decoration: underline;">window-list</span>))))
    (<span style="font-weight: bold; text-decoration: underline;">set-window-buffer</span> win buf t)
    t))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 447: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-bring-org-agenda-to-front-h</span> ()
  (<span style="font-weight: bold;">when</span> (my-bring-buffer-to-front <span style="font-weight: bold; font-style: italic;">org-agenda-buffer</span>)
    (my-org-agenda-buffer-config-h)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 448: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">custom-set-faces!</span>
  <span style="font-weight: bold;">`</span>(org-agenda-current-time <span style="font-weight: bold;">:foreground</span> ,(<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">red</span> <span style="font-weight: bold; text-decoration: underline;">256</span>))
  <span style="font-weight: bold;">`</span>(org-agenda-date-today <span style="font-weight: bold;">:foreground</span> ,(<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">violet</span> <span style="font-weight: bold; text-decoration: underline;">256</span>)
                          <span style="font-weight: bold;">:height</span> <span style="font-weight: bold; text-decoration: underline;">1.5</span>
                          <span style="font-weight: bold;">:weight</span> bold
                          <span style="font-weight: bold;">:inherit</span> variable-pitch))

(<span style="font-weight: bold;">after!</span> org-agenda
  (<span style="font-weight: bold;">add-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">org-agenda-mode-hook</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-org-agenda-buffer-config-h</span>)
  (<span style="font-weight: bold;">add-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">org-agenda-finalize-hook</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-org-agenda-setup-time-grid-h</span>)
  (<span style="font-weight: bold;">add-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">window-state-change-hook</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">my-bring-org-agenda-to-front-h</span>)
  (<span style="font-weight: bold;">remove-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">org-agenda-finalize-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">+org-exclude-agenda-buffers-from-workspace-h</span>)
  (<span style="font-weight: bold;">remove-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">org-agenda-finalize-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">+org-defer-mode-in-agenda-buffers-h</span>))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 449: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">after!</span> evil-org-agenda
  (<span style="font-weight: bold;">map!</span> <span style="font-weight: bold;">:map</span> evil-org-agenda-mode-map
        <span style="font-weight: bold;">:nvm</span> [return] <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">org-agenda-goto</span>
        <span style="font-weight: bold;">:nvm</span> <span style="font-style: italic;">"RET"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">org-agenda-goto</span>
        <span style="font-weight: bold;">:nvm</span> <span style="font-style: italic;">"j"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">org-agenda-next-item</span>
        <span style="font-weight: bold;">:nvm</span> <span style="font-style: italic;">"l"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">org-agenda-next-item</span>
        <span style="font-weight: bold;">:nvm</span> <span style="font-style: italic;">"k"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">org-agenda-previous-item</span>
        <span style="font-weight: bold;">:nvm</span> <span style="font-style: italic;">"h"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">org-agenda-previous-item</span>
        <span style="font-weight: bold;">:nvm</span> <span style="font-style: italic;">"&lt;DOWN&gt;"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">org-agenda-next-item</span>
        <span style="font-weight: bold;">:nvm</span> <span style="font-style: italic;">"&lt;RIGHT&gt;"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">org-agenda-next-item</span>
        <span style="font-weight: bold;">:nvm</span> <span style="font-style: italic;">"&lt;UP&gt;"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">org-agenda-previous-item</span>
        <span style="font-weight: bold;">:nvm</span> <span style="font-style: italic;">"&lt;LEFT&gt;"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">org-agenda-previous-item</span>
        <span style="font-weight: bold;">:nvm</span> [down] <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">org-agenda-next-item</span>
        <span style="font-weight: bold;">:nvm</span> [right] <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">org-agenda-next-item</span>
        <span style="font-weight: bold;">:nvm</span> [up] <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">org-agenda-previous-item</span>
        <span style="font-weight: bold;">:nvm</span> [left] <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">org-agenda-previous-item</span>
        <span style="font-weight: bold;">:nvm</span> <span style="font-style: italic;">"C-h"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">evil-window-left</span>
        <span style="font-weight: bold;">:nvm</span> <span style="font-style: italic;">"C-j"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">evil-window-down</span>
        <span style="font-weight: bold;">:nvm</span> <span style="font-style: italic;">"C-k"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">evil-window-up</span>
        <span style="font-weight: bold;">:nvm</span> <span style="font-style: italic;">"C-l"</span> <span style="font-weight: bold;">#'</span><span style="font-weight: bold; text-decoration: underline;">evil-window-right</span>
        <span style="font-weight: bold;">:nvm</span> <span style="font-style: italic;">"G"</span> <span style="font-weight: bold;">#'</span>(lambda ()
                     (<span style="font-weight: bold;">interactive</span>)
                     (<span style="font-weight: bold; text-decoration: underline;">goto-char</span> (<span style="font-weight: bold; text-decoration: underline;">point-max</span>)) (<span style="font-weight: bold;">org-agenda-previous-item</span> <span style="font-weight: bold; text-decoration: underline;">1</span>))
        (<span style="font-weight: bold;">:prefix</span> (<span style="font-style: italic;">"g"</span> . <span style="font-style: italic;">"goto"</span>)
         <span style="font-weight: bold;">:desc</span> <span style="font-style: italic;">"Go to first item"</span> <span style="font-weight: bold;">:nvm</span> <span style="font-style: italic;">"g"</span> <span style="font-weight: bold;">#'</span>(lambda ()
                                               (<span style="font-weight: bold;">interactive</span>)
                                               (<span style="font-weight: bold; text-decoration: underline;">goto-char</span> (<span style="font-weight: bold; text-decoration: underline;">point-min</span>))
                                               (<span style="font-weight: bold;">org-agenda-next-item</span> <span style="font-weight: bold; text-decoration: underline;">1</span>)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 450: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">package!</span> org-super-agenda)
(<span style="font-weight: bold;">package!</span> org-ql)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 451: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defadvice!</span> my-org-agenda-make-agenda-icon-header-a (func name)
  <span style="font-weight: bold;">:around</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">org-super-agenda--make-agenda-header</span>
  (<span style="font-weight: bold;">let</span> ((icon (<span style="font-weight: bold; text-decoration: underline;">get-text-property</span> <span style="font-weight: bold; text-decoration: underline;">0</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">icon</span> name))
        (icon-color (<span style="font-weight: bold; text-decoration: underline;">get-text-property</span> <span style="font-weight: bold; text-decoration: underline;">0</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">icon-color</span> name))
        (header (<span style="font-weight: bold;">s-trim</span> (<span style="font-weight: bold; text-decoration: underline;">funcall</span> func name))))
    (<span style="font-weight: bold; text-decoration: underline;">concat</span>
     <span style="font-style: italic;">"\n"</span>
     (<span style="font-weight: bold;">when</span> icon
       (<span style="font-weight: bold; text-decoration: underline;">format</span> <span style="font-style: italic;">"%s "</span> (my-icon icon icon-color)))
     header
     <span style="font-style: italic;">"\n"</span>
     (<span style="font-weight: bold;">if</span> icon
         (<span style="font-weight: bold;">s-repeat</span> (<span style="font-weight: bold; text-decoration: underline;">+</span> <span style="font-weight: bold; text-decoration: underline;">3</span> (<span style="font-weight: bold; text-decoration: underline;">length</span> header)) <span style="font-style: italic;">"&#9472;"</span>)
       (<span style="font-weight: bold;">s-repeat</span> (<span style="font-weight: bold; text-decoration: underline;">length</span> header) <span style="font-style: italic;">"&#9472;"</span>)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 452: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-org-agenda-group-title</span> (text <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> icon icon-color)
  (<span style="font-weight: bold; text-decoration: underline;">propertize</span> text <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">icon</span> icon <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">icon-color</span> icon-color))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 453: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package!</span> org-super-agenda
  <span style="font-weight: bold;">:commands</span> (<span style="font-weight: bold;">org-agenda</span>)
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">org-agenda-custom-commands</span>
        <span style="font-weight: bold;">'</span>((<span style="font-style: italic;">"c"</span> <span style="font-style: italic;">"Super view"</span>
           ((agenda <span style="font-style: italic;">""</span> ((<span style="font-weight: bold; font-style: italic;">org-agenda-span</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">day</span>)
                        (<span style="font-weight: bold; font-style: italic;">org-agenda-start-day</span> (<span style="font-weight: bold; text-decoration: underline;">format-time-string</span> <span style="font-style: italic;">"%Y-%m-%d"</span>))
                        (<span style="font-weight: bold; font-style: italic;">org-agenda-skip-function</span> <span style="font-weight: bold;">'</span>(org-agenda-skip-entry-if <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">deadline</span>))
                        (<span style="font-weight: bold; font-style: italic;">org-agenda-show-all-dates</span> t)
                        (<span style="font-weight: bold; font-style: italic;">org-agenda-use-time-grid</span> t)
                        (<span style="font-weight: bold; font-style: italic;">org-agenda-overriding-header</span> <span style="font-style: italic;">""</span>)
                        (org-super-agenda-groups
                         <span style="font-weight: bold;">`</span>((<span style="font-weight: bold;">:name</span> ,(my-org-agenda-group-title <span style="font-style: italic;">"Agenda"</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">calendar</span> (<span style="font-weight: bold;">doom-lighten</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">blue</span> <span style="font-weight: bold; text-decoration: underline;">0.5</span>))
                            <span style="font-weight: bold;">:time-grid</span> t
                            <span style="font-weight: bold;">:and</span> (<span style="font-weight: bold;">:date</span> today
                                  <span style="font-weight: bold;">:todo</span> nil))))))
            (alltodo <span style="font-style: italic;">""</span> ((<span style="font-weight: bold; font-style: italic;">org-agenda-overriding-header</span> <span style="font-style: italic;">""</span>)
                         (org-super-agenda-groups
                          <span style="font-weight: bold;">`</span>(
                            (<span style="font-weight: bold;">:name</span> ,(my-org-agenda-group-title <span style="font-style: italic;">"Inbox"</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">inbox</span> (<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">orange</span>))
                             <span style="font-weight: bold;">:category</span> <span style="font-style: italic;">"journal"</span>
                             <span style="font-weight: bold;">:order</span> <span style="font-weight: bold; text-decoration: underline;">15</span>)
                            (<span style="font-weight: bold;">:name</span> ,(my-org-agenda-group-title <span style="font-style: italic;">"Delegated"</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">assign</span> (<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">orange</span>))
                             <span style="font-weight: bold;">:todo</span> <span style="font-style: italic;">"DELG"</span>
                             <span style="font-weight: bold;">:order</span> <span style="font-weight: bold; text-decoration: underline;">45</span>)
                            (<span style="font-weight: bold;">:name</span> ,(my-org-agenda-group-title <span style="font-style: italic;">"Waiting"</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">wait</span>  (<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">yellow</span>))
                             <span style="font-weight: bold;">:todo</span> <span style="font-style: italic;">"WAIT"</span>
                             <span style="font-weight: bold;">:order</span> <span style="font-weight: bold; text-decoration: underline;">35</span>)
                            (<span style="font-weight: bold;">:name</span> ,(my-org-agenda-group-title <span style="font-style: italic;">"On Hold"</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">pause</span> (<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">yellow</span>))
                             <span style="font-weight: bold;">:todo</span> <span style="font-style: italic;">"HOLD"</span>
                             <span style="font-weight: bold;">:order</span> <span style="font-weight: bold; text-decoration: underline;">40</span>)
                            (<span style="font-weight: bold;">:name</span> ,(my-org-agenda-group-title <span style="font-style: italic;">"Issues"</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">bug</span> (<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">red</span>))
                             <span style="font-weight: bold;">:tag</span> <span style="font-style: italic;">"issue"</span>
                             <span style="font-weight: bold;">:order</span> <span style="font-weight: bold; text-decoration: underline;">30</span>)
                            (<span style="font-weight: bold;">:name</span> ,(my-org-agenda-group-title <span style="font-style: italic;">"Habits"</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">loop</span> (<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">blue</span>))
                             <span style="font-weight: bold;">:habit</span> t
                             <span style="font-weight: bold;">:order</span> <span style="font-weight: bold; text-decoration: underline;">1</span>)
                            (<span style="font-weight: bold;">:name</span> ,(my-org-agenda-group-title <span style="font-style: italic;">"Overdue"</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">busy</span> (<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">red</span>))
                             <span style="font-weight: bold;">:deadline</span> past
                             <span style="font-weight: bold;">:face</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">all-the-icons-dpink</span>
                             <span style="font-weight: bold;">:order</span> <span style="font-weight: bold; text-decoration: underline;">4</span>)
                            (<span style="font-weight: bold;">:name</span> ,(my-org-agenda-group-title <span style="font-style: italic;">"Due Today"</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">new</span> (<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">orange</span>))
                             <span style="font-weight: bold;">:deadline</span> today
                             <span style="font-weight: bold;">:face</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">all-the-icons-orange</span>
                             <span style="font-weight: bold;">:order</span> <span style="font-weight: bold; text-decoration: underline;">5</span>)
                            (<span style="font-weight: bold;">:name</span> ,(my-org-agenda-group-title <span style="font-style: italic;">"Actionable"</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">checked</span> (<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">green</span>))
                             <span style="font-weight: bold;">:and</span> (<span style="font-weight: bold;">:todo</span> (<span style="font-style: italic;">"</span><span style="font-weight: bold;">TODO</span><span style="font-style: italic;">"</span> <span style="font-style: italic;">"STRT"</span>)
                                   <span style="font-weight: bold;">:scheduled</span> (past today)
                                   <span style="font-weight: bold;">:deadline</span> nil)
                             <span style="font-weight: bold;">:order</span> <span style="font-weight: bold; text-decoration: underline;">21</span>)
                            (<span style="font-weight: bold;">:name</span> ,(my-org-agenda-group-title <span style="font-style: italic;">"Due Soon"</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">snooze</span> (<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">yellow</span>))
                             <span style="font-weight: bold;">:deadline</span> future
                             <span style="font-weight: bold;">:face</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">all-the-icons-yellow</span>
                             <span style="font-weight: bold;">:order</span> <span style="font-weight: bold; text-decoration: underline;">10</span>)
                            (<span style="font-weight: bold;">:name</span> ,(my-org-agenda-group-title <span style="font-style: italic;">"Important"</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">error</span> (<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">red</span>))
                             <span style="font-weight: bold;">:priority</span> <span style="font-style: italic;">"A"</span>
                             <span style="font-weight: bold;">:order</span> <span style="font-weight: bold; text-decoration: underline;">15</span>)
                            (<span style="font-weight: bold;">:name</span> ,(my-org-agenda-group-title <span style="font-style: italic;">"Next to do"</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">visibility</span> (<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">yellow</span>))
                             <span style="font-weight: bold;">:todo</span> <span style="font-style: italic;">"NEXT"</span>
                             <span style="font-weight: bold;">:order</span> <span style="font-weight: bold; text-decoration: underline;">20</span>)
                            (<span style="font-weight: bold;">:name</span> ,(my-org-agenda-group-title <span style="font-style: italic;">"To do"</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">checked</span> (<span style="font-weight: bold;">doom-color</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; text-decoration: underline;">green</span>))
                             <span style="font-weight: bold;">:anything</span> t
                             <span style="font-weight: bold;">:order</span> <span style="font-weight: bold; text-decoration: underline;">23</span>)
                            ))))))))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> org-super-agenda-header-map nil)
  (org-super-agenda-mode))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org53c0602" class="outline-2">
<h2 id="org53c0602"><span class="section-number-2">8</span> Appendix</h2>
<div class="outline-text-2" id="text-8">
</div>
<div id="outline-container-org470541e" class="outline-3">
<h3 id="org470541e"><span class="section-number-3">8.1</span> The <code>init.el</code> file</h3>
<div class="outline-text-3" id="text-8-1">
<p>
We can&rsquo;t tangle the <code>init.el</code> on Doom because it is always loaded before <code>doom sync</code> starts tangling <code>config.org</code>.
</p>

<p>
I have two alternatives here:
</p>

<ol class="org-ol">
<li>Let <code>init.el</code> as a lisp package;</li>
<li>Create a <code>doom sync</code> extension to tangle a <code>init.org</code> file;</li>
</ol>

<p>
For now, I will keep it as a separated Lisp file that I&rsquo;m reproducing in this appendix for sake of documentation:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 454: </span>$DOOMDIR/init.el</label><pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;; </span><span style="font-weight: bold; font-style: italic;">init.el -*- lexical-binding: t; -*-</span>

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">This file controls what Doom modules are enabled and what order they load</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">in. Remember to run 'doom sync' after modifying it!</span>

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold;">NOTE</span><span style="font-weight: bold; font-style: italic;"> Press 'SPC h d h' (or 'C-h d h' for non-vim users) to access Doom's</span>
<span style="font-weight: bold; font-style: italic;">;;      </span><span style="font-weight: bold; font-style: italic;">documentation. There you'll find a "Module Index" link where you'll find</span>
<span style="font-weight: bold; font-style: italic;">;;      </span><span style="font-weight: bold; font-style: italic;">a comprehensive list of Doom's modules and what flags they support.</span>

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold;">NOTE</span><span style="font-weight: bold; font-style: italic;"> Move your cursor over a module's name (or its flags) and press 'K' (or</span>
<span style="font-weight: bold; font-style: italic;">;;      </span><span style="font-weight: bold; font-style: italic;">'C-c c k' for non-vim users) to view its documentation. This works on</span>
<span style="font-weight: bold; font-style: italic;">;;      </span><span style="font-weight: bold; font-style: italic;">flags as well (those symbols that start with a plus).</span>
<span style="font-weight: bold; font-style: italic;">;;</span>
<span style="font-weight: bold; font-style: italic;">;;      </span><span style="font-weight: bold; font-style: italic;">Alternatively, press 'gd' (or 'C-c c d') on a module to browse its</span>
<span style="font-weight: bold; font-style: italic;">;;      </span><span style="font-weight: bold; font-style: italic;">directory (for easy access to its source code).</span>

(<span style="font-weight: bold;">doom!</span> <span style="font-weight: bold;">:input</span>
       <span style="font-weight: bold; font-style: italic;">;;</span><span style="font-weight: bold; font-style: italic;">chinese</span>
       <span style="font-weight: bold; font-style: italic;">;;</span><span style="font-weight: bold; font-style: italic;">japanese</span>
       <span style="font-weight: bold; font-style: italic;">;;</span><span style="font-weight: bold; font-style: italic;">layout            ; auie,ctsrnm is the superior home row</span>

       <span style="font-weight: bold;">:completion</span>
       (company          <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">the ultimate code completion backend</span>
        +childframe
        )
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">helm              ; the *other* search engine for love and life</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">ido               ; the other *other* search engine...</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">ivy               ; a search engine for love and life</span>

       <span style="font-weight: bold;">:ui</span>
       deft              <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">notational velocity for Emacs</span>
       doom              <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">what makes DOOM look the way it does</span>
       doom-dashboard    <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">a nifty splash screen for Emacs</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">doom-quit         ; DOOM quit-message prompts when you quit Emacs</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(emoji +unicode)  ; &#128578;</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">fill-column       ; a `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">fill-column</span><span style="font-weight: bold; font-style: italic;">' indicator</span>
       hl-todo           <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">highlight </span><span style="font-weight: bold;">TODO</span><span style="font-weight: bold; font-style: italic;">/</span><span style="font-weight: bold;">FIXME</span><span style="font-weight: bold; font-style: italic;">/</span><span style="font-weight: bold;">NOTE</span><span style="font-weight: bold; font-style: italic;">/</span><span style="font-weight: bold; font-style: italic;">DEPRECATED</span><span style="font-weight: bold; font-style: italic;">/</span><span style="font-weight: bold; text-decoration: underline;">HACK</span><span style="font-weight: bold; font-style: italic;">/</span><span style="font-weight: bold;">REVIEW</span>
       hydra
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">indent-guides     ; highlighted indent columns</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">ligatures         ; ligatures and symbols to make your code pretty again</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">minimap           ; show a map of the code on the side</span>
       modeline          <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">snazzy, Atom-inspired modeline, plus API</span>
       nav-flash         <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">blink cursor line after big motions</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">neotree           ; a project drawer, like NERDTree for vim</span>
       ophints           <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">highlight the region an operation acts on</span>
       (popup            <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">tame sudden yet inevitable temporary windows</span>
        +all             <span style="font-weight: bold; font-style: italic;">;</span>
        +defaults
        )
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">tabs              ; a tab bar for Emacs</span>
       (<span style="font-weight: bold;">treemacs</span>         <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">a project drawer, like neotree but cooler</span>
        +lsp
        )
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">unicode           ; extended unicode support for various languages</span>
       vc-gutter         <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">vcs diff in the fringe</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">vi-tilde-fringe   ; fringe tildes to mark beyond EOB</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">window-select     ; visually switch windows</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">workspaces        ; tab emulation, persistence &amp; separate workspaces</span>
       zen               <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">distraction-free coding or writing</span>

       <span style="font-weight: bold;">:editor</span>
       (evil             <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">come to the dark side, we have cookies</span>
        +everywhere
        )
       file-templates    <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">auto-snippets for empty files</span>
       fold              <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">(nigh) universal code folding</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(format           ; automated prettiness</span>
       <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">+onsave</span>
       <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">)</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">god               ; run Emacs commands without modifier keys</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">lispy             ; vim for lisp, for people who don't like vim</span>
       multiple-cursors  <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">editing in many places at once</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">objed             ; text object editing for the innocent</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">parinfer          ; turn lisp into python, sort of</span>
       rotate-text       <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">cycle region at point between text candidates</span>
       snippets          <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">my elves. They type so I don't have to</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">word-wrap         ; soft wrapping with language-aware indent</span>

       <span style="font-weight: bold;">:emacs</span>
       (<span style="font-weight: bold;">dired</span>            <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">making dired pretty [functional]</span>
        +icons
        )
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">electric          ; smarter, keyword-based electric-indent</span>
       (<span style="font-weight: bold;">ibuffer</span>          <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">interactive buffer management</span>
        +icons
        )
       (<span style="font-weight: bold;">undo</span>             <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">persistent, smarter undo for your inevitable mistakes</span>
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">+tree</span>
        )
       vc                <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">version-control and Emacs, sitting in a tree</span>

       <span style="font-weight: bold;">:term</span>
       eshell            <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">the elisp shell that works everywhere</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">shell             ; simple shell REPL for Emacs</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">term              ; basic terminal emulator for Emacs</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">vterm             ; the best terminal emulation in Emacs</span>

       <span style="font-weight: bold;">:checkers</span>
       syntax            <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">tasing you for every semicolon you forget</span>
       (spell            <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">tasing you for misspelling mispelling</span>
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">+flyspell</span>
        +aspell
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">+hunspell</span>
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">+enchant</span>
        +everywhere
        )
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">grammar           ; tasing grammar mistake every you make</span>

       <span style="font-weight: bold;">:tools</span>
       ansible
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">debugger          ; </span><span style="font-weight: bold;">FIXME</span><span style="font-weight: bold; font-style: italic;"> stepping through code, to help you add bugs</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">direnv</span>
       docker
       editorconfig      <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">let someone else argue about tabs vs spaces</span>
       <span style="font-weight: bold; font-style: italic;">;;</span><span style="font-weight: bold; font-style: italic;">ein               ; tame Jupyter notebooks with emacs</span>
       (<span style="font-weight: bold; text-decoration: underline;">eval</span>             <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">run code, run (also, repls)</span>
        +overlay
        )
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">gist              ; interacting with github gists</span>
       (lookup           <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">navigate your code and its documentation</span>
        +dictionary
        +offline
        +docsets
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">+xwidget</span>
        )
       (<span style="font-weight: bold;">lsp</span>
        +peek
        )
       (<span style="font-weight: bold;">magit</span>            <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">a git porcelain for Emacs</span>
        +forge
        )
       make              <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">run make tasks from Emacs</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">pass              ; password manager for nerds</span>
       pdf               <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">pdf enhancements</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">prodigy           ; </span><span style="font-weight: bold;">FIXME</span><span style="font-weight: bold; font-style: italic;"> managing external services &amp; code builders</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">rgb               ; creating color strings</span>
       taskrunner        <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">taskrunner for all your projects</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">terraform         ; infrastructure as code</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">tmux              ; an API for interacting with tmux</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">upload            ; map local to remote projects via ssh/ftp</span>

       <span style="font-weight: bold;">:os</span>
       (<span style="font-weight: bold;">:if</span> <span style="font-weight: bold; font-style: italic;">IS-MAC</span>
        macos            <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">improve compatibility with macOS</span>
        )
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">tty               ; improve the terminal Emacs experience</span>

       <span style="font-weight: bold;">:lang</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">agda              ; types of types of types of types...</span>
       (cc               <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">C/C++/Obj-C madness</span>
        +lsp)
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">clojure           ; java with a lisp</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">common-lisp       ; if you've seen one lisp, you've seen them all</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">coq               ; proofs-as-programs</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">crystal           ; ruby at the speed of c</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">csharp            ; unity, .NET, and mono shenanigans</span>
       data              <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">config/data formats</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(dart             ; paint ui and not much else</span>
       <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">+flutter)</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">elixir            ; erlang done right</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">elm               ; care for a cup of TEA?</span>
       emacs-lisp        <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">drown in parentheses</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">erlang            ; an elegant language for a more civilized age</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">ess               ; emacs speaks statistics</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">faust             ; dsp, but you get to keep your soul</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">fsharp            ; ML stands for Microsoft's Language</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">fstar             ; (dependent) types and (monadic) effects and Z3</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">gdscript          ; the language you waited for</span>
       (go               <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">the hipster dialect</span>
        +lsp
        )
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(haskell          ; a language that's lazier than I am</span>
       <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">+dante)</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">hy                ; readability of scheme w/ speed of python</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">idris             ; a language you can depend on</span>
       (json             <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">At least it ain't XML</span>
        +lsp
        )
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(java             ; the poster child for carpal tunnel syndrome</span>
       <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">+meghanada)</span>
       (javascript       <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">all(hope(abandon(ye(who(enter(here))))))</span>
        +lsp
        )
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">julia             ; a better, faster MATLAB</span>
       kotlin            <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">a better, slicker Java(Script)</span>
       latex             <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">writing papers in Emacs has never been so fun</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">lean</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">factor</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">ledger            ; an accounting system in Emacs</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">lua               ; one-based indices? one-based indices</span>
       (<span style="font-weight: bold;">markdown</span>         <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">writing docs for people to ignore</span>
        +grip
        )
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">nim               ; python + lisp at the speed of c</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">nix               ; I hereby declare "nix geht mehr!"</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">ocaml             ; an objective camel</span>
       (org              <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">organize your plain life in plain text</span>
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">+brain</span>
        +dragndrop
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">+gnuplot</span>
        +hugo
        +journal
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">+jupyter</span>
        +noter
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">+pandoc</span>
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">+pomodoro</span>
        +present
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">+pretty</span>
        +roam
        )
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">php               ; perl's insecure younger brother</span>
       plantuml          <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">diagrams for confusing people more</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">purescript        ; javascript, but functional</span>
       (python           <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">beautiful is better than ugly</span>
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">+conda</span>
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">+cython</span>
        +lsp
        +poetry
        +pyenv
        +pyright
        )
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">qt                ; the 'cutest' gui framework ever</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">racket            ; a DSL for DSLs</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">raku              ; the artist formerly known as perl6</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">rest              ; Emacs as a REST client</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">rst               ; ReST in peace</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(ruby             ; 1.step {|i| p "Ruby is #{i.even? ? 'love' : 'life'}"}</span>
       <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">+rails</span>
       <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">)</span>
       (rust             <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">Fe2O3.unwrap().unwrap().unwrap().unwrap()</span>
        +lsp
        )
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">scala             ; java, but good</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">scheme            ; a fully conniving family of lisps</span>
       (sh               <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">she sells {ba,z,fi}sh shells on the C xor</span>
        +lsp)
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">sml</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">solidity          ; do you need a blockchain? No.</span>
       swift             <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">who asked for emoji variables?</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">terra             ; Earth and Moon in alignment for performance.</span>
       web               <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">the tubes</span>
       (yaml             <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">JSON, but readable</span>
        +lsp)

       <span style="font-weight: bold;">:email</span>
       (<span style="font-weight: bold;">mu4e</span>
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">+gmail</span>
        )
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">notmuch</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(wanderlust</span>
       <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">+gmail</span>
       <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">)</span>

       <span style="font-weight: bold;">:app</span>
       calendar
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">irc               ; how neckbeards socialize</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(rss              ; emacs as an RSS reader</span>
       <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">+org</span>
       <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">)</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">twitter           ; twitter client https://twitter.com/vnought</span>

       <span style="font-weight: bold;">:config</span>
       literate
       (default
         +bindings
         +smartparens))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(require 'benchmark-init)</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(add-hook 'doom-first-input-hook #'benchmark-init/deactivate</span>

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">I need this hook here to make sure my tangle runs this autoloaded function.</span>
(<span style="font-weight: bold;">add-hook</span> <span style="font-weight: bold;">'</span><span style="font-weight: bold; font-style: italic;">org-babel-post-tangle-hook</span>
          <span style="font-weight: bold;">#'</span>(lambda ()
              (<span style="font-weight: bold;">let</span> ((<span style="font-weight: bold; font-style: italic;">make-backup-files</span> nil)
                    (<span style="font-weight: bold;">last</span>))
                (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">string-match-p</span> <span style="font-style: italic;">"\\/</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">share\\/</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">templates</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">capture</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">snippets</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">\\/"</span>
                                      (<span style="font-weight: bold; font-style: italic;">buffer-file-name</span>))
                  (<span style="font-weight: bold; text-decoration: underline;">goto-char</span> (<span style="font-weight: bold; text-decoration: underline;">point-min</span>))
                  (<span style="font-weight: bold; text-decoration: underline;">insert</span> <span style="font-style: italic;">"# -*- mode: snippet -*-\n"</span>))
                (<span style="font-weight: bold; text-decoration: underline;">goto-char</span> (<span style="font-weight: bold; text-decoration: underline;">point-max</span>))
                (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold; text-decoration: underline;">equal</span> (<span style="font-weight: bold; text-decoration: underline;">char-before</span>) ?\n)
                  (<span style="font-weight: bold; text-decoration: underline;">delete-char</span> <span style="font-weight: bold; text-decoration: underline;">-1</span>)
                  (<span style="font-weight: bold;">save-buffer</span>)))))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">When I'm using soft-wraps to write prose, I like to have Emacs (Evil in</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">particular) to respect my visual lines. In order to do that, I must set</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">evil-respect-visual-line-mode</span><span style="font-weight: bold; font-style: italic;">' variable before Evil is loaded.</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Unfortunately, by the time the 'config.el' file is loaded, it is too late,</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">and that is why I have to set this variable here.</span>
(<span style="font-weight: bold;">setq</span> <span style="font-weight: bold; font-style: italic;">evil-respect-visual-line-mode</span> t)
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: Fri, Jan 1 2021</p>
<p class="author">Author: Thiago Alves</p>
<p class="date">Created: 2021-05-16 Sun 22:12</p>
</div>
</body>
</html>
