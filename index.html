<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2021-07-29 Thu 15:27 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>The Doomed Configuration</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Thiago Alves">
<meta name="keywords" content="emacs config literate doom">
<link rel="stylesheet" type="text/css" href="https://gongzhitaao.org/orgcss/org.css"/>
<style type="text/css">
@media all {
body {
font-size: 1.6rem;
line-height: 1.4em;
font-family: 'Cardo', serif;
color: #222
}
h1 {
font-size: 2.2em;
font-family: 'Cardo', serif;
}
#list-of-tables h2 {
display: none
}
.org-src-container {
padding: 0.3em 0.8em;
border-radius: 4px;
}
table caption {
font-size: 0.7em;
}
figcaption {
font-size: 0.7em;
}
label.org-src-name {
float: right;
position: absolute;
bottom: -0.7em;
right: 0.8em;
font-size: 0.5em;
}
.org-src-name, .org-src-name * {
color: #b3b3b3;
}
.listing-number {
visibility: hidden;
}
.src {
font-size: 0.7em;
line-height: 1.2em;
}
a code {
color:#3a5fcd;
}
div.note {
-moz-border-radius: 6px;
-webkit-border-radius: 6px;
background-color: #f0f7fb;
background-image: url(https://f1.madcapsoftware.com/blogImages/2017/08/css-box-icon-3.png);
background-position: 0.3em 0.8em;
background-repeat: no-repeat;
border: solid 1px #3498db;
border-radius: 4px;
overflow: hidden;
padding: 0 1em 0 2.5em;
}
div.warning {
-moz-border-radius: 6px;
-webkit-border-radius: 6px;
background-color: #fde6e5;
background-image: url(https://f1.madcapsoftware.com/blogImages/2017/08/css-box-icon-4.png);
background-position: 0.3em 0.8em;
background-repeat: no-repeat;
border: solid 1px #ce2a21;
border-radius: 4px;
overflow: hidden;
padding: 0 1em 0 2.5em;
}
div.outline-text-2>p:first-child:first-letter {
float: left;
font-size: 4em;
padding-right: 5px;
}
#table-of-contents {
font-size: 10pt;
position: fixed;
right: 3em;
top: 0em;
background: #2b2b2b;
color: #dcdccc;
-webkit-box-shadow: 0 0 4px #777777;
-moz-box-shadow: 0 0 4px #777777;
border-radius: 4px;
text-align: right;
/* ensure doesn't flow off the screen when expanded */
max-height: 80%;
overflow: auto;
z-index: 1000;
}
#table-of-contents h2 {
font-size: 10pt;
max-width: 8em;
font-weight: normal;
padding-left: 0.5em;
padding-left: 0.5em;
padding-top: 0.05em;
padding-bottom: 0.05em;
}
#table-of-contents #text-table-of-contents {
display: none;
text-align: left;
}
#table-of-contents:hover #text-table-of-contents {
display: block;
padding: 0.5em;
margin-top: 0em;
}
#table-of-contents {
color: black;
background: #FFF;
font-size: 80%;
padding: .5em;
margin: 1em -2em 1em 1em;
display: block;
}
#table-of-contents a {
color: #003333;
}
#table-of-contents a:hover {
color: #003333;
text-decoration: underline;
}
#table-of-contents h2 {
margin-top: 0;
margin-bottom: 0;
padding: 0;
border: none;
}
.org-rainbow-delimiters-depth-1 {
color: #c39900
}
.org-rainbow-delimiters-depth-2 {
color: #00bfff
}
.org-rainbow-delimiters-depth-3 {
color: #c39900
}
.org-rainbow-delimiters-depth-4 {
color: #00bfff
}
.org-rainbow-delimiters-depth-5 {
color: #c39900
}
.org-rainbow-delimiters-depth-6 {
color: #00bfff
}
.org-rainbow-delimiters-depth-7 {
color: #c39900
}
.org-rainbow-delimiters-depth-8 {
color: #00bfff
}
.org-rainbow-delimiters-depth-9 {
color: #c39900
}
}
@media screen {
#table-of-contents {
float: right;
border: 1px solid #CCC;
max-width: 50%;
overflow: auto;
}
}
</style>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<header>
<h1 class="title">The Doomed Configuration</h1>
<p class="subtitle">A detailed setup for Emacs using Doom Emacs configuration framework</p>
</header><nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org029c483">1. Prologue</a>
<ul>
<li><a href="#org4dc4d45">1.1. About this document</a></li>
<li><a href="#org3969248">1.2. About literate configuration</a></li>
<li><a href="#org4324f96">1.3. About Doom configuration style</a>
<ul>
<li><a href="#org52801d3">1.3.1. Doom has its package manager</a></li>
<li><a href="#orga1fa75e">1.3.2. Lazy load everything</a></li>
<li><a href="#orgba6a08b">1.3.3. Configuration evaluation order</a></li>
<li><a href="#orgb794e30">1.3.4. Use the <code>map!</code> macro to bind keys</a></li>
</ul>
</li>
<li><a href="#orgce7851f">1.4. Investigating issues</a></li>
<li><a href="#orgccf3533">1.5. Acknowledgments</a></li>
</ul>
</li>
<li><a href="#org3cbcfef">2. Standard features</a>
<ul>
<li><a href="#standard-requirements">2.1. Requirements</a>
<ul>
<li><a href="#org365f551">2.1.1. Modal editing</a></li>
<li><a href="#org74009fc">2.1.2. Text Snippets</a></li>
<li><a href="#org0344784">2.1.3. Inline completion</a></li>
<li><a href="#org305b605">2.1.4. Automatic indentation</a></li>
<li><a href="#org0a5b693">2.1.5. Smart backspace</a></li>
<li><a href="#org68a972d">2.1.6. Balanced pairs</a></li>
<li><a href="#orga231bd7">2.1.7. Rich keybindings</a></li>
<li><a href="#org3575bfd">2.1.8. Useful line numbers</a></li>
<li><a href="#org74a276c">2.1.9. Auto-saving</a></li>
<li><a href="#org0873fab">2.1.10. Persist frame position and geometry</a></li>
<li><a href="#orga174da0">2.1.11. Remote editing</a></li>
</ul>
</li>
<li><a href="#orgd0926a9">2.2. Emacs-only configurations</a>
<ul>
<li><a href="#org2b93225">2.2.1. Identity</a></li>
<li><a href="#org45bbe34">2.2.2. Dashboard</a></li>
<li><a href="#orge418694">2.2.3. Key modifiers</a></li>
<li><a href="#org8af7180">2.2.4. Training wheels</a></li>
<li><a href="#orged5804b">2.2.5. Emacs source code</a></li>
<li><a href="#org5fd6582">2.2.6. Line numbers</a></li>
<li><a href="#orgbc20178">2.2.7. Indentation</a></li>
<li><a href="#org2f64cb9">2.2.8. Line wrapping</a></li>
<li><a href="#orgdf053eb">2.2.9. Scrolling</a></li>
<li><a href="#orgffd8d47">2.2.10. Repeatable commands</a></li>
<li><a href="#orgffdc335">2.2.11. Completion framework</a></li>
</ul>
</li>
<li><a href="#org04c0020">2.3. Modal editing</a></li>
<li><a href="#orgb388a91">2.4. Text snippets</a></li>
<li><a href="#org8c6b049">2.5. Inline completion</a></li>
<li><a href="#org463d798">2.6. Automatic indentation</a></li>
<li><a href="#org526bd3e">2.7. Smart backspace</a></li>
<li><a href="#org6269bc5">2.8. Balanced pairs</a></li>
<li><a href="#org63f05bb">2.9. Rich keybindings</a></li>
<li><a href="#org835face">2.10. Useful line numbers</a></li>
<li><a href="#org7215074">2.11. Auto-Saving</a></li>
<li><a href="#org4c216a9">2.12. Persist frame position and geometry</a></li>
<li><a href="#orga938a69">2.13. <span class="todo TODO">TODO</span> Remote editing</a></li>
</ul>
</li>
<li><a href="#org92c72e6">3. Personal preferences</a>
<ul>
<li><a href="#org129c5bc">3.1. Evil</a>
<ul>
<li><a href="#org5edf9ce">3.1.1. Evil-MatchIt</a></li>
<li><a href="#org833d567">3.1.2. Plus-Minus</a></li>
<li><a href="#org4aeecc0">3.1.3. Evil-String-Inflection</a></li>
</ul>
</li>
<li><a href="#orgfe982a0">3.2. Keybindings</a>
<ul>
<li><a href="#org7810124">3.2.1. Window navigation</a></li>
<li><a href="#orgb1a8bf3">3.2.2. Vim defaults</a></li>
<li><a href="#org37b2fce">3.2.3. Personal shortcuts</a></li>
<li><a href="#orgd319b86">3.2.4. Repeatable shortcuts</a></li>
</ul>
</li>
<li><a href="#orgc5db7d9">3.3. Appearances</a>
<ul>
<li><a href="#org6fba8e6">3.3.1. Frame</a></li>
<li><a href="#orgeb21616">3.3.2. Editor</a></li>
<li><a href="#orgd189465">3.3.3. Theme</a></li>
<li><a href="#prefs-typography">3.3.4. Typography</a></li>
<li><a href="#orgdd91f67">3.3.5. Iconography</a></li>
</ul>
</li>
<li><a href="#orga8f7cef">3.4. Editor Tabs</a>
<ul>
<li><a href="#org9e9c0a1">3.4.1. Tab actions</a></li>
<li><a href="#org5c8d390">3.4.2. Windows</a></li>
</ul>
</li>
<li><a href="#orgcf11352">3.5. Special modes</a>
<ul>
<li><a href="#org2e7fa43">3.5.1. Info mode</a></li>
<li><a href="#orgb903016">3.5.2. Help mode and Man mode</a></li>
<li><a href="#org875a464">3.5.3. Rainbow mode</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org9cb333f">4. Writing&#xa0;&#xa0;&#xa0;<span class="tag"><span class="wip">wip</span></span></a>
<ul>
<li><a href="#orga169f46">4.1. Requirements</a>
<ul>
<li><a href="#org4ee82d0">4.1.1. Fonts</a></li>
<li><a href="#org676dead">4.1.2. Writing quality</a></li>
<li><a href="#org8c5e959">4.1.3. Publishing</a></li>
<li><a href="#org29efa7a">4.1.4. Note taking</a></li>
</ul>
</li>
<li><a href="#orgd1fea31">4.2. Writing typography</a></li>
<li><a href="#org21be93a">4.3. <span class="todo TODO">TODO</span> Common Org configurations</a></li>
<li><a href="#orgdb58c1a">4.4. <span class="todo TODO">TODO</span> Prose writing</a>
<ul>
<li><a href="#org410360a">4.4.1. Dictionary and writing helpers</a></li>
<li><a href="#orgd8211c0">4.4.2. Templates</a></li>
<li><a href="#org824983e">4.4.3. Focus Writing</a></li>
<li><a href="#org5a5341a">4.4.4. Snippets</a></li>
</ul>
</li>
<li><a href="#org12724a6">4.5. <span class="todo TODO">TODO</span> Reading or reviewing</a></li>
<li><a href="#org9d1a314">4.6. <span class="todo TODO">TODO</span> Publishing</a></li>
<li><a href="#org511d339">4.7. <span class="todo TODO">TODO</span> Presenting</a></li>
<li><a href="#org37bccad">4.8. <span class="todo TODO">TODO</span> Note Taking</a>
<ul>
<li><a href="#org71fcd29">4.8.1. Capturing</a></li>
<li><a href="#org1b17a83">4.8.2. Journal</a></li>
<li><a href="#org7cc56c2">4.8.3. Zettelkasten</a></li>
<li><a href="#org75d2af1">4.8.4. Deft</a></li>
<li><a href="#org069e8ce">4.8.5. Utilities</a></li>
</ul>
</li>
<li><a href="#org1746aa7">4.9. <span class="todo TODO">TODO</span> Other modes</a>
<ul>
<li><a href="#org643c516">4.9.1. Markdown</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org4af6ec0">5. Development</a>
<ul>
<li><a href="#org1579374">5.1. <span class="todo TODO">TODO</span> Requirements</a></li>
<li><a href="#orgb92885a">5.2. <span class="todo TODO">TODO</span> Common configuration</a>
<ul>
<li><a href="#orgd81a946">5.2.1. Version control system</a></li>
<li><a href="#orgc705167">5.2.2. Comments</a></li>
</ul>
</li>
<li><a href="#org4fa14c1">5.3. <span class="todo TODO">TODO</span> Lisp</a></li>
<li><a href="#orgb091443">5.4. <span class="todo TODO">TODO</span> Shell script</a></li>
<li><a href="#org24f1a60">5.5. <span class="todo TODO">TODO</span> Python</a></li>
<li><a href="#orgd82645d">5.6. <span class="todo TODO">TODO</span> Ansible</a></li>
<li><a href="#org1752227">5.7. <span class="todo TODO">TODO</span> Javascript/TypeScript</a></li>
<li><a href="#org6084756">5.8. <span class="todo TODO">TODO</span> C/C++</a></li>
<li><a href="#org970fa72">5.9. <span class="todo TODO">TODO</span> Swift</a></li>
<li><a href="#orgade2f8f">5.10. <span class="todo TODO">TODO</span> Kotlin</a></li>
<li><a href="#org80d8c40">5.11. <span class="todo TODO">TODO</span> Java</a></li>
</ul>
</li>
<li><a href="#org4807e8c">6. Non-editor features</a>
<ul>
<li><a href="#org27e5e93">6.1. <span class="todo TODO">TODO</span> Requirements</a></li>
<li><a href="#orgfdc9075">6.2. <span class="todo TODO">TODO</span> File management</a></li>
<li><a href="#org37f2477">6.3. <span class="todo TODO">TODO</span> Project management</a></li>
<li><a href="#orgc9a2865">6.4. <span class="todo TODO">TODO</span> Terminal</a></li>
<li><a href="#org40c2187">6.5. <span class="todo TODO">TODO</span> Emails</a></li>
<li><a href="#org76718e4">6.6. <span class="todo TODO">TODO</span> Calendars</a></li>
<li><a href="#org22be281">6.7. <span class="todo TODO">TODO</span> Contacts</a></li>
<li><a href="#orgeb7efaa">6.8. <span class="todo TODO">TODO</span> Time Management</a></li>
</ul>
</li>
<li><a href="#orge7377ad">7. Appendix</a>
<ul>
<li><a href="#orge309d46">7.1. The <code>init.el</code> file</a></li>
<li><a href="#orgbad6ff6">7.2. List of tables</a></li>
<li><a href="#org0710833">7.3. List of figures</a></li>
</ul>
</li>
</ul>
</div>
</nav>

<div id="outline-container-org029c483" class="outline-2">
<h2 id="org029c483"><span class="section-number-2">1</span> Prologue</h2>
<div class="outline-text-2" id="text-1">
<p>
Hello there! Thanks for checking my Emacs configuration. I decided to go with a literate programming style, to try to contribute back to the Emacs and Doom community.
</p>

<p>
This configuration uses <a href="https://github.com/hlissner/doom-emacs">Doom Emacs</a> configuration framework (from now on, referred as Doom) as its base, so, my suggestion to you is to get familiarized with it <b>before</b> diving deep into this document (a good starting point is the <a href="https://github.com/hlissner/doom-emacs/blob/develop/docs/getting_started.org">Getting Started</a> page on the official repository), there will be options, functions, and variables I will use without much explanation because they're some sort of <i>common knowledge</i> in the Doom's community.
</p>

<p>
Furthermore, when you install Doom for the first time, it creates the <code>config.el</code> and <code>packages.el</code> files for you, containing some useful doc-strings there. In this version of my configuration, I will try to include as much of those comments as possible as <i>free text</i>. I want you to remember that I didn't come up with those words, some folks much smarter than me did, so feel free to <a href="https://liberapay.com/hlissner">thank</a> the Doom's <a href="https://paypal.me/henriklissner">creator</a>.
</p>

<p>
For instance, a Doom installation without a previous private configuration creates the file <code>$DOOMDIR/config.el</code> with the following comments:
</p>

<div class="note" id="org74f8e07">
<p>
In your journey configuring Emacs the way you want, you might need to use more functions than I'm using in this configuration. Here are some additional functions or macros that could help you configure Doom:
</p>

<ul class="org-ul">
<li><code>load!</code> for loading external <code>*.el</code> files relative to <code>$DOOMDIR/config.el</code>;</li>
<li><code>use-package!</code> for configuring packages;</li>
<li><code>after!</code> for running code after a package has loaded;</li>
<li><code>add-load-path!</code> for adding directories to the <code>load-path</code>, relative to <code>$DOOMDIR/config.el</code>. Emacs searches the <code>load-path</code> when you load packages with <code>require</code> or <code>use-package</code>;</li>
<li><code>map!</code> for binding new keys;</li>
</ul>

<p>
To get information about any of these functions or macros, move the cursor over the highlighted symbol at press '<code>K</code>' (non-evil users must press '<code>C-c g k</code>'). This will open documentation for it, including demos on how to use them.
</p>

<p>
You can also try '<code>gd</code>' (or '<code>C-c g d</code>') to jump to their definition and see their source code.
</p>

</div>
</div>

<div id="outline-container-org4dc4d45" class="outline-3">
<h3 id="org4dc4d45"><span class="section-number-3">1.1</span> About this document</h3>
<div class="outline-text-3" id="text-1-1">
<p>
The organization of my Emacs configuration tries to structure the design and build of a text editor tailored for my needs.
</p>

<p>
Some of these needs are technology related (e.g., programming languages, diagrams tooling, etc.), while others are aesthetic or productivity related.
</p>

<p>
I want to stress out to you, that ultimately, you are reading an opinion, and what works for me may or may not work for you.
</p>

<p>
I intend to start with features I consider common to any text editor, then, I'll go into some personal preferences still related to text editor in general. Once I'm done with the common features, I'll configure Emacs for writing prose. I decided to do all my prose writing using <a href="https://orgmode.org/">Org Mode</a> and will focus the configuration, at that point, to adjust Emacs and Org to fit my personal workflow.
</p>

<p>
After configuring Emacs for writing prose, my next focus is programming (which is what I do for work). I will set up <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/">Emacs Lisp</a>, <a href="https://www.javascript.com/">Javascript</a>/<a href="https://www.typescriptlang.org/">Typescript</a>, <a href="https://kotlinlang.org/">Kotlin</a>, <a href="https://www.python.org/">Python</a>, <a href="https://www.shellscript.sh/">Shell Script</a>, <a href="https://developer.apple.com/swift/">Swift</a>, <a href="https://golang.org/">Go</a>, <a href="https://www.rust-lang.org/">Rust</a>, and <a href="http://www.open-std.org/JTC1/SC22/WG14/">C</a>/<a href="http://www.open-std.org/JTC1/SC22/WG21/">C++</a>. Most likely not in this order and some of them in more details than others, but at a minimum, I want Emacs to open files of those languages without errors or wrong syntax highlight.
</p>

<p>
Overall, I intend to configure Doom and core Emacs to get consistent keybindings and behaviors, so that when you learn to use one part of my configuration, you will feel comfortable on the other parts.
</p>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
Before you move on to the next section I must give you a disclaimer:
</p>

<p>
Although I'm using Emacs for about six years, I can't consider myself an expert. It was not until the beginning of 2021 that I decided to learn lisp properly, so you may find some code snippets here that are not considered optimal.
</p>

<p>
Moreover, do not trust me blindly. I try my best to verify the information I write by reading documentation and sometimes reaching out to the subject-matter expert of a feature. But for your own good, you should create the habit of reading documentation and manuals by yourself, there will be nothing that will build your knowledge better than this.
</p>
</div>
</div>

<div id="outline-container-org3969248" class="outline-3">
<h3 id="org3969248"><span class="section-number-3">1.2</span> About literate configuration</h3>
<div class="outline-text-3" id="text-1-2">
<p>
A long time ago I discovered <a href="http://literateprogramming.com">Literate Programming</a> when I first read an Emacs configuration using Org Mode. It was the <a href="https://pages.sachachua.com/.emacs.d/Sacha.html">Emacs configuration</a> of <a href="https://sachachua.com/blog/about/">Sacha Chua</a>, and it was a fantastic reading. I tried a couple of times to do the same with past configurations without much success.
</p>

<p>
I believe the mentality shift happened when I finally decided to read the original paper about <a href="http://literateprogramming.com/knuthweb.pdf">Literate Programming</a> by <a href="https://www-cs-faculty.stanford.edu/~knuth/">Donald E. Knuth</a>, and just like that, I wanted to practice Literate Programming on about everything I do.
</p>

<p>
Since this document is about an editor configuration, I have to highlight a couple of differences between Mr. Knuth's Literate Programming and my Literate Configuration.
</p>

<p>
The core difference, is the fact that each piece of code in this document may not be a self-contained snippet (although I will try my best to do so). When I find appropriate, I will split a big block of code into smaller blocks separated by text used to explain the rationale behind the snippet in question. So, if you're following this document and copying some snippets, make sure you include the <i>close parenthesis</i> that these split sections contain.
</p>
</div>
</div>

<div id="outline-container-org4324f96" class="outline-3">
<h3 id="org4324f96"><span class="section-number-3">1.3</span> About Doom configuration style</h3>
<div class="outline-text-3" id="text-1-3">
<p>
One of the major hurdles for newcomers, is to understand how Doom configure Emacs based on one's private configuration, specially for modules or packages which Doom supports.
</p>

<p>
This section describes four aspects of Doom that I felt important to understand before I could properly configure it.
</p>
</div>

<div id="outline-container-org52801d3" class="outline-4">
<h4 id="org52801d3"><span class="section-number-4">1.3.1</span> Doom has its package manager</h4>
<div class="outline-text-4" id="text-1-3-1">
<p>
Doom does not use <code>package.el</code>, it has its package manager system and even though, it uses <code>use-package</code> and <code>straight.el</code> packages, it uses them as support tools for the package manager to work. This means that if you copy and paste a configuration showing how to use them into your <code>config.el</code>, most likely you will get some sort of error. So, keep this in mind when you blindly copy a snippet to your <code>config.el</code>.
</p>
</div>
</div>

<div id="outline-container-orga1fa75e" class="outline-4">
<h4 id="orga1fa75e"><span class="section-number-4">1.3.2</span> Lazy load everything</h4>
<div class="outline-text-4" id="text-1-3-2">
<p>
You should get used to use the options <code>:defer</code>, <code>:hook</code>, <code>:after</code>, <code>:mode</code>, and <code>:commands</code> from <code>use-package</code> (check the <a href="https://github.com/jwiegley/use-package">package documentation</a> for more details) when configuring any package with it. Not doing so, may cause the package to get loaded during the Emacs initialization, potentially slowing the start of Emacs.
</p>
</div>
</div>

<div id="outline-container-orgba6a08b" class="outline-4">
<h4 id="orgba6a08b"><span class="section-number-4">1.3.3</span> Configuration evaluation order</h4>
<div class="outline-text-4" id="text-1-3-3">
<p>
There are four potential loading <i>spots</i> for each configuration you want to tweak, and you must always decide which one is the best option to apply in your particular case:
</p>

<dl class="org-dl">
<dt>Directly on <code>config.el</code></dt><dd>This is the most direct point of configuration. As Emacs evaluates the line of your configuration, it applies such configuration immediately. This is a good spot to configure variables the documentation states that <i>“it needs to get configured before the package gets loaded”</i>. On Doom's world, any directory or file variable should go to directly into your <code>config.el</code>;</dd>
<dt>Inside the <code>:init</code> section of <code>use-package</code></dt><dd>Depending on how a package gets configured, this is equivalent to configuring something directly on the <code>config.el</code>, but not always. If a package configuration uses the <code>:after</code> section from <code>use-package</code>, Emacs evaluates the code inside <code>:init</code> only <b>after</b> the resource defined on the option, loads;</dd>
<dt>Inside the <code>:config</code> section of <code>use-package</code></dt><dd>This always executes after the given package gets loaded. You need to consider other instances of the call to <code>use-package</code> on the same package. The order in which they evaluate dictates who will overwrite a variable last;</dd>
<dt>Inside an <code>after!</code> or <code>with-eval-after-load</code> macro</dt><dd>Code here executes after the defined resource gets loaded, but also after all instances of <code>use-package</code> finish to run code from their <code>:config</code> section;</dd>
</dl>

<p>
If you have any question about where you should add your configuration, I suggest following this rule of thumb:
</p>

<ul class="org-ul">
<li>If a package requires you to configure a variable before Emacs loads such package, set the variable directly on the <code>config.el</code>;</li>
<li>If you're configuring a package that Doom installs as part of a module, and it does not require you to define the configuration before Emacs loads the package, use the <code>after!</code> macro;</li>
<li>If you're adding a new package to your configuration, configure it using the <code>use-package</code> macro. To know if you should use <code>use-package</code> just check if you had to add the package to your <code>packages.el</code> file. If you did, then use <code>use-package</code>.</li>
</ul>

<p>
For instance:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 1: </span>Standard configuration of a package on Doom</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-directory <span class="org-string">"~/org"</span>)

(<span class="org-keyword">after!</span> org
  (<span class="org-keyword">setq</span> org-startup-indented nil))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb794e30" class="outline-4">
<h4 id="orgb794e30"><span class="section-number-4">1.3.4</span> Use the <code>map!</code> macro to bind keys</h4>
<div class="outline-text-4" id="text-1-3-4">
<p>
Eventually, you will realize that <code>use-package</code> has a nice <code>:bind</code> option to it, and you may think that your configuration would be so much cleaner if you could have everything under a <code>use-package</code> call (been there, done that). Unfortunately, this is not a good idea, unless you're aware of all possible gotchas related to <code>leader</code> and <code>localleader</code>.
</p>

<p>
My recommendation to you is to always configure your keybindings using the <code>map!</code> macro. Check its documentation for more details (on Emacs press <code>SPC h f map! RET</code>).
</p>
</div>
</div>
</div>

<div id="outline-container-orgce7851f" class="outline-3">
<h3 id="orgce7851f"><span class="section-number-3">1.4</span> Investigating issues</h3>
<div class="outline-text-3" id="text-1-4">
<p>
If you, like me, try new things with your config until it breaks, is important that we have some tools to help us figure out what is going on. Regardless if you'll use this configuration <i>as is</i>, or start yours from scratch, and copy the tidbits that may interest you. Before you start know these things:
</p>

<p>
To get a better sense of what is going on, start Emacs from terminal with the <code>--debug-init</code> flag:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 2: </span>Command to start emacs in debug mode</label><pre class="src src-shell">emacs --debug-init
</pre>
</div>

<p>
This will stop Emacs on the first error and print the stack trace for it. As of now, this might not be useful beyond reporting bugs, nevertheless, it's important you keep it in your mind!
</p>

<p>
Another issue that may show up, is slowness, specially after adding packages. This is not uncommon since Emacs startup time is sensitive to package loading.
</p>

<p>
What I recommend doing, is to install a package called <a href="https://github.com/kekeimiku/benchmark-init-el"><code>benchmark-init-el</code></a> that specializes on benchmarking (notice that I'm not using the <a href="https://github.com/dholm/benchmark-init-el">official repository</a> for <code>benchmark-init-el</code>, but a fork that fixed a bug when using it with Emacs 28+), and use it, when you have the need:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 3: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> benchmark-init
  <span class="org-builtin">:recipe</span> (<span class="org-builtin">:host</span> github
           <span class="org-builtin">:repo</span> <span class="org-string">"kekeimiku/benchmark-init-el"</span>))
</pre>
</div>

<p>
Check my <code>init.el</code> file on the <a href="#orge7377ad">Appendix</a>, to see how I hook up benchmarking to the <code>--debug-init</code> flag.
</p>

<p>
After starting Emacs with the <code>--debug-init</code> flag, you can check the call tree with the <code>M-x benchmark-init/show-durations-tree</code> command.
</p>
</div>
</div>

<div id="outline-container-orgccf3533" class="outline-3">
<h3 id="orgccf3533"><span class="section-number-3">1.5</span> Acknowledgments</h3>
<div class="outline-text-3" id="text-1-5">
<p>
Besides the already mentioned <a href="https://sachachua.com/blog/about/">Sacha Chua</a>, I would also like to thank Timothy (a.k.a. <a href="https://github.com/tecosaur">tecosaur</a>) for his wonderful literate config. I would be lying if I said <a href="https://www.gitmemory.com/tecosaur">tecosaur</a> was not one of the big reasons for me to give it a second try on my literate config, so thank you mate! You are welcome to say that this configuration is a byproduct of yours.
</p>

<p>
I would also like to thank <a href="https://github.com/gongzhitaao">Zhitao Gong</a> for the remarkable theme I'm using in this publication, it's called <a href="https://github.com/gongzhitaao/orgcss">OrgCSS</a> and you should definitely check it out. If you try <a href="https://github.com/gongzhitaao">Zhitao Gong</a>'s theme, and it does not look like this, you can use my extra modification by adding the following on your Org preamble:
</p>

<div class="org-src-container">
<pre class="src src-text">#+setupfile: https://raw.githubusercontent.com/Townk/doom-emacs-private/master/.github/support/org/html-export.setup
</pre>
</div>

<p>
Last, but not least, I like to give a shout to <a href="https://github.com/justinbondoc">Justin Bondoc</a> for his CSS tutorial on "<a href="https://www.madcapsoftware.com/blog/css-tip-creating-styled-boxes-notes-warnings-examples-tips/">Creating Styled Boxes for Notes, Warnings, Examples, and Tips</a>". You will notice that I not only got his CSS here, but also his icons for the note and warning boxes!
</p>

<p>
By the way, if you are reading this document online, there is a chance you might feel a familiarity with the typography used here. This is due to the fact I'm using the same font used by <a href="https://github.com/mickeynp">Mickey Petersen</a> on his amazing <a href="https://www.masteringemacs.org/">Mastering Emacs</a> site. So if you think this is a nice typography for reading online, again, I can't take credit for that either, check Mickey's site and maybe purchase a copy of his <a href="https://www.masteringemacs.org/order">book</a>.
</p>
</div>
</div>
</div>

<div id="outline-container-org3cbcfef" class="outline-2">
<h2 id="org3cbcfef"><span class="section-number-2">2</span> Standard features</h2>
<div class="outline-text-2" id="text-2">
<p>
Before jumping in the configuration itself, I like to describe what I'm trying to achieve on each section, so the reader doesn't feel lost. Also, by defining good requirements, this document may help someone else to achieve similar results with different editors. If you are among the crazies that besides liking my choices, decided to port this to other editors, drop me a line, and I'll be more than happy to link your document here.
</p>
</div>

<div id="outline-container-standard-requirements" class="outline-3">
<h3 id="standard-requirements"><span class="section-number-3">2.1</span> Requirements</h3>
<div class="outline-text-3" id="text-standard-requirements">
<p>
This part of the document will deal with configurations and functionalities that I consider as essential on any text editor, from IDEs to editors like <a href="https://en.wikipedia.org/wiki/Microsoft_Notepad">Notepad</a>, even though they're not present in all of them.
</p>
</div>

<div id="outline-container-org365f551" class="outline-4">
<h4 id="org365f551"><span class="section-number-4">2.1.1</span> Modal editing</h4>
<div class="outline-text-4" id="text-2-1-1">
<p>
I need to come clean to the reader about my experiences with text editors. I'm a <i>die-hard</i> Vim user, even though I'm not using Vim for some time now. Nevertheless, I, personally, believe that modal editing is a far superior way to use a text editor than any other alternative, and that is why I consider <i>modal editing</i>, a feature that any text editor should have.
</p>
</div>
</div>

<div id="outline-container-org74009fc" class="outline-4">
<h4 id="org74009fc"><span class="section-number-4">2.1.2</span> Text Snippets</h4>
<div class="outline-text-4" id="text-2-1-2">
<p>
Although I'm not an avid user of snippets, I believe they're a fundamental part of modern editors. Without them, I have to resort to some bookkeeping method to save interesting coding snippets. So, I consider snippets a base requirement for my editor.
</p>
</div>
</div>

<div id="outline-container-org0344784" class="outline-4">
<h4 id="org0344784"><span class="section-number-4">2.1.3</span> Inline completion</h4>
<div class="outline-text-4" id="text-2-1-3">
<p>
Also known as <i>intellisence</i>, or <i>code complete</i> in other editors and IDEs, <i>at-point completion</i> are those popups that show up when you type, with possible completions for what you're doing. My editor should also offer such feature, but it must play well with modal editing (if I leave the <i>Insert Mode</i> the popup should close), and snippets (snippet expansion keywords have precedence over skipping to the next line with the <code>&lt;TAB&gt;</code> key).
</p>
</div>
</div>

<div id="outline-container-org305b605" class="outline-4">
<h4 id="org305b605"><span class="section-number-4">2.1.4</span> Automatic indentation</h4>
<div class="outline-text-4" id="text-2-1-4">
<p>
Here I'm not talking about indent after pressing '<code>RET</code>'. I'm talking about re-indenting the file as I change it. On the Emacs world, this is also known as <i>electric indent</i>.
</p>

<p>
I understand that in some occasions this process may slow down the editor, so I will define here that I want the whole indentation to change when I change the total number of lines on the file.
</p>
</div>
</div>

<div id="outline-container-org0a5b693" class="outline-4">
<h4 id="org0a5b693"><span class="section-number-4">2.1.5</span> Smart backspace</h4>
<div class="outline-text-4" id="text-2-1-5">
<p>
When I'm editing a file (usually a source code), in some scenarios, the editor helps me out by inserting text that I want. One example of this is the closing pair character. If I type a ' <code>"</code> ', Doom will add a second one after my cursor. In most of the scenarios, to revert what just happened, I press <code>&lt;BACKSPACE&gt;</code>, and I get the same state I was before pressing the key that generated the completion.
</p>

<p>
But there is one case where this does not happen, which is when Doom adds a paired new line when I press <code>&lt;ENTER&gt;</code> after open a pair. The net effect of this completion, is to have the cursor on the next line, indented correctly. But when I immediately press <code>&lt;BACKSPACE&gt;</code>, Doom deletes the indentation and that's it.
</p>

<p>
This requirement, is to make sure the <code>&lt;BACKSPACE&gt;</code> key behaves in the same way when we use it after a completion.
</p>
</div>
</div>

<div id="outline-container-org68a972d" class="outline-4">
<h4 id="org68a972d"><span class="section-number-4">2.1.6</span> Balanced pairs</h4>
<div class="outline-text-4" id="text-2-1-6">
<p>
The common behavior you might see on text editors is to complete a character pair as you type. For instance, if you type an open parenthesis, the editor would insert the closing one automatically, and if you press the closing parenthesis, the editor would simply move the cursor to the right of the already inserted close parenthesis character.
</p>

<p>
My requirement is to my editor to keep any of these character pairs balanced. If I try to delete a line with a closing pair character that would make the pairs of such character unbalanced. The editor would delete the line content, but would leave the closing character for the pair, preventing the file from getting to an unbalanced state.
</p>
</div>
</div>

<div id="outline-container-orga231bd7" class="outline-4">
<h4 id="orga231bd7"><span class="section-number-4">2.1.7</span> Rich keybindings</h4>
<div class="outline-text-4" id="text-2-1-7">
<p>
Any half-decent text editor these days supports an infinite plethora of shortcuts. What I believe an editor should support to be ahead of the game, is the ability to bind <b>any</b> editor action to a key, and to offer to the user some sort of guidance while one uses the editor.
</p>

<p>
For instance, if you configure your editor to search for files when you press '<code>SPC f f</code>', when you press '<code>SPC f</code>' and wait. I want the editor to display all the possible options for me to complete your key sequence.
</p>
</div>
</div>

<div id="outline-container-org3575bfd" class="outline-4">
<h4 id="org3575bfd"><span class="section-number-4">2.1.8</span> Useful line numbers</h4>
<div class="outline-text-4" id="text-2-1-8">
<p>
I like the text editor to show me line numbers when mater, and when it does, I like to get the most of them. This requirement is to make sure that line numbers are aware of the modal editing, so when I'm on <i>normal mode</i> with line numbers visible, the editor should show me lines as relative numbers, and when I'm editing the file (in <i>insert mode</i>), the line numbers should be absolute.
</p>
</div>
</div>

<div id="outline-container-org74a276c" class="outline-4">
<h4 id="org74a276c"><span class="section-number-4">2.1.9</span> Auto-saving</h4>
<div class="outline-text-4" id="text-2-1-9">
<p>
I want to stop saving my files. Any editor has a substantial number of undo actions, and Doom even allow me to save the undo history across sessions. Because of that, I want my editor to save files I'm editing from time to time and on special events like switching to a different app, or a different buffer.
</p>
</div>
</div>

<div id="outline-container-org0873fab" class="outline-4">
<h4 id="org0873fab"><span class="section-number-4">2.1.10</span> Persist frame position and geometry</h4>
<div class="outline-text-4" id="text-2-1-10">
<p>
I move my editor all around my desktop, and I resize it just as much, do I'm not particular to any specific size or position it should be. If I turn it off, the next time I decide to open it, I expect it to be in the same place, and with the same size, I defined on the last time I've opened it.
</p>
</div>
</div>

<div id="outline-container-orga174da0" class="outline-4">
<h4 id="orga174da0"><span class="section-number-4">2.1.11</span> Remote editing</h4>
<div class="outline-text-4" id="text-2-1-11">
<p>
I want my text editor to edit remote files seamlessly, and by remote, I mean not in the same Operating System where the editor is running. This also include containers like Docker.
</p>

<p>
I also want my text editor to allow me to start this remote editing by picking a server and a remote path, so it can create a remote <i>project</i> for me to explore.
</p>
</div>
</div>
</div>

<div id="outline-container-orgd0926a9" class="outline-3">
<h3 id="orgd0926a9"><span class="section-number-3">2.2</span> Emacs-only configurations</h3>
<div class="outline-text-3" id="text-2-2">
<p>
This section will cover some changes I like to do on the Emacs (or Doom) default behavior, and some required settings to make sure Emacs have all the information it needs to function properly.
</p>
</div>

<div id="outline-container-org2b93225" class="outline-4">
<h4 id="org2b93225"><span class="section-number-4">2.2.1</span> Identity</h4>
<div class="outline-text-4" id="text-2-2-1">
<p>
It's important we let Emacs know who we are, and also, according to Doom's comments on the sample <code>config.el</code> available upon installation, some functionality uses this identification (e.g. GPG configuration, email clients, file templates and snippets).
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 4: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> user-full-name <span class="org-string">"Thiago Alves"</span>
      user-mail-address <span class="org-string">"thiago@rapinialves.com"</span>)
</pre>
</div>

<p>
I also like to have a variable holding the value of my email's host name:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 5: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">user-domain</span> (cadr (split-string user-mail-address <span class="org-string">"@"</span>))
  <span class="org-doc">"Holds the user's personal domain. By default, this variable is</span>
<span class="org-doc">  the `</span><span class="org-doc"><span class="org-constant">user-email-address</span></span><span class="org-doc">' host."</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org45bbe34" class="outline-4">
<h4 id="org45bbe34"><span class="section-number-4">2.2.2</span> Dashboard</h4>
<div class="outline-text-4" id="text-2-2-2">
<p>
Doom Emacs offers a lightweight dashboard, that serves as the landing page for Emacs.
</p>

<p>
I really like the idea of a dashboard and I like even more what Doom offers, but, the ASCII art for its logo is not something I'm affectionate with.
</p>

<p>
In order to replace the ASCII art with something more pleasant and thematic, I like to add a small picture on the dashboard:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 6: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> +doom-dashboard-banner-dir (expand-file-name <span class="org-string">"assets"</span> doom-private-dir)
      +doom-dashboard-banner-file <span class="org-string">"doom.png"</span>
      +doom-dashboard-banner-padding '(0 . 4))
</pre>
</div>

<p>
I love the style of this image so much, that it is, besides my dashboard image, my Emacs icon as well. The author of this beauty is <a href="https://github.com/eccentric-j/doom-icon">Jay Zawrotny</a>, feel free to send him an accolade!
</p>

<div class="org-center">

<figure id="org649263f">
<img src="./assets/doom.png" alt="doom.png">

<figcaption><span class="figure-number">Figure 1: </span>My favorite contender for a Doom Emacs logo</figcaption>
</figure>
</div>
</div>
</div>

<div id="outline-container-orge418694" class="outline-4">
<h4 id="orge418694"><span class="section-number-4">2.2.3</span> Key modifiers</h4>
<div class="outline-text-4" id="text-2-2-3">
<p>
]]Since I use a Mac as my primary computer, I need to adjust its control keys to match a good set of control keys on Emacs:
</p>

<table id="orga5e2505">
<caption class="t-bottom"><span class="table-number">Table 1:</span> macOS key mappings</caption>

<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">macOS Key</th>
<th scope="col" class="org-left">Emacs Key</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">⌘ (<code>cmd</code>)</td>
<td class="org-left"><code>'super</code></td>
</tr>

<tr>
<td class="org-left">⌃ (<code>ctrl</code>)</td>
<td class="org-left"><code>'control</code></td>
</tr>

<tr>
<td class="org-left">⌥ (<code>option</code>)</td>
<td class="org-left"><code>'meta</code></td>
</tr>
</tbody>
</table>

<p>
Emacs expose three variables to allow you to make these adjustments:
</p>

<ul class="org-ul">
<li><code>mac-command-modifier</code></li>
<li><code>mac-control-modifier</code></li>
<li><code>mac-option-modifier</code></li>
</ul>

<p>
To adjust this values according to table <a href="#orga5e2505">1</a>, set each one of them to the symbol described on the column <code>Emacs Key</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 7: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> mac-command-modifier 'super
      mac-control-modifier 'control
      mac-option-modifier  'meta)
</pre>
</div>
</div>
</div>

<div id="outline-container-org8af7180" class="outline-4">
<h4 id="org8af7180"><span class="section-number-4">2.2.4</span> Training wheels</h4>
<div class="outline-text-4" id="text-2-2-4">
<p>
By default, Emacs prevent you from executing certain <i>dangerous</i> commands inadvertently. While I understand and sympathize with the need of such feature, I personally prefer to turn it off.
</p>

<p>
To change this option, set the variable <code>disabled-command-function</code> to <code>nil</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 8: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> disabled-command-function nil)
</pre>
</div>

<p>
On Emacs, you can set variables when open files, we call those <a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Specifying-File-Variables.html">File Variables</a>. There are occasions I want to execute some arbitrary code when I open a file. To do that, I would add a file variable called <code>eval</code>, and pass my arbitrary code to it. As you can imagine, this is a dangerous feature, so I have to give you the standard disclaimer:
</p>

<div class="warning" id="org8da648d">
<p>
The next configuration can lead to Emacs executing malicious code upon opening a file. By allowing Emacs to enable local <code>eval</code> you gain some nice ways to configure Emacs per file, on the cost of a high risk of vulnerability, so&#x2026; think a little bit about how do you indiscriminately open files on your editor before enabling this one.
</p>

</div>

<p>
To enable Emacs to use <code>eval</code> as a file variable, set the variable <code>enable-local-eval</code> to a non-<code>nil</code> value:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 9: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> enable-local-eval t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orged5804b" class="outline-4">
<h4 id="orged5804b"><span class="section-number-4">2.2.5</span> Emacs source code</h4>
<div class="outline-text-4" id="text-2-2-5">
<p>
Emacs documentation system is fantastic! It allows you to inspect any value, binding or function on the fly, and it displays the source code for of any callable together with its documentation.
</p>

<p>
For some Emacs functions, such source code is a <i>C</i> function from its core code, and by default, Emacs does not know where to look for its own source code.
</p>

<p>
To help Emacs to find its own source code, first clone it from the Emacs <a href="https://git.savannah.gnu.org/git/emacs.git">repository</a>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 10: </span>Commands to clone Emacs to local directory</label><pre class="src src-shell">mkdir -p ~/workplace/vendor/gnu
<span class="org-builtin">cd</span> ~/workplace/vendor/gnu
git clone https://git.savannah.gnu.org/git/emacs.git
</pre>
</div>

<p>
Then, set the variable <code>source-directory</code> to the cloned repository's path:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 11: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> source-directory (concat (getenv <span class="org-string">"HOME"</span>) <span class="org-string">"/workplace/vendor/gnu/emacs"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5fd6582" class="outline-4">
<h4 id="org5fd6582"><span class="section-number-4">2.2.6</span> Line numbers</h4>
<div class="outline-text-4" id="text-2-2-6">
<p>
I like to have line numbers displayed on the side of any source code I edit, but I don't like them everywhere (e.g. during prose writing), so I always make them turned off by default, and let the appropriate modes to set them on when they needed it:
</p>

<p>
To disable line numbers by default, set the variable <code>display-line-numbers-type</code> to <code>nil</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 12: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq-default</span> display-line-numbers-type nil)
</pre>
</div>

<p>
Notice I used the function <code>setq-default</code> here. It tells Emacs that if a buffer uses a local version of it, it always starts with the given value.
</p>

<p>
When Emacs is showing line numbers, it does so on the window's left <i>gutter</i>. To save some screen space, Emacs only reserves the necessary space on its gutter, to display the biggest visible line number. I believe this behavior disrupts the user experience when I scroll from line 99 to 100 and back. The visual effect is the editor screen moving right and left as I scroll.
</p>

<p>
It would be incredible inefficient to read the entire file just to check what is the biggest line number, so we can instruct Emacs does the second best thing: to only grow the gutter's size, and never shrink it.
</p>

<p>
To have such configuration, set the variable <code>display-line-numbers-grow-only</code> to a non-<code>nil</code> value:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 13: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq-default</span> display-line-numbers-grow-only t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbc20178" class="outline-4">
<h4 id="orgbc20178"><span class="section-number-4">2.2.7</span> Indentation</h4>
<div class="outline-text-4" id="text-2-2-7">
<p>
On this section, I will ask the reader to disagree on disagree, and set aside the almost religious subject of tabs versus spaces.
</p>

<p>
I prefer to always indent my files with <code>4</code> spaces with some rare exceptions for certain languages. To make Emacs use <code>4</code> spaces to indent by default, set the variable <code>tab-width</code> to <code>4</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 14: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq-default</span> tab-width 4)
</pre>
</div>

<p>
And to force emacs to always use spaces instead of tabs, set the <code>indent-tabs-mode</code> variable to <code>nil</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 15: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq-default</span> indent-tabs-mode nil)
</pre>
</div>
</div>
</div>

<div id="outline-container-org2f64cb9" class="outline-4">
<h4 id="org2f64cb9"><span class="section-number-4">2.2.8</span> Line wrapping</h4>
<div class="outline-text-4" id="text-2-2-8">
<p>
Until the writing of this document, I had the opinion that <i>soft wrap</i> was evil, and it had no place on any editor. Since then, I learned to appreciate <i>soft wrap</i> for prose, and later in this document, you will see all the other setup around <i>soft wrap</i> and have an idea why I was so against it.
</p>

<p>
To prevent Emacs from wrapping your text as it goes over the size of the screen, set the variable <code>truncate-lines</code> to a non-<code>nil</code> value:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 16: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq-default</span> truncate-lines t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdf053eb" class="outline-4">
<h4 id="orgdf053eb"><span class="section-number-4">2.2.9</span> Scrolling</h4>
<div class="outline-text-4" id="text-2-2-9">
<p>
One of my biggest gripes over Emacs is how it handles scrolling. Besides the slowness, the entire behavior is just bonkers. For me, the logical way to deal with scrolling, is to move the screen only when we move the cursor outside of it, and the editor should only move the screen by the value of current line number minus bottom line when user is going <i>down</i> the text.
</p>

<p>
To make Emacs not jump then necessary when cursor goes outside the screen, set the <code>scroll-conservatively</code> to a big number (bigger then the number of lines your display can show):
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 17: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> scroll-margin 3
      scroll-conservatively most-positive-fixnum
      scroll-up-aggressively 0.001
      scroll-down-aggressively 0.001)
</pre>
</div>

<p>
By default, Emacs will move the cursor with the text as you scroll, but only until the edge of the screen. When the cursor reaches the edge, it will stay there as you keep scrolling. This behavior presents an anti-pattern for usability. When I decide to scroll my buffer with the mouse wheel, I'm generally looking at the screen, around the area where the cursor is. If the cursor moves up or down from its position, my eyes lose track of it, and I will assume, it stayed with its original position as I scroll. If I decide to get back writing, my expectation is to just start typing, because the cursor should be on its previous position, but if I do this, I will start typing on the wrong part of the text.
</p>

<p>
After some lookup, I believe Emacs does not support such feature yet, so I decided to go with the best alternative for usability, which is to not move the cursor from its screen position at all. This way, my eyes will keep track of its position as I scroll, and I won't have any surprises as I type.
</p>

<p>
To prevent Emacs from moving the cursor up to the edge of the screen, set the variable <code>scroll-preserve-screen-position</code> to a non-<code>nil</code> value, and if you want this behavior to be the same for horizontal and vertical scroll, set it to a non-<code>nil</code> and non-<code>t</code> value:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 18: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> scroll-preserve-screen-position 'always)
</pre>
</div>

<p>
To fine tune my scroll, I like to have a bit of room between my cursor and the edge of the screen when I navigate the buffer using the keyboard.
</p>

<p>
To add a margin on your cursor as it gets on the edge of the screen, set the variable <code>scroll-margin</code> to the number of lines you want to always keep visible:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 19: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> scroll-margin 2)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgffd8d47" class="outline-4">
<h4 id="orgffd8d47"><span class="section-number-4">2.2.10</span> Repeatable commands</h4>
<div class="outline-text-4" id="text-2-2-10">
<p>
There is a new feature available since Emacs 28 that allow you to define a <i>repeatable map</i> for actions that take more than one keystroke to perform, and you want to repeat them with only the last keystroke in sequence.
</p>

<p>
For instance, on Doom, to increase the value of number, you need to use the key binding <code>g +</code>. If you want to increase the same number multiple times, you would have to type the same sequence multiple times (ignore the repeat command associated with the <code>.</code> key for didactic reasons).
</p>

<p>
I want to press <code>g +</code>, and then multiple keystrokes of <code>+</code> to increase the number multiple times, and the <code>repeat-mode</code> is the new feature that allows me to do that.
</p>

<p>
In order to use it, you have to define a keymap for the <i>repeatable keys</i>, and associate that keymap to the command that will start the repeat. This is an example on how to accomplish that:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 20: </span><code>repeat-mode</code> example for increment or rotate function</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">my-inc-or-rotate-repeat-map</span>
  (<span class="org-keyword">let</span> ((map (make-sparse-keymap)))
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Standard keys:</span>
    (define-key map <span class="org-string">"="</span> 'my-inc-or-rotate-at-point)
    (define-key map <span class="org-string">"-"</span> 'my-dec-or-rotate-at-point)
    map)
  <span class="org-doc">"Keymap to repeat window resizing commands.  Used in `</span><span class="org-doc"><span class="org-constant">repeat-mode</span></span><span class="org-doc">'."</span>)

(put 'my-inc-or-rotate-at-point 'repeat-map 'my-inc-or-rotate-repeat-map)
(put 'my-dec-or-rotate-at-point 'repeat-map 'my-inc-or-rotate-repeat-map)
</pre>
</div>

<p>
This is not bad, but with Lisp we can do better than that! The next macro helps with this process:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 21: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defmacro</span> <span class="org-function-name">my-repeat-map!</span> (map-name keys-alist <span class="org-type">&amp;optional</span> docstring)
  <span class="org-doc">"A helper macro to create keymaps for repeatable actions.</span>

<span class="org-doc">MAP-NAME is the variable name for the sparse keymap created, and KEYS-ALIST, is</span>
<span class="org-doc">an association list of functions to keys, where each function is called after</span>
<span class="org-doc">the associated key is pressed after the repeatable action is triggered."</span>
  `(<span class="org-keyword">defvar</span> ,map-name
     (<span class="org-keyword">let</span> ((map (make-sparse-keymap)))
       (<span class="org-keyword">dolist</span> (cmd ,keys-alist)
         (define-key map (cdr cmd) (car cmd))
         (put (car cmd) 'repeat-map ',map-name))
       map)
     ,docstring))
</pre>
</div>

<p>
You can find the previous example using the new macro on section <a href="#org833d567">3.1.2</a>.
</p>

<p>
In order to be able to use <code>repeat-mode</code> everywhere, I will turn it on after Emacs initializes:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 22: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(add-hook 'after-init-hook 'repeat-mode)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgffdc335" class="outline-4">
<h4 id="orgffdc335"><span class="section-number-4">2.2.11</span> Completion framework</h4>
<div class="outline-text-4" id="text-2-2-11">
<p>
TBD
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 23: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> vertico
  (vertico-mouse-mode))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 24: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> marginalia
  (add-to-list 'marginalia-prompt-categories '(<span class="org-string">"\\&lt;Find file\\&gt;"</span> . file))
  (add-to-list 'marginalia-prompt-categories '(<span class="org-string">"\\&lt;project\\&gt;"</span> . file)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 25: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> embark-action-indicator #'my-embark-which-key-action-indicator
      embark-become-indicator embark-action-indicator)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 26: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-embark-which-key-action-indicator</span> (map target)
  <span class="org-doc">"Helper function to display the `</span><span class="org-doc"><span class="org-constant">whichey</span></span><span class="org-doc">' help buffer for embark."</span>
  (which-key--show-keymap <span class="org-string">"Embark"</span> map nil nil 'no-paging)
  #'which-key--hide-popup-ignore-command)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org04c0020" class="outline-3">
<h3 id="org04c0020"><span class="section-number-3">2.3</span> Modal editing</h3>
<div class="outline-text-3" id="text-2-3">
<p>
As I mentioned on section <a href="#org365f551">2.1.1</a>, I do consider <i>Modal Editing</i> far superior then other methods. The main reason is the separation of states while editing a text. At some level, we all do modal editing, but the keybindings style popularized by Vim goes a step forward and <i>formalize</i> these states.
</p>

<p>
I decided to use Doom as the base of my configuration because it has good reasonable defaults, and its author is also an ex-<i>Vimer</i> like me, so he tailored this distribution with a Vim user in mind.
</p>

<p>
On Emacs, the package responsible to provide Vim inside Emacs is <a href="https://github.com/emacs-evil/evil">Evil</a>, and from all Vim plugins for other editors that I use, Evil is by far the best. So much that compare it with other Vim plugins is doing injustice to Evil developers. More often than not, we call Evil the Vim inside Emacs.
</p>

<p>
In this section, I will go through configurations and other packages related directly to Evil, so if you don't use Evil or modal editing, feel free to skip this one.
</p>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
If you're new to Vim, when you learn about the modes, on of the first <i>it's weird</i> feelings you'll have is when you are in <i>Normal Mode</i>, then, you decide to go into <i>Insert Mode</i> by pressing <code>i</code>, but right after that, you change your mind and press <code>&lt;ESC&gt;</code>&#x2026; What just happened? You didn't act on anything, you didn't press any movement key, still, the cursor moved one character to the left!
</p>

<p>
Well, I have to tell you that this behavior is not a bug, is just how we should expect the change of modes to be.
</p>

<p>
I said <i>should</i>, because I disliked this behavior since I first used Vim. I never understood the rationale behind it and I always tried to fix it in my configurations. The good news is, Evil developers added an option to do just that.
</p>

<p>
To fix the moving back the cursor annoyance, set the variable <code>evil-move-cursor-back</code> to <code>nil</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 27: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> evil-move-cursor-back nil)
</pre>
</div>

<p>
After this configuration, one might realize that going to <i>Insert Mode</i> using <code>a</code> and pressing <code>&lt;ESC&gt;</code> has the opposite effect of moving the cursor to the right. In this case, at least for me, this is an acceptable behavior since the user explicitly requested to go to <i>Insert Mode</i> <b>after</b> the current character, is reasonable the editor to move your cursor to the next position.
</p>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
On the same lines of <i>moving back the cursor</i>, there is another <i>expected</i> behavior of Vim that I don't get it, the infamous <i>overwriting your clipboard with the contents of a selection that you just paste on top of it</i> (I couldn't find a better way to refer to this behavior).
</p>

<p>
I'm sure that, at some point, this behavior made sense for a lot of developers, but in my personal opinion, if you are pasting the clipboard on top of a selected text, is highly unlikely that you want to use the contents of such selection right after pasting something on top of it. I believe the natural behavior of developers these days, is to consider the selected text you just paste on top of it, as gone.
</p>

<p>
And just like with the previous annoyance, Evil also offers an option to change this behavior. If you want to <b>not</b> copy the content of a selection you just paste something on top of it, set the variable <code>evil-kill-on-visual-paste</code> to <code>nil</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 28: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> evil-kill-on-visual-paste nil)
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
Because Evil tries to stay faithful to Vim, it does not force Emacs objects into Vim's lingo. One of these examples is the visual selection. Emacs has something called <i>regions</i> that serves, also, to the purpose of selecting text, but in reality, the Vim's visual selection and Emacs' regions, are not the same thing.
</p>

<p>
However, Evil is an Emacs package, and it also tries to integrate with existent packages and features, and it offers a configuration that makes Evil visual selection, to expand the Emacs selection region when we select something. The net effect of this, is that we can use the terms selection and region interchangeability for all practical purposes.
</p>

<p>
If you want Evil to synchronize its visual selection with the Emacs region, set the variable <code>evil-visual-region-expanded</code> to a non-<code>nil</code> value:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 29: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> evil-visual-region-expanded t)
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
Evil defines the priority of its highlight in a way that Emacs displays the visual selection overlays bellow search highlights. As of today I can't figure out why this is the case. One workflow pretty common is to search the name of a variable, select its prefix, and search for the rest of the variable. With the default configuration, you can't see what you're selecting until your selections is bigger than the search term.
</p>

<p>
Unfortunately, Evil hard-code the <a href="https://github.com/emacs-evil/evil/blob/master/evil-states.el#L624">visual</a> <a href="https://github.com/emacs-evil/evil/blob/master/evil-states.el#L731">priority</a> value to 99 for visual selection, which is smaller than the other hard-coded values for the <a href="https://github.com/emacs-evil/evil/blob/master/evil-search.el#L666">search</a> <a href="https://github.com/emacs-evil/evil/blob/master/evil-search.el#L868">highlight</a> overlays, and this was already reported to Evil on issue <a href="https://github.com/emacs-evil/evil/issues/1089">#1089</a> on GitHub.
</p>

<p>
To fix this, we have to advise <code>evil-visual-highlight</code> and <code>evil-visual-highlight-block</code> to bump the overlay priority after these functions execute:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 30: </span>autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-evil-visual-highlight-a (<span class="org-type">&amp;rest</span> _)
  <span class="org-doc">"Make the visual overlay have higher priority than the search highlight."</span>
  <span class="org-builtin">:after</span> '(evil-visual-highlight evil-visual-highlight-block)
  (<span class="org-keyword">when</span> evil-visual-overlay
    (overlay-put evil-visual-overlay 'priority 1010))
  (<span class="org-keyword">when</span> evil-visual-block-overlays
    (<span class="org-keyword">dolist</span> (overlay evil-visual-block-overlays)
        (overlay-put overlay 'priority 1010))))
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
Vim (therefore also Evil) has this notion of a grammar to execute actions on text:
</p>

<div class="org-src-container">
<pre class="src src-text">{operation}{operator}{target object}
</pre>
</div>

<p>
Where <i>operation</i> is the command you're executing, operator can be <i>i</i> (inside) or <i>a</i> (also), and the <i>target object</i> can be any of the targets defined Evil (e.g. <i>s</i> for <i>sentence</i>, <i>p</i> for <i>paragraph</i>, <i>[</i> for <i>square brackets content</i>, etc. ).
</p>

<p>
One of these target object is <i>w</i> for <i>word</i> and in my experience, the meaning of <i>"word"</i> varies according to context. Let me explain&#x2026;
</p>

<p>
If you're editing a text file for blog, the meaning of <i>"word"</i> is most likely the same meaning of the English dictionary, but if you're editing a <i>Lisp</i> code, a word probably include more characters than the conventional <i>"word"</i> (e.g. while <i>"foo"</i> is a word in any context, <i>"foo-bar"</i> is a word, probably only when you're editing a Lisp file).
</p>

<p>
A quick trick to make Evil understand the meaning of <i>"word"</i> as I just described, is to create an alias for the function <code>forward-evil-symbol</code>, and name it <code>forward-evil-word</code>. This way, we override the normal function to act as if it is the <code>forward-evil-symbol</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 31: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defalias</span> #'forward-evil-word #'forward-evil-symbol)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb388a91" class="outline-3">
<h3 id="orgb388a91"><span class="section-number-3">2.4</span> Text snippets</h3>
<div class="outline-text-3" id="text-2-4">
<p>
Snippets (also known as Live Templates on certain platforms), are tidbits of text that one can include on the editing text by typing a keyword and pressing a shortcut key (usually <code>TAB</code>) with the cursor right after the keyword.
</p>

<p>
Doom Emacs offers basic configuration for the package <i><a href="https://github.com/joaotavora/yasnippet">Yasnippet</a></i>, which is the most used snippet system on Emacs.
</p>

<p>
Most snippet frameworks available across editors (including <i>Yasnippet</i>) offer the ability to edit some placeholders on the snippet, so one can have a single snippet and use it on different scenarios. For instance:
</p>

<p>
Let's assume I'm a Java developer, and as such, one of the most common scenarios is for me to create a class, more or less like this:
</p>

<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">MyClassName</span> {
    <span class="org-keyword">public</span> <span class="org-function-name">MyClass</span>() {
    }
}
</pre>
</div>

<p>
I could make this text as a snippet, and I would have to replace <code>MyClassName</code> with whatever name I want, but I could go a step further and make my snippet something like this:
</p>

<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> ${1:MyClassName} {
    <span class="org-keyword">public</span> $1() {
        $0
    }
}
</pre>
</div>

<p>
Now, when I expand this snippet, I have the chance to type the name of the class right after expanding it, press <code>TAB</code> again, and get my cursor inside the public constructor.
</p>

<p>
For instance, first I type the snippet keyword (the <code>|</code> character represents the cursor, and <code>[]</code> represents a selected placeholder):
</p>

<div class="org-src-container">
<pre class="src src-java">myclass|
</pre>
</div>

<p>
As soon as I press <code>TAB</code>, the snippet expansion happens:
</p>

<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> [|MyClassName] {
    <span class="org-keyword">public</span> <span class="org-function-name">MyClassName</span>() {

    }
}
</pre>
</div>

<p>
If I type a different name for the class, the constructor will mirror that change:
</p>

<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">AwesomeClass</span>| {
    <span class="org-keyword">public</span> <span class="org-function-name">AwesomeClass</span>() {

    }
}
</pre>
</div>

<p>
And as soon as I press <code>TAB</code> again, the cursor moves to inside the constructor:
</p>

<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">AwesomeClass</span> {
    <span class="org-keyword">public</span> <span class="org-function-name">AwesomeClass</span>() {
        |
    }
}
</pre>
</div>

<p>
Another functionality provided by the snippet framework, is the ability to delete a placeholder that does not make sense on the current context. As an example, lets augment our previous snippet with the ability to type arguments on the constructor:
</p>

<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> ${1:MyClassName} {
    <span class="org-keyword">public</span> $1(${2:args}) {
        $0
    }
}
</pre>
</div>

<p>
Now, after renaming the class, if I press <code>TAB</code>, I have the chance to type anything as an argument tot the constructor:
</p>

<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">AwesomeClass</span> {
    <span class="org-keyword">public</span> <span class="org-type">AwesomeClass</span>([|args]) {

    }
}
</pre>
</div>

<p>
If I press <code>TAB</code> without typing anything, I would move the cursor to inside the constructor, but would have the word <code>args</code> as a parameter definition (which, in Java, is not a valid declaration):
</p>

<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">AwesomeClass</span> {
    <span class="org-keyword">public</span> <span class="org-function-name">AwesomeClass</span>(<span class="org-type">args</span>) {   <span class="org-comment-delimiter">// </span><span class="org-comment">&lt;-- Compile error</span>
        |
    }
}
</pre>
</div>

<p>
What we want to do here, is to delete the placeholder and move to the next position, and end up with the same result as before:
</p>

<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">AwesomeClass</span> {
    <span class="org-keyword">public</span> <span class="org-function-name">AwesomeClass</span>() {
        |
    }
}
</pre>
</div>

<p>
By default, we can achieve this by pressing <code>DEL</code> instead of <code>TAB</code>. In general, this behavior is pretty good, except when you're typing on a MacBook laptop keyboard. MacBook's keyboards don't have the key <code>DEL</code> on them, and to get a <code>DEL</code>, I have to use a combination of two keys.
</p>

<p>
For this reason, I want to make sure that the same behavior I have with <code>DEL</code>, I also have with <code>BACKSPACE</code>.
</p>

<p>
The following function, is an adaptation of the Doom's own <code>+snippets/delete-forward-char-or-field</code> function, but doing the reverse of it.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 32: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-snippets-delete-backward-char-or-field</span> (<span class="org-type">&amp;optional</span> field)
  <span class="org-doc">"Delete backward, or skip the current field if it's empty.</span>

<span class="org-doc">Prevents Yas from interfering with backspace deletion."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((field (<span class="org-keyword">or</span> field (<span class="org-keyword">and</span> (overlayp yas--active-field-overlay)
                              (overlay-buffer yas--active-field-overlay)
                              (overlay-get yas--active-field-overlay 'yas--field)))))
    (<span class="org-keyword">cond</span> ((not (yas--field-p field))
           (call-interactively #'delete-backward-char))
          ((<span class="org-keyword">and</span> (not (yas--field-modified-p field))
                (eq (point) (marker-position (yas--field-start field))))
           (yas--skip-and-clear field)
           (yas-next-field 1))
          ((eq (point) (marker-position (yas--field-start field))) nil)
          ((call-interactively #'delete-backward-char)))))
</pre>
</div>

<p>
With the function defined, I can simply add it to a key bind to start using it. Notice on the following code, that I also map <code>⌘-RET</code> to allow me to end the snippet completion and accept all the default values (I'm trying to make <code>⌘-RET</code> a standard keymap that means <i>finish and accept</i>):
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 33: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:after</span> yasnippet

      (<span class="org-builtin">:leader</span> <span class="org-builtin">:prefix</span> (<span class="org-string">"h"</span> . <span class="org-string">"help"</span>)
       <span class="org-builtin">:desc</span> <span class="org-string">"Show snippets"</span> <span class="org-builtin">:n</span> <span class="org-string">"y"</span> #'yas-describe-tables)

      (<span class="org-builtin">:map</span> yas-keymap
       <span class="org-builtin">:g</span> [backspace] #'my-snippets-delete-backward-char-or-field
       <span class="org-builtin">:g</span> [deletechar] #'+snippets/delete-forward-char-or-field
       <span class="org-builtin">:g</span> [s-return] #'yas-exit-snippet))
</pre>
</div>

<p>
The last configuration for snippets is to guarantee the <code>yas-describe-tables</code> shows up on the right side of the screen:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 34: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(set-popup-rule! <span class="org-string">"^\\*YASnippet Tables\\*"</span>
  <span class="org-builtin">:slot</span> 2   <span class="org-builtin">:vslot</span> -1     <span class="org-builtin">:side</span> 'right   <span class="org-builtin">:width</span> 104 <span class="org-builtin">:height</span> 0.4
  <span class="org-builtin">:select</span> t <span class="org-builtin">:modeline</span> nil <span class="org-builtin">:autosave</span> nil  <span class="org-builtin">:ttl</span> 0     <span class="org-builtin">:quit</span> t)
</pre>
</div>

<p>
Throughout this document, you will find helpful snippets I like to define for certain features. I decided to spread the snippets across different features because I want to indicate to the reader to consider the snippet in question as an integral part of the configuration at hand.
</p>
</div>
</div>

<div id="outline-container-org8c6b049" class="outline-3">
<h3 id="org8c6b049"><span class="section-number-3">2.5</span> Inline completion</h3>
<div class="outline-text-3" id="text-2-5">
<p>
What I call inline completion, is also known as intellisense, code completion, or in the Vim world, omni completion. It's a useful tool to help the user type less and more correctly while editing source code.
</p>

<p>
Years ago, there were two main packages that provided such feature on Emacs:
</p>

<ul class="org-ul">
<li><a href="https://github.com/auto-complete/auto-complete">auto-complete</a></li>
<li><a href="https://github.com/company-mode/company-mode">company-mode</a></li>
</ul>

<p>
On the time I'm writing this part of my document, <a href="https://github.com/auto-complete/auto-complete">auto-complete</a> is searching for a new maintainer, and I barely read any mention of it on the mainstream media.
</p>

<p>
Since I've been using <a href="https://github.com/company-mode/company-mode">company-mode</a> for the most part of my Emacs experience, I will stick with it on my new configuration.
</p>

<p>
One of the best features I like on <a href="https://github.com/company-mode/company-mode">company-mode</a>, is its architecture design, where the author decided to modularize the package, allowing other packages to integrate with it where they actually mater. For instance, if my package offers a major mode to edit files from the <i>Foo</i> language, I can create a <code>foo-company-backend</code> to integrate it on the Company ecosystem, or if my package provides a new cool way to display inline completions, I can create a <i>company frontend</i> to make such integration.
</p>

<p>
For the most part, Doom does a pretty good job configuring <a href="https://github.com/company-mode/company-mode"><code>company-mode</code></a> to my liking, I just need to adjust some small behaviors and keymaps.
</p>

<p>
One of the most prominent differences on my configuration is the fact that I don't like to let <a href="https://github.com/company-mode/company-mode"><code>company-mode</code></a> to show its popup automatically. It is a nice feature, but with certain backends, it can slow down the edit experience (I'm looking at you <a href="https://github.com/company-mode/company-mode/blob/master/company-ispell.el"><code>company-ispell</code></a>). For that reasons (and also because I rather the experience of <a href="https://github.com/ervandew/supertab"><code>supertab</code></a> on Vim's world), I decided to not <i>auto-display</i> Company's popup.
</p>

<p>
In order to display the completion on my configuration, one has to press <code>TAB</code> after type couple characters of the word, or type a "<code>.</code>" character after a keyword on programming modes that support it.
</p>

<p>
Such behavior is so wildly used that Company offers a helper function (<code>company-indent-or-complete-common</code>) to help the user to handle <i>inserting a "<code>\t</code>" character</i> versus displaying the completion. That is all and good, but unfortunately, as seen on section <a href="#orgb388a91">2.4</a>, I have a third function for the <code>TAB</code> key.
</p>

<p>
In order to help me handle my three cases for <code>TAB</code> I need to create small wrapper function to add the <code>yasnippet</code> check before handling completion to Company:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 35: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-company-indent-or-complete-common</span> (arg)
  <span class="org-doc">"Tab key action for current point.</span>

<span class="org-doc">This function tries to insert a tab character, trigger a snippet or complete a</span>
<span class="org-doc">word with company.</span>

<span class="org-doc">The order for this selection is:</span>

<span class="org-doc">- Org table</span>
<span class="org-doc">- Yasnippet</span>
<span class="org-doc">- Indent region</span>
<span class="org-doc">- Indent line</span>
<span class="org-doc">- Indent org-mode line</span>
<span class="org-doc">- Indent org-mode headline</span>
<span class="org-doc">- Indent org-mode item from a list</span>
<span class="org-doc">- Indent markdown-mode line</span>
<span class="org-doc">- Indent rst-mode line</span>
<span class="org-doc">- Complete with company</span>

<span class="org-doc">The action selection happens in this order and stops as soon as the first action</span>
<span class="org-doc">works."</span>
  (<span class="org-keyword">interactive</span> <span class="org-string">"P"</span>)
  (<span class="org-keyword">if</span> (org-table-p)
      (orgtbl-tab arg)
    (<span class="org-keyword">if</span> (<span class="org-keyword">or</span> (not yas-minor-mode)
            (null (yas-expand)))
        (<span class="org-keyword">cond</span> ((use-region-p) (indent-region (region-beginning) (region-end)))
              (t (<span class="org-keyword">let</span> ((old-point (point))
                       (old-tick (buffer-chars-modified-tick))
                       (tab-always-indent t))
                   (indent-for-tab-command arg)
                   (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> (eq old-point (point))
                              (eq old-tick (buffer-chars-modified-tick)))
                     (<span class="org-keyword">unless</span> (<span class="org-keyword">pcase</span> major-mode
                               ('org-mode (<span class="org-keyword">or</span> (org-indent-line)
                                              (org-cycle-level)
                                              (org-cycle-item-indentation)))
                               ('markdown-mode (markdown-indent-line))
                               ('rst-mode (rst-indent-line nil))
                               (_ nil))
                       (company-complete-common))))))
      (company-abort))))
</pre>
</div>

<p>
This function incorporates the source code of <code>company-indent-or-complete-common</code> to allow me to handle special cases like in Org mode when I want to indent a list item or headline. It first tries to expand the previous word on a snippet. If it can't, it falls back to the altered Company function, where it also tries to do an Org indent, or a Markdown indent, or a reStructuredText before settling on <code>company-complete-common</code>.
</p>

<p>
But what if I'm already displaying the Company popup, but I want to expand what I just typed into a snippet? The previous function can't help us, because it does not handle navigating the completion options with <code>TAB</code>. For such behavior, I need another function that I should run instead of the previous one if I have Company's popup opened:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 36: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-completion-yasnippet-or-completion</span> ()
  <span class="org-doc">"Tab key action when company popup is visible.</span>

<span class="org-doc">This function tries to expand a snippet, complete a common prefix on a company</span>
<span class="org-doc">completion, or move the company selction to the next item."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> (<span class="org-keyword">or</span> (not yas-minor-mode)
          (null (yas-expand)))
      (company-complete-common-or-cycle)
    (company-abort)))
</pre>
</div>

<p>
Notice that the only difference between <code>my-company-indent-or-complete-common</code> and <code>my-completion-yasnippet-or-completion</code> is that I call <code>company-indent-or-complete-common</code> on the former, and <code>company-complete-common-or-cycle</code> on the latter.
</p>

<p>
Another deviation from the standard that I like, is how the <code>RET</code> should work with Company.
</p>

<p>
For me, there are two scenarios that can happen if one presses <code>RET</code> while the Company popup is visible:
</p>

<ol class="org-ol">
<li>The user meant to insert a "<code>\n</code>" character on the document;</li>
<li>The user intended to select the selected completion option;</li>
</ol>

<p>
The way to distinguish between these two scenarios, is to check if Company already have a selection stored at <code>company-selection</code>. If it does have, the <code>RET</code> should represent a <code>company-complete-selection</code>, otherwise, the <code>RET</code> should close the Company popup, and insert a "<code>\n</code>" character on the document. I created the next function to manage these behaviors:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 37: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-completion-complete-selection-or-return</span> ()
  <span class="org-doc">"Return key action when company popup is visible.</span>

<span class="org-doc">This function will select current company item if user already selected one, or</span>
<span class="org-doc">insert a new line character."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> company-selection
      (company-complete-selection)
    (company-abort)
    (execute-kbd-macro (read-kbd-macro <span class="org-string">"&lt;return&gt;"</span>))))
</pre>
</div>

<p>
Notice also, that I didn't use <code>insert</code> when a <code>RET</code> means to <i>add a new line</i>. This decision is to allow Emacs to trigger any function or hook tied to the <code>RET</code> key.
</p>

<p>
With all auxiliary functions created, I just need to set up Company according to my needs:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 38: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> company
  (<span class="org-keyword">setq</span> company-idle-delay nil)
  (<span class="org-keyword">setq</span> tab-always-indent 'complete)
  (<span class="org-keyword">setq</span> company-minimum-prefix-length 2)
  (<span class="org-keyword">setq</span> company-show-numbers t)
  (<span class="org-keyword">setq</span> company-box-doc-enable nil)
  (<span class="org-keyword">setq</span> company-frontends (delq 'company-pseudo-tooltip-frontend company-frontends))

  (add-hook 'evil-normal-state-entry-hook #'company-abort))
</pre>
</div>

<p>
One configuration that worth mention why I choose it is to set <code>company-box-doc-enable</code> to <code>nil</code>. I did this, not because I don't like the documentation as another child frame, is the fact that if I do show it, I can't move my popup completion without aborting Company.
</p>

<p>
Last, I need to set up the proper keymaps for the package:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 39: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:after</span> company
      (<span class="org-builtin">:map</span> global-map
       <span class="org-builtin">:i</span> [tab] #'my-company-indent-or-complete-common)
      (<span class="org-builtin">:map</span> company-active-map
       <span class="org-builtin">:g</span> [tab] #'my-completion-yasnippet-or-completion
       <span class="org-builtin">:g</span> [backtab] #'company-select-previous
       <span class="org-builtin">:g</span> [down] #'company-select-next
       <span class="org-builtin">:g</span> [up] #'company-select-previous
       <span class="org-builtin">:g</span> [return] #'my-completion-complete-selection-or-return
       <span class="org-builtin">:g</span> <span class="org-string">"C-S-j"</span> #'company-next-page
       <span class="org-builtin">:g</span> <span class="org-string">"C-S-k"</span> #'company-previous-page
       <span class="org-builtin">:g</span> <span class="org-string">"C-/"</span> #'company-show-doc-buffer))
</pre>
</div>
</div>
</div>

<div id="outline-container-org463d798" class="outline-3">
<h3 id="org463d798"><span class="section-number-3">2.6</span> Automatic indentation</h3>
<div class="outline-text-3" id="text-2-6">
<p>
I appreciate the fact that majority of editor these days can keep the indentation of the previous line, and some of them, are even capable of adding indentation where is necessary. Although this is a good start, I want my editor to do more. When I add braces around a code, or when I make a one-line statement, a multi-line one, I want the editor to reformat my file to properly indent it.
</p>

<p>
Emacs offers a mode called <code>electric-indent-mode</code> where the ultimate goal, is to achieve exactly what I described, but unfortunately, the current state of the mode is falling short of it.
</p>

<p>
The solution I found, is an external package called <a href="https://github.com/Malabarba/aggressive-indent-mode"><code>aggressive-indent</code></a> that re-indent the entire file on every change.
</p>

<p>
It is a bit too aggressive, but so far is working just fine for me, so let's add it to our packages:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 40: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> aggressive-indent)
</pre>
</div>

<p>
A point to note is where to use this package. I need it on <code>prog-mode</code>, but due to some particularities of certain languages (did someone said Python here?), I need to specify the set of languages I want to support aggressive indent. The reader can check the list of supported language on the following code snippet:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 41: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> aggressive-indent
  <span class="org-builtin">:hook</span> ((emacs-lisp-mode
          c-mode
          cpp-mode
          rust-mode
          go-mode
          java-mode
          kotlin-mode
          shell-mode
          javascript-mode
          typescript-mode) <span class="org-warning">. aggressive-indent-mode))</span>
</pre>
</div>

<p>
The reason to not include Python on this list, is the fact that Python uses indentation as block delimiter, and the package does not know how where a block ends, and a new one starts, causing re-indentation to pretty much break the code.
</p>
</div>
</div>

<div id="outline-container-org526bd3e" class="outline-3">
<h3 id="org526bd3e"><span class="section-number-3">2.7</span> Smart backspace</h3>
<div class="outline-text-3" id="text-2-7">
<p>
As part of my day job, I had to do a lot of Android development, and inevitably I used <a href="https://www.jetbrains.com/">JetBrains</a>
IDE <a href="https://www.jetbrains.com/idea/">IntelliJ IDEA</a>. I bring this up not to chastise who uses or to complain about it. In face, IntelliJ the best IDE for Java and Kotlin out there. It has some features that are so good, that I want to implement on any text editor I use. One of these features is what I call <i>Smart Backspace</i>.
</p>

<p>
On both, Doom and IntelliJ, when you type an open pair, the editor completes with the closing one:
</p>

<div class="org-src-container">
<pre class="src src-kotlin">fun foo() {|}
</pre>
</div>

<p>
Also, when you press <code>&lt;ENTER&gt;</code>, the editor position the cursor on a newly inserted line, on using the correct indentation, and it also inserts a '<code>\n</code>' character after cursor. The result of these actions would be like this:
</p>

<div class="org-src-container">
<pre class="src src-kotlin">fun foo() {
    |
}
</pre>
</div>

<p>
The difference between both editors happens when you press <code>&lt;BACKSPACE&gt;</code> at this point. While in Doom, this operation would result in:
</p>

<div class="org-src-container">
<pre class="src src-kotlin">fun foo() {
|
}
</pre>
</div>

<p>
On IntelliJ, it results in:
</p>

<div class="org-src-container">
<pre class="src src-kotlin">fun foo() {|}
</pre>
</div>

<p>
But what happened here?
</p>

<p>
IntelliJ was able to figure out that, since I was on the indent column of the line <b>and</b> I haven't typed anything after the auto-pair, when I pressed <code>&lt;BACKSPACE&gt;</code>, my intention was to get back to the state I was before pressing <code>&lt;ENTER&gt;</code>, therefore the name I gave to this feature: <i>Smart backspace</i>.
</p>

<p>
To achieve the same result with Doom, we have to add a function advice to delete advice Doom adds to Emacs (the <code>+default--delete-backward-char-a</code> advice is what is responsible to balance the blank characters you enter after a pair completion).
</p>

<p>
Our advice function checks if our cursor is position on the expected position to revert the <code>&lt;ENTER&gt;</code> pressed between the two pairs. If it is, we remove all the characters before the cursor on the current line. This will put the cursor on a position that Doom's advice function can remove the two new line characters around the cursor, putting the buffer on the same state we were before we pressed <code>&lt;ENTER&gt;</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 42: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-super-backward-delete-a (<span class="org-type">&amp;rest</span> _)
  <span class="org-doc">"Special function to super-delete things.</span>

<span class="org-doc">If the line content before cursor contains only blank characters, this function</span>
<span class="org-doc">will delete all the blank characters, and then, join with the previous line. I</span>
<span class="org-doc">there is any non-blank character before cursor, this function will delete the</span>
<span class="org-doc">entire line, but keep the correct indentation on it."</span>
  <span class="org-builtin">:before</span> '+default--delete-backward-char-a
  (<span class="org-keyword">let*</span> ((line-pos (- (point) (point-at-bol)))
         (prev-indent (<span class="org-keyword">save-excursion</span>
                        (forward-line -1)
                        (current-indentation)))
         (prev-line-bol (point-at-bol 0))
         (next-line-eol (point-at-eol 2))
         (smart-bs-p (<span class="org-keyword">or</span> (<span class="org-keyword">save-excursion</span>
                           (<span class="org-keyword">and</span> (re-search-backward <span class="org-string">"{[ \t]*\n[ \t]*"</span> prev-line-bol t)
                                (re-search-forward <span class="org-string">"[ \t]*\n[ \t]*}"</span> next-line-eol t)))
                         (<span class="org-keyword">save-excursion</span>
                           (<span class="org-keyword">and</span> (re-search-backward <span class="org-string">"\\[[ \t]*\n[ \t]*"</span> prev-line-bol t)
                                (re-search-forward <span class="org-string">"[ \t]*\n[ \t]*\\]"</span> next-line-eol t)))
                         (<span class="org-keyword">save-excursion</span>
                           (<span class="org-keyword">and</span> (re-search-backward <span class="org-string">"([ \t]*\n[ \t]*"</span> prev-line-bol t)
                                (re-search-forward <span class="org-string">"[ \t]*\n[ \t]*)"</span> next-line-eol t))))))
    (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> smart-bs-p
               (&lt;= line-pos (+ prev-indent standard-indent)))
      (delete-char (- line-pos)))))
</pre>
</div>

<p>
Adding this advice as an <i>autoload</i> function on our configuration is all we need to get the functionality working. When Doom loads the <code>smartparens</code> on the default module, it replaces the Emacs <code>delete-backward-char</code> function with its <code>+default--delete-backward-char-a</code> advice, which will load our function, which, in turn, installs itself as a <code>:before</code> advice on Doom's function.
</p>
</div>
</div>

<div id="outline-container-org6269bc5" class="outline-3">
<h3 id="org6269bc5"><span class="section-number-3">2.8</span> Balanced pairs</h3>
<div class="outline-text-3" id="text-2-8">
<p>
In most editors (as far as editors go, I only saw Emacs allowing balanced pairs), there is no balanced pair protection. If you remove a line where a closing character is, without removing its open pair, your buffer becomes unbalanced.
</p>

<p>
Emacs has some packages that help you keep the balance on pair characters, even if you try to remove a line containing just one of the pairs.
</p>

<p>
Among the packages I checked, the two top two contenders for me are <a href="https://github.com/noctuid/lispyville"><code>lispville</code></a> and <a href="https://github.com/Fuco1/smartparens"><code>smartparens</code></a>  + (<a href="https://github.com/luxbock/evil-cleverparens"><code>evil-cleverparens</code></a> or <a href="https://github.com/expez/evil-smartparens"><code>evil-smartparens</code></a>).
</p>

<p>
From the two, <code>lispville</code> seams to be the most maintained, but it depends on <code>lispy</code> and even though you can use it just for the balance protection, it requires much more code and effort to do it right, so my choice is <code>smartparens</code> + <code>evil-cleverparens</code>. I tried <code>evil-smartparens</code> before, and it is not as polished as <code>evil-cleverparens</code>.
</p>

<p>
To install them, make sure <code>smartparens</code> is enable in your <code>init.el</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 43: </span>$DOOMDIR/init.el</label><pre class="src src-emacs-lisp"><span class="org-builtin">:config</span>
(default
    +bindings
    +smartparens)
</pre>
</div>

<p>
And <code>evil-cleverparens</code> is on the <code>packages.el</code> file as well:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 44: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> evil-cleverparens)
</pre>
</div>

<p>
These changes will make Doom download them into its local cache when you run <code>doom sync</code>.
</p>

<p>
Before I configure these packages, I would like to explain why I turn on balance protection only on Emacs modes deriving from <code>prog-mode</code>.
</p>

<p>
The simplest explanation is that you don't really need pair balance protection in any other place then your coding buffers. I did some informal experiments on this area, and found that pair protection turned on when you write prose is magnitudes more annoying than useful, so I will stick with protection only in <code>prog-mode</code>.
</p>

<p>
To make Emacs turn <code>smartparens</code> and related packages correctly, make sure that you turn on <code>evil-cleverparens-mode</code> on the <code>smartparens-enabled-hook</code>, and only enable the strict mode when editing a <code>prog-mode</code> buffer:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 45: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> smartparens
  <span class="org-builtin">:init</span> (add-hook 'smartparens-strict-mode-hook #'evil-cleverparens-mode)
  <span class="org-builtin">:hook</span> ((prog-mode . smartparens-strict-mode)))
</pre>
</div>

<p>
Doom will turn on <code>smartparens</code> appropriately, so we don't need to hook anything else to get this feature working, but there is one more configuration that I like to have on, all the time. It is the ability of Emacs to highlight the <i>other pair</i> when the cursor is on top of a character pair.
</p>

<p>
To do so, enable the <code>show-smartparens-global-mode</code> after enabling <code>smartparens</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 46: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> smartparens
  (show-smartparens-global-mode 1))
</pre>
</div>
</div>
</div>

<div id="outline-container-org63f05bb" class="outline-3">
<h3 id="org63f05bb"><span class="section-number-3">2.9</span> Rich keybindings</h3>
<div class="outline-text-3" id="text-2-9">
<p>
The good thing about this feature is that Emacs already covers almost all of my <a href="#orga231bd7">requirements</a> for free, and doom ships with a package that covers the rest of it (<code>which-key</code>). What I need to do here, is to tweak <code>which-key</code> to <i>look</i> and <i>feel</i> like I want it.
</p>

<p>
One aspect of which key that bothered me is not so much a <code>which-key</code> thing, and more an Emacs thing in general. This aspect is how popup windows show and hide. When Emacs shows one at the bottom of the screen, it shifts the window I'm working on upwards, and although this came to be the expected behavior, it disrupts my flow, specially if the time I take to finish a shortcut sequence is couple milliseconds more than the <code>which-key</code> timeout.
</p>

<p>
To remediate this situation, I found this package called  <a href="https://github.com/yanghaoxie/which-key-posframe"><code>which-key-posframe</code></a> that display the shortcut hints on a child frame. With a configuration or two, I believe this package can deliver what I want.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 47: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> which-key-posframe)
</pre>
</div>

<p>
The main adjustments I want to do, is to make sure the child frame <i>width</i> is big enough to fit the biggest description I can have.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 48: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> which-key-posframe
  <span class="org-builtin">:hook</span> (which-key-mode . which-key-posframe-mode)
  <span class="org-builtin">:custom</span>
  (which-key-posframe-poshandler 'my-posframe-poshandler-frame-right-middle)
  (which-key-posframe-parameters '((min-width . 44))))
</pre>
</div>

<p>
And respect the border color for popups:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 49: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(custom-set-faces!
  `(which-key-posframe-border <span class="org-builtin">:background</span> <span class="org-string">"#000000"</span>)
  `(which-key-posframe <span class="org-builtin">:background</span> <span class="org-string">"#21242b"</span>))
</pre>
</div>

<p>
I need also to set the <code>which-key-posframe-poshandler</code> variable, to allow a special behavior regarding positioning the child frame on the screen.
</p>

<p>
This special behavior is simply to most of the time, show the shortcut hints on the right side of the frame, but if I invoke an Embark action, I want the shortcut hints child frame to show up right besides the cursor point.
</p>

<p>
To achieve this behavior, I'll define a <code>nil</code> placeholder variable that I can set to <code>t</code> when invoking Embark.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 50: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defvar</span> <span class="org-variable-name">my-which-key-on-embark</span> nil)
</pre>
</div>

<p>
Which such variable created, I can define my function to place the frame where I want it:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 51: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-posframe-poshandler-frame-right-middle</span> (info)
  <span class="org-doc">"Posframe's position handler.</span>

<span class="org-doc">Get a position which let posframe stay vertically centralized onto current</span>
<span class="org-doc">frame's right site. Checkk the docstring of `</span><span class="org-doc"><span class="org-constant">posframe-show</span></span><span class="org-doc">' for more information</span>
<span class="org-doc">about the INFO structure."</span>
  (<span class="org-keyword">if</span> my-which-key-on-embark
      (posframe-poshandler-point-bottom-left-corner info)
    (<span class="org-keyword">let*</span> ((frame-width (plist-get info <span class="org-builtin">:parent-frame-width</span>))
           (frame-height (plist-get info <span class="org-builtin">:parent-frame-height</span>))
           (posframe-width (plist-get info <span class="org-builtin">:posframe-width</span>))
           (posframe-height (plist-get info <span class="org-builtin">:posframe-height</span>)))
      (cons (- frame-width posframe-width (line-pixel-height))
            (/ (- frame-height posframe-height) 2)))))
</pre>
</div>

<p>
In order to connect <code>embark</code> to <code>which-key</code>, I need to advise the function I defined to invoke <code>which-key</code> when I invoke <code>embark</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 52: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-embark-which-key-action-wrapper (orig-fun <span class="org-type">&amp;rest</span> args)
  <span class="org-doc">"Wrap ORIGIN-FUN on a let bind to indicate this is an Embark call.</span>

<span class="org-doc">It passes ARGS to ORIGIN-FUN without altering them. "</span>
  <span class="org-builtin">:around</span> 'my-embark-which-key-action-indicator
  (<span class="org-keyword">let</span> ((my-which-key-on-embark t))
    (apply orig-fun args)))
</pre>
</div>

<p>
With the <code>which-key-posframe</code> configured, I just need to do some minor adjustments on the <code>which-key</code> package to make it display the hints on a single column with a single description occupying up to 40 characters of such column:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 53: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> which-key
  (<span class="org-keyword">setq</span> which-key-allow-multiple-replacements t)
  (<span class="org-keyword">setq</span> which-key-min-display-lines 10)
  (<span class="org-keyword">setq</span> which-key-max-display-columns 1)
  (<span class="org-keyword">setq</span> which-key-add-column-padding 2)
  (<span class="org-keyword">setq</span> which-key-max-description-length 40))
</pre>
</div>
</div>
</div>

<div id="outline-container-org835face" class="outline-3">
<h3 id="org835face"><span class="section-number-3">2.10</span> Useful line numbers</h3>
<div class="outline-text-3" id="text-2-10">
<p>
A long time ago, I read on some Vim mailing list, an opinion on how line numbers should behave on different editing modes (if you know who is the original author of such idea, please let me know, so I can give credit where credit is due). Since on normal mode is pretty useful to know the line count from the cursor until some target text, it makes more sense to have the <code>relative number</code> shown on the gutter, but when I'm editing the buffer, is nice to have a sense of size by looking to the line numbers.
</p>

<p>
So, I can describe this behavior as follows:
</p>

<ul class="org-ul">
<li>When on normal mode, show relative line numbers;</li>
<li>When on insert mode, show absolute line numbers;</li>
</ul>

<p>
To achieve this, I need a function that turns the <i>absolute</i> line number when line numbers are visible:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 54: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-line-number-absolute-h</span> ()
  <span class="org-doc">"If line numbers are visible, set the current line number type to `</span><span class="org-doc"><span class="org-constant">absolute.</span></span><span class="org-doc">'"</span>
  (<span class="org-keyword">if</span> display-line-numbers
      (<span class="org-keyword">setq</span> display-line-numbers t)))
</pre>
</div>

<p>
And another function to put the line numbers on <i>relative mode</i> (but again, only if line numbers are visible):
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 55: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-line-number-visual-h</span> ()
  <span class="org-doc">"If line numbers are visible, set the current line number type to `</span><span class="org-doc"><span class="org-constant">visual</span></span><span class="org-doc">'"</span>
  (<span class="org-keyword">if</span> display-line-numbers
      (<span class="org-keyword">setq</span> display-line-numbers 'visual)))
</pre>
</div>

<p>
With those functions created, after loading Evil, I can hook them to a mode switch:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 56: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> evil
  (<span class="org-keyword">add-hook!</span> '(evil-emacs-state-entry-hook
               evil-insert-state-entry-hook) <span class="org-warning">'my-line-number-absolute-h)</span>
  (<span class="org-keyword">add-hook!</span> '(evil-emacs-state-exit-hook
               evil-insert-state-exit-hook) <span class="org-warning">'my-line-number-visual-h))</span>
</pre>
</div>

<p>
To finalize, I want to make line numbers visible on any programming mode:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 57: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> evil
  (<span class="org-keyword">setq-hook!</span> 'prog-mode-hook display-line-numbers-type 'visual))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7215074" class="outline-3">
<h3 id="org7215074"><span class="section-number-3">2.11</span> Auto-Saving</h3>
<div class="outline-text-3" id="text-2-11">
<p>
First of all, since I'm going to save my work constantly, I don't want Emacs to ask me if it should really exit, or if it should kill outstanding processes while doing it. For me, if I'm telling Emacs to quit, I want it to do it, regardless its state, but I don't want to lose any content of my current work. So, the first thing I'm going to do, is to disable questions when I'm quitting Emacs:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 58: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> confirm-kill-emacs nil
      confirm-kill-processes nil)
</pre>
</div>

<p>
Emacs allows you to define some <i>advices</i> to any function you want. This allows you to hook some code when the user, or the system calls such functions. On the case of aggressive auto-save, I want Emacs to save any content when I try to close the buffer associated with the content, of if I'm trying to quit Emacs. To do so, I'll create an <i>autoload</i> advice to perform such work:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 59: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-save-all-buffers-a (<span class="org-type">&amp;rest</span> _)
  <span class="org-doc">"Advice to run `</span><span class="org-doc"><span class="org-constant">save-some-buffers</span></span><span class="org-doc">' before a function.</span>

<span class="org-doc">This is a part of the full auto-save feature."</span>
  <span class="org-builtin">:before</span> (list #'save-buffers-kill-emacs #'my-tabs-close-buffer-tab)
  (save-some-buffers t nil))
</pre>
</div>

<p>
And to wrap up this configuration, I enable the auto-save mode:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 60: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(auto-save-visited-mode 1)
</pre>
</div>

<p>
Call the same advice as a normal function when Emacs executes the auto-save hook:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 61: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">add-hook!</span> 'auto-save-hook #'my-save-all-buffers-a)
</pre>
</div>

<p>
And add the advice function to the <code>after-focus-change-function</code> as well, just to make sure Emacs save any outstanding buffer as soon as possible if it loses focus:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 62: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">add-function</span> <span class="org-builtin">:after</span> after-focus-change-function #'my-save-all-buffers-a)
</pre>
</div>

<p>
This aggressive auto-save will work as expected, but it will crate a side effect with my literate configuration. Since Doom tangles the Org file every time we save it, the aggressive auto-save will make this tangle happen more often than we want.
</p>

<p>
Doom documentation offers a partial solution to this problem asking us to remove the auto-tangle function from the save hook, so let's do it:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 63: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(remove-hook 'org-mode-hook #'+literate-enable-recompile-h)
</pre>
</div>

<p>
Another core behavior that does not play well with my aggressive auto-save configuration is how Doom configures <code>ws-butler</code>. While I understand the rationale behind the choice of always remove blank spaces regardless the cursor position, I rather the plugin to not remove blank spaces before the cursor.
</p>

<p>
To adjust that, let's make <code>ws-butler</code> behave how I expect it:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 64: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> ws-butler
  (<span class="org-keyword">setq</span> ws-butler-keep-whitespace-before-point t))
</pre>
</div>
</div>
</div>

<div id="outline-container-org4c216a9" class="outline-3">
<h3 id="org4c216a9"><span class="section-number-3">2.12</span> Persist frame position and geometry</h3>
<div class="outline-text-3" id="text-2-12">
<p>
Before I start tackling my own requirement, let's make Emacs <i>remember</i> its window size and position between launches.
</p>

<p>
First, I like to define an autoloaded function to hook into the Emacs kill process to save frame dimensions. The reason to get an autoload function, is to allow Emacs to <b>not</b> load it until it really needs it, which would be when I'm quitting Emacs.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 65: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-save-frame-dimensions-h</span> ()
  <span class="org-doc">"Caches the current frame dimensions and position."</span>
  (<span class="org-keyword">if-let</span> ((main-frame (car-safe (visible-frame-list))))
      (doom-store-put 'last-frame-size
                      (list (frame-position main-frame)
                            (frame-width main-frame)
                            (frame-height main-frame)
                            (frame-parameter main-frame 'fullscreen)))))
</pre>
</div>

<p>
Then, I like to have the analog function to call when we create a frame:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 66: </span>$DOOMDIR/autoload/editor.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-restore-frame-dimensions-h</span> ()
  <span class="org-doc">"Restore frame dimensions and position from `</span><span class="org-doc"><span class="org-constant">my-save-frame-dimensions-h</span></span><span class="org-doc">'."</span>
  (<span class="org-keyword">if-let</span> (dims (doom-store-get 'last-frame-size <span class="org-string">"default"</span>))
      (<span class="org-keyword">cl-destructuring-bind</span> ((left . top) width height fullscreen) dims
        (<span class="org-keyword">setq</span> initial-frame-alist
              (append initial-frame-alist
                      `((left . ,left)
                        (top . ,top)
                        (width . ,width)
                        (height . ,height)
                        (fullscreen . ,fullscreen)))))
    (add-to-list 'default-frame-alist '(height . 40))
    (add-to-list 'default-frame-alist '(width . 140))))
</pre>
</div>

<p>
With the function defined, I just need to connect them to the correct hooks:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 67: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(add-hook 'kill-emacs-hook #'my-save-frame-dimensions-h)
(my-restore-frame-dimensions-h)
</pre>
</div>
</div>
</div>

<div id="outline-container-orga938a69" class="outline-3">
<h3 id="orga938a69"><span class="section-number-3">2.13</span> <span class="todo TODO">TODO</span> Remote editing</h3>
<div class="outline-text-3" id="text-2-13">
<p>
TBD (still need to figure out the best way to address this).
</p>
</div>
</div>
</div>

<div id="outline-container-org92c72e6" class="outline-2">
<h2 id="org92c72e6"><span class="section-number-2">3</span> Personal preferences</h2>
<div class="outline-text-2" id="text-3">
<p>
This section will show the reader, some of the small changes I decided to implement on Doom related to Evil, my personal keybindings, my choice of appearance, and other personal configurations. All in all, is pretty safe to skip this section if you intend to implement your own customization.
</p>
</div>

<div id="outline-container-org129c5bc" class="outline-3">
<h3 id="org129c5bc"><span class="section-number-3">3.1</span> Evil</h3>
<div class="outline-text-3" id="text-3-1">
<p>
For most of it, Doom integration of Evil is pretty amazing, I found just one package I don't use (or don't want to use at all), two configurations that I want to do some adjustments, and three packages missing.
</p>

<p>
The package I don't use is <code>evil-escape</code>, and its purpose, is to allow one to type <code>j k</code> fast enough on insert mode to force moving from insert mode to normal mode.
</p>

<p>
If you're used to this feature, good for you, but I was never able to adjust my muscle memory to it, so I rather disable it on <code>packages.el</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 68: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> evil-escape <span class="org-builtin">:disable</span> t)
</pre>
</div>

<p>
The first Evil configuration I want to adjust to my liking is on <code>evil-goggles</code>. I understand Henrik (Doom's creator) has a good rational on why he set up <code>evil-goggles</code> the way it is, but I like the original design where <b>all</b> changes get the highlight treatment.
</p>

<p>
Also, I use <code>evil-cleverparens</code>, and its editing operations are not configured on <code>evil-goggles</code>, so, in order to make it work for me, I have to do two things:
</p>

<ol class="org-ol">
<li>Re-enable the change feedback disabled by default on Doom;</li>
<li>Add all <code>evil-cleverparens</code> commands to the <code>evil-goggles--commands</code> to allow <code>evil-goggles</code> to handle changes from those commands as well.</li>
</ol>

<p>
I can perform those changes using <code>use-package</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 69: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> evil-goggles
  <span class="org-builtin">:hook</span> (doom-first-input . evil-goggles-mode)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setq</span> evil-goggles-duration 0.15
        evil-goggles-enable-delete t
        evil-goggles-enable-change t)

  (<span class="org-keyword">pushnew!</span> evil-goggles--commands
            '(evil-cp-delete
              <span class="org-builtin">:face</span> evil-goggles-delete-face
              <span class="org-builtin">:switch</span> evil-goggles-enable-delete
              <span class="org-builtin">:advice</span> evil-goggles--generic-blocking-advice)
            '(evil-cp-delete-line
              <span class="org-builtin">:face</span> evil-goggles-delete-face
              <span class="org-builtin">:switch</span> evil-goggles-enable-delete
              <span class="org-builtin">:advice</span> evil-goggles--delete-line-advice)
            '(evil-cp-delete-sexp
              <span class="org-builtin">:face</span> evil-goggles-delete-face
              <span class="org-builtin">:switch</span> evil-goggles-enable-delete
              <span class="org-builtin">:advice</span> evil-goggles--generic-blocking-advice)
            '(evil-cp-delete-enclosing
              <span class="org-builtin">:face</span> evil-goggles-delete-face
              <span class="org-builtin">:switch</span> evil-goggles-enable-delete
              <span class="org-builtin">:advice</span> evil-goggles--generic-blocking-advice)
            '(evil-cp-yank
              <span class="org-builtin">:face</span> evil-goggles-yank-face
              <span class="org-builtin">:switch</span> evil-goggles-enable-yank
              <span class="org-builtin">:advice</span> evil-goggles--generic-async-advice)
            '(evil-cp-yank-line
              <span class="org-builtin">:face</span> evil-goggles-yank-face
              <span class="org-builtin">:switch</span> evil-goggles-enable-yank
              <span class="org-builtin">:advice</span> evil-goggles--generic-async-advice)
            '(evil-cp-yank-sexp
              <span class="org-builtin">:face</span> evil-goggles-yank-face
              <span class="org-builtin">:switch</span> evil-goggles-enable-yank
              <span class="org-builtin">:advice</span> evil-goggles--generic-async-advice)
            '(evil-cp-yank-enclosing
              <span class="org-builtin">:face</span> evil-goggles-yank-face
              <span class="org-builtin">:switch</span> evil-goggles-enable-yank
              <span class="org-builtin">:advice</span> evil-goggles--generic-async-advice)
            '(evil-cp-change
              <span class="org-builtin">:face</span> evil-goggles-change-face
              <span class="org-builtin">:switch</span> evil-goggles-enable-change
              <span class="org-builtin">:advice</span> evil-goggles--generic-blocking-advice)
            '(evil-cp-change-line
              <span class="org-builtin">:face</span> evil-goggles-change-face
              <span class="org-builtin">:switch</span> evil-goggles-enable-change
              <span class="org-builtin">:advice</span> evil-goggles--generic-blocking-advice)
            '(evil-cp-change-sexp
              <span class="org-builtin">:face</span> evil-goggles-change-face
              <span class="org-builtin">:switch</span> evil-goggles-enable-change
              <span class="org-builtin">:advice</span> evil-goggles--generic-blocking-advice)
            '(evil-cp-change-enclosing
              <span class="org-builtin">:face</span> evil-goggles-change-face
              <span class="org-builtin">:switch</span> evil-goggles-enable-change
              <span class="org-builtin">:advice</span> evil-goggles--generic-blocking-advice)
            '(evil-paste-after
              <span class="org-builtin">:face</span> evil-goggles-paste-face
              <span class="org-builtin">:switch</span> evil-goggles-enable-paste
              <span class="org-builtin">:advice</span> evil-goggles--paste-advice
              <span class="org-builtin">:after</span> t)
            '(evil-cp-copy-paste-form
              <span class="org-builtin">:face</span> evil-goggles-paste-face
              <span class="org-builtin">:switch</span> evil-goggles-enable-paste
              <span class="org-builtin">:advice</span> evil-goggles--paste-advice
              <span class="org-builtin">:after</span> t)))
</pre>
</div>

<p>
After this I can sneak a quick modification to allow <code>evil-goggles</code> to use the same faces used on <code>diff</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 70: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> evil-goggles
  (evil-goggles-use-diff-refine-faces))
</pre>
</div>

<p>
The second configuration is regarding centralizing the cursor after search jumps. I find myself pretty uncomfortable after I press <code>n</code> following a search term, and I figured it out that what makes me uncomfortable is the fact the cursor is at the bottom of the screen, and I have almost no visibility of the text after it.
</p>

<p>
To fix this, I will add an advice after the Evil search function used to perform those jumps, to recenter the cursor on the window:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 71: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-center-after-jump-a (<span class="org-type">&amp;rest</span> _)
  <span class="org-builtin">:after</span> 'evil-ex-search
  (evil-scroll-line-to-center nil))
</pre>
</div>

<p>
And to make this behavior more consistent throughout the editor, I will add the same function used to advise <code>'evil-ex-search</code> as a hook to the <code>evil-jumps-post-jump-hook</code> hook:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 72: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> evil
  (add-hook 'evil-jumps-post-jump-hook #'my-center-after-jump-a))
</pre>
</div>

<p>
And finally, for the packages I'm missing, they are:
</p>

<ul class="org-ul">
<li><code>evil-matchit</code></li>
<li><code>plus-minus</code></li>
<li><code>evil-string-inflection</code></li>
</ul>
</div>

<div id="outline-container-org5edf9ce" class="outline-4">
<h4 id="org5edf9ce"><span class="section-number-4">3.1.1</span> Evil-MatchIt</h4>
<div class="outline-text-4" id="text-3-1-1">
<p>
In all fairness, <code>matchit</code> (the one originally from Vim) is also disabled by default, but it provides such useful feature that I can't understand why it is not part of the standard Vim/Evil.
</p>

<p>
To the reader not familiar with this plugin, let me give a brief overview of it. You probably know that pressing the key <code>%</code> on a pair of character (e.g. <code>(</code>, <code>)</code>, <code>[</code>, <code>]</code>, etc.), makes the cursor jump to the other pair.
</p>

<p>
The <code>matchit</code> plugin, extends this functionality to other types of pairs, like XML/HTML tags, language control flows like <code>if</code>, <code>else</code>, and <code>endif</code>, and others. So, as I said, a pretty useful plugin!
</p>

<p>
Since <a href="https://github.com/redguardtoo/evil-matchit"><code>evil-matchit</code></a> is not distributed with Doom, I need to bring its package in:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 73: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> evil-matchit)
</pre>
</div>

<p>
Then, need to make sure to enable the plugin itself. In order to not slow the Emacs startup, I will enable it after I load the first file into a buffer:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 74: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> evil-matchit
  <span class="org-builtin">:hook</span> (doom-first-file . global-evil-matchit-mode)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> evilmi-quote-chars (string-to-list <span class="org-string">"'\"/"</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org833d567" class="outline-4">
<h4 id="org833d567"><span class="section-number-4">3.1.2</span> Plus-Minus</h4>
<div class="outline-text-4" id="text-3-1-2">
<p>
<a href="https://github.com/peterwu/plus-minus"><code>plus-minus</code></a> is a package that provides the functionality to increase or decrease a number value at point. On Vim, the key bindings for these actions are <code>C-a</code> and <code>C-x</code> respectively.
</p>

<p>
I spend too much time thinking that I should preserve the <code>C-x</code> keybinding for Emacs' sake, and I learn to use a command or two that uses it, but the reality is that I don't really need it, so I will give it a try on rebinding this key to its original Vim purpose, but instead of using <code>evil-numbers</code> (which Doom provides as a core package), I'll try a brand-new package called <code>plus-minus</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 75: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> evil-numbers <span class="org-builtin">:disable</span> t)

(<span class="org-keyword">package!</span> plus-minus
  <span class="org-builtin">:recipe</span> (<span class="org-builtin">:host</span> github
           <span class="org-builtin">:repo</span> <span class="org-string">"peterwu/plus-minus"</span>))
</pre>
</div>

<p>
Since this package provides the correct <code>autoloads</code> on it, I can simply configure it to get deferred until I actually need it:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 76: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> plus-minus <span class="org-builtin">:defer</span> t)
</pre>
</div>

<p>
Before defining the keybindings for this I would like to have an extra behavior when I try to increase or decrease a number at point. I would like to rotate the text at point with the same keybinding if the <i>thing at point</i> is not a number.
</p>

<p>
Doom ships with the <code>rotate-text</code> package by default, but I need couple helper functions to define which package should handle the key press:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 77: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-inc-or-rotate-at-point</span> (arg)
  <span class="org-doc">"Try to rotate or increase the text at point.</span>

<span class="org-doc">If the thing under cursor is not rotated, tries to increase the number at</span>
<span class="org-doc">`</span><span class="org-doc"><span class="org-constant">point</span></span><span class="org-doc">' or the first number from `</span><span class="org-doc"><span class="org-constant">point</span></span><span class="org-doc">' to `</span><span class="org-doc"><span class="org-constant">point-at-eol</span></span><span class="org-doc">'.</span>

<span class="org-doc">When called with ARG (by using the universal prefix key) the search for a number</span>
<span class="org-doc">happens from `</span><span class="org-doc"><span class="org-constant">point</span></span><span class="org-doc">' to `</span><span class="org-doc"><span class="org-constant">point-at-bol</span></span><span class="org-doc">'."</span>
  (<span class="org-keyword">interactive</span> <span class="org-string">"p"</span>)
  (<span class="org-keyword">if</span> (thing-at-point 'number)
      (<span class="org-keyword">if</span> current-prefix-arg (+/-:backward+) (+/-:forward+))
    (<span class="org-keyword">condition-case</span> nil
        (rotate-text arg)
      ('error (<span class="org-keyword">if</span> current-prefix-arg (+/-:backward+) (+/-:forward+))))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 78: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-dec-or-rotate-at-point</span> (arg)
  <span class="org-doc">"Try to rotate or decrease the text at point.</span>

<span class="org-doc">If the thing under cursor is not rotated, tries to decrease the number at</span>
<span class="org-doc">`</span><span class="org-doc"><span class="org-constant">point</span></span><span class="org-doc">' or the first number from `</span><span class="org-doc"><span class="org-constant">point</span></span><span class="org-doc">' to `</span><span class="org-doc"><span class="org-constant">point-at-eol</span></span><span class="org-doc">'.</span>

<span class="org-doc">When called with ARG (by using the universal prefix key) the search for a number</span>
<span class="org-doc">happens from `</span><span class="org-doc"><span class="org-constant">point</span></span><span class="org-doc">' to `</span><span class="org-doc"><span class="org-constant">point-at-bol</span></span><span class="org-doc">'."</span>
  (<span class="org-keyword">interactive</span> <span class="org-string">"p"</span>)
  (<span class="org-keyword">if</span> (thing-at-point 'number)
      (<span class="org-keyword">if</span> current-prefix-arg (+/-:backward- 1) (+/-:forward- 1))
    (<span class="org-keyword">condition-case</span> nil
        (rotate-text arg)
      ('error (<span class="org-keyword">if</span> current-prefix-arg (+/-:backward- 1) (+/-:forward- 1))))))
</pre>
</div>

<p>
And I also like to define some extra words for rotation:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 79: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> rotate-text
  (add-to-list 'rotate-text-words '(<span class="org-string">"yes"</span> <span class="org-string">"no"</span>))
  (add-to-list 'rotate-text-words '(<span class="org-string">"allow"</span> <span class="org-string">"deny"</span>))
  (add-to-list 'rotate-text-words '(<span class="org-string">"allowed"</span> <span class="org-string">"denyed"</span>)))
</pre>
</div>

<p>
With all in place, we just need to define the keybindings:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 80: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map!
  <span class="org-builtin">:n</span> <span class="org-string">"C-a"</span> #'my-inc-or-rotate-at-point
  <span class="org-builtin">:n</span> <span class="org-string">"C-x"</span> #'my-dec-or-rotate-at-point
  (<span class="org-builtin">:prefix</span> <span class="org-string">"g"</span>
    <span class="org-builtin">:desc</span> <span class="org-string">"Inc sequence"</span> <span class="org-builtin">:v</span> <span class="org-string">"="</span> #'+/-:block+
    <span class="org-builtin">:desc</span> <span class="org-string">"Dec sequence"</span> <span class="org-builtin">:v</span> <span class="org-string">"-"</span> #'+/-:block-
    <span class="org-builtin">:desc</span> <span class="org-string">"Inc sequence"</span> <span class="org-builtin">:n</span> <span class="org-string">"="</span> #'my-inc-or-rotate-at-point
    <span class="org-builtin">:desc</span> <span class="org-string">"Dec sequence"</span> <span class="org-builtin">:v</span> <span class="org-string">"-"</span> #'my-dec-or-rotate-at-point)
  (<span class="org-builtin">:leader</span>
   <span class="org-builtin">:desc</span> <span class="org-string">"Emacs C-x"</span> <span class="org-builtin">:n</span> <span class="org-string">"C-x"</span> ctl-x-map))
</pre>
</div>

<p>
In order to allow me to repeat the last increase or decrease, I will define a <i>repeatable map</i> for my custom increase and decrease functions:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 81: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(my-repeat-map! my-inc-or-rotate-repeat-map
                '((my-inc-or-rotate-at-point . <span class="org-string">"="</span>)
                  (my-dec-or-rotate-at-point . <span class="org-string">"-"</span>))
                <span class="org-string">"Keymap to repeat the last number increase or decrease."</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org4aeecc0" class="outline-4">
<h4 id="org4aeecc0"><span class="section-number-4">3.1.3</span> Evil-String-Inflection</h4>
<div class="outline-text-4" id="text-3-1-3">
<p>
I've been on situations where I realized that I used <i>camelCase</i> for all my variables, where the standard coding style of the language, request to use <i>snake<sub>case</sub></i> style. There are packages available, that allow you to cycle through all case styles on a given word.
</p>

<p>
I found the <a href="https://github.com/akicho8/string-inflection"><code>string-inflection</code></a> package to be one of the best available. There is the package <a href="https://github.com/ninrod/evil-string-inflection"><code>evil-string-inflection</code> </a>to integrate with Evil, but it turns out to not work as expected, so I will have to configure Evil integration myself. Let's start with the package itself:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 82: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> string-inflection)
</pre>
</div>

<p>
As with the <code>matchit</code> package, I'll defer its loading until we need it, but different from <code>matchit</code>, I have to defer it using an alternative approach. I will make the package load on the first invocation of one of its main commands:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 83: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> string-inflection
  <span class="org-builtin">:commands</span> (string-inflection-all-cycle
             string-inflection-toggle
             string-inflection-camelcase
             string-inflection-lower-camelcase
             string-inflection-kebab-case
             string-inflection-underscore
             string-inflection-capital-underscore
             string-inflection-upcase))
</pre>
</div>

<p>
I want to have a rich set of mappings for this package, so I will add one key for each inflection plus a toggle and a cycle:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 84: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:leader</span> <span class="org-builtin">:prefix</span> (<span class="org-string">"g~"</span> . <span class="org-string">"string inflection"</span>)
      <span class="org-builtin">:desc</span> <span class="org-string">"cycle"</span> <span class="org-string">"~"</span> #'string-inflection-all-cycle
      <span class="org-builtin">:desc</span> <span class="org-string">"toggle"</span> <span class="org-string">"t"</span> #'string-inflection-toggle
      <span class="org-builtin">:desc</span> <span class="org-string">"CamelCase"</span> <span class="org-string">"c"</span> #'string-inflection-camelcase
      <span class="org-builtin">:desc</span> <span class="org-string">"downCase"</span> <span class="org-string">"d"</span> #'string-inflection-lower-camelcase
      <span class="org-builtin">:desc</span> <span class="org-string">"kebab-case"</span> <span class="org-string">"k"</span> #'string-inflection-kebab-case
      <span class="org-builtin">:desc</span> <span class="org-string">"under_score"</span> <span class="org-string">"_"</span> #'string-inflection-underscore
      <span class="org-builtin">:desc</span> <span class="org-string">"Upper_Score"</span> <span class="org-string">"u"</span> #'string-inflection-capital-underscore
      <span class="org-builtin">:desc</span> <span class="org-string">"UP_CASE"</span> <span class="org-string">"U"</span> #'string-inflection-upcase)
</pre>
</div>

<p>
In order to create a nicer workflow, I want to access the previous shortcuts by pressing the same key after the initial inflection. For instance, I want to press <code>SPC g ~</code> to start the inflection, and keep pressing just <code>~</code> to cycle through all the other inflections.
</p>

<p>
To achieve this behavior I will use the <code>my-repeat-map!</code> macro introduced on the section <a href="#orgffd8d47">2.2.10</a>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 85: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(my-repeat-map! my-string-inflection-repeat-map
                '((string-inflection-all-cycle . <span class="org-string">"~"</span>)
                  (string-inflection-toggle . <span class="org-string">"t"</span>)
                  (string-inflection-camelcase . <span class="org-string">"c"</span>)
                  (string-inflection-lower-camelcase . <span class="org-string">"d"</span>)
                  (string-inflection-kebab-case . <span class="org-string">"k"</span>)
                  (string-inflection-underscore . <span class="org-string">"_"</span>)
                  (string-inflection-capital-underscore . <span class="org-string">"u"</span>)
                  (string-inflection-upcase . <span class="org-string">"U"</span>))
                <span class="org-string">"Keymap to repease the last string inflection."</span>)
</pre>
</div>

<p>
To make <code>string-inflection</code> to work nice with Evil, I will create an <i>Evil operator</i> to allow me to change the string inflection of a target text object:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 86: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> evil
  (evil-define-operator my-evil-operator-string-inflection (beg end _type)
    <span class="org-string">"Define a new evil operator that cicles underscore -&gt; UPCASE -&gt; CamelCase."</span>
    <span class="org-builtin">:move-point</span> nil
    (<span class="org-keyword">interactive</span> <span class="org-string">"&lt;R&gt;"</span>)
    (string-inflection-all-cycle)
    (<span class="org-keyword">setq</span> evil-repeat-info (list [?g ?~])))

  (define-key evil-normal-state-map (kbd <span class="org-string">"g~"</span>) 'my-evil-operator-string-inflection))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfe982a0" class="outline-3">
<h3 id="orgfe982a0"><span class="section-number-3">3.2</span> Keybindings</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Since I decided to write this configuration, I also decided to try to use the standard Doom key bindings as much as possible, and for the most part of it, I'm not having as much problem as I expected. There are three main areas where I still like to define my own bindings.
</p>
</div>

<div id="outline-container-org7810124" class="outline-4">
<h4 id="org7810124"><span class="section-number-4">3.2.1</span> Window navigation</h4>
<div class="outline-text-4" id="text-3-2-1">
<p>
A while ago, I configured Vim to move the cursor from one window to another using the standard movements keys (<code>h</code>, <code>j</code>, <code>k</code>, and <code>l</code>) while keeping <code>Ctrl</code> pressed. I got so used to these shortcuts, that I can't live without it anymore.
</p>

<p>
The good news is that, on most cases, there is no conflict between features I use and these shortcuts, and on the cases that a conflict exists, there are reasonable options to work around these limitations.
</p>

<p>
The first step to achieve a global window navigation shortcuts, is to clean the target keys from any keymap that might bind them to a command:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 87: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map!
 (<span class="org-builtin">:after</span> outline
  (<span class="org-builtin">:map</span> outline-mode-map
   <span class="org-builtin">:gn</span> <span class="org-string">"C-h"</span> nil
   <span class="org-builtin">:gn</span> <span class="org-string">"C-j"</span> nil
   <span class="org-builtin">:gn</span> <span class="org-string">"C-k"</span> nil
   <span class="org-builtin">:gn</span> <span class="org-string">"C-l"</span> nil)))
</pre>
</div>

<p>
After that, I can bind these keys to the target window movements to the proper window commands:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 88: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map!
  <span class="org-builtin">:gn</span> <span class="org-string">"C-h"</span> #'evil-window-left
  <span class="org-builtin">:gn</span> <span class="org-string">"C-j"</span> #'evil-window-down
  <span class="org-builtin">:gn</span> <span class="org-string">"C-k"</span> #'evil-window-up
  <span class="org-builtin">:gn</span> <span class="org-string">"C-l"</span> #'evil-window-right)
</pre>
</div>

<p>
Some other modes don't play nice with this particular key bindings I choose, and I have to adjust them accordingly. This is the case of the <code>Info-mode</code>, where <code>C-j</code> and <code>C-k</code> are the keys to navigate forward and backwards on nodes. The solution for me is to bind those commands to other keys, and configure the proper window navigation:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 89: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:after</span> info
      <span class="org-builtin">:map</span> Info-mode-map
      <span class="org-builtin">:gn</span> <span class="org-string">"s-k"</span> #'Info-backward-node
      <span class="org-builtin">:gn</span> <span class="org-string">"s-j"</span> #'Info-forward-node
      <span class="org-builtin">:gn</span> <span class="org-string">"C-k"</span> #'evil-window-up
      <span class="org-builtin">:gn</span> <span class="org-string">"C-j"</span> #'evil-window-down)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb1a8bf3" class="outline-4">
<h4 id="orgb1a8bf3"><span class="section-number-4">3.2.2</span> Vim defaults</h4>
<div class="outline-text-4" id="text-3-2-2">
<p>
Here I need to make yet another disclaimer to the reader: I know what I'm about to write is a pet peeve, and most likely most Doom users won't even understand this, but&#x2026;
</p>

<p>
On Doom, there are these keymaps bound to <code>&lt;leader&gt; w ...</code>, that should match Vim's <code>&lt;C-w&gt; &lt;C-...&gt;</code>. Since the <i>leader shortcuts</i> are more ergonomic for me, I got used to them quickly. The problem I have, is the difference between <code>&lt;C-w&gt; &lt;C-o&gt;</code> and <code>&lt;leader&gt; w o</code>!
</p>

<p>
To not lose a Doom-only keymap, instead of simply rebinding <code>&lt;leader&gt; w o</code> to the <i>correct</i> command, I'll <i>move</i> <code>doom/window-enlargen</code> to a different keymap (<code>&lt;leader&gt; w z</code> to represent <i>zoom window</i>), and assign the <i>correct</i> command to the <i>correct</i> keymap:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 90: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:leader</span> <span class="org-builtin">:prefix</span> (<span class="org-string">"w"</span> . <span class="org-string">"window"</span>)
      <span class="org-builtin">:desc</span> <span class="org-string">"Enlarge window"</span>         <span class="org-builtin">:n</span> <span class="org-string">"z"</span> #'doom/window-enlargen
      <span class="org-builtin">:desc</span> <span class="org-string">"Select window"</span>          <span class="org-builtin">:n</span> <span class="org-string">"o"</span> #'delete-other-windows)
</pre>
</div>
</div>
</div>

<div id="outline-container-org37b2fce" class="outline-4">
<h4 id="org37b2fce"><span class="section-number-4">3.2.3</span> Personal shortcuts</h4>
<div class="outline-text-4" id="text-3-2-3">
<p>
Key bindings in this section are purely personal choice. Feel free to give them a try if you want, but if you're used to Doom Emacs already, my suggestion is to skip this section.
</p>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
The first keymap group I like to add custom shortcuts is the multiple cursors. When I first heard about multiple cursors, was on a demo of the <a href="https://macromates.com/">TextMate</a> editor. I got so impressed by it that this feature was one of the first things I would search on an editor. Fast forwarding to January 2008, I was watching yet another demo of a brand-new editor, when the person showing off the features, demonstrated the multiple cursors. This editor was <a href="https://www.sublimetext.com">Sublime Text</a>, and I couldn't resist the chance to give it a try. For reasons of the brain (at least my brain), the shortcuts defined to manipulate multiple cursors got engraved in my memory, and recently, I decide to stop fighting against it and embrace! So these are the shortcuts (which might be different from the current shortcuts in Sublime) that I got <i>used to</i>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 91: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map!
 <span class="org-builtin">:gn</span> <span class="org-string">"s-d"</span> #'evil-mc-make-and-goto-next-match
 <span class="org-builtin">:gn</span> <span class="org-string">"s-u"</span> #'evil-mc-skip-and-goto-prev-cursor
 <span class="org-builtin">:gn</span> <span class="org-string">"s-n"</span> #'evil-mc-skip-and-goto-next-match
 <span class="org-builtin">:gn</span> <span class="org-string">"s-g"</span> #'evil-mc-make-all-cursors
 <span class="org-builtin">:gn</span> <span class="org-string">"C-M-k"</span> #'evil-mc-make-cursor-move-prev-line
 <span class="org-builtin">:gn</span> <span class="org-string">"C-M-j"</span> #'evil-mc-make-cursor-move-next-line)
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
Another <i>nice to have</i> binding I got used to, is to move blocks of text up and down, using <code>j</code> and <code>k</code>, plus the <code>Meta</code> (a.k.a. <code>Alt</code>, <code>option</code>, or  <code>⌥</code>):
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 92: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:nvi</span> <span class="org-string">"M-j"</span> #'drag-stuff-down
      <span class="org-builtin">:nvi</span> <span class="org-string">"M-k"</span> #'drag-stuff-up)
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
Something that I really like but usually forget to use is the ability to insert a new line while on <i>insert mode</i>, above or bellow the current line, regardless where the cursor is. To use it, I would simply press <code>&lt;ENTER&gt;</code> with <code>&lt;SUPER&gt;</code> (a.k.a. <code>cmd</code> or <code>⌘</code>) to insert a line bellow, or <code>&lt;ENTER&gt;</code> plus <code>&lt;SHIFT&gt;</code> and <code>&lt;SUPER&gt;</code> for a line above:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 93: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:i</span> [s-return]   #'+default/newline-below
      <span class="org-builtin">:i</span> [s-S-return] #'+default/newline-above
      (<span class="org-builtin">:when</span> IS-MAC
         <span class="org-builtin">:gn</span> <span class="org-string">"s-RET"</span>        nil
         <span class="org-builtin">:gn</span> [s-return]     nil
         <span class="org-builtin">:gn</span> <span class="org-string">"S-s-RET"</span>      nil
         <span class="org-builtin">:gn</span> [S-s-return]   nil))
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
Doom Emacs, offer a shortcut to bring back the last dismissed popup, which is what I want to do on the majority of the cases. But sometimes, I want to bring back a specific popup buffer to the front, and I like to have a dedicated prefix key to handle this scenario.
</p>

<p>
For now, I set a shortcut for the <code>*Messages*</code>, and the <code>*Backtrace*</code> buffers, but more popup buffer might get added here in the future:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 94: </span>config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:leader</span> <span class="org-builtin">:prefix</span> (<span class="org-string">"v"</span> . <span class="org-string">"view"</span>)
      <span class="org-builtin">:desc</span> <span class="org-string">"View Messages"</span> <span class="org-builtin">:n</span> <span class="org-string">"m"</span> #'(lambda ()
                                       (<span class="org-keyword">interactive</span>)
                                       (pop-to-buffer <span class="org-string">"*Messages*"</span>)
                                        (goto-char (point-max)))
      <span class="org-builtin">:desc</span> <span class="org-string">"View Backtrace"</span> <span class="org-builtin">:n</span> <span class="org-string">"e"</span> #'(lambda ()
                                        (<span class="org-keyword">interactive</span>)
                                        (pop-to-buffer <span class="org-string">"*Backtrace*"</span>)))
</pre>
</div>

<p>
As you can see, I also like to <i>scroll to the bottom</i> of the buffer when opening messages. The rationale behind it is the fact that if I want to quick loo into the <code>*Messages*</code> buffer, is most likely to check the latest messages there.
</p>

<p>
Also, for the <code>*Messages*</code> buffer, I like to be able to press <code>q</code> to quit as well. Unfortunately this is not defined by default:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 95: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:map</span> messages-buffer-mode-map
      <span class="org-builtin">:n</span> <span class="org-string">"q"</span> #'delete-window)
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
One binding I feel is missing on Doom, is the ability to evaluate any sexp on <b>any</b> mode, like a <i>global</i> <code>eval-last-sexp</code>. Gladly, it's easy enough to create my own:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 96: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:prefix</span> <span class="org-string">"g"</span>
      <span class="org-builtin">:desc</span> <span class="org-string">"Eval last sexp"</span> <span class="org-builtin">:n</span> <span class="org-string">")"</span> #'eval-last-sexp)
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
I don't remember when this shortcut entered my life, but some time ago I got used to using <code>s-RET</code> to <i>confirm operations</i> like sending emails and messages. In order to try to replicate this behavior I will start setting it to the <code>with-editor-mode-map</code> together with the analog cancel operation with <code>s-ESC</code> shortcut:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 97: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:map</span> with-editor-mode-map
      <span class="org-builtin">:in</span> [s-return] #'with-editor-finish
      <span class="org-builtin">:in</span> [s-escape] #'with-editor-cancel)
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
Doom ships with the <i>Rainbow Mode</i> package, which is a package that colorizes strings that represent colors. Usually there is no need to enable this mode globally because the colorization might get in the way of legibility, but on the cases where it is useful (e.g. editing CSS or Android XML files), it is <b>really</b> useful.
</p>

<p>
Because of this, I want to set this mode as a toggable shortcut:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 98: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:leader</span> <span class="org-builtin">:prefix</span> (<span class="org-string">"t"</span> . <span class="org-string">"toggle"</span>)
      <span class="org-builtin">:desc</span> <span class="org-string">"Rainbow mode"</span> <span class="org-builtin">:mvn</span> <span class="org-string">"R"</span> #'rainbow-mode)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd319b86" class="outline-4">
<h4 id="orgd319b86"><span class="section-number-4">3.2.4</span> Repeatable shortcuts</h4>
<div class="outline-text-4" id="text-3-2-4">
<p>
Due to the nature of modal edit, some shortcuts need more than one key press to activate. This is usually fine until we try an action designed to repeat (e.g. side scroll and window resizing). This section will use the <code>my-repeat-map!</code> macro defined on the <a href="#orgffd8d47">2.2.10</a> sections to make these actions more ergonomic.
</p>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
The first candidate for a repeatable pattern is window resizing. On Vim (and also Evil) for instance, the key binding to increase height is <code>C-w +</code>. Doom makes this a little bit better by making all key bindings from <code>C-w</code> accessible with the prefix <code>SPC w</code>, but still, adjusting the size of a window with multiple keystrokes like this, is a bad experience.
</p>

<p>
We can make the window resizing commands safe to repeat, which would allow us to repeat the last resizing with the <code>.</code> repeat operator. The problem with this approach, is the fact that we can <i>change directions</i> when repeating the resize. For instance, if we are increasing the height of a window, and we press the <code>.</code> couple more times we wanted, to decrease its size, we would have to start over with the decrease command and pay attention to not get it wrong this time.
</p>

<p>
To avoid this issue, I will define a <i>repeatable map</i> for resizing, and because this is a separate map from the normal window map, I can add couple extra keys there to make the operation even smoother, for instance, we can increase the window height with <code>+</code> or with the <code>=</code> key
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 99: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(my-repeat-map! my-window-resize-repeat-map
                '((evil-window-increase-height . <span class="org-string">"+"</span>)
                  (evil-window-increase-height . <span class="org-string">"="</span>)
                  (evil-window-decrease-height . <span class="org-string">"-"</span>)
                  (evil-window-decrease-height . <span class="org-string">"_"</span>)
                  (evil-window-increase-width . <span class="org-string">"&gt;"</span>)
                  (evil-window-decrease-width . <span class="org-string">"&lt;"</span>))
                <span class="org-string">"Repeatable map for window resizing"</span>)
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
Sometimes you're editing a buffer on a window that requires you to scroll to the right and left to read its content. You can achieve that by pressing <code>z l</code> to scroll to the right, and <code>z h</code> to scroll to the left. While this is ok, besides enabling to repeat this motion with just an <code>l</code> or an <code>h</code> after the initial scroll, I also want to jump longer distances (the default is to move one character on each <code>z l</code> or <code>z h</code> shortcuts). To jump more than one character, I need to create a wrapper function that passes a bigger number to the <code>evil-scroll-column-right</code> or <code>evil-scroll-column-left</code> functions:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 100: </span>autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-big-scroll-column-right</span> ()
  <span class="org-doc">"Wrapper for the `</span><span class="org-doc"><span class="org-constant">evil-scroll-column-right</span></span><span class="org-doc">' that passes 10 as the jump size."</span>
  (<span class="org-keyword">interactive</span>)
  (evil-scroll-column-right 10))

<span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-big-scroll-column-left</span> ()
  <span class="org-doc">"Wrapper for the `</span><span class="org-doc"><span class="org-constant">evil-scroll-column-left</span></span><span class="org-doc">' that passes 10 as the jump size."</span>
  (<span class="org-keyword">interactive</span>)
  (evil-scroll-column-left 10))
</pre>
</div>

<p>
And with those helper functions I can define the proper <i>repeatable map</i> for side scrolling:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 101: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(my-repeat-map! my-side-scrolling-repeat-map
                '((evil-scroll-column-right . <span class="org-string">"l"</span>)
                  (my-big-scroll-column-right . <span class="org-string">"L"</span>)
                  (evil-scroll-column-left . <span class="org-string">"h"</span>)
                  (my-big-scroll-column-left . <span class="org-string">"H"</span>))
                <span class="org-string">"Repeatable map to scroll the buffer left or right."</span>)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc5db7d9" class="outline-3">
<h3 id="orgc5db7d9"><span class="section-number-3">3.3</span> Appearances</h3>
<div class="outline-text-3" id="text-3-3">
<p>
As far as I understand, there is a share of Emacs users that value Emacs functionalities over its looks, and I would like to write something targeted for those users.
</p>

<p>
You are awesome! I can't imagine how liberating it would feel if my brain did not obsess about my editor's appearance, so, stay strong folks! The breakthroughs on technology happen more often by the desire of people like you then people like me.
</p>

<p>
With that out of the way, I need to explain to the reader my personal position on this subject. As a person with <a href="https://en.wikipedia.org/wiki/Attention_deficit_hyperactivity_disorder">ADHD</a> and <a href="https://en.wikipedia.org/wiki/Obsessive%E2%80%93compulsive_disorder">OCD</a>.
</p>

<p>
Looks mater. There is not much else to say, but if you need a bit more let me say this: When your brain is constantly searching for dopamine, and is incapable to retain it for much longer, every tinny rewarding counts towards the goal to keep my focus on one subject. If my work environment is pleasing to look, there is a lower chance my brain gets distracted by the scene outside the window. If I open my editor and get the feeling of <i>"oh yeah"</i>, then my brain will look forward to using the same tool again, or as I saw on this <a href="https://twitter.com/ADHDelaide/status/1326412306079682560">tweet</a> a while ago, and reproduce it here for you:
</p>

<blockquote>
<p>
❝ Having <b>ADHD</b> is basically finding new ways to trick your brain into doing the stuff you want it to do, until you die. ❞
─ <b>@ADHDelaide</b>
</p>
</blockquote>

<p>
Nevertheless, keep in mind that taste, is a personal thing. What I consider to be beautiful, might look horrendous to the reader, and that is OK.
</p>

<p>
So, if you're happy with the look and feel of your editor, feel free to skip this entire section.
</p>
</div>

<div id="outline-container-org6fba8e6" class="outline-4">
<h4 id="org6fba8e6"><span class="section-number-4">3.3.1</span> Frame</h4>
<div class="outline-text-4" id="text-3-3-1">
<p>
The Emacs frame is the container for my small world, and although I intend to do most of my things within Emacs, I still want it to look like it belongs to its environment (macOS in my case), and there are couple things I like to change to make it more macOS.
</p>

<p>
The first one is to remove the text from the title bar. On macOS, the application name is present on the system menu, so there is no reason to keep any text on the title bar:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 102: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> frame-title-format nil
      ns-use-proxy-icon nil)
</pre>
</div>

<p>
And the second one, is to make the title bar to have the same color as the background of my selected theme:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 103: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(add-to-list 'default-frame-alist '(ns-transparent-titlebar . t))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeb21616" class="outline-4">
<h4 id="orgeb21616"><span class="section-number-4">3.3.2</span> Editor</h4>
<div class="outline-text-4" id="text-3-3-2">
<p>
The first thing to do to help with my editor appearance, is to store the current line height in a variable. This way, other adjustments can use this value without worrying about different font sizes:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 104: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">my-line-pixel-height</span> (line-pixel-height)
  <span class="org-doc">"Line height in pixels.</span>

<span class="org-doc">Used to avoid getting the wrong line height when `</span><span class="org-doc"><span class="org-constant">text-scale-mode</span></span><span class="org-doc">' is active."</span>)
</pre>
</div>

<p>
One editor visual I like to have while I'm coding, is the <code>fill-column-indicator</code>. Unfortunately I discovered that on macOS, the default <code>fill-column-indicator</code> face, can't render Unicode characters properly. The workaround here is to make this particular face to use a font that can render them:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 105: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(set-face-attribute 'fill-column-indicator nil
                    <span class="org-builtin">:font</span> <span class="org-string">"Arial Unicode MS"</span>
                    <span class="org-builtin">:height</span> 140
                    <span class="org-builtin">:foreground</span> (doom-color 'base3 256))
</pre>
</div>

<p>
Using <i>Arial Unicode MS</i> allow me to use the "<code>┊</code>" character to decorate my <code>prog-mode</code> buffers. After setting this up, I need to adjust the <code>fill-column</code> value to the column I want (while is usually 100), and make the column indicator use the correct Unicode character (which is <code>0x9482</code>):
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 106: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq-default</span> fill-column 100
              display-fill-column-indicator-column 100
              display-fill-column-indicator-character 9482)
</pre>
</div>

<p>
After this configuration I want to make sure the column indicator is off by default:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 107: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(global-hl-line-mode -1)
</pre>
</div>

<p>
And enabled on all <code>prog-mode</code> buffers:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 108: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(add-hook 'prog-mode-hook 'display-fill-column-indicator-mode)
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
As with column indicator, there is another visual that I consider crucial for programming, but a bit annoying when writing prose: The current line highlight.
</p>

<p>
I can't imagine coding without it, but when I'm writing, it becomes more a distraction then an aid.
</p>

<p>
On Doom, to make sure current line highlight gets disabled, you need to remove its global mode from the <code>doom-first-buffer-hook</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 109: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(remove-hook 'doom-first-buffer-hook 'global-hl-line-mode)
</pre>
</div>

<p>
Then, I can add the mode to all <code>prog-mode</code> buffers with another hook:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 110: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(add-hook 'prog-mode-hook 'hl-line-mode)
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
Another extra for the editor visuals is rendering the character <code>^L</code>, which represents a page break (more precisely, the <i>form feed</i> character).
</p>

<p>
The page break character is considered a <i>space</i> or <i>empty</i> character, which allows one to add it on a coding file without breaking the build for such file.
</p>

<p>
There are a couple packages that achieve this goal, but I set on the <a href="https://github.com/purcell/page-break-lines"><code>page-break-lines</code></a> from <a href="https://github.com/purcell">Steve Purcell</a> because he chose to implement this feature using glyph composition instead of <i>font-lock</i>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 111: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> page-break-lines)
</pre>
</div>

<p>
There is just one configuration I prefer to change over the defaults, which is the size of the horizontal line. I like the horizontal like to stop at the <code>fill-column</code> column, which gives this nice <i>box feeling</i> to the code.
</p>

<p>
Besides this change, I only enable the mode on <code>prog-mode</code> buffers, and I like to define a shortcut key to jump to the next or previous page break:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 112: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> page-break-lines
  <span class="org-builtin">:hook</span> ((prog-mode . page-break-lines-mode))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> page-break-lines-max-width fill-column)

  (map! <span class="org-builtin">:prefix</span> <span class="org-string">"g"</span>
        <span class="org-builtin">:desc</span> <span class="org-string">"Prev page break"</span> <span class="org-builtin">:nv</span> <span class="org-string">"["</span> #'backward-page
        <span class="org-builtin">:desc</span> <span class="org-string">"Next page break"</span> <span class="org-builtin">:nv</span> <span class="org-string">"]"</span> #'forward-page))
</pre>
</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
Since the time when widescreen monitors became the standard, when it comes to split windows in two, I prefer horizontal splits (one window aside of the other). In order to tell Emacs that I prefer horizontal splits, I have to set the width split threshold to a small number to add weight on Emacs' decision of which orientation to split:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 113: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> split-width-threshold 40)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd189465" class="outline-4">
<h4 id="orgd189465"><span class="section-number-4">3.3.3</span> Theme</h4>
<div class="outline-text-4" id="text-3-3-3">
<p>
I believe this section to be the most volatile section on this text. Since I got interested on cool old esoteric editors, I'm on an endless search for the Holy Grail of themes. So far I got fond of Tomorrow Night and I use it for the most part of the last 5 years. Recently I got annoyed by some color choices of the theme (the background and line highlight are a bit odd in my opinion), so I kept looking.
</p>

<p>
I decided to give <i>Doom-One</i> a try, and so far I'm enjoying. I will admit that the purplish feeling of the palette is not my style, but overall, I'm not finding a bed choice.
</p>

<p>
So, to make <i>Doom-One</i> the default theme, set the variable <code>doom-theme</code> to the symbol <code>'doom-one</code> to let Doom know what is the theme it should load:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 114: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> doom-theme 'doom-one)
</pre>
</div>

<p>
And because I like visual cues on my editor, I will turn on the ability to display <b>bold</b> and <i>italic</i> faces for the theme:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 115: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> doom-themes-enable-bold t
      doom-themes-enable-italic t)
</pre>
</div>
</div>
</div>

<div id="outline-container-prefs-typography" class="outline-4">
<h4 id="prefs-typography"><span class="section-number-4">3.3.4</span> Typography</h4>
<div class="outline-text-4" id="text-prefs-typography">
<p>
This section requires an important disclaimer to the reader. In the majority of the cases, one should not <i>need</i> to customize their fonts the way I'm doing it. Doom Emacs has a system to configure the editor fonts, and one should prefer to use such systems instead of this particular configuration.
</p>

<p>
Doom exposes five (optional) variables for controlling fonts:
</p>

<dl class="org-dl">
<dt><code>doom-font</code></dt><dd>The global font used by Emacs;</dd>
<dt><code>doom-big-font</code></dt><dd>Used for <code>doom-big-font-mode</code>, which you can use for presentations or streaming;</dd>
<dt><code>doom-variable-pitch-font</code></dt><dd>Font used for prose text (if you configure such modes to accept variable pitch fonts);</dd>
<dt><code>doom-serif-font</code></dt><dd>The default font to use for the fixed-pitch-serif face;</dd>
<dt><code>doom-unicode-font</code></dt><dd>Fallback font for Unicode glyphs;</dd>
</dl>

<p>
They all accept either a font-spec, a font string (e.g. "Input Mono-12"), or a <code>xlfd</code> font string. You generally only need <code>doom-font</code> and <code>doom-variable-pitch-font</code>, but I like to set <code>doom-big-font</code> as well, to make sure any time I switch to a presentation mode, it still feels like I have the same editor, but with a bigger font.
</p>

<p>
With that out of the way, I need to explain what is, and why my <i>typography</i> configuration exists.
</p>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
In the past years, I've got involved in some projects where I worked directly with the UX team on visual identity tasks. One of the first thing I got used to doing, is to define the typography of the project. But what is typography? According to the Wikipedia:
</p>

<blockquote>
<p>
<b>Typography</b> is the art and technique of arranging type to make written language legible, readable and appealing when displayed.
</p>
</blockquote>

<p>
In the case of my configuration, I can define typography as a set of rules regarding displayed text that I want to use regardless the mode Emacs is in. Or simply put:
</p>

<p>
Text in my editor must be consistent, and look good.
</p>

<p>
To achieve this, I have to define said rules, and create a mechanism that will help me get the editor to behave the way I want. The one exception are the colors used on text elements. I want to let this particular trait to the theme I'm using.
</p>

<p>
The first rule to define is the simplest one: which fonts to use throughout the editor.
</p>

<p>
Currently, I narrowed my selection to these 3 fonts:
</p>

<dl class="org-dl">
<dt><a href="https://github.com/iaolo/iA-Fonts">iA Writer Mono</a></dt><dd>Used as my default monospaced font. The actual font I'm using is the <a href="https://www.nerdfonts.com/">Nerd Fonts</a> version, known as <i>"iMWritingMonoS Nerd Font"</i> due to its support for the <code>all-the-icons</code> package;</dd>
<dt><a href="https://github.com/iaolo/iA-Fonts">iA Writer Quattro</a></dt><dd>Used as my default font for prose writing. For this font in particular, I can't use the Nerd Fonts version, nor the version distributed through <a href="https://brew.sh/">Homebrew</a>. These versions, use the static version of the font that does not support different weights. For my configuration I use the <a href="https://github.com/iaolo/iA-Fonts/tree/master/iA%20Writer%20Quattro/Variable">Veriable</a> version of the font;</dd>
<dt><a href="https://github.com/googlefonts/roboto">Roboto</a></dt><dd>Used on UI elements like the project drawer, tab names, and tooltips;</dd>
</dl>

<p>
To install the <a href="https://github.com/iaolo/iA-Fonts">iA Writer Mono</a> and the <a href="https://github.com/googlefonts/roboto">Roboto</a>, one can use <a href="https://brew.sh/">Homebrew</a> on macOS:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 116: </span>Commands to install fonts with Homebrew</label><pre class="src src-shell">brew tap homebrew/cask-fonts
brew install --cask font-roboto font-im-writing-nerd-font
</pre>
</div>

<p>
But for the <a href="https://github.com/iaolo/iA-Fonts">iA Writer Quattro</a> you have to use to install it manually because the version offered by Homebrew is the static version of the font, which does not come with all the weights available. The correct font to install here is the <i>variable</i> type.
</p>

<p>
To install the correct font, first download it using <code>curl</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 117: </span>Commands to download the iA Writer font</label><pre class="src src-shell"><span class="org-builtin">cd</span> ~/Downloads &amp;&amp; {
 curl -O <span class="org-string">'https://github.com/iaolo/iA-Fonts/raw/master/iA%20Writer%20Quattro/Variable/iAWriterQuattroV.ttf'</span>
 curl -O <span class="org-string">'https://github.com/iaolo/iA-Fonts/raw/master/iA%20Writer%20Quattro/Variable/iAWriterQuattroV-Italic.ttf'</span>
 <span class="org-builtin">cd</span> -
}
</pre>
</div>

<p>
Then, run the following AppleScript to perform the installation:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 118: </span>Apple Script used to install iA Writer fonts</label><pre class="src src-shell">osascript &lt;&lt;<span class="org-string">'END'</span>
<span class="org-sh-heredoc">  set theDownloadsFolder to get path to Downloads folder</span>
<span class="org-sh-heredoc">  tell application "Finder"</span>
<span class="org-sh-heredoc">    set allFonts to every file of theDownloadsFolder whose name starts with "iAWriterQuattroV"</span>
<span class="org-sh-heredoc">  end tell</span>

<span class="org-sh-heredoc">  repeat with theFont in allFonts</span>
<span class="org-sh-heredoc">    tell application "Finder"</span>
<span class="org-sh-heredoc">        open theFont</span>
<span class="org-sh-heredoc">    end tell</span>

<span class="org-sh-heredoc">    tell application "Font Book"</span>
<span class="org-sh-heredoc">        activate</span>
<span class="org-sh-heredoc">        set theFontWindow to the first window</span>
<span class="org-sh-heredoc">    end tell</span>

<span class="org-sh-heredoc">    tell application "System Events"</span>
<span class="org-sh-heredoc">        tell process "Font Book"</span>
<span class="org-sh-heredoc">            tell window 1</span>
<span class="org-sh-heredoc">                tell group 1</span>
<span class="org-sh-heredoc">                    click button "Install Font"</span>
<span class="org-sh-heredoc">                end tell</span>
<span class="org-sh-heredoc">            end tell</span>
<span class="org-sh-heredoc">        end tell</span>
<span class="org-sh-heredoc">    end tell</span>
<span class="org-sh-heredoc">  end repeat</span>
<span class="org-sh-heredoc">END</span>
</pre>
</div>

<p>
The rest of the rules are more subjective, and in all honesty, the methodology I used to decide which slant, and weight to use to each one of the text elements is non-existent. I simply tried, checked how it looked, and asked myself, <i>"Is this a nice looking element?"</i>. If the answer was yes, I kept the configuration.
</p>

<p>
For the size, I started with the headline level 1 and configure it to be as big as it could be without looking disproportional to the text. Then, I reduced the size for the next level gradually until I get to the 8<sup>th</sup> one, guaranteeing that it would not be smaller than the normal font size.
</p>

<p>
In practice, this means:
</p>

<table id="org5c1a0f8">
<caption class="t-bottom"><span class="table-number">Table 2:</span> Headline sizes and multipliers</caption>

<colgroup>
<col  class="org-left">

<col  class="org-right">

<col  class="org-right">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Headline Level</th>
<th scope="col" class="org-right">Proportional size</th>
<th scope="col" class="org-right">Multiplier</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Level 1</td>
<td class="org-right">100%</td>
<td class="org-right">2.0</td>
</tr>

<tr>
<td class="org-left">Level 2</td>
<td class="org-right">80%</td>
<td class="org-right">1.8</td>
</tr>

<tr>
<td class="org-left">Level 3</td>
<td class="org-right">60%</td>
<td class="org-right">1.6</td>
</tr>

<tr>
<td class="org-left">Level 4</td>
<td class="org-right">40%</td>
<td class="org-right">1.4</td>
</tr>

<tr>
<td class="org-left">Level 5</td>
<td class="org-right">30%</td>
<td class="org-right">1.3</td>
</tr>

<tr>
<td class="org-left">Level 6</td>
<td class="org-right">20%</td>
<td class="org-right">1.2</td>
</tr>

<tr>
<td class="org-left">Level 7</td>
<td class="org-right">10%</td>
<td class="org-right">1.1</td>
</tr>

<tr>
<td class="org-left">Level 8</td>
<td class="org-right">0%</td>
<td class="org-right">1.0</td>
</tr>
</tbody>
</table>

<p>
To make my typography rules easy to refer to, I create one face for each rule as follows:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 119: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defface</span> <span class="org-variable-name">my-default-mono</span> `((t <span class="org-builtin">:font</span> ,(font-spec <span class="org-builtin">:family</span> <span class="org-string">"iMWritingMonoS Nerd Font"</span>
                                                <span class="org-builtin">:size</span> 16)))
  <span class="org-doc">"Default monospaced font used on majority of the buffers."</span>
  <span class="org-builtin">:group</span> 'my-typography)

(<span class="org-keyword">defface</span> <span class="org-variable-name">my-big-face-mono</span> `((t <span class="org-builtin">:font</span> ,(font-spec <span class="org-builtin">:family</span> <span class="org-string">"iMWritingMonoS Nerd Font"</span>
                                                 <span class="org-builtin">:size</span> 26)))
  <span class="org-doc">"Monospaced font used on presentation mode."</span>
  <span class="org-builtin">:group</span> 'my-typography)

(<span class="org-keyword">defface</span> <span class="org-variable-name">my-default-ui</span> `((t <span class="org-builtin">:font</span> ,(font-spec <span class="org-builtin">:family</span> <span class="org-string">"Roboto"</span>
                                              <span class="org-builtin">:size</span> 16)))
  <span class="org-doc">"Extra face used on UI elements."</span>
  <span class="org-builtin">:group</span> 'my-typography)

(<span class="org-keyword">defface</span> <span class="org-variable-name">my-ui-window-header</span> `((t <span class="org-builtin">:inherit</span> my-default-ui
                                  <span class="org-builtin">:height</span> 0.8))
  <span class="org-doc">"Face used on decorative buffer headers."</span>
  <span class="org-builtin">:group</span> 'my-typography)

(<span class="org-keyword">defface</span> <span class="org-variable-name">my-default-prose</span> `((t <span class="org-builtin">:font</span> ,(font-spec <span class="org-builtin">:family</span> <span class="org-string">"iA Writer Quattro V"</span>
                                                 <span class="org-builtin">:size</span> 18)))
  <span class="org-doc">"Default variable pitch font used on prose writing."</span>
  <span class="org-builtin">:group</span> 'my-typography)

(<span class="org-keyword">defface</span> <span class="org-variable-name">my-document-title</span> `((t <span class="org-builtin">:inherit</span> my-default-prose
                                <span class="org-builtin">:height</span> 2.4
                                <span class="org-builtin">:weight</span> light
                                <span class="org-builtin">:slant</span> normal))
  <span class="org-doc">"Face used for document titles."</span>
  <span class="org-builtin">:group</span> 'my-typography)

(<span class="org-keyword">defface</span> <span class="org-variable-name">my-headline-1</span> `((t <span class="org-builtin">:inherit</span> my-default-prose
                            <span class="org-builtin">:height</span> 2.0
                            <span class="org-builtin">:weight</span> semi-light
                            <span class="org-builtin">:slant</span> normal))
  <span class="org-doc">"Face used for headlines of level 1."</span>
  <span class="org-builtin">:group</span> 'my-typography)

(<span class="org-keyword">defface</span> <span class="org-variable-name">my-headline-2</span> `((t <span class="org-builtin">:inherit</span> my-default-prose
                            <span class="org-builtin">:height</span> 1.8
                            <span class="org-builtin">:weight</span> semi-light
                            <span class="org-builtin">:slant</span> italic))
  <span class="org-doc">"Face used for headlines of level 1."</span>
  <span class="org-builtin">:group</span> 'my-typography)

(<span class="org-keyword">defface</span> <span class="org-variable-name">my-headline-3</span> `((t <span class="org-builtin">:inherit</span> my-default-prose
                            <span class="org-builtin">:height</span> 1.6
                            <span class="org-builtin">:weight</span> semi-light
                            <span class="org-builtin">:slant</span> normal))
  <span class="org-doc">"Face used for headlines of level 1."</span>
  <span class="org-builtin">:group</span> 'my-typography)

(<span class="org-keyword">defface</span> <span class="org-variable-name">my-headline-4</span> `((t <span class="org-builtin">:inherit</span> my-default-prose
                            <span class="org-builtin">:height</span> 1.4
                            <span class="org-builtin">:weight</span> semi-light
                            <span class="org-builtin">:slant</span> italic))
  <span class="org-doc">"Face used for headlines of level 1."</span>
  <span class="org-builtin">:group</span> 'my-typography)

(<span class="org-keyword">defface</span> <span class="org-variable-name">my-headline-5</span> `((t <span class="org-builtin">:inherit</span> my-default-prose
                            <span class="org-builtin">:height</span> 1.3
                            <span class="org-builtin">:weight</span> bold
                            <span class="org-builtin">:slant</span> normal))
  <span class="org-doc">"Face used for headlines of level 1."</span>
  <span class="org-builtin">:group</span> 'my-typography)

(<span class="org-keyword">defface</span> <span class="org-variable-name">my-headline-6</span> `((t <span class="org-builtin">:inherit</span> my-default-prose
                            <span class="org-builtin">:height</span> 1.2
                            <span class="org-builtin">:weight</span> bold
                            <span class="org-builtin">:slant</span> italic))
  <span class="org-doc">"Face used for headlines of level 1."</span>
  <span class="org-builtin">:group</span> 'my-typography)

(<span class="org-keyword">defface</span> <span class="org-variable-name">my-headline-7</span> `((t <span class="org-builtin">:inherit</span> my-default-prose
                            <span class="org-builtin">:height</span> 1.1
                            <span class="org-builtin">:weight</span> bold
                            <span class="org-builtin">:slant</span> normal))
  <span class="org-doc">"Face used for headlines of level 1."</span>
  <span class="org-builtin">:group</span> 'my-typography)

(<span class="org-keyword">defface</span> <span class="org-variable-name">my-headline-8</span> `((t <span class="org-builtin">:inherit</span> my-default-prose
                            <span class="org-builtin">:height</span> 1.0
                            <span class="org-builtin">:weight</span> bold
                            <span class="org-builtin">:slant</span> italic))
  <span class="org-doc">"Face used for headlines of level 1."</span>
  <span class="org-builtin">:group</span> 'my-typography)

(<span class="org-keyword">defface</span> <span class="org-variable-name">my-uri-face</span> `((t <span class="org-builtin">:inherit</span> link))
  <span class="org-doc">"Face used to display URIs."</span>
  <span class="org-builtin">:group</span> 'my-typography)
</pre>
</div>

<p>
The goal is to customize the fonts I want to have follow one of these rules by resetting all its values to <code>'unspecified</code> and inheriting one of my typography faces.
</p>

<p>
To help the tedious task of resetting a face, I want to have a helper function that will do the work for me:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 120: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defsubst</span> <span class="org-function-name">my-typography-reset</span> (<span class="org-type">&amp;rest</span> faces)
  <span class="org-doc">"Mark all face attributes from each face on FACES as `</span><span class="org-doc"><span class="org-constant">unspecified</span></span><span class="org-doc">'."</span>
  (custom-set-faces!
            `(,faces
              <span class="org-builtin">:family</span> unspecified
              <span class="org-builtin">:foundry</span> unspecified
              <span class="org-builtin">:width</span> unspecified
              <span class="org-builtin">:height</span> unspecified
              <span class="org-builtin">:weight</span> unspecified
              <span class="org-builtin">:slant</span> unspecified
              <span class="org-builtin">:underline</span> unspecified
              <span class="org-builtin">:overline</span> unspecified
              <span class="org-builtin">:strike-through</span> unspecified
              <span class="org-builtin">:box</span> unspecified
              <span class="org-builtin">:stipple</span> unspecified
              <span class="org-builtin">:font</span> unspecified
              <span class="org-builtin">:fontset</span> unspecified
              <span class="org-builtin">:extend</span> unspecified)))
</pre>
</div>

<p>
The astute reader might ask: <i>"Why not have this function do the whole work of resetting the font and assign an inheritance?"</i>
</p>

<p>
Unfortunately at this point, the answer is not clear. When I tried to implement the <i>one-shot</i> function, the target face would not get the inheritance value, and fonts were all messed up.
</p>

<p>
By splitting the process into cleaning and then setting, Emacs seams to behave as expected.
</p>

<div class="note" id="org7334233">
<p>
If you know what is going on here, please let me know. I'll be more than happy to learn and credit you for that!
</p>

</div>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
To start the configuration, I will get the Doom's font system configured accordingly to my typography:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 121: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> doom-font (face-attribute 'my-default-mono <span class="org-builtin">:font</span>)
      doom-big-font (face-attribute 'my-big-face-mono <span class="org-builtin">:font</span>)
      doom-variable-pitch-font (face-attribute 'my-default-prose <span class="org-builtin">:font</span>))
</pre>
</div>

<p>
It would be great if Doom could accept a <i>face</i> as the value for these variables, but unfortunately, it does not. Until this change, I have to live with this anonymous face that copy the <code>font</code> attribute from my typography face.
</p>

<p>
The next step is to make sure the base faces used on the editor match my base typography. The process to do so is the same I will use throughout this document whenever I find a mode that I need to adjust to match the defined typography.
</p>

<p>
I first clean up all styles except color on the faces I want to configure, in this case the faces are <code>fixed-pitch</code> and <code>variable-pitch</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 122: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(my-typography-reset 'fixed-pitch 'variable-pitch)
</pre>
</div>

<p>
Then I set each face inheritance to the correct typography face:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 123: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(custom-set-faces!
  '(fixed-pitch <span class="org-builtin">:inherit</span> my-default-mono)
  '(variable-pitch <span class="org-builtin">:inherit</span> my-default-prose))
</pre>
</div>

<p>
At his point, Emacs have <code>'default</code>, <code>'fixed-pitch</code>, and <code>'variable-pitch</code> faces matching my selection of fonts. This is, probably, a major part on the typography configuration. The rest of my setup, are individual packages, which I will configure once they show up in this document.
</p>

<p>
To close out the typography section, I like to enable font smoothing on macOS. To do so, simply set <code>ns-use-thin-smoothing</code> to <code>t</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 124: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> ns-use-thin-smoothing t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdd91f67" class="outline-4">
<h4 id="orgdd91f67"><span class="section-number-4">3.3.5</span> Iconography</h4>
<div class="outline-text-4" id="text-3-3-5">
<p>
Doom offers the <code>all-the-icons</code> package, which allow one to insert Unicode glyphs on buffers. That is a great start, but the problem I see here is how inconsistent the size of these icons are.
</p>

<p>
The idea for this section is to create a list of curated icons, adjusted to occupy exactly 2 ASCII characters on the buffer. This allows for a better alignment of text when we use an Icon.
</p>

<p>
I will create an <i>Association List</i> to store symbols associated with an adjusted icon:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 125: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-supported-icons</span>
  (list 'assign       (all-the-icons-material <span class="org-string">"assignment_ind"</span>          <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.17)
        'bug          (all-the-icons-material <span class="org-string">"bug_report"</span>              <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.17)
        'busy         (all-the-icons-material <span class="org-string">"event_busy"</span>              <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.17)
        'calendar     (all-the-icons-octicon  <span class="org-string">"calendar"</span>                <span class="org-builtin">:height</span> 1.05 <span class="org-builtin">:v-adjust</span> 0.0)
        'checked      (all-the-icons-material <span class="org-string">"check_box"</span>               <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.17)
        'checklist    (all-the-icons-octicon  <span class="org-string">"checklist"</span>               <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> 0.1)
        'contact-add  (all-the-icons-material <span class="org-string">"person_add"</span>              <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.17)
        'error        (all-the-icons-material <span class="org-string">"error_outline"</span>           <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.17)
        'globe        (all-the-icons-faicon   <span class="org-string">"globe"</span>                   <span class="org-builtin">:height</span> 1.15 <span class="org-builtin">:v-adjust</span> -0.05)
        'help         (all-the-icons-material <span class="org-string">"live_help"</span>               <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.22)
        'history      (all-the-icons-material <span class="org-string">"history"</span>                 <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.17)
        'idea         (all-the-icons-material <span class="org-string">"lightbulb_outline"</span>       <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.17)
        'inbox        (all-the-icons-material <span class="org-string">"inbox"</span>                   <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.15)
        'journal      (all-the-icons-material <span class="org-string">"book"</span>                    <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.15)
        'list         (all-the-icons-faicon   <span class="org-string">"list"</span>                    <span class="org-builtin">:height</span> 0.93 <span class="org-builtin">:v-adjust</span> -0.05)
        'loop         (all-the-icons-material <span class="org-string">"loop"</span>                    <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.17)
        'meeting      (all-the-icons-material <span class="org-string">"date_range"</span>              <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.15)
        'new          (all-the-icons-material <span class="org-string">"new_releases"</span>            <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.17)
        'notes        (all-the-icons-material <span class="org-string">"library_books"</span>           <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.1)
        'pause        (all-the-icons-material <span class="org-string">"pause_circle_outline"</span>    <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.17)
        'postit       (all-the-icons-faicon   <span class="org-string">"sticky-note"</span>             <span class="org-builtin">:height</span> 1.15 <span class="org-builtin">:v-adjust</span> 0.05)
        'project      (all-the-icons-octicon  <span class="org-string">"briefcase"</span>               <span class="org-builtin">:height</span> 1.05 <span class="org-builtin">:v-adjust</span> 0.05)
        'review       (all-the-icons-material <span class="org-string">"rate_review"</span>             <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.15)
        'semi-checked (all-the-icons-material <span class="org-string">"indeterminate_check_box"</span> <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.17)
        'snooze       (all-the-icons-material <span class="org-string">"snooze"</span>                  <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.17)
        'stop         (all-the-icons-octicon  <span class="org-string">"stop"</span>                    <span class="org-builtin">:height</span> 1.05 <span class="org-builtin">:v-adjust</span> -0.05)
        'timer        (all-the-icons-material <span class="org-string">"timer"</span>                   <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.15)
        'unchecked    (all-the-icons-material <span class="org-string">"check_box_outline_blank"</span> <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.17)
        'visibility   (all-the-icons-material <span class="org-string">"visibility"</span>              <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.17)
        'wait         (all-the-icons-material <span class="org-string">"hourglass_empty"</span>         <span class="org-builtin">:height</span> 0.95 <span class="org-builtin">:v-adjust</span> -0.17))
  <span class="org-doc">"Property list with all supported icons from my configuration."</span>)
</pre>
</div>

<p>
In order to allow other parts of this configuration to leverage the curated icons, I'll create a predicate function to check if a given symbol has an icon associated with it:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 126: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-supported-icons-p</span> (icon)
  <span class="org-doc">"Return t if the symbol given on ICON, is one associated with supported icon."</span>
  (<span class="org-keyword">and</span> (boundp 'my-supported-icons)
       (listp my-supported-icons)
       (plist-member my-supported-icons icon)))
</pre>
</div>

<p>
I want to also create a thin-wrapper around the <code>plist-get</code> to retrieve the icon string for a given symbol:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 127: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-raw-icon</span> (icon)
  <span class="org-doc">"This function returns the requested ICON as if you're calling the</span>
<span class="org-doc">`</span><span class="org-doc"><span class="org-constant">all-the-icons-</span></span><span class="org-doc">'* functions directly.</span>

<span class="org-doc">Icons supported by this function were all optimized to use exactly 2 characters</span>
<span class="org-doc">of space when used with the font and size defined in the main configuration.</span>

<span class="org-doc">Check th documentation of `</span><span class="org-doc"><span class="org-constant">my-supported-icons</span></span><span class="org-doc">' to see the list of supported</span>
<span class="org-doc">icons."</span>
  (plist-get my-supported-icons icon))
</pre>
</div>

<p>
And to finalize my icons configuration, I need to expose a function where one (me in this case) will call it to get a curated icon with a given color (this is the only function in this section that a user should call to get an icon).
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 128: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-icon</span> (icon <span class="org-type">&amp;optional</span> color)
  <span class="org-doc">"This function returns the requested ICON as a 2-characters string,</span>
<span class="org-doc">propertized to display the associated icon from the `</span><span class="org-doc"><span class="org-constant">all-the-icons</span></span><span class="org-doc">' package. It</span>
<span class="org-doc">uses the COLOR arg to 'paint' the icon.</span>

<span class="org-doc">Check documentation of the function `</span><span class="org-doc"><span class="org-constant">my-raw-icon</span></span><span class="org-doc">' for a list of supported</span>
<span class="org-doc">icons."</span>
  (<span class="org-keyword">cond</span> ((eq color 'raw) (my-raw-icon icon))
        (color (propertize <span class="org-string">"--"</span>
                   'face `(<span class="org-builtin">:foreground</span> ,color)
                   'display (my-raw-icon icon)))
        (t (propertize <span class="org-string">"--"</span>
                   'face `(<span class="org-builtin">:foreground</span> ,(face-attribute 'default <span class="org-builtin">:foreground</span>))
                   'display (my-raw-icon icon)))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga8f7cef" class="outline-3">
<h3 id="orga8f7cef"><span class="section-number-3">3.4</span> Editor Tabs</h3>
<div class="outline-text-3" id="text-3-4">
<p>
I've been all over the place regarding the use of tabs on editors. I used to think they were useless, since all files on my editor were buffers, not tabs. I though that using tabs as a sort of layout manager was a great idea, because I would have the visual cue of <i>workspaces</i> I had configured.
</p>

<p>
Recently, I spent time thinking about this, and I changed my mind regarding tabs. First, I believe the common knowledge that one tab represents one file, is too ingrained into our collective minds by all other software that use them (web browsers, IDEs, file managers, etc.). This causes a weird feeling when I look to the tabs, and they do not represent opened files. Also, as I work on my editor, I lose track of files opened without tabs.
</p>

<p>
For some Emacs users, all these arguments are silly because they are too used to the way Emacs works. But I believe that this argument should be the other way around. Because of the way Emacs developers decided to use the tab paradigm inside the editor, Emacs users accepted and got used to it.
</p>

<p>
But, as if to point out things I'm arguing for, there are way too many packages that say they <i>fix the Emacs window system</i> on GitHub these days.
</p>

<p>
On 2020, I read a blog post from <a href="https://andreyorst.gitlab.io/">Andrey Listopadov</a> about his desire to have <a href="https://andreyorst.gitlab.io/posts/2020-05-07-making-emacs-tabs-work-like-in-atom/">Emacs tabs behaving more like tabs on Atom</a>. The post itself is an excellent read, but I would like to reproduce here Andrey's description of how he believes the tab behavior should be:
</p>

<blockquote>
<p>
In Emacs, however, we can’t close tab via close button, because it will cycle buffers, so instead we can switch to second policy of killing buffer instead. But it will not work either, because it will not kill the window, and it will kill buffer in all windows. So how do we fix this?
</p>

<p>
First let’s establish some logical rules:
</p>

<ul class="org-ul">
<li>Buffer can exist without a tab, but tab can not exist without a buffer,</li>
<li>If tab was closed buffer should be killed only if there are no tabs for this buffer left,</li>
<li>If tab was closed and there are no more tabs in the window, window should be killed.</li>
</ul>

<p>
These three rules are basically how tabs work in modern editors.
</p>
</blockquote>

<p>
The configuration you're reading here is almost a copy from Andrey's posts (there is a sequel to the aforementioned post called <a href="https://andreyorst.gitlab.io/posts/2020-05-10-making-emacs-tabs-look-like-in-atom/">Making Emacs tabs look like in Atom</a>, that I also copy snippets in order fully configure tabs here.) with minor modifications to adjust it to my code style.
</p>

<p>
The way to achieve this configuration, is to define a set of <code>tab-line</code> variables and let Emacs do its thing.
</p>

<p>
My tab configuration uses dynamic values in almost all of it, but there are two constants that I have to decide beforehand: <code>tab-line-tab-min-width</code> and <code>tab-line-tab-max-width</code>.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 129: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defconst</span> <span class="org-variable-name">tab-line-tab-min-width</span> 20
  <span class="org-doc">"Minimum width of a tab in characters."</span>)

(<span class="org-keyword">defconst</span> <span class="org-variable-name">tab-line-tab-max-width</span> 70
  <span class="org-doc">"Maximum width of a tab in characters."</span>)
</pre>
</div>

<p>
It might look an exaggeration to use the values I chose, but since I will use a variable pitch face to draw the tabs, these numbers become more realistic.
</p>

<p>
So let's configure the faces used on my tabs:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 130: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-tabs--setup-faces-h</span> ()
  <span class="org-doc">"Configure the `</span><span class="org-doc"><span class="org-constant">tab-line-mode</span></span><span class="org-doc">' user interface."</span>
  (<span class="org-keyword">let*</span> ((base (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> (facep 'solaire-default-face)
                        (not (eq (face-attribute 'solaire-default-face <span class="org-builtin">:background</span>) 'unspecified)))
                   (face-attribute 'default <span class="org-builtin">:background</span>)
                 (face-attribute 'mode-line <span class="org-builtin">:background</span>)))
         (bg (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> (facep 'solaire-default-face)
                      (not (eq (face-attribute 'solaire-default-face <span class="org-builtin">:background</span>) 'unspecified)))
                 (face-attribute 'solaire-default-face <span class="org-builtin">:background</span>)
               (face-attribute 'default <span class="org-builtin">:background</span>)))
         (fg (face-attribute 'default <span class="org-builtin">:foreground</span>))
         (dark-fg (face-attribute 'shadow <span class="org-builtin">:foreground</span>))
         (overline (face-attribute 'highlight <span class="org-builtin">:background</span>))
         (box-width (/ my-line-pixel-height 2))
         (box-base (<span class="org-keyword">when</span> (&gt; box-width 0) (list <span class="org-builtin">:line-width</span> box-width <span class="org-builtin">:color</span> base)))
         (box-bg (<span class="org-keyword">when</span> (&gt; box-width 0) (list <span class="org-builtin">:line-width</span> box-width <span class="org-builtin">:color</span> bg))))
    (set-face-attribute 'tab-line nil
                        <span class="org-builtin">:background</span> base
                        <span class="org-builtin">:foreground</span> dark-fg
                        <span class="org-builtin">:overline</span> base
                        <span class="org-builtin">:inherit</span> 'my-default-ui
                        <span class="org-builtin">:box</span> box-base)
    (set-face-attribute 'tab-line-tab nil
                        <span class="org-builtin">:foreground</span> dark-fg
                        <span class="org-builtin">:background</span> bg
                        <span class="org-builtin">:inherit</span> 'my-default-ui
                        <span class="org-builtin">:box</span> box-bg)
    (set-face-attribute 'tab-line-tab-inactive nil
                        <span class="org-builtin">:foreground</span> dark-fg
                        <span class="org-builtin">:background</span> base
                        <span class="org-builtin">:inherit</span> 'my-default-ui
                        <span class="org-builtin">:box</span> box-base)
    (set-face-attribute 'tab-line-tab-current nil
                        <span class="org-builtin">:foreground</span> fg
                        <span class="org-builtin">:background</span> bg
                        <span class="org-builtin">:inherit</span> 'my-default-ui
                        <span class="org-builtin">:overline</span> overline
                        <span class="org-builtin">:box</span> box-bg)
    (set-face-attribute 'tab-line-highlight nil
                        <span class="org-builtin">:foreground</span> fg
                        <span class="org-builtin">:background</span> nil
                        <span class="org-builtin">:inherit</span> 'tab-line-tab
                        <span class="org-builtin">:overline</span> overline
                        <span class="org-builtin">:box</span> box-bg)
    (set-face-attribute 'tab-line-close-highlight nil
                        <span class="org-builtin">:foreground</span> overline
                        <span class="org-builtin">:overline</span> overline
                        <span class="org-builtin">:background</span> nil
                        <span class="org-builtin">:inherit</span> 'tab-line-tab
                        <span class="org-builtin">:box</span> box-bg)))
</pre>
</div>

<p>
And I need to make sure I call this function after Doom loads the editor's theme:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 131: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(add-hook 'doom-load-theme-hook #'my-tabs--setup-faces-h)
</pre>
</div>

<p>
To configure the look and feel of <i>non-tab</i> elements of the <code>tab-line</code>, I need to set the <code>tab-line-right-button</code>, <code>tab-line-left-button</code>, <code>tab-line-new-button-show</code>, and <code>tab-line-separator</code> variables:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 132: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> tab-line
  (<span class="org-keyword">setq</span> tab-line-right-button (propertize (<span class="org-keyword">if</span> (char-displayable-p ?&#9656;) <span class="org-string">" &#9656; "</span> <span class="org-string">" &gt; "</span>)
                                          'keymap tab-line-right-map
                                          'mouse-face 'tab-line-highlight
                                          'help-echo <span class="org-string">"Click to scroll right"</span>)
        tab-line-left-button (propertize (<span class="org-keyword">if</span> (char-displayable-p ?&#9666;) <span class="org-string">" &#9666; "</span> <span class="org-string">" &lt; "</span>)
                                         'keymap tab-line-left-map
                                         'mouse-face 'tab-line-highlight
                                         'help-echo <span class="org-string">"Click to scroll left"</span>)
        tab-line-new-button-show nil
        tab-line-separator <span class="org-string">""</span>))
</pre>
</div>

<p>
And to configure the tab itself, I need to set the <code>tab-line-close-button-show</code>, <code>tab-line-close-button</code>, and the <code>tab-line-tab-name-function</code> variables:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 133: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> tab-line
  (<span class="org-keyword">setq</span> tab-line-close-button-show t
        tab-line-close-button (propertize (format <span class="org-string">"%s "</span> (all-the-icons-material <span class="org-string">"close"</span>))
                                          'keymap tab-line-tab-close-map
                                          'mouse-face 'tab-line-close-highlight
                                          'face 'tab-line-tab-curent
                                          'help-echo <span class="org-string">"Click to close tab"</span>)
        tab-line-tab-name-function #'my-tabs-name-buffer))
</pre>
</div>

<p>
While the <code>tab-line-close-button-show</code> and the <code>tab-line-close-button</code> variables control the appearance of the tab close button, the <code>tab-line-tab-name-function</code> is responsible for everything else on the tab. The <code>my-tabs-name-buffer</code> function will return a string representing the tab name for each tab, and is also this function's responsibility to return the normalized tab size in form of blank spaces:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 134: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-tabs-name-buffer</span> (buffer <span class="org-type">&amp;rest</span> _buffers)
  <span class="org-doc">"Create name for tab with padding and truncation.</span>

<span class="org-doc">If buffer name is shorter than `</span><span class="org-doc"><span class="org-constant">tab-line-tab-max-width</span></span><span class="org-doc">' it gets centered with</span>
<span class="org-doc">spaces, otherwise it gets truncated, to preserve equal width for all tabs. This</span>
<span class="org-doc">function also tries to fit as many tabs in window as possible, so if there are</span>
<span class="org-doc">no room for tabs with maximum width, it calculates new width for each tab and</span>
<span class="org-doc">truncates text if needed. You can set the minimal width with</span>
<span class="org-doc">`</span><span class="org-doc"><span class="org-constant">tab-line-tab-min-width</span></span><span class="org-doc">' variable."</span>
  (<span class="org-keyword">with-current-buffer</span> buffer
    (<span class="org-keyword">let*</span> ((window-width (window-width (get-buffer-window)))
           (close-button-size (<span class="org-keyword">if</span> tab-line-close-button-show
                                  (length (substring-no-properties tab-line-close-button))
                                0))
           (tab-amount (length (funcall tab-line-tabs-function)))
           (window-max-tab-width (/ window-width tab-amount))
           (tab-width (- (<span class="org-keyword">cond</span> ((&gt;= window-max-tab-width tab-line-tab-max-width)
                                tab-line-tab-max-width)
                               ((&lt; window-max-tab-width tab-line-tab-min-width)
                                tab-line-tab-min-width)
                               (t window-max-tab-width))
                         close-button-size))
           (buffer-name (string-trim (buffer-name)))
           (name-width (length buffer-name)))
      (<span class="org-keyword">if</span> (&gt;= name-width (- tab-width 3))
          (concat  <span class="org-string">" "</span> (truncate-string-to-width buffer-name (- tab-width 3)) <span class="org-string">"&#8230; "</span>)
        (<span class="org-keyword">let*</span> ((padding (make-string (/ (- tab-width name-width) 2) ?\s))
               (buffer-name (concat padding buffer-name))
               (name-width (length buffer-name)))
          (concat buffer-name (make-string (- tab-width name-width) ?\s)))))))
</pre>
</div>

<p>
The reader might have noticed I use the size of the list returned by the function <code>tab-line-tabs-function</code> to calculate single tab size, and as you imagine, the function symbol used in this variable is responsible to return a list of tabs on the current window, so I will also use such function to filter some unwanted buffers on the tab bar. The function's docstring, explains these exceptional cases in a bit more detail:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 135: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-tabs-mode-persp-window</span> ()
  <span class="org-doc">"Return a list of buffer tabs of the current window.</span>

<span class="org-doc">This function take in account the active perspective (or workspace) so it does</span>
<span class="org-doc">not display tabs from other perspectives on the current one.</span>

<span class="org-doc">There are 4 types of buffer that this function handles:</span>

<span class="org-doc">1. Real buffers</span>

<span class="org-doc">   These buffers are the normal buffers that have a tab associated with them. To</span>
<span class="org-doc">   be a real buffer, the function `</span><span class="org-doc"><span class="org-constant">doom-real-buffer-p</span></span><span class="org-doc">' must return t for the</span>
<span class="org-doc">   buffer.</span>

<span class="org-doc">2. Popup buffers (or non-real buffers)</span>

<span class="org-doc">   These are the inverse of real buffers.</span>

<span class="org-doc">3. Org capture buffers</span>

<span class="org-doc">   These buffers are the ones created to perform the `</span><span class="org-doc"><span class="org-constant">org-capture</span></span><span class="org-doc">'. Such buffers</span>
<span class="org-doc">   should never have a tab associated with them.</span>

<span class="org-doc">4. Dired buffers</span>

<span class="org-doc">   These are real buffers that should never exist in more than one per window.</span>
<span class="org-doc">   When jumping from one Dired buffer to another, Emacs creates one buffer per</span>
<span class="org-doc">   directory, but the tab bar should not display any other then the current</span>
<span class="org-doc">   buffer."</span>
  (<span class="org-keyword">let</span> ((win-buffs (tab-line-tabs-window-buffers))
        (last-dired-buf (seq-find 'doom-dired-buffer-p (buffer-list (selected-frame)))))
    (reverse (seq-filter (<span class="org-keyword">lambda</span> (buf)
                           (<span class="org-keyword">let</span> ((buf-name (buffer-name buf)))
                             (<span class="org-keyword">and</span> (member buf win-buffs)
                                  (doom-real-buffer-p buf)
                                  (not (string-prefix-p buf-name <span class="org-string">"CAPTURE-"</span>))
                                  (<span class="org-keyword">or</span> (not (doom-dired-buffer-p buf))
                                      (eq buf last-dired-buf)))))
                         (funcall tab-line-tabs-buffer-list-function)))))
</pre>
</div>

<p>
And as with the <code>tab-line-tabs-function</code>, the <code>tab-line-tabs-buffer-list-function</code> holds a symbol of a function that returns all buffers to consider during <code>tab-line-tabs-function</code> execution, and I should set them to their proper functions, unfortunately the <code>persp-current-buffers</code> (which is the function we need to call), is a macro, and according to the Emacs <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Calling-Functions.html">documentation</a>, we can't pass macros to <code>funcall</code> or <code>apply</code>.
</p>

<p>
To workaround this problem, I will create an alias function to call the same functions the <code>persp-current-buffers</code> macro do:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 136: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defalias</span> '<span class="org-function-name">my-persp-current-buffers</span>
  (<span class="org-keyword">lambda</span> ()
    (<span class="org-keyword">when</span> (fboundp 'persp-buffers)
      (persp-buffers (get-current-persp))))
  <span class="org-doc">"Wrapper for the `</span><span class="org-doc"><span class="org-constant">persp-current-buffers</span></span><span class="org-doc">' macro."</span>)
</pre>
</div>

<p>
Now we can properly define the two variables we need to make <code>tab-line</code> find the tab buffers:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 137: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> tab-line
  (<span class="org-keyword">setq</span> tab-line-tabs-function #'my-tabs-mode-persp-window
        tab-line-tabs-buffer-list-function #'my-persp-current-buffers))
</pre>
</div>

<p>
The last variable to configure is the <code>tab-line-exclude-modes</code>. This variable holds a list of modes that will not have <code>tab-line-mode</code> enabled on them, even when <code>global-tab-line-mode</code> gets enabled:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 138: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> tab-line
  (<span class="org-keyword">setq</span> tab-line-exclude-modes '(+doom-dashboard-mode
                                 cfw:calendar-mode
                                 Info-mode
                                 calendar-mode
                                 ediff-mode
                                 eshell-mode
                                 help-mode
                                 helpful-mode
                                 imenu-list-major-mode
                                 lexic-mode
                                 process-menu-mode
                                 Man-mode
                                 WoMan-mode
                                 term-mode
                                 treemacs-mode
                                 vterm-mode
                                 wordnut-mode
                                 reb-mode)))
</pre>
</div>

<p>
Even with the <code>tab-line-exclude-modes</code> list, some <i>non-real</i> buffers get displayed. I need to create an extra function to help me get rid of the <code>tab-line</code> when I load such buffers:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 139: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-tabs-hide-tab-line-maybe-h</span> ()
  <span class="org-doc">"Disable `</span><span class="org-doc"><span class="org-constant">tab-line-mode</span></span><span class="org-doc">' for non-real buffers.</span>

<span class="org-doc">For a definition of what is a non-real buffer, check the documentation of</span>
<span class="org-doc">`</span><span class="org-doc"><span class="org-constant">doom-real-buffer-p</span></span><span class="org-doc">'."</span>
  (<span class="org-keyword">when</span> (not (doom-real-buffer-p (current-buffer)))
    (tab-line-mode -1)))
</pre>
</div>

<p>
With the helper function defined, I need to make sure I call it when I switch buffers. The reason for that is that I could explicitly request to load a <i>non-real</i> buffer, which would create the <code>tab-line</code> on such buffer:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 140: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(add-hook 'doom-switch-buffer-hook #'my-tabs-hide-tab-line-maybe-h)
</pre>
</div>

<p>
Also, when Emacs calls the <code>window-configuration-change-hook</code> hooks, I need to clean all <code>tab-line</code> cache to make sure Emacs will re-consider all the proper buffers when re-displaying it:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 141: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(add-hook 'window-configuration-change-hook #'my-tabs--drop-caches-h)
</pre>
</div>

<p>
The implementation of <code>my-tabs--drop-caches-h</code> simply <i>nullify</i> the value of the <code>tab-line-cache</code> window parameter for all windows:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 142: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-tabs--drop-caches-h</span> ()
  <span class="org-doc">"Drops `</span><span class="org-doc"><span class="org-constant">tab-line</span></span><span class="org-doc">' cache in every window."</span>
  (<span class="org-keyword">dolist</span> (window (window-list))
    (set-window-parameter window 'tab-line-cache nil)))
</pre>
</div>

<p>
With all that in place, we can make sure the <code>tab-line</code> gets loaded when Emacs start:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 143: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> tab-line
  <span class="org-builtin">:when</span> window-system
  <span class="org-builtin">:hook</span> ((after-init . global-tab-line-mode)))
</pre>
</div>
</div>

<div id="outline-container-org9e9c0a1" class="outline-4">
<h4 id="org9e9c0a1"><span class="section-number-4">3.4.1</span> Tab actions</h4>
<div class="outline-text-4" id="text-3-4-1">
<p>
There are two main actions that I need to address here: selection and closing.
</p>

<p>
I would like to start talking about the latter. Unfortunately, the Emacs implementation of <code>tab-line-close-tab</code> does not leave room to customize its behavior the way I want it. Instead, I will implement my own version (more like "I'll copy Andrey's version and change it a bit"):
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 144: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-tabs-close-buffer-tab</span> (buffer-or-name <span class="org-type">&amp;optional</span> window)
  (<span class="org-keyword">let</span> ((buffer (get-buffer buffer-or-name))
        (window (<span class="org-keyword">or</span> window (get-buffer-window))))
    (<span class="org-keyword">if</span> window
        (<span class="org-keyword">with-selected-window</span> window
          (<span class="org-keyword">let</span> ((tab-list (my-tabs-mode-persp-window))
                (buffer-list (flatten-list
                              (seq-reduce (<span class="org-keyword">lambda</span> (list window)
                                            (select-window window t)
                                            (cons (my-tabs-mode-persp-window) list))
                                          (window-list) nil))))
            (select-window window)
            (<span class="org-keyword">if</span> (&gt; (seq-count (<span class="org-keyword">lambda</span> (b) (eq b buffer)) buffer-list) 1)
                (<span class="org-keyword">progn</span>
                  (<span class="org-keyword">if</span> (eq buffer (current-buffer))
                      (bury-buffer)
                    (set-window-prev-buffers window (assq-delete-all buffer (window-prev-buffers)))
                    (set-window-next-buffers window (delq buffer (window-next-buffers))))
                  (<span class="org-keyword">unless</span> (cdr tab-list)
                    (<span class="org-keyword">ignore-errors</span> (delete-window window))))
              (<span class="org-keyword">and</span> (kill-buffer buffer)
                   (<span class="org-keyword">unless</span> (cdr tab-list)
                     (<span class="org-keyword">ignore-errors</span> (delete-window window)))))))
      (<span class="org-keyword">if</span> (persp-buffer-in-other-p buffer)
          (persp-remove-buffer buffer)
        (kill-buffer buffer)))))
</pre>
</div>

<p>
With the function implemented, I need to override the original one with it using an advice:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 145: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-tabs-close-tab-a (<span class="org-type">&amp;optional</span> mouse-event)
  <span class="org-doc">"Close the selected tab.</span>

<span class="org-doc">If buffer on tab is present in another window, close the tab by using</span>
<span class="org-doc">`</span><span class="org-doc"><span class="org-constant">bury-buffer</span></span><span class="org-doc">' function. If buffer on tab is unique to all existing windows, kill</span>
<span class="org-doc">the buffer with `</span><span class="org-doc"><span class="org-constant">kill-buffer</span></span><span class="org-doc">' function. Lastly, if no tabs left in the window,</span>
<span class="org-doc">it will delete it with `</span><span class="org-doc"><span class="org-constant">delete-window</span></span><span class="org-doc">' function."</span>
  <span class="org-builtin">:override</span> 'tab-line-close-tab
  (<span class="org-keyword">let*</span> ((posnp (<span class="org-keyword">and</span> mouse-event (event-start mouse-event)))
         (window (<span class="org-keyword">and</span> posnp (posn-window posnp)))
         (buffer (<span class="org-keyword">or</span> (<span class="org-keyword">and</span> posnp (get-pos-property 1 'tab (car (posn-string posnp))))
                     (current-buffer)))
         (window (<span class="org-keyword">or</span> window (get-buffer-window buffer))))
    (my-tabs-close-buffer-tab buffer window)
    (force-mode-line-update)))
</pre>
</div>

<p>
Now, any code calling the <code>tab-line-close-tab</code> will use the algorithm defined in this section.
</p>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
The next and final action to handle is actually a group of actions related to <i>switching between tabs</i>.
</p>

<p>
The first step to configure tab switching, is to create a function that allows me to switch to any tab, by passing a tab to it. The only special thing about this function is that you can pass a buffer or an association list representing a tab. Other than that, this function behaves much like the <code>switch-to-buffer</code> one:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 146: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-tab-line-switch-to-tab</span> (tab)
  <span class="org-doc">"Switch to the buffer associated with TAB."</span>
  (<span class="org-keyword">let</span> ((buffer (<span class="org-keyword">if</span> (bufferp tab) tab (cdr (assq 'buffer tab)))))
    (<span class="org-keyword">when</span> (bufferp buffer)
        (switch-to-buffer buffer))))
</pre>
</div>

<p>
Next, I need a way to select a tab by its position of the displayed tabs:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 147: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-tab-line-switch-to</span> (pos)
  <span class="org-doc">"Switch to the tab on position POS.</span>

<span class="org-doc">If POS is negative, access the tab on the reverse order.</span>

<span class="org-doc">If POS is bigger than the number of tabs, return nil. The same is valid for</span>
<span class="org-doc">negative numbers, so if POS is negative and its absolute value minus 1 is bigger</span>
<span class="org-doc">than the number of tabs, return nil."</span>
  (<span class="org-keyword">let*</span> ((tabs (funcall tab-line-tabs-function))
         (tabs (<span class="org-keyword">if</span> (&lt; pos 0) (reverse tabs) tabs))
         (pos (<span class="org-keyword">if</span> (&lt; pos 0) (1- (- pos)) pos))
         (tab (nth pos tabs)))
    (<span class="org-keyword">unless</span> (my-tab-line-switch-to-tab tab)
      (<span class="org-warning">user-error</span> <span class="org-string">"There is no tab on position %s"</span> (1+ pos)))))
</pre>
</div>

<p>
And a helper function to select the last tab on the list:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 148: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-tab-line-switch-to-final</span> ()
  <span class="org-doc">"Switch to the last tab."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((tab (car (last (funcall tab-line-tabs-function)))))
    (<span class="org-keyword">unless</span> (my-tab-line-switch-to-tab tab)
      (<span class="org-warning">user-error</span> <span class="org-string">"Tab line is not visible to go to the last tab"</span>))))
</pre>
</div>

<p>
These functions should be enough to allow me to switch tabs on any way I defined here. To get a good set of key bindings, I need to create aliases for calling <code>my-tab-line-switch-to</code> from 1 to 9:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 149: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">dotimes</span> (i 9)
  (<span class="org-keyword">defalias</span> (intern (format <span class="org-string">"my-tab-line-switch-to-%d"</span> i))
    (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>) (my-tab-line-switch-to i))
    (format
     <span class="org-string">"Thin wrapper around `</span><span class="org-string"><span class="org-constant">+workspace/switch-to</span></span><span class="org-string">' function where we pass #%d as the INDEX parameter."</span>
     (1+ i))))
</pre>
</div>

<p>
And my keymap for all these functions should allow me to switch tabs using <code>Cmd</code> plus a number from <code>1</code> to <code>9</code>. The <code>Cmd-0</code> shortcut will call the <code>my-tab-line-switch-to-final</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 150: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:after</span> tab-line
      <span class="org-builtin">:ne</span> <span class="org-string">"s-1"</span> #'my-tab-line-switch-to-0
      <span class="org-builtin">:ne</span> <span class="org-string">"s-2"</span> #'my-tab-line-switch-to-1
      <span class="org-builtin">:ne</span> <span class="org-string">"s-3"</span> #'my-tab-line-switch-to-2
      <span class="org-builtin">:ne</span> <span class="org-string">"s-4"</span> #'my-tab-line-switch-to-3
      <span class="org-builtin">:ne</span> <span class="org-string">"s-5"</span> #'my-tab-line-switch-to-4
      <span class="org-builtin">:ne</span> <span class="org-string">"s-6"</span> #'my-tab-line-switch-to-5
      <span class="org-builtin">:ne</span> <span class="org-string">"s-7"</span> #'my-tab-line-switch-to-6
      <span class="org-builtin">:ne</span> <span class="org-string">"s-8"</span> #'my-tab-line-switch-to-7
      <span class="org-builtin">:ne</span> <span class="org-string">"s-9"</span> #'my-tab-line-switch-to-8
      <span class="org-builtin">:ne</span> <span class="org-string">"s-0"</span> #'my-tab-line-switch-to-final

      (<span class="org-builtin">:prefix</span> <span class="org-string">"g"</span>
       <span class="org-builtin">:desc</span> <span class="org-string">"Go to tab on the right"</span> <span class="org-builtin">:n</span> <span class="org-string">"t"</span> #'tab-line-switch-to-next-tab
       <span class="org-builtin">:desc</span> <span class="org-string">"Go to tab on the left"</span>  <span class="org-builtin">:n</span> <span class="org-string">"T"</span> #'tab-line-switch-to-prev-tab))
</pre>
</div>

<p>
One final configuration I need to do is to make sure Emacs selects the correct tab when I click on it with the mouse:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 151: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-tabs-select-tab-a (<span class="org-type">&amp;optional</span> e)
  <span class="org-doc">"Advice to select the buffer window of a tab when clicking on the tab."</span>
  <span class="org-builtin">:after</span> 'tab-line-select-tab
  (select-window (posn-window (event-start e))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5c8d390" class="outline-4">
<h4 id="org5c8d390"><span class="section-number-4">3.4.2</span> Windows</h4>
<div class="outline-text-4" id="text-3-4-2">
<p>
It's impossible to get the tab configuration right without adjusting the Emacs window behavior.
</p>

<p>
The main behavior I want to guarantee, is that Emacs should close a window if there are no buffers left on the list of previous buffers:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 152: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-close-window-when-kill-buffer-h</span> (<span class="org-type">&amp;optional</span> buffer-or-name)
  (<span class="org-keyword">let*</span> ((buf (get-buffer (<span class="org-keyword">or</span> buffer-or-name (current-buffer))))
         (win (get-buffer-window buf)))
    (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> win (my-window-single-buffer-p win))
      (delete-window win))))
</pre>
</div>

<p>
Because this function needs to know if there are no buffer lefts on the list of buffers associated with the window, I will implement a helper function for that:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 153: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defsubst</span> <span class="org-function-name">my-window-single-buffer-p</span> (<span class="org-type">&amp;optional</span> win)
  (<span class="org-keyword">let</span> ((win (<span class="org-keyword">or</span> win (selected-window))))
    (<span class="org-keyword">or</span> (window-dedicated-p win)
        (not (<span class="org-keyword">or</span> (window-next-buffers win)
                 (window-prev-buffers win))))))
</pre>
</div>

<p>
Now I just need to make sure Emacs calls the <code>my-close-window-when-kill-buffer-h</code> function when I kill a buffer:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 154: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(add-hook 'kill-buffer-hook 'my-close-window-when-kill-buffer-h)
</pre>
</div>

<p>
These covers most of the closing behavior regarding windows. The one exception is the <code>kill-current-buffer</code> that needs to not switch buffers as we kill the current buffer. I will implement this behavior as a <i>before</i> advice to the <code>kill-current-buffer</code> function:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 155: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-close-window-when-no-buffer-a (<span class="org-type">&amp;rest</span> _)
  <span class="org-builtin">:before-until</span> #'kill-current-buffer
  (my-save-all-buffers-a)
  (<span class="org-keyword">let</span> ((buf (current-buffer))
        (tabs (my-tabs-mode-persp-window)))
    (<span class="org-keyword">cond</span>
     ((window-dedicated-p) (delete-window) t)
     ((eq buf (doom-fallback-buffer)) (message <span class="org-string">"Can't kill the fallback buffer."</span>) t)
     ((doom-real-buffer-p buf)
      (<span class="org-keyword">let</span> ((doom-inhibit-switch-buffer-hooks-original doom-inhibit-switch-buffer-hooks)
            (inhibit-redisplay t)
            buffer-list-update-hook)
        (<span class="org-keyword">if</span> (memq buf tabs)
            (<span class="org-keyword">progn</span>
              (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> (doom-real-buffer-p buf)
                         (buffer-file-name buf)
                         (buffer-modified-p buf)
                         (not (y-or-n-p (format <span class="org-string">"Buffer %s has unsaved changes; kill it anyway?"</span> buf))))
                (<span class="org-warning">user-error</span> <span class="org-string">"Aborted"</span>))
              (tab-line-close-tab))
          (<span class="org-keyword">with-current-buffer</span> buf
            (restore-buffer-modified-p nil))
          (kill-buffer buf))
        (<span class="org-keyword">setq</span> doom-inhibit-switch-buffer-hooks doom-inhibit-switch-buffer-hooks-original))
      (run-hooks 'buffer-list-update-hook)
      t))))
</pre>
</div>

<p>
To finish the window changes, I need to make sure Doom does not switch to the fallback buffer (a.k.a. the Dashboard buffer) when there are no more buffers left on the window:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 156: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(advice-remove 'kill-current-buffer #'doom--switch-to-fallback-buffer-maybe-a)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgcf11352" class="outline-3">
<h3 id="orgcf11352"><span class="section-number-3">3.5</span> Special modes</h3>
<div class="outline-text-3" id="text-3-5">
<p>
The configuration in this section, belongs to some modes that I use all over the place or that are not big enough to justify their own section in this document.
</p>

<p>
In practice, most of the configurations here are about the mode's appearance, and where they show their content.
</p>
</div>

<div id="outline-container-org2e7fa43" class="outline-4">
<h4 id="org2e7fa43"><span class="section-number-4">3.5.1</span> Info mode</h4>
<div class="outline-text-4" id="text-3-5-1">
<p>
The Info mode is where all user manuals exist. Up to now, I'm not used to read and search through the manuals, but I feel this is a habit I must acquire.
</p>

<p>
First I need to make the manuals to <i>look</i> nicer (if you're rolling your eyes right now, have a remembering read into the section <a href="#orgc5db7d9">3.3</a>).
</p>

<p>
Although this is not a radical change, there are two font lock additions I want to do. The first is a symbol to represent the <i>menu</i> for the current info page, and the second is to replace the <code>*</code> character as the list item markup, by the character I will use on all other modes that deal with lists:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 157: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> info
  (font-lock-add-keywords
   'Info-mode
   `((<span class="org-string">"^</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">\\*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"> "</span>
      (0 (<span class="org-keyword">prog1</span> () (compose-region (match-beginning 1) (match-end 1) <span class="org-string">"&#8226;"</span>))))
     (<span class="org-string">"^[\t ]*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">\\*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"> Menu</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">:</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span>
      (0 (<span class="org-keyword">prog1</span> ()
           (compose-region (match-beginning 1) (match-end 1) <span class="org-string">"&#9776;"</span>)
           (put-text-property (match-beginning 2) (match-end 2) 'invisible t)
           )))) <span class="org-warning">t))</span>
</pre>
</div>

<p>
There is a package called <a href="https://www.emacswiki.org/emacs/InfoPlus"><code>info+.el</code></a>, available through the Emacs Wiki, that fontify the <code>Info-mode</code> buffer to make it look nicer.
</p>

<p>
Unfortunately the latest changes introduced in March broke the package on Emacs 27 and 28, so in order to still have the nice feature it provides with a version that still works on my Emacs, I need to <i>pin</i> the package to the version that still works:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 158: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> info-plus <span class="org-builtin">:pin</span> <span class="org-string">"5ecd4c1e3f1384bffb386e61a8e3788652e55c25"</span>)
</pre>
</div>

<p>
Due to the nature of this package, we need to load it only when we need to fontify the buffer:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 159: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> info-plus <span class="org-builtin">:commands</span> Info-toggle-fontify-all)
</pre>
</div>

<p>
But when this actually happens? The best place to add this, is the hook <code>Info-selection-hook</code>. First I need to define a function that will configure the mode when any info page gets selected:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 160: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-info--fontify-info-h</span> ()
  <span class="org-doc">"Hook called to fontify the Info buffer.</span>

<span class="org-doc">This function lexically bind some configuration for the `</span><span class="org-doc"><span class="org-constant">into-plus</span></span><span class="org-doc">' package,</span>
<span class="org-doc">and call the `</span><span class="org-doc"><span class="org-constant">Info-toggle-fontify-all</span></span><span class="org-doc">' to perform the fontification work.</span>

<span class="org-doc">Notice we need to update the font lock overlays after this call to guarantee</span>
<span class="org-doc">the fontification didn't remove any important overlay."</span>
  (<span class="org-keyword">let</span> ((Info-fontify-angle-bracketed-flag nil)
        (Info-fontify-bookmarked-xrefs-flag nil)
        (Info-fontify-emphasis-flag nil)
        (Info-fontify-glossary-words nil)
        (Info-fontify-isolated-quote-flag nil)
        (Info-fontify-quotations nil)
        (Info-fontify-reference-items-flag nil)
        (Info-fontify-visited-nodes nil))
    (call-interactively 'Info-toggle-fontify-all)
    (font-lock-update)))
</pre>
</div>

<p>
Then, I can hook it to the <code>Info-selection-hook</code> hook:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 161: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">add-hook!</span> Info-selection #'my-info--fontify-info-h)
</pre>
</div>

<p>
The next step is to make sure the <code>Info-mode</code> respects the typography I defined earlier. First we clean up any outstanding setup to the faces that need to get adjusted:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 162: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(my-typography-reset (<span class="org-keyword">cl-loop</span> for i from 1 to 4 collect (intern (format <span class="org-string">"info-title-%d"</span> i))))
(my-typography-reset 'info-menu-header)
</pre>
</div>

<p>
And then, we modify all the faces to match my particular configuration:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 163: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(custom-set-faces!
  '(info-title-1 <span class="org-builtin">:inherit</span> outline-1 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  '(info-title-2 <span class="org-builtin">:inherit</span> outline-2 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  '(info-title-3 <span class="org-builtin">:inherit</span> outline-3 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  '(info-title-4 <span class="org-builtin">:inherit</span> outline-4 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  '(info-menu-header <span class="org-builtin">:inherit</span> outline-5 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  `(info-quoted-name <span class="org-builtin">:inherit</span> font-lock-constant-face)
  `(info-isolated-quote <span class="org-builtin">:inherit</span> info-quoted-name)
  `(info-isolated-backquote <span class="org-builtin">:inherit</span> info-quoted-name)
  `(info-glossary-word <span class="org-builtin">:foreground</span> ,(doom-color 'type 256)
                       <span class="org-builtin">:background</span> ,(doom-darken 'type 0.7)
                       <span class="org-builtin">:box</span> (<span class="org-builtin">:line-width</span> 1 <span class="org-builtin">:color</span> ,(doom-darken 'type 0.7) <span class="org-builtin">:style</span> nil)
                       <span class="org-builtin">:inherit</span> fixed-pitch)
  `(link-visited <span class="org-builtin">:foreground</span> ,(doom-color 'violet 256))
  `(info-double-quoted-name <span class="org-builtin">:inherit</span> font-lock-string-face)
  `(info-string <span class="org-builtin">:inherit</span> font-lock-string-face)
  `(info-header-node <span class="org-builtin">:height</span> 160
                     <span class="org-builtin">:inherit</span> info-node)
  `(info-header-xref <span class="org-builtin">:height</span> 160
                     <span class="org-builtin">:inherit</span> info-xref))
</pre>
</div>

<p>
There are two remaining configurations. The first one is to make the <code>Info-mode</code> buffer to match how it gets displayed on the editor. I will use <code>writeroom</code> to make the buffer centralized on the window, and will turn on <code>variable-pitch-mode</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 164: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-info-buffer-config-h</span> ()
  (<span class="org-keyword">setq</span> writeroom-width 75)
  (<span class="org-keyword">let</span> ((+zen-text-scale 0))
    (+zen/toggle))
  (variable-pitch-mode 1)
  (visual-line-mode 1))
</pre>
</div>

<p>
With the function that will configure my buffer in place, I need to hook it to the mode initialization:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 165: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">add-hook!</span> Info-mode #'my-info-buffer-config-h)
</pre>
</div>

<p>
The last configuration for the <code>Info-mode</code> is <b>where</b> its buffer gets displayed. For me, it should show up on the right side of my screen. I can achieve that with a popup rule for the buffer:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 166: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(set-popup-rule! <span class="org-string">"^\\*info\\*$"</span>
  <span class="org-builtin">:slot</span> 2   <span class="org-builtin">:vslot</span> -1     <span class="org-builtin">:side</span> 'right  <span class="org-builtin">:width</span> 85 <span class="org-builtin">:height</span> 0.4
  <span class="org-builtin">:select</span> t <span class="org-builtin">:modeline</span> nil <span class="org-builtin">:autosave</span> nil <span class="org-builtin">:ttl</span> 0    <span class="org-builtin">:quit</span> t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb903016" class="outline-4">
<h4 id="orgb903016"><span class="section-number-4">3.5.2</span> Help mode and Man mode</h4>
<div class="outline-text-4" id="text-3-5-2">
<p>
I want to give a similar treatment I did to the <code>Info-mode</code> to both these modes, and like the <code>Info-mode</code>, the first thing to do is to create the functions that will configure these modes:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 167: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-help-man-buffer-config-h</span> ()
  (<span class="org-keyword">setq</span> writeroom-width 75)
  (<span class="org-keyword">let</span> ((+zen-text-scale 0))
    (+zen/toggle))
  (visual-line-mode 1))
</pre>
</div>

<p>
And then, hook them up to their modes hooks:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 168: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">add-hook!</span> (help-mode
            helpful-mode
            Man-mode
            WoMan-mode)
           #'my-help-man-buffer-config-h)
</pre>
</div>

<p>
The last step on these configurations is to add a popup rule for each mode to make their buffers to open on the right side of the editor:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 169: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(set-popup-rule! <span class="org-string">"^\\*[Hh]elp"</span>
  <span class="org-builtin">:slot</span> 2   <span class="org-builtin">:vslot</span> -1     <span class="org-builtin">:side</span> 'right  <span class="org-builtin">:width</span> 85 <span class="org-builtin">:height</span> 0.4
  <span class="org-builtin">:select</span> t <span class="org-builtin">:modeline</span> nil <span class="org-builtin">:autosave</span> nil <span class="org-builtin">:ttl</span> 0    <span class="org-builtin">:quit</span> t)

(set-popup-rule! <span class="org-string">"^\\*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">Wo</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?Man "</span>
  <span class="org-builtin">:slot</span> 2   <span class="org-builtin">:vslot</span> -1     <span class="org-builtin">:side</span> 'right  <span class="org-builtin">:width</span> 88 <span class="org-builtin">:height</span> 0.4
  <span class="org-builtin">:select</span> t <span class="org-builtin">:modeline</span> nil <span class="org-builtin">:autosave</span> nil <span class="org-builtin">:ttl</span> 0     <span class="org-builtin">:quit</span> t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org875a464" class="outline-4">
<h4 id="org875a464"><span class="section-number-4">3.5.3</span> Rainbow mode</h4>
<div class="outline-text-4" id="text-3-5-3">
<p>
The Rainbow mode is a small visual helper to display colors on the buffer, whenever it finds a string that can be a color.
</p>

<p>
I already configured a key binding (<code>SPC t R</code>) to toggle this mode.
</p>

<p>
What I still need to do, is to make sure that I use a fixed font when displaying the color text, unfortunately, the <code>rainbow-mode</code> uses an anonymous face to display the colors, so the only way for me to customize it, is to override the <code>rainbow-colorize-match</code> with a function that add any property I want to the face (in this case, to inherit from the <code>fixed-pitch</code> face):
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 170: </span>$DOOMDIR/autoload/preferences.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-fontify-rainbow-colorize-match-a (color <span class="org-type">&amp;optional</span> match)
  <span class="org-doc">"Return a matched string propertized with a face whose background is COLOR.</span>

<span class="org-doc">This function computes the foreground using `</span><span class="org-doc"><span class="org-constant">rainbow-color-luminance</span></span><span class="org-doc">', and is</span>
<span class="org-doc">either white or black."</span>
  <span class="org-builtin">:override</span> 'rainbow-colorize-match
  (<span class="org-keyword">let</span> ((match (<span class="org-keyword">or</span> match 0)))
    (put-text-property
     (match-beginning match) (match-end match)
     'face `((<span class="org-builtin">:foreground</span> ,(<span class="org-keyword">if</span> (&gt; 0.5 (rainbow-x-color-luminance color))
                               <span class="org-string">"white"</span> <span class="org-string">"black"</span>))
             (<span class="org-builtin">:background</span> ,color)
             (<span class="org-builtin">:inherit</span> fixed-pitch)))))
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org9cb333f" class="outline-2">
<h2 id="org9cb333f"><span class="section-number-2">4</span> Writing&#xa0;&#xa0;&#xa0;<span class="tag"><span class="wip">wip</span></span></h2>
<div class="outline-text-2" id="text-4">
<p>
In my day-time job, my role, among other things, is to do mobile development for the Android platform. While Emacs is OK handling Java, Kotlin, and friends, compared to IDEs like IntelliJ and Android Studio, it lacks a substantial amount of features. The amount of configurations and adjustments I would need to do to get a distance resemblance of those IDEs is prohibitive. Because of this reason, one of my main usage for Emacs is writing and scripting.
</p>

<p>
I decided to use Org mode as my writing platform, and I'll detail in this section, how I configured Org mode to fit my writing workflow.
</p>

<div class="org-center">
<p>
◆
</p>
</div>

<p>
I come up with a directory infrastructure for my writings that will hold all type of text I need to produce, while keeping them well organized:
</p>


<figure id="orgcd43abb">
<object type="image/svg+xml" data="assets/org-dir-struct.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>

<figcaption><span class="figure-number">Figure 2: </span>My org directory structure</figcaption>
</figure>

<p>
Most of these directories are straightforward to understand their purpose, but I still want to go through them to document my need.
</p>

<dl class="org-dl">
<dt><code>.archives</code></dt><dd>Any Org task archived on my system will end up in this directory. After a while, this directory should be a shadow copy of the root <code>org</code> directory, but containing only files with archived tasks;</dd>
<dt><code>.attach</code></dt><dd>This is the Doom's directory to store attached files;</dd>
<dt><code>agenda</code></dt><dd>The root folder for task management:
<dl class="org-dl">
<dt><code>calendars</code></dt><dd>Here is where I will add the events for my calendars. Each calendar I have will have its own file here. These files are not intended to manage my calendars, and I will consider them as <i>read-only files</i>. Outside Emacs, I will have process running and synchronizing these files;</dd>
<dt><code>tasks</code></dt><dd>Directory to store Org files with tasks. The main file, which I will track on Org Agenda is the <code>todo.org</code>, but I have this extra file called <code>someday.org</code> as a dump for tasks I wish to accomplish but are not essentials;</dd>
<dt><code>contacts.org</code></dt><dd>The Org file used to record my contacts. I still need to find a good way to synchronize this file with my phone contacts, but this is out of the scope of this document;</dd>
<dt><code>habits.org</code></dt><dd>Once I'm ready to try tracking my habits, this is the file I should use;</dd>
</dl></dd>
<dt><code>documents</code></dt><dd>This is the dumping ground for any type of document (articles, design architecture, blog posts, wiki entries, etc.). Inside of it, I will have one directory per area (work, home, personal site, etc.);</dd>
<dt><code>journal</code></dt><dd>I need to have one work journal and one personal journal, but I still don't know how to do this separation effectively. For now, I will have all my journaling stored here;</dd>
<dt><code>notes</code></dt><dd>My curated notes. All files in this directory have no name (I use UUID as their name), and I can access their content by using the Zettelkasten method on my system;</dd>
<dt><code>presentations</code></dt><dd>The directory for my presentation projects using <code>reveal.js</code>;</dd>
</dl>
</div>

<div id="outline-container-orga169f46" class="outline-3">
<h3 id="orga169f46"><span class="section-number-3">4.1</span> Requirements</h3>
<div class="outline-text-3" id="text-4-1">
<p>
Different from the editor requirements on section <a href="#standard-requirements">2.1</a>, my writing requirements are more loosely defined, and one requirement might need multiple configurations while others might get configured on a single section. Nevertheless, I split my requirements into four distinct stories.
</p>
</div>

<div id="outline-container-org4ee82d0" class="outline-4">
<h4 id="org4ee82d0"><span class="section-number-4">4.1.1</span> Fonts</h4>
<div class="outline-text-4" id="text-4-1-1">
<p>
Fonts for writing must use variable pitch and follow the typography rules defined on section <a href="#prefs-typography">3.3.4</a>. Any reference to code or code elements must get the normal <i>coding</i> style with fixed pitch. Also, other than headlines, element should have variable size depending on their importance.
</p>
</div>
</div>

<div id="outline-container-org676dead" class="outline-4">
<h4 id="org676dead"><span class="section-number-4">4.1.2</span> Writing quality</h4>
<div class="outline-text-4" id="text-4-1-2">
<p>
Throughout the <i>writing sections</i> you'll see a common theme: I'm not a good writer. I sure do try my best, and use whatever tools are available to me, but I'm far from the person who sits down and put on paper what is in her head.
</p>

<p>
My writing quality requirement tries to specify the features that help me be <i>less bad</i> at writing.
</p>

<dl class="org-dl">
<dt>Spell checking</dt><dd>I need a good spell checking dictionary that offers English and Portuguese (my native language) support;</dd>
<dt>Grammar checking</dt><dd>The title says it all. I need something on the molds of <a href="https://www.grammarly.com/">Grammarly</a> or <a href="https://languagetool.org/">LanguageTool</a>. I would be fantastic to have such tool supporting Portuguese, but as far as I know, these tools only support English, so I would be OK if I get grammar check for English only;</dd>
<dt>Dictionary</dt><dd>I need a good words dictionary that support thesaurus, etymology, and translation between English and Portuguese;</dd>
<dt>Text linting</dt><dd>This is a tool closer to programming languages, but there are certain text lints that can help you write a better text. At a minimal, I want my text lint to support:
<ul class="org-ul">
<li>Insensible words;</li>
<li>Weasel words;</li>
</ul></dd>
<dt>Revision</dt><dd>I want to have some sort of tool that allows me to add comments on text files. I'll use this feature when I'm reviewing the text with a group of people and I want to add people's comments as annotations to the text;</dd>
</dl>
</div>
</div>

<div id="outline-container-org8c5e959" class="outline-4">
<h4 id="org8c5e959"><span class="section-number-4">4.1.3</span> Publishing</h4>
<div class="outline-text-4" id="text-4-1-3">
<p>
Publishing a text is not necessarily to send the manuscript to a printing shop to get back a book. In my editor's context, publishing can  encompass things like:
</p>

<ul class="org-ul">
<li>Posting on my blog (using <a href="https://gohugo.io/">Hugo</a> export);</li>
<li>Publishing the text into a wiki (which I have a requirement to support <a href="https://www.xwiki.org/xwiki/bin/view/Main/WebHome">XWiki</a> and <a href="http://www.confluense.com/">Confluense</a>);</li>
<li>Exporting the text to a book format (PDF and <a href="https://www.w3.org/AudioVideo/ebook/">ePub</a>);</li>
<li>Exporting the text to an article format (using <a href="https://www.latex-project.org/">LaTeX</a>);</li>
<li>Exporting the text as an HTML presentation (using reveal.js);</li>
<li>Sending an email with the text attached as a document (using any of the previous supported formats);</li>
</ul>

<p>
With the exception of the email attachment (which will have half of it here and the other half when I configure my email client), all the other publishing configuration will live in this writing section.
</p>
</div>
</div>

<div id="outline-container-org29efa7a" class="outline-4">
<h4 id="org29efa7a"><span class="section-number-4">4.1.4</span> Note taking</h4>
<div class="outline-text-4" id="text-4-1-4">
<p>
This requirement got enormous attention from me, when I realized I couldn't keep up with storing information about my daily life, plus work, plus hobby within my brain. My current preferred method to take notes is the Zettelkasten, and I want to implement a good workflow for it in my configuration.
</p>

<p>
Fleet notes should not take more than 2 seconds to take, and I will define a process for note review daily and weekly.
</p>
</div>
</div>
</div>

<div id="outline-container-orgd1fea31" class="outline-3">
<h3 id="orgd1fea31"><span class="section-number-3">4.2</span> Writing typography</h3>
<div class="outline-text-3" id="text-4-2">
<p>
Fortunately for me, <code>org-mode</code> and other writing major modes, derive from the built-in <code>outline-mode</code>. This allows me to configure the headline typography for <code>outline-mode</code> and have <code>org-mode</code> inheriting it.
</p>

<p>
To start, I will make sure the headlines of any mode derived from <code>outline-mode</code> gets the correct face configuration:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 171: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(my-typography-reset (<span class="org-keyword">cl-loop</span> for i from 1 to 8 collect (intern (format <span class="org-string">"outline-%d"</span> i))))
(custom-set-faces!
  `(outline-1 <span class="org-builtin">:inherit</span> my-headline-1 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  `(outline-2 <span class="org-builtin">:inherit</span> my-headline-2 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  `(outline-3 <span class="org-builtin">:inherit</span> my-headline-3 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  `(outline-4 <span class="org-builtin">:inherit</span> my-headline-4 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  `(outline-5 <span class="org-builtin">:inherit</span> my-headline-5 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  `(outline-6 <span class="org-builtin">:inherit</span> my-headline-6 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  `(outline-7 <span class="org-builtin">:inherit</span> my-headline-7 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  `(outline-8 <span class="org-builtin">:inherit</span> my-headline-8 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified))
</pre>
</div>

<p>
Then, I have to adjust the document title face, that by default, gets the same treatment as any document metadata:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 172: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(my-typography-reset 'org-document-title)
(custom-set-faces!
  '(org-document-title <span class="org-builtin">:inherit</span> my-document-title <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified))
</pre>
</div>

<p>
The next step to get Org to conform with my defined typography, is to make sure Emacs renders faces designated to display some sort of code information with a fixed pitch face:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 173: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(custom-set-faces!
  '((org-document-info
     org-document-info-keyword
     org-property-value
     org-drawer
     org-table
     org-block
     org-verbatim
     org-code
     org-date
     org-block-begin-line)
    <span class="org-builtin">:inherit</span> fixed-pitch))
</pre>
</div>

<p>
The rest of the face adjustments are my personal preferences.
</p>

<p>
I want the drawers from Org to use the same color as code comments:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 174: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(custom-set-faces!
  `(org-drawer <span class="org-builtin">:foreground</span> ,(doom-color 'doc-comments)))
</pre>
</div>

<p>
On the normalization front, I like to have special keywords to look like comments, formulas to use the same face as tables, and indentation to use monospaced font and also to stay hidden:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 175: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(custom-set-faces!
  '(org-special-keyword <span class="org-builtin">:inherit</span> font-lock-comment-face)
  '(org-formula <span class="org-builtin">:inherit</span> org-table)
'(org-indent <span class="org-builtin">:inherit</span> (org-hide fixed-pitch)))
</pre>
</div>

<p>
I like to have secondary information (anything that is <b>not</b> the main text) using a smaller face:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 176: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(custom-set-faces!
  '(org-meta-line <span class="org-builtin">:height</span> 0.8 <span class="org-builtin">:inherit</span> font-lock-comment-face)
  `(org-drawer <span class="org-builtin">:foreground</span> ,(doom-color 'doc-comments))
  '(org-block-begin-line <span class="org-builtin">:height</span> 0.8)
  '(org-block-end-line <span class="org-builtin">:inherit</span> org-block-begin-line)
  '(org-tag <span class="org-builtin">:height</span> 150))
</pre>
</div>

<p>
The last configuration related to fonts, is how I like to render certain document elements. Instead of showing the standard Org markup, I like to use Unicode characters instead. The table <a href="#org7155d89">3</a> shows the mapping between Org elements and the respective Unicode character I want to use:
</p>

<table id="org7155d89">
<caption class="t-bottom"><span class="table-number">Table 3:</span> Org elements to unicode characters</caption>

<colgroup>
<col  class="org-left">

<col  class="org-center">

<col  class="org-center">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Org element</th>
<th scope="col" class="org-center">Org symbol</th>
<th scope="col" class="org-center">Unicode</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Unmarked checkbox</td>
<td class="org-center"><code>- [ ]</code></td>
<td class="org-center">☐</td>
</tr>

<tr>
<td class="org-left">In-progress checkbox</td>
<td class="org-center"><code>- [-]</code></td>
<td class="org-center">⊡</td>
</tr>

<tr>
<td class="org-left">Finished checkbox</td>
<td class="org-center"><code>- [X]</code></td>
<td class="org-center">☒</td>
</tr>

<tr>
<td class="org-left">List item bullet 1</td>
<td class="org-center"><code>-</code></td>
<td class="org-center">•</td>
</tr>

<tr>
<td class="org-left">List item bullet 2</td>
<td class="org-center"><code>+</code></td>
<td class="org-center">‣</td>
</tr>

<tr>
<td class="org-left">List item bullet 3</td>
<td class="org-center"><code>*</code></td>
<td class="org-center">⁍</td>
</tr>
</tbody>
</table>

<p>
Unfortunately, I can only define new <code>font-lock-keywords</code> for a major mode, after loading it for the first time, so I will effectively add them when I'm configuring Org on the next section. But here, I want to define a constant holding the list of new <code>font-lock-keywords</code> that I can use later during the Org configuration. Another advantage to have such constant, is to allow me to reuse the same configuration on other derived modes (e.g. <code>org-journal-mode</code>):
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 177: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-org-font-lock-beautify-keywords</span>
  `((<span class="org-string">"^#\\+TITLE: *"</span>
     (0 (<span class="org-keyword">prog1</span> nil (put-text-property (match-beginning 0) (match-end 0) 'invisible t))))
    (<span class="org-string">"^\\*+ "</span>
     (0 (<span class="org-keyword">prog1</span> nil (put-text-property (match-beginning 0) (match-end 0) 'invisible t))))
    (<span class="org-string">"^ *</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[-+*] \\[ \\]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"> "</span>
     (0 (<span class="org-keyword">prog1</span> nil (compose-region (match-beginning 1) (match-end 1) <span class="org-string">"&#9744; "</span>))))
    (<span class="org-string">"^ *</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[-+*] \\[</span><span class="org-string"><span class="org-constant">-\\</span></span><span class="org-string">]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"> "</span>
     (0 (<span class="org-keyword">prog1</span> nil (compose-region (match-beginning 1) (match-end 1) <span class="org-string">"&#8865; "</span>))))
    (<span class="org-string">"^ *</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[-+*] \\[[xX]\\]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"> "</span>
     (0 (<span class="org-keyword">prog1</span> nil (compose-region (match-beginning 1) (match-end 1) <span class="org-string">"&#9746; "</span>))))
    (<span class="org-string">"^ *</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">-</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"> </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">\\[]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\[[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string"> xX-]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span>
     (0 (<span class="org-keyword">prog1</span> nil (compose-region (match-beginning 1) (match-end 1) <span class="org-string">"&#8226;"</span>))))
    (<span class="org-string">"^ *</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">\\+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"> </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">\\[]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\[[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string"> xX-]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span>
     (0 (<span class="org-keyword">prog1</span> nil (compose-region (match-beginning 1) (match-end 1) <span class="org-string">"&#8227;"</span>))))
    (<span class="org-string">"^ *</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">\\*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"> </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">\\[]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\[[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string"> xX-]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span>
     (0 (<span class="org-keyword">prog1</span> nil (compose-region (match-beginning 1) (match-end 1) <span class="org-string">"&#8269;"</span>)))))
  <span class="org-doc">"This is a list of text elements fontification for Org. It</span>
<span class="org-doc">beautifies title, check-boxes, and list bullets."</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org21be93a" class="outline-3">
<h3 id="org21be93a"><span class="section-number-3">4.3</span> <span class="todo TODO">TODO</span> Common Org configurations</h3>
<div class="outline-text-3" id="text-4-3">
<p>
But before we dive in each one of these usages, there are some things I like to configure on Org that will affect all the other areas, so I will start with them here.
</p>

<p>
The first thing I like to do, is to create some variables pointing to key locations and files on my directory structure:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 178: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> writeroom-mode-line       t
      +zen-window-divider-size  2
      +zen-text-scale           1)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 179: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-directory (expand-file-name <span class="org-string">"~/depot/Dropbox/org"</span>))

(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-journal-directory</span> (expand-file-name <span class="org-string">"journal"</span> org-directory)
  <span class="org-doc">"Path to directory holding all journal files"</span>)

(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-docs-directory</span> (expand-file-name <span class="org-string">"documents"</span> org-directory)
  <span class="org-doc">"Path to directory used to store non specific documents."</span>)

(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-agenda-directory</span> (expand-file-name <span class="org-string">"agenda"</span> org-directory)
  <span class="org-doc">"Path to the base directory for the agenda system."</span>)

(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-calendars-directory</span> (expand-file-name <span class="org-string">"calendars"</span> my-agenda-directory)
  <span class="org-doc">"Path to directory used to store calendar files."</span>)

(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-tasks-directory</span> (expand-file-name <span class="org-string">"tasks"</span> my-agenda-directory)
  <span class="org-doc">"Path to directory used to store task files."</span>)

(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-notes-directory</span> (expand-file-name <span class="org-string">"notes"</span> org-directory)
  <span class="org-doc">"Path to directory used to store note files."</span>)

(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-presentations-directory</span> (expand-file-name <span class="org-string">"presentations"</span> org-directory)
  <span class="org-doc">"Path to directory used to store presentation files."</span>)
</pre>
</div>

<p>
Notice that we crated these variables before loading anything related to Org. The <code>org-directory</code> variable needs to have the correct value when Org mode is initializing, and the others are just grouped close to the main Org one.
</p>

<p>
Now we can wait Org to load to  continue our configuration:
</p>



<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 180: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org
</pre>
</div>

<p>
I like to <i>beautify</i> Org buffers with some tweaks. First I want header tags to be close to the header text:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 181: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-tags-column 0)
</pre>
</div>

<p>
Then I like to have some indentation indicating which header level I am:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 182: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-startup-indented nil)
</pre>
</div>

<p>
I also like to display text formatting as close to WYSIWYG as I can have. This means that if I mark a word as italic, instead of showing <code>/word/</code>, I want to display <i>word</i>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 183: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-hide-emphasis-markers t
      org-pretty-entities t)
</pre>
</div>

<p>
When Org collapse a header, it displays an ellipsis right after the header text. Although this is not "bad", I like to have a better indication of a collapsed header:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 184: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-ellipsis <span class="org-string">" &#61703; "</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 185: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-adapt-indentation nil)
</pre>
</div>


<p>
In some documents, I need to write math formulas and Org can render them pretty well using LaTeX, but I like to adjust their render to use SVG instead of image, and use a transparent background to match the overall theme of Emacs
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 186: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">plist-put!</span> org-format-latex-options
            <span class="org-builtin">:scale</span> 1.55
            <span class="org-builtin">:foreground</span> <span class="org-string">"White"</span>
            <span class="org-builtin">:background</span> <span class="org-string">"Transparent"</span>)

(<span class="org-keyword">setq</span> org-preview-latex-default-process 'dvisvgm
      org-startup-with-latex-preview t)

(<span class="org-keyword">pushnew!</span> org-link-abbrev-alist
          '(<span class="org-string">"sim"</span>   . <span class="org-string">"https://sim.amazon.com/issues/%s"</span>)
          '(<span class="org-string">"tt"</span>    . <span class="org-string">"https://t.corp.amazon.com/%s"</span>)
          '(<span class="org-string">"pkg"</span>   . <span class="org-string">"https://code.amazon.com/packages/%s"</span>)
          '(<span class="org-string">"ptool"</span> . <span class="org-string">"https://phonetool.amazon.com/users/%s"</span>)
          '(<span class="org-string">"crux"</span>  . <span class="org-string">"https://code.amazon.com/reviews/%s"</span>)
          '(<span class="org-string">"vs"</span>    . <span class="org-string">"https://code.amazon.com/version-sets/%s"</span>)
          '(<span class="org-string">"coe"</span>   . <span class="org-string">"https://www.coe.a2z.com/coe/%s/content"</span>)
          '(<span class="org-string">"xwiki"</span> . <span class="org-string">"https://w.amazon.com/bin/view/%(+org-xwiki--translate-path)"</span>))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 187: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(font-lock-add-keywords 'org-mode my-org-font-lock-beautify-keywords)
</pre>
</div>

<p>
Besides <i>beautification</i>, there are some configurations I like to have as a default behavior. The first one is how I can edit a code block on a separate buffer. By default, Org will edit it using <code>switch-to-buffer-other-window</code>. While this seams to be a popular choice, I just can't stand the two buffers together when I can't touch on the Org file while I have the source block opened.
</p>

<p>
I will use the <code>'current-window</code> option to have the source block behaving like a normal buffer:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 188: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-src-window-setup 'split-window-right)
</pre>
</div>

<p>
After all these tweaks, we can close our parenthesis:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 189: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">) <span class="org-comment-delimiter">;; </span><span class="org-comment">after! org</span>
</pre>
</div>


<p>
Even though our configuration can render math formulas nicely, it's still awkward to edit them once you write them. To help us with this task, I'll install a plugin called <a href="https://github.com/io12/org-fragtog"><code>org-fragtog</code></a>. This plugin will show the math formula with the LaTeX syntax if the cursor is inside the formula area, and will render the formula when the cursor leaves it.
</p>

<p>
First we add the plugin on our <code>packages.el</code> file:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 190: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> org-fragtog)
</pre>
</div>

<p>
Then, we use <code>use-package!</code> to defer its loading (we will load it manually later):
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 191: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> org-fragtog <span class="org-builtin">:defer</span> t)
</pre>
</div>

<p>
Another nice plugin to have is the <a href="https://github.com/casouri/valign"><code>valign</code></a> plugin. It will align your Org tables nicely, even when you have formulas and images on them.
</p>

<p>
As with the <code>org-fragtog</code>, let's first add it to our <code>packages.el</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 192: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> valign)
</pre>
</div>

<p>
Then, we use <code>use-package!</code> to defer its loading as we did with <code>org-fragtog</code>, but for this plugin, we want to set the <code>valign-fancy-bar</code> to <code>t</code>, to have even nicer renders of tables:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 193: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> valign
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:init</span> (<span class="org-keyword">setq</span> valign-fancy-bar t))
</pre>
</div>

<p>
So far, with our configuration, we will use the entire size of the frame as our text canvas before wrapping it. This is far from ideal when you're reading a text (specially for me). I want to have narrower text to reduce the amount of focus I need to read a line.
</p>

<p>
We could configure the left and right gutter to achieve a narrower text area, or we could use another plugin for it. I tried both methods, and find out that the plugin has a better response and is easier to install and maintain.
</p>

<p>
Let's add it to our <code>packages.el</code>:
</p>

<p>
Defer its loading on our configuration, and as with the <code>valign</code> package, we will use this time to also set the maximum width for our text:
</p>

<p>
Now that I have a narrower width, the text will wrap more often, but the normal navigation keys will make the cursor jump from one line to the other, even if I have other <i>visual</i> lines displayed.
</p>

<p>
To fix this behavior, we just need to re-bind some movement keys to the <i>visual</i> version of their original command, for instance, while we have <code>j</code> bound to <code>evil-next-line</code>, in <code>org-moode</code>, we want it bound to <code>evil-next-visual-line</code>:
</p>

<p>
While I'm sure I'm missing a command or two, these will get me started.
</p>

<p>
I also need to adjust the window navigation keys that clash with default Org bindings:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 194: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:after</span> org <span class="org-builtin">:map</span> org-mode-map
      <span class="org-builtin">:localleader</span>
      <span class="org-builtin">:desc</span> <span class="org-string">"org-reveal"</span> <span class="org-builtin">:n</span> <span class="org-string">"R"</span> #'org-reveal
      <span class="org-builtin">:desc</span> <span class="org-string">"Copy visible"</span> <span class="org-builtin">:v</span> <span class="org-string">"y"</span> #'org-copy-visible)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 195: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:after</span> org <span class="org-builtin">:map</span> org-mode-map
      <span class="org-builtin">:localleader</span> <span class="org-builtin">:prefix</span> (<span class="org-string">"s"</span> . <span class="org-string">"tree/subtree"</span>)
      <span class="org-builtin">:desc</span> <span class="org-string">"Clone subtree"</span> <span class="org-builtin">:n</span> <span class="org-string">"c"</span> #'org-clone-subtree-with-time-shift
      <span class="org-builtin">:desc</span> <span class="org-string">"Copy special"</span> <span class="org-builtin">:n</span> <span class="org-string">"y"</span> #'org-copy-special
      <span class="org-builtin">:desc</span> <span class="org-string">"Cut special"</span> <span class="org-builtin">:n</span> <span class="org-string">"d"</span> #'org-cut-special
      <span class="org-builtin">:desc</span> <span class="org-string">"Cut special"</span> <span class="org-builtin">:n</span> <span class="org-string">"x"</span> #'org-cut-special)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 196: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:after</span> org <span class="org-builtin">:map</span> org-mode-map
      <span class="org-builtin">:prefix</span> (<span class="org-string">"g"</span> . <span class="org-string">"action"</span>)
      <span class="org-builtin">:desc</span> <span class="org-string">"org-ctrl-c-ctrl-c"</span> <span class="org-builtin">:n</span> [return] #'org-ctrl-c-ctrl-c
      <span class="org-builtin">:desc</span> <span class="org-string">"org-ctrl-c-ctrl-c"</span> <span class="org-builtin">:n</span> <span class="org-string">"RET"</span> #'org-ctrl-c-ctrl-c)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 197: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:after</span> org <span class="org-builtin">:map</span> org-mode-map
      <span class="org-builtin">:n</span> <span class="org-string">"s-j"</span> #'org-next-visible-heading
      <span class="org-builtin">:n</span> <span class="org-string">"s-k"</span> #'org-previous-visible-heading
      <span class="org-builtin">:n</span> <span class="org-string">"s-C-h"</span> #'org-up-element
      <span class="org-builtin">:n</span> <span class="org-string">"s-C-j"</span> #'org-forward-heading-same-level
      <span class="org-builtin">:n</span> <span class="org-string">"s-C-k"</span> #'org-backward-heading-same-level
      <span class="org-builtin">:n</span> <span class="org-string">"C-j"</span> #'evil-window-down
      <span class="org-builtin">:n</span> <span class="org-string">"C-k"</span> #'evil-window-up)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 198: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:after</span> org <span class="org-builtin">:map</span> org-mode-map
      <span class="org-builtin">:g</span> <span class="org-string">"s-RET"</span>     #'org-edit-special
      <span class="org-builtin">:g</span> [s-return]  #'org-edit-special)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 199: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:after</span> org <span class="org-builtin">:map</span> org-src-mode-map
      <span class="org-builtin">:in</span> [s-escape] #'org-edit-src-abort
      <span class="org-builtin">:gin</span> <span class="org-string">"s-RET"</span>     #'org-edit-src-exit
      <span class="org-builtin">:gin</span> [s-return]  #'org-edit-src-exit)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 200: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-link-snippet-in-place</span> ()
  (<span class="org-keyword">interactive</span>)
  (yas-expand-snippet (yas-lookup-snippet <span class="org-string">"Link"</span>)
                      (region-beginning)
                      (region-end)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 201: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:after</span> org <span class="org-builtin">:map</span> org-mode-map
      <span class="org-builtin">:v</span> <span class="org-string">"s-k"</span> #'my-link-snippet-in-place)
</pre>
</div>

<p>
At this point we can tight up everything and set up our buffer when we open an org file.
</p>

<p>
<a href="https://github.com/awth13/org-appear">https://github.com/awth13/org-appear</a>
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 202: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> org-appear
  <span class="org-builtin">:recipe</span> (<span class="org-builtin">:host</span> github
           <span class="org-builtin">:repo</span> <span class="org-string">"awth13/org-appear"</span>))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 203: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> org-appear
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> org-appear-autolinks t
        org-appear-autosubmarkers t))
</pre>
</div>

<p>
To separate my configuration from initialization logic, let's create another autoload function, but this time on a file used for <i>Org things</i> (<code>autoload/org.el</code>):
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 204: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-org-buffer-config-h</span> ()
  <span class="org-doc">"Configure all aspects of an Org buffer right before we display it to the user."</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Enable minor modes</span>
  (<span class="org-keyword">when</span> window-system
    (+zen/toggle)
    (valign-mode 1)
    (variable-pitch-mode 1)

    (<span class="org-keyword">add-hook!</span> evil-insert-state-entry <span class="org-builtin">:local</span>
      (org-fragtog-mode 1)
      (org-appear-mode 1))
    (<span class="org-keyword">add-hook!</span> evil-insert-state-exit <span class="org-builtin">:local</span>
      (org-fragtog-mode -1)
      (org-appear-mode -1)))
  (visual-line-mode 1)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Call org configuration functions</span>
  (org-display-inline-images)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Ignore flycheck errors on source blocks</span>
  (my-noflycheck-h)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Force a buffer refresh to guarantee all setup is in use</span>
  (set-window-buffer nil (current-buffer)))
</pre>
</div>

<p>
With this function in place, we can <i>hook</i> it to our Org major mode:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 205: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(add-hook 'org-mode-hook #'my-org-buffer-config-h)
</pre>
</div>

<ul class="org-ul">
<li><a href="https://github.com/Townk/org-ol-tree">https://github.com/Townk/org-ol-tree</a></li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 206: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">if</span> (getenv <span class="org-string">"GITHUB_WORKFLOW"</span>)
    (<span class="org-keyword">package!</span> org-ol-tree
      <span class="org-builtin">:recipe</span> (<span class="org-builtin">:host</span> github
               <span class="org-builtin">:repo</span> <span class="org-string">"Townk/org-ol-tree"</span>))
  (<span class="org-keyword">package!</span> org-ol-tree
    <span class="org-builtin">:recipe</span> (<span class="org-builtin">:local-repo</span> <span class="org-string">"~/workplace/personal/emacs/org-ol-tree"</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 207: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> org-ol-tree
  <span class="org-builtin">:commands</span> org-ol-tree
  <span class="org-builtin">:init</span>
  (map! <span class="org-builtin">:map</span> org-mode-map
        <span class="org-builtin">:localleader</span> <span class="org-builtin">:prefix</span> (<span class="org-string">"g"</span> . <span class="org-string">"goto"</span>)
        <span class="org-builtin">:desc</span> <span class="org-string">"Open outline"</span>  <span class="org-string">"o"</span> #'org-ol-tree)

  (<span class="org-keyword">setq</span> org-ol-tree-ui-window-header-format
        '((<span class="org-builtin">:eval</span> (concat <span class="org-string">" &#9776; "</span> (propertize <span class="org-string">"Outline"</span> 'face '(<span class="org-builtin">:inherit</span> 'my-default-ui <span class="org-builtin">:height</span> 0.8)))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdb58c1a" class="outline-3">
<h3 id="orgdb58c1a"><span class="section-number-3">4.4</span> <span class="todo TODO">TODO</span> Prose writing</h3>
<div class="outline-text-3" id="text-4-4">
<p>
I don't like to write. After reading this page or any other text I published you might think this is a lie, but it's not. I say way more than I need at any given moment. Suffice to say that this takes a big chunk of my energy, and on top of that, I'm not good at it. This means that for my crazy brain, there is not much reward when I write, and in some times, there is actually anxiety and discomfort.
</p>

<p>
With that out of the way, I need to acknowledge that, currently in my career, there is no way I can get away with <i>not writing</i>. There are too much design, architecture, plans, and projects involved on my day-to-day work, that my team and I need some form of record of our decisions. And if writing is inevitable, I should, at least, try to make it less painful.
</p>

<p>
For me, this means I should have a tool that offers me the power required to do any kind of writing, but in the same time, makes my life easier when doing the <i>writing thing</i>.
</p>

<p>
Emacs and Org Mode fulfill the <i>power</i> part of my goal, and this configuration will try to tackle the second.
</p>

<p>
Let's look into my list of requirements for writing:
</p>

<dl class="org-dl">
<dt>File templates</dt><dd>My setup should have a set of file templates that would help me start writing something faster. At any time while using Emacs, I can start a new document and select one of these templates, and Emacs will create the file on the right location, using the selected template;</dd>
<dt>No hard line wrap</dt><dd>While I can't stand soft-wraps on code, I'm getting used to it when I'm writing text, specially now that I can navigate using <i>visual lines</i> on Org Mode. So, this requirement is to make sure I use soft wraps while editing an Org file;</dd>
<dt>Inline images</dt><dd>If I add an image to a text, I want the image to show up right away. Also, if I open a file containing an image, Emacs should display the image automatically. I also want to auto-split the image into chunks so when navigate the text with the cursor, the screen does not jump over the image.</dd>
<dt>Inline formulas</dt><dd>As with images, I want to render math formulas automatically;</dd>
<dt>Formatted tables</dt><dd>Tables on my Org files should stay aligned all the time, and render with proper borders;</dd>
<dt>Focus writing</dt><dd>When I need to dive deep into creating a document, it's useful to remove distractions from my writing environment. Besides getting rid of UI elements, I would like to have the same <i>Focus Mode</i> behavior from <a href="https://ia.net/writer">iA Writer</a>;</dd>
<dt>Snippets</dt><dd>I like to have a snippet system to help me with boilerplate writing for Org;</dd>
</dl>

<p>
Although we already covered most of this list of the previous section, we still need to configure <i>File templates,</i> some personal <i>Snippets</i>, and <i>Focus Writing</i>, so let's get to it.
</p>
</div>

<div id="outline-container-org410360a" class="outline-4">
<h4 id="org410360a"><span class="section-number-4">4.4.1</span> Dictionary and writing helpers</h4>
<div class="outline-text-4" id="text-4-4-1">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 208: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> writegood-mode <span class="org-builtin">:disable</span> t)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 209: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(custom-set-faces!
  `(langtool-errline <span class="org-builtin">:background</span> <span class="org-string">"#372C34"</span>
                     <span class="org-builtin">:underline</span> (<span class="org-builtin">:style</span> wave <span class="org-builtin">:color</span> <span class="org-string">"red"</span>)))

(<span class="org-keyword">after!</span> langtool
  (<span class="org-keyword">setq</span> langtool-disabled-rules '(<span class="org-string">"WHITESPACE_RULE"</span>
                                  <span class="org-string">"EN_UNPAIRED_BRACKETS"</span>
                                  <span class="org-string">"COMMA_PARENTHESIS_WHITESPACE"</span>
                                  <span class="org-string">"EN_QUOTES"</span>
                                  <span class="org-string">"MORFOLOGIK_RULE_EN_US"</span>))

  (<span class="org-keyword">setq</span> langtool-http-server-host <span class="org-string">"localhost"</span>
        langtool-http-server-port 8010))
</pre>
</div>

<ul class="org-ul">
<li><a href="https://github.com/tecosaur/lexic">https://github.com/tecosaur/lexic</a></li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 210: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> lexic
  <span class="org-builtin">:recipe</span> (<span class="org-builtin">:host</span> github
           <span class="org-builtin">:repo</span> <span class="org-string">"tecosaur/lexic"</span>))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 211: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> lexic
  <span class="org-builtin">:commands</span> lexic-search lexic-list-dictionary
  <span class="org-builtin">:init</span>
  (set-popup-rule! <span class="org-string">"^\\*lexic\\*$"</span>
    <span class="org-builtin">:slot</span> 2   <span class="org-builtin">:vslot</span> -1     <span class="org-builtin">:side</span> 'right  <span class="org-builtin">:width</span> 100 <span class="org-builtin">:height</span> 0.4
    <span class="org-builtin">:select</span> t <span class="org-builtin">:modeline</span> nil <span class="org-builtin">:autosave</span> nil <span class="org-builtin">:ttl</span> 0     <span class="org-builtin">:quit</span> t)

  <span class="org-builtin">:config</span>
  (cl-delete-if (<span class="org-keyword">lambda</span> (spec)
                  (equal (car-safe spec) <span class="org-string">"Online Etymology Dictionary"</span>))
                lexic-dictionary-specs)

  (<span class="org-keyword">pushnew!</span> lexic-dictionary-specs
            '(<span class="org-string">"GNU Collaborative International Dictionary of English"</span>
              <span class="org-builtin">:short</span> <span class="org-string">"Meaning"</span>
              <span class="org-builtin">:formatter</span> lexic-format-webster
              <span class="org-builtin">:priority</span> 1)
            '(<span class="org-string">"English - Portuguese"</span>
              <span class="org-builtin">:short</span> <span class="org-string">"Portuguese"</span>
              <span class="org-builtin">:formatter</span> lexic-format-online-etym
              <span class="org-builtin">:priority</span> 2)
            '(<span class="org-string">"Online Etymology Dictionary"</span>
              <span class="org-builtin">:short</span> <span class="org-string">"Origin"</span>
              <span class="org-builtin">:formatter</span> lexic-format-online-etym
              <span class="org-builtin">:priority</span> 4))

  (map! <span class="org-builtin">:map</span> lexic-mode-map
        <span class="org-builtin">:n</span> <span class="org-string">"q"</span> #'lexic-return-from-lexic
        <span class="org-builtin">:nv</span> <span class="org-string">"RET"</span> #'lexic-search-word-at-point
        <span class="org-builtin">:n</span> <span class="org-string">"a"</span> #'outline-show-all
        <span class="org-builtin">:n</span> <span class="org-string">"o"</span> #'lexic-toggle-entry
        <span class="org-builtin">:n</span> <span class="org-string">"n"</span> #'lexic-next-entry
        <span class="org-builtin">:n</span> <span class="org-string">"N"</span> (<span class="org-keyword">cmd!</span> (lexic-next-entry t))
        <span class="org-builtin">:n</span> <span class="org-string">"p"</span> #'lexic-previous-entry
        <span class="org-builtin">:n</span> <span class="org-string">"P"</span> (<span class="org-keyword">cmd!</span> (lexic-previous-entry t))
        <span class="org-builtin">:n</span> <span class="org-string">"E"</span> (<span class="org-keyword">cmd!</span> (lexic-return-from-lexic) <span class="org-comment-delimiter">; </span><span class="org-comment">expand</span>
                     (switch-to-buffer (lexic-get-buffer)))
        <span class="org-builtin">:n</span> <span class="org-string">"M"</span> (<span class="org-keyword">cmd!</span> (lexic-return-from-lexic) <span class="org-comment-delimiter">; </span><span class="org-comment">minimise</span>
                     (lexic-goto-lexic))
        <span class="org-builtin">:n</span> <span class="org-string">"C-p"</span> #'lexic-search-history-backwards
        <span class="org-builtin">:n</span> <span class="org-string">"C-n"</span> #'lexic-search-history-forwards
        <span class="org-builtin">:n</span> <span class="org-string">"/"</span> (<span class="org-keyword">cmd!</span> (call-interactively #'lexic-search))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 212: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-lexic-buffer-config-h</span> ()
  (<span class="org-keyword">setq</span> writeroom-width 75)
  (<span class="org-keyword">let</span> ((+zen-text-scale 0))
    (+zen/toggle)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 213: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(add-hook 'lexic-mode-hook #'my-lexic-buffer-config-h)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 214: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-dictionary-definition-lexic-a (identifier <span class="org-type">&amp;optional</span> _)
  <span class="org-doc">"Look up the definition of the word at point (or selection) using `</span><span class="org-doc"><span class="org-constant">lexic-search</span></span><span class="org-doc">'."</span>
  <span class="org-builtin">:override</span> #'+lookup/dictionary-definition
  (<span class="org-keyword">interactive</span>
   (list (<span class="org-keyword">or</span> (doom-thing-at-point-or-region 'word)
             (read-string <span class="org-string">"Look up in dictionary: "</span>))
         current-prefix-arg))
  (lexic-search identifier nil nil t))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 215: </span>Commands to install custom aspell dictionary</label><pre class="src src-shell"><span class="org-builtin">cd</span> $<span class="org-variable-name">TMPDIR</span>
curl -o <span class="org-string">"aspell6-en-custom.tar.bz2"</span> <span class="org-string">'http://app.aspell.net/create?max_size=95&amp;spelling=GBs&amp;spelling=AU&amp;max_variant=0&amp;diacritic=keep&amp;special=hacker&amp;special=roman-numerals&amp;encoding=utf-8&amp;format=inline&amp;download=aspell'</span>
tar -xjf <span class="org-string">"aspell6-en-custom.tar.bz2"</span>
<span class="org-builtin">cd</span> aspell6-en-custom
./configure &amp;&amp; make &amp;&amp; sudo make install
<span class="org-builtin">cd</span> ..
rm -rf aspell6-en-custom*
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 216: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-aspell-local-data-dir</span> (expand-file-name <span class="org-string">"~/.local/share/aspell"</span>)
  <span class="org-doc">"Directory of Aspell dictionaries."</span>)

(<span class="org-keyword">unless</span> (file-exists-p my-aspell-local-data-dir)
  (mkdir my-aspell-local-data-dir t))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 217: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-aspell--personal-dictionary</span> (expand-file-name <span class="org-string">"personal.en.pws"</span> my-aspell-local-data-dir)
  <span class="org-doc">"File path for my personal word dictionaries."</span>)

(<span class="org-keyword">when</span> (not (file-exists-p my-aspell--personal-dictionary))
  (append-to-file <span class="org-string">"personal_ws-1.1 en 0 utf-8"</span> nil my-aspell--personal-dictionary))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 218: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-aspell-cmd-flags</span> (<span class="org-type">&amp;optional</span> camel-case <span class="org-type">&amp;rest</span> extra-args)
  <span class="org-doc">"Return the list of arguments Emacs should use to run aspell.</span>

<span class="org-doc">You can use this list of arguments directly as the value of `</span><span class="org-doc"><span class="org-constant">ispell-extra-args</span></span><span class="org-doc">'.</span>
<span class="org-doc">If CAMEL-CASE is a non-nil value, the list of arguments will include the</span>
<span class="org-doc">\"--camel-case\" option.</span>

<span class="org-doc">If EXTRA-ARGS is not nil, this function will append its value to the result."</span>
  (append '(<span class="org-string">"--sug-mode=ultra"</span>) extra-args (<span class="org-keyword">when</span> camel-case '(<span class="org-string">"--camel-case"</span>))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 219: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> ispell
  (<span class="org-keyword">setq</span> ispell-personal-dictionary my-aspell--personal-dictionary)
  (<span class="org-keyword">setq</span> ispell-really-aspell t)
  (<span class="org-keyword">setq</span> ispell-extra-args (my-aspell-cmd-flags t)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 220: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-spell-fu-find-urls</span> (point-start point-end)
  (<span class="org-keyword">let</span> ((url-ranges (list)))
    (<span class="org-keyword">save-match-data</span>
      (<span class="org-keyword">save-excursion</span>
        (goto-char point-start)
        (<span class="org-keyword">while</span> (re-search-forward browse-url-button-regexp point-end t)
          (<span class="org-keyword">push</span> (cons (match-beginning 0) (match-end 0)) url-ranges))
        url-ranges))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 221: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-spell-fu-check-range</span> (point-start point-end)
  <span class="org-doc">"Check spelling for POINT-START &amp; POINT-END ignoring urls."</span>
  (spell-fu--remove-overlays point-start point-end)
  (<span class="org-keyword">with-syntax-table</span> spell-fu-syntax-table
    (<span class="org-keyword">save-match-data</span>
      (<span class="org-keyword">save-excursion</span>
        (goto-char point-start)
        (<span class="org-keyword">while</span> (re-search-forward spell-fu-word-regexp point-end t)
          (<span class="org-keyword">let</span> ((url-ranges (my-spell-fu-find-urls point-start point-end))
                (word-start (match-beginning 0))
                (word-end (match-end 0)))
            (<span class="org-keyword">unless</span> (seq-some (<span class="org-keyword">lambda</span> (range)
                                (<span class="org-keyword">or</span> (<span class="org-keyword">and</span> (&gt; word-start (car range))
                                         (&lt; word-start (cdr range)))
                                    (<span class="org-keyword">and</span> (&gt; word-end (car range))
                                         (&lt; word-end (cdr range)))))
                              url-ranges)
              (<span class="org-keyword">when</span> (spell-fu--check-faces-at-point
                     word-start
                     spell-fu-faces-include
                     spell-fu-faces-exclude)
                (spell-fu-check-word word-start word-end (match-string-no-properties 0))))))))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 222: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> spell-fu
  (<span class="org-keyword">setq</span> spell-fu-check-range 'my-spell-fu-check-range))
</pre>
</div>

<p>
Rules:
</p>
<ul class="org-ul">
<li><a href="https://github.com/textlint-rule/textlint-rule-no-start-duplicated-conjunction">https://github.com/textlint-rule/textlint-rule-no-start-duplicated-conjunction</a></li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 223: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> flycheck
  (<span class="org-keyword">setq</span> flycheck-textlint-config <span class="org-string">"~/.config/textlint/config.json"</span>))
</pre>
</div>

<ul class="org-ul">
<li><a href="https://emacs.stackexchange.com/questions/48587/have-flycheck-skip-certain-regions">https://emacs.stackexchange.com/questions/48587/have-flycheck-skip-certain-regions</a></li>
<li><a href="https://emacs.stackexchange.com/questions/47878/how-can-i-disable-a-specific-lint-error-for-emacs-lisp-using-flycheck">https://emacs.stackexchange.com/questions/47878/how-can-i-disable-a-specific-lint-error-for-emacs-lisp-using-flycheck</a></li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 224: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">my-noflycheck-region-alist</span>
  '((org-mode (<span class="org-string">"^[ \\t]*?#\\+begin_</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">src</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">quote</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span> . <span class="org-string">"^[ \\t]*?#\\+end_</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">src</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">quote</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span>)))
  <span class="org-doc">"An association list between major modes and a noflycheck region delimiters.</span>

<span class="org-doc">The region delimiters are two regular expressions that should match the</span>
<span class="org-doc">beginning and the end of the region respectively."</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 225: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-noflycheck-should-skip-error-h</span> (err)
  <span class="org-doc">"Ignore flycheck ERR if it happens inside a 'no flycheck' region."</span>
  (<span class="org-keyword">when-let</span> ((region (car (alist-get major-mode my-noflycheck-region-alist)))
             (_ (<span class="org-keyword">save-excursion</span>
                  (<span class="org-keyword">save-match-data</span>
                    (<span class="org-keyword">let*</span> ((start (car region))
                           (end (cdr region))
                           (both (format <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">%s</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">%s</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span> start end)))
                      (goto-char (flycheck-error-pos err))
                      (<span class="org-keyword">and</span> (re-search-backward both nil t)
                           (match-beginning 1)))))))
    (<span class="org-keyword">setq-local</span> flycheck-current-errors (remove err flycheck-current-errors))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 226: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-noflycheck-should-skip-urls-h</span> (err)
  <span class="org-doc">"Ignore flycheck ERR if it happens inside a 'no flycheck' region."</span>
  (<span class="org-keyword">when-let</span> ((_ (<span class="org-keyword">save-excursion</span>
                  (<span class="org-keyword">save-match-data</span>
                    (<span class="org-keyword">when-let</span> ((err-pos (flycheck-error-pos err)))
                      (goto-char err-pos)
                      (thing-at-point 'url))))))
    (<span class="org-keyword">setq-local</span> flycheck-current-errors (remove err flycheck-current-errors))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 227: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-noflycheck-h</span> ()
  <span class="org-doc">"Add a skip flycheck for regions defined at `</span><span class="org-doc"><span class="org-constant">my-noflycheck-region-alist</span></span><span class="org-doc">'."</span>
  (<span class="org-keyword">require</span> '<span class="org-constant">flycheck</span>)
  (add-hook 'flycheck-process-error-functions #'my-noflycheck-should-skip-error-h nil t)
  (add-hook 'flycheck-process-error-functions #'my-noflycheck-should-skip-urls-h nil t))
</pre>
</div>

<ul class="org-ul">
<li><a href="https://github.com/alexmurray/flycheck-posframe">https://github.com/alexmurray/flycheck-posframe</a></li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 228: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> flycheck-posframe)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 229: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(custom-set-faces!
  '(flycheck-posframe-border-face <span class="org-builtin">:foreground</span> <span class="org-string">"#000000"</span>)
  '(flycheck-posframe-face <span class="org-builtin">:inherit</span> my-default-ui))

(<span class="org-keyword">use-package!</span> flycheck-posframe
  <span class="org-builtin">:hook</span> ((flycheck-mode . flycheck-posframe-mode))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> flycheck-posframe-border-width 1
        flycheck-posframe-prefix
        (format <span class="org-string">"%s\t"</span> (all-the-icons-material <span class="org-string">"close"</span> <span class="org-builtin">:height</span> 0.7 <span class="org-builtin">:v-adjust</span> -0.1))
        flycheck-posframe-info-prefix
        (format <span class="org-string">"%s\t"</span> (all-the-icons-material <span class="org-string">"info"</span> <span class="org-builtin">:height</span> 0.7 <span class="org-builtin">:v-adjust</span> -0.1))
        flycheck-posframe-warning-prefix
        (format <span class="org-string">"%s\t"</span> (all-the-icons-material <span class="org-string">"warning"</span> <span class="org-builtin">:height</span> 0.7 <span class="org-builtin">:v-adjust</span> -0.1))
        flycheck-posframe-error-prefix
        (format <span class="org-string">"%s\t"</span> (all-the-icons-material <span class="org-string">"error"</span> <span class="org-builtin">:height</span> 0.7 <span class="org-builtin">:v-adjust</span> -0.1)))
)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 230: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-flycheck-posframe-format-errors-a (fun <span class="org-type">&amp;rest</span> args)
  <span class="org-doc">"Advice to add a top and bottom padding to the error message."</span>
  <span class="org-builtin">:around</span> 'flycheck-posframe-format-errors
  (concat (propertize <span class="org-string">"  \n"</span> 'face '(<span class="org-builtin">:height</span> 60))
          (apply fun args)
          (propertize <span class="org-string">"\n  "</span> 'face '(<span class="org-builtin">:height</span> 60))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 231: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defadvice!</span> my-flycheck-posframe-show-posframe-a (errors)
  <span class="org-doc">"Display ERRORS, using posframe.el library."</span>
  <span class="org-builtin">:override</span> 'flycheck-posframe-show-posframe
  (posframe-hide flycheck-posframe-buffer)
  (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> errors
             (not (run-hook-with-args-until-success 'flycheck-posframe-inhibit-functions)))
    (<span class="org-keyword">let</span> ((poshandler (intern (format <span class="org-string">"posframe-poshandler-%s"</span> flycheck-posframe-position))))
      (<span class="org-keyword">unless</span> (functionp poshandler)
        (<span class="org-keyword">setq</span> poshandler nil))
      (flycheck-posframe-check-position)
      (posframe-show
       flycheck-posframe-buffer
       <span class="org-builtin">:string</span> (flycheck-posframe-format-errors errors)
       <span class="org-builtin">:background-color</span> (face-background 'flycheck-posframe-background-face nil t)
       <span class="org-builtin">:position</span> (point)
       <span class="org-builtin">:internal-border-width</span> flycheck-posframe-border-width
       <span class="org-builtin">:internal-border-color</span> (face-foreground 'flycheck-posframe-border-face nil t)
       <span class="org-builtin">:poshandler</span> poshandler
       <span class="org-builtin">:hidehandler</span> #'flycheck-posframe-hidehandler
       <span class="org-builtin">:left-fringe</span> 10
       <span class="org-builtin">:right-fringe</span> 10))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd8211c0" class="outline-4">
<h4 id="orgd8211c0"><span class="section-number-4">4.4.2</span> Templates</h4>
<div class="outline-text-4" id="text-4-4-2">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 232: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-file-templates-yasnippet-dir</span> (expand-file-name <span class="org-string">"share/templates"</span> doom-private-dir))
(<span class="org-keyword">pushnew!</span> yas-snippet-dirs 'my-file-templates-yasnippet-dir)
</pre>
</div>


<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 233: </span>$DOOMDIR/share/templates/org-mode/__</label><pre class="src src-snippet"># name: Blank Org File
# key: __
# --
#+TITLE: ${1:`(s-titleized-words (file-name-sans-extension (buffer-name)))`}
#+AUTHOR: `user-full-name`
#+EMAIL: `user-mail-address`
#+DATE: `(format (format-time-string "%B %%s, %Y") (string-to-number (format-time-string "%d")))`
#+LANGUAGE: ${2:en}

`%`$0
</pre>
</div>
</div>


<ol class="org-ol">
<li><a id="orged30295"></a><span class="todo TODO">TODO</span> Define a Hydra for <i>new documents</i> to use my templates<br></li>
</ol>
</div>

<div id="outline-container-org824983e" class="outline-4">
<h4 id="org824983e"><span class="section-number-4">4.4.3</span> Focus Writing</h4>
<div class="outline-text-4" id="text-4-4-3">
<ul class="org-ul">
<li><a href="https://github.com/larstvei/Focus">https://github.com/larstvei/Focus</a></li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 234: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> focus)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 235: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> focus <span class="org-builtin">:defer</span> t)

(map! <span class="org-builtin">:leader</span> <span class="org-builtin">:prefix</span> (<span class="org-string">"t"</span> . <span class="org-string">"toggle"</span>)
      <span class="org-builtin">:desc</span> <span class="org-string">"Focus mode"</span> <span class="org-builtin">:mvn</span> <span class="org-string">"o"</span> #'focus-mode
      <span class="org-builtin">:desc</span> <span class="org-string">"Focus mode (RO)"</span> <span class="org-builtin">:mvn</span> <span class="org-string">"O"</span> #'focus-read-only-mode)
</pre>
</div>
</div>
</div>

<div id="outline-container-org5a5341a" class="outline-4">
<h4 id="org5a5341a"><span class="section-number-4">4.4.4</span> Snippets</h4>
<div class="outline-text-4" id="text-4-4-4">
<p>
Even though writing does not have boilerplate typing <i>per-se</i>, Org mode still has a formal syntax to follow. Most of the syntax are straightforward, but some could use a snippet help to make it easier and faster to type them.
</p>

<p>
This section shows the snippets I decide to use for writing.
</p>

<p>
Before defining the snippets though, I need to adjust the <code>yas-keymap</code> to behave properly with evil:
</p>
</div>


<ol class="org-ol">
<li><a id="orgd2af831"></a>Source blocks<br>
<div class="outline-text-5" id="text-4-4-4-1">
<p>
This journey of literate configuration made me realize how much faster is to <i>prepare</i> source blocks using snippets.
</p>

<p>
The first snippet, is a simple <code>emacs-lisp</code> snippet that I use all the time:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 236: </span>$DOOMDIR/snippets/org-mode/src-emacs-lisp</label><pre class="src src-snippet"># name: #+begin_src emacs-lisp
# uuid: emacs-lisp
# key: &lt;el
# --
`(when buffer-file-name (format "#+caption: $DOOMDIR/%s.el\n" (file-name-base buffer-file-name)))`#+begin_src emacs-lisp
`%`$0
#+end_src
</pre>
</div>

<p>
Then I have the same snippet, but allowing me to add a <code>:tangle</code> header to it:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 237: </span>$DOOMDIR/snippets/org-mode/src-emacs-lisp-tangled</label><pre class="src src-snippet"># name: #+begin_src emacs-lisp :tangle
# uuid: emacs-lisp-tangle
# key: &lt;elt
# --
${1:$(unless (or (string-blank-p yas-text) (equal yas-text "no"))
	(format "#+caption: %s\n" yas-text))
}#+begin_src emacs-lisp `":tangle"` ${1:$$(unless (or yas-moving-away-p yas-modified-p)
			    (yas-auto-next
			      (condition-case nil
				  (let ((fname (read-file-name "Tangle to file: ")))
				    (if fname
					(file-relative-name fname (file-name-directory (or buffer-file-name ".")))
				      "no"))
				('quit "no"))))}
`%`$0
#+end_src
</pre>
</div>

<p>
And for a more generic approach, I have this snippet where you can define the language, if you want a tangle header, and if you do, allows you to select the file:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 238: </span>$DOOMDIR/snippets/org-mode/src-tangled</label><pre class="src src-snippet"># name: #+begin_src on steroids
# uuid: src_block
# key: &lt;st
# --
${3:$(unless (or (string-blank-p yas-text) (equal yas-text "no"))
	(format "#+caption: %s\n" yas-text))
}#+begin_src ${1:emacs-lisp} ${2:`":tangle"` ${3:$$(unless (or yas-moving-away-p
							       yas-modified-p)
			    (yas-auto-next
			      (condition-case nil
				  (let ((fname (read-file-name "Tangle to file: ")))
				    (if fname
					(file-relative-name fname (file-name-directory (or (buffer-file-name) ".")))
				      "no"))
				('quit "no"))))}}
`%`$0
#+end_src
</pre>
</div>

<p>
The last snippets I consider useful for source blocks are captions. On the two snippets with tangled files, the capture mark is already there, but if I want to add a caption to the non-tangled snippet I have to do it by hand. So, let's create a snippet to help us with this:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 239: </span>$DOOMDIR/snippets/org-mode/caption</label><pre class="src src-snippet"># name: #+caption:
# key: cap
# --
#+caption: $0
</pre>
</div>

<p>
This snippet is fine, but we still have to type the filename there. Let's create another one to make this task even easier:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 240: </span>$DOOMDIR/snippets/org-mode/caption-file</label><pre class="src src-snippet"># name: #+caption: filename
# uuid: caption-file
# key: capf
# --
#+caption: ${1:$$(unless (or yas-moving-away-p yas-modified-p)
			    (yas-auto-next
			      (file-relative-name
				(read-file-name "Tangle to file: ")
				(file-name-directory (or (buffer-file-name) "."))
			      )))}$0
</pre>
</div>
</div>
</li>

<li><a id="orga2f27b3"></a>Org elements<br>
<div class="outline-text-5" id="text-4-4-4-2">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 241: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-links-in-kill-ring</span> ()
  <span class="org-doc">"Return a list of links in kill ring."</span>
  (<span class="org-keyword">require</span> '<span class="org-constant">goto-addr</span>)
  (<span class="org-keyword">let*</span> ((kill-ring-kills (mapcar #'substring-no-properties kill-ring))
         (clipboard (gui-get-selection 'CLIPBOARD 'NSStringPboardType))
         (clipboard-url (<span class="org-keyword">when</span> (string-match goto-address-url-regexp clipboard)
                          (list (match-string 0 clipboard))))
         (potential-links))
    (<span class="org-keyword">dolist</span> (kill kill-ring-kills)
      (<span class="org-keyword">let</span> (last-match)
        (<span class="org-keyword">while</span>
            (<span class="org-keyword">prog1</span>
                (string-match goto-address-url-regexp
                              kill last-match)
              (<span class="org-keyword">setq</span> last-match (match-end 0)))
          (<span class="org-keyword">cl-pushnew</span> (match-string 0 kill) potential-links)
          )))
    (append clipboard-url (delete-dups potential-links))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 242: </span>$DOOMDIR/snippets/org-mode/link</label><pre class="src src-snippet"># name: Link
# key: link
# --
[[${1:$$(unless (or yas-moving-away-p yas-modified-p)
  (let ((links (my-links-in-kill-ring)))
    (if links
	(yas-auto-next
	  (completing-read "Choose the URL to link: " links))
      "url")))}][${2:`(or yas-selected-text "description")`}]]$0
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-org12724a6" class="outline-3">
<h3 id="org12724a6"><span class="section-number-3">4.5</span> <span class="todo TODO">TODO</span> Reading or reviewing</h3>
<div class="outline-text-3" id="text-4-5">
<ul class="org-ul">
<li>Narrower width</li>
<li>Visual motion</li>
<li>Show document structure on sidebar</li>
<li>Annotations
<ul class="org-ul">
<li>Referenceable</li>
<li>Annotate external documents (default to Doom)</li>
</ul></li>

<li><a href="https://depp.brause.cc/nov.el/">https://depp.brause.cc/nov.el/</a></li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 243: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> nov)
</pre>
</div>
</div>
</div>

<div id="outline-container-org9d1a314" class="outline-3">
<h3 id="org9d1a314"><span class="section-number-3">4.6</span> <span class="todo TODO">TODO</span> Publishing</h3>
<div class="outline-text-3" id="text-4-6">
<ul class="org-ul">
<li>Blog or site post</li>
<li>Email document</li>
<li>Wiki entry</li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 244: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> org-html-htmlize-output-type 'css
      org-html-head-include-default-style nil
      org-html-doctype <span class="org-string">"html5"</span>
      org-html-html5-fancy t
      org-html-table-caption-above nil)
</pre>
</div>


<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 245: </span>$DOOMDIR/snippets/org-mode/macro</label><pre class="src src-snippet"># name: #+BEGIN_MACRO ... block
# uuid: macro
# key: &lt;m
# --
#+attr_block: :macro ${1:info} $2
#+BEGIN_MACRO
`%`$0
#+END_MACRO
</pre>
</div>
</div>
</div>

<div id="outline-container-org511d339" class="outline-3">
<h3 id="org511d339"><span class="section-number-3">4.7</span> <span class="todo TODO">TODO</span> Presenting</h3>
<div class="outline-text-3" id="text-4-7">
<ul class="org-ul">
<li>Use <code>reveal.js</code> inside a WebKit XWidget in full screen</li>
</ul>
</div>
</div>

<div id="outline-container-org37bccad" class="outline-3">
<h3 id="org37bccad"><span class="section-number-3">4.8</span> <span class="todo TODO">TODO</span> Note Taking</h3>
<div class="outline-text-3" id="text-4-8">
<p>
Here in this section I need to come clean to the reader. I'm a horrible note taker! I have <a href="https://www.cdc.gov/ncbddd/adhd/facts.html">ADHD</a> and my capacity to keep up with any system to take notes is as short as a <a href="https://www.cdc.gov/ncbddd/adhd/facts.html">fruit fly's attention span</a>. That said, one of the longest streaks of success keeping up with notes I had in the past, was when I tried Org mode for the first time. I believe if I have a setup that makes taking notes effortless, I might be able to finally start taking notes and refer to them when needed.
</p>

<p>
After a lot of reading, consultation, and thinking, I believe I found a system I will enjoy working with. Let me describe it to you.
</p>

<p>
One of the constants I found when searching for a note taking system was the fact that writing down a note (regardless of its type), has to happen in less than two seconds or I don't get motivated to do it all the time. This time is valid to take notes from a computer, as well as on the go. For some individuals, having a small notebook at hand all the time, is crucial for them. Since I'm more of a tech guy, my system will use exclusively computer software.
</p>

<p>
To get under these two seconds to take a note when I'm on a computer, I defined a single entry point for all notes. This way I can optimize this process inside and outside Emacs if I want.
</p>

<p>
My entry point for notes is <a href="https://github.com/bastibe/org-journal">Org Journal</a>. I will use an entry scheme of one file per year, and create an <a href="https://orgmode.org/manual/Capture.html">org-capture</a> system that will use this single journal file and help me achieve the two seconds mark.
</p>

<p>
Part of my strategy is to have one capture template per type of note to reduce the necessary amount of thinking not related to the note itself. Another artifact I will use is <a href="https://joaotavora.github.io/yasnippet/">Yasnippet</a> instead of <code>org-capture</code> templates. The reason for this decision is to keep a visual track on the entry text. With the standard <code>org-capture</code>, I have to move my eyes from top to bottom of the screen to look between the template text and the input field.
</p>

<p>
I will take notes any time I feel the need, but here are the main topics for my notes:
</p>

<dl class="org-dl">
<dt>Fleet notes</dt><dd>These are the <i>quick notes</i> of the day. I will use fleet notes any time a note does not fit on anyone of the next categories;</dd>
<dt>Journal entries</dt><dd>When need to add an event on my personal journal, I will use this category. I need to clarify though, that a <i>personal journal</i> for me, is anything that happens to myself, regardless if is a work related event or not;</dd>
<dt>Meeting notes</dt><dd>Should happen on any meeting, I must review them no longer than 30 minutes after it,  and must include:
<ul class="org-ul">
<li>List of participants;</li>
<li>Meeting time;</li>
<li>Meeting subjects;</li>
<li>Important points on the meeting;</li>
<li>Action items and their owners;</li>
</ul></dd>
<dt>Support</dt><dd>When I spend some time with a co-worker helping her on any subject, I will have a note about this support containing:
<ul class="org-ul">
<li>Co-worker's name;</li>
<li>Support's subject;</li>
<li>Start and end time;</li>
<li>Action items for me or the co-worker;</li>
</ul></dd>
<dt>Idea</dt><dd>Whenever something interesting pops from my brain, I will try to capture it in this category;</dd>
<dt>Link</dt><dd>When I find something interesting online, or something I should spend some time reading or studying;</dd>
<dt>Past entry</dt><dd>If I remember of something that happens a couple days earlier, or when I want to make a journal entry on the past, I will use this category;</dd>
</dl>

<p>
On the end of each day, I will sit down in front of my computer to review the notes I took on the day. I will think about each note I took and verify if its worth ot keeping it. If it is, I'll try to synthesize the note on my own words and relate it with previous notes.
</p>

<p>
I will be able to search notes using their reference label, title, tags, or content (a great package for this is <a href="https://github.com/jrblevin/deft">Deft</a>).
</p>
</div>

<div id="outline-container-org71fcd29" class="outline-4">
<h4 id="org71fcd29"><span class="section-number-4">4.8.1</span> Capturing</h4>
<div class="outline-text-4" id="text-4-8-1">
<p>
Talk about capture in general:
</p>
<ul class="org-ul">
<li>How am I going to use it?</li>
<li>How am I going to implement it with Yasnippets?</li>
<li>Any goals for this area?</li>
</ul>

<div class="org-src-container">
<pre class="src src-text">[n]     &#9679; Fleet note
[j]...  &#9679; Journal
[t]...  &#9679; Tasks
[c]     &#9679; Contact
[p]...  &#9679; Project
--------------------------------------------------------------------------------
[q]     &#9679; Abort
</pre>
</div>

<p>
Start with the open definition for <code>org-capture</code>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 246: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-capture--note-frame-height</span> 15
  <span class="org-doc">"Number of lines a note frame should have when capturing a long note."</span>)

(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-capture--long-note-frame-height</span> 35
  <span class="org-doc">"Number of lines a note frame should have when capturing a long note."</span>)

(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-capture--menu-width</span> 50
  <span class="org-doc">"Number of lines a note frame should have when capturing a long note."</span>)

(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-capture--yas-prefix</span> <span class="org-string">"--DOOM-ORG-CAPTURE-YAS-PREFIX--:"</span>
  <span class="org-doc">"String used to identify a yasnippet template on a capture buffer"</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 247: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-capture-yasnippet-dir</span> (expand-file-name <span class="org-string">"share/capture"</span> doom-private-dir)
  <span class="org-doc">"Directory containning all capture snippets."</span>)
(<span class="org-keyword">pushnew!</span> yas-snippet-dirs 'my-capture-yasnippet-dir)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 248: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> org-capture
  <span class="org-builtin">:after</span> all-the-icons
  <span class="org-builtin">:commands</span> (org-capture +org-capture/open-frame)
  <span class="org-builtin">:init</span>
  (add-hook 'org-capture-mode-hook #'my-capture--yas-expand-h)
  (add-hook 'org-capture-after-finalize-hook #'my-capture--finish-h)
  (add-hook 'window-state-change-hook #'my-bring-org-capture-to-front-h)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setq</span> +org-capture-changelog-file <span class="org-string">"CHANGELOG.org"</span>)
  (<span class="org-keyword">setq</span> org-capture-templates-contexts '((<span class="org-string">"p"</span> (my-capture-projects-p))))
  (<span class="org-keyword">setq</span> +org-capture-fn (<span class="org-keyword">lambda</span> ()
                          (<span class="org-keyword">interactive</span>)
                          (set-window-parameter nil 'mode-line-format 'none)
                          (set-window-parameter nil 'header-line-format 'none)
                          (<span class="org-keyword">setq</span> default-minibuffer-frame (org-capture))))

  (map! (<span class="org-builtin">:map</span> org-capture-mode-map
         <span class="org-builtin">:in</span> [s-return] #'org-capture-finalize
         <span class="org-builtin">:in</span> [s-escape] #'org-capture-kill)
        (<span class="org-builtin">:leader</span>
         <span class="org-builtin">:desc</span> <span class="org-string">"Org Capture"</span>           <span class="org-string">"X"</span> #'+org-capture
         (<span class="org-builtin">:prefix</span> (<span class="org-string">"n"</span> . <span class="org-string">"notes"</span>)
          <span class="org-builtin">:desc</span> <span class="org-string">"Org capture"</span>          <span class="org-string">"n"</span> #'+org-capture/open-frame))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 249: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org-capture
  (<span class="org-keyword">setq</span> org-capture-templates '()))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 250: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-bring-org-capture-to-front-h</span> ()
  (<span class="org-keyword">when-let</span> ((captur-buffer (seq-find (<span class="org-keyword">lambda</span> (buf) (string-prefix-p <span class="org-string">"CAPTURE"</span> (buffer-name buf)))
                                      (buffer-list))))
    (my-bring-buffer-to-front captur-buffer)
    (<span class="org-keyword">when</span> (eq (org-roam-buffer--visibility) 'visible)
      (org-roam-buffer-deactivate))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 251: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture--adjust-frame</span> (<span class="org-type">&amp;optional</span> extended-p frame)
  <span class="org-doc">"Dinamically adjust the capture FRAME width to WIDTH and reposition it on the</span>
<span class="org-doc">center of the screen."</span>
  (<span class="org-keyword">when</span> (+org-capture-frame-p)
    (set-frame-size (<span class="org-keyword">or</span> frame (selected-frame))
                    (+ fill-column 20)
                    (<span class="org-keyword">if</span> extended-p
                        my-capture--long-note-frame-height
                      my-capture--note-frame-height))
    (my-capture--reposition-frame frame)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 252: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture--reposition-frame</span> (<span class="org-type">&amp;optional</span> frame)
  <span class="org-doc">"Position FRAME around the center of the screen."</span>
  (<span class="org-keyword">let</span> ((frame-w (window-pixel-width))
        (frame-h (window-pixel-height)))
    (set-frame-position (<span class="org-keyword">or</span> frame (selected-frame))
                        (/ (- (display-pixel-width) frame-w) 2)     <span class="org-comment-delimiter">;; </span><span class="org-comment">X</span>
                        (/ (- (display-pixel-height) frame-h) 3)))) <span class="org-comment-delimiter">;; </span><span class="org-comment">Y</span>
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 253: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture--yas-expand-h</span> ()
  <span class="org-doc">"Expand `</span><span class="org-doc"><span class="org-constant">my-capture--yas-prefix</span></span><span class="org-doc">' on the template."</span>
  (<span class="org-keyword">setq</span> +org-capture--auto-align-tags-store org-auto-align-tags)
  (<span class="org-keyword">let</span> ((saved-point (point)))
    (goto-char (point-min))
    (<span class="org-keyword">if</span> (search-forward-regexp (concat my-capture--yas-prefix <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">:]*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">:"</span>) nil t)
        (<span class="org-keyword">progn</span>
          (<span class="org-keyword">setq</span> org-auto-align-tags nil)
          (goto-char (match-end 0))
          (replace-match (match-string 1))
          (yas-expand))
      (goto-char saved-point)))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">(org-num-mode -1)</span>
  (tab-line-mode -1)
  (ws-butler-mode -1)
  (<span class="org-keyword">setq-local</span> org-startup-folded nil))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 254: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture-yasnippet</span> (snippet)
  <span class="org-doc">"Returns a snippet mark with the given SNIPPET used to expand it with yasnippet</span>
<span class="org-doc">when the capture finishes.</span>

<span class="org-doc">SNIPPET can be a string or a symbol.</span>

<span class="org-doc">The snippet mark will have the format:</span>

<span class="org-doc">\"--DOOM-ORG-CAPTURE-YAS-PREFIX--:&lt;snippet name&gt;:\""</span>
  (concat my-capture--yas-prefix
          (<span class="org-keyword">if</span> (stringp snippet)
              snippet
            (symbol-name snippet))
          <span class="org-string">":"</span>))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 255: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture--finish-h</span> ()
  <span class="org-doc">"Clean up any outstanding variable and values set when capture</span>
<span class="org-doc">starts."</span>
  (<span class="org-keyword">setq</span> org-auto-align-tags +org-capture--auto-align-tags-store)
  (<span class="org-keyword">setq</span> +org-capture--auto-align-tags-store nil))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 256: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture-template-selection</span> ()
  <span class="org-doc">"Returns the text selected on the buffer that originated the capture. If the</span>
<span class="org-doc">selection is the entire buffer, return an org link to buffer."</span>
  (<span class="org-keyword">with-current-buffer</span> (org-capture-get <span class="org-builtin">:original-buffer</span>)
    (<span class="org-keyword">when</span> (region-active-p)
      (<span class="org-keyword">or</span> (my-capture--mu4e-headers-selected)
          (my-capture--mu4e-view-selected)
          (my-capture--buffer-selected)
          <span class="org-string">""</span>))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 257: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture--mu4e-headers-selected</span> (<span class="org-type">&amp;optional</span> buf-name)
  <span class="org-doc">"When on a mu4e-headers buffer, store an org link to each one of the selected</span>
<span class="org-doc">messages and return them all as a string."</span>
  (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> (boundp 'mu4e~headers-buffer-name)
             (string= (<span class="org-keyword">or</span> buf-name (buffer-name)) mu4e~headers-buffer-name))
    (<span class="org-keyword">let*</span> ((beg (region-beginning))
           (end (region-end))
           (lines (count-lines beg end)))
      (<span class="org-keyword">save-excursion</span>
        (goto-char beg)
        (<span class="org-keyword">while</span> (&lt; (point) end)
          (org-store-link t t)
          (forward-line 1)))
      (<span class="org-keyword">with-temp-buffer</span>
        (org-insert-all-links lines)
        (buffer-string)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 258: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture--mu4e-view-selected</span> (<span class="org-type">&amp;optional</span> buf-name)
  <span class="org-doc">"When on a mu4e-view buffer, store an org link to the message and return it as a</span>
<span class="org-doc">string with the selected text as a block-quote. If the selection is the entire</span>
<span class="org-doc">buffer, just return the org link."</span>
  (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> (boundp 'mu4e~view-buffer-name)
             (string= (<span class="org-keyword">or</span> buf-name (buffer-name)) mu4e~view-buffer-name))
    (<span class="org-keyword">let*</span> ((beg (region-beginning))
           (end (region-end))
           (full-buf-sel-p (<span class="org-keyword">and</span> (= beg (point-min))
                                (= end (point-max))))
           (buf-quote (<span class="org-keyword">when</span> (not full-buf-sel-p) (buffer-substring beg end))))
      (org-store-link t t)
      (<span class="org-keyword">with-temp-buffer</span>
        (insert <span class="org-string">"- "</span>)
        (org-insert-last-stored-link 1)
        (<span class="org-keyword">when</span> buf-quote
          (insert <span class="org-string">"#+BEGIN_QUOTE\n"</span>)
          (insert buf-quote)
          (insert <span class="org-string">"#+END_QUOTE\n"</span>))
        (buffer-string)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 259: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture--buffer-selected</span> ()
  <span class="org-doc">"When there is an active selection in the current buffer,</span>
<span class="org-doc">returns an org link to the current buffer with the selection as a blockquote. If</span>
<span class="org-doc">the selection is the entire buffer, just return the org link."</span>
  (<span class="org-keyword">let</span> ((sel-text (<span class="org-keyword">let*</span> ((beg (region-beginning))
                         (end (region-end))
                         (full-buf-sel-p (<span class="org-keyword">and</span> (= beg (point-min))
                                              (= end (point-max))))
                         (buf-file (expand-file-name (buffer-file-name)))
                         (buf-name (buffer-name))
                         (buf-linum (line-number-at-pos beg t))
                         (buf-quote (<span class="org-keyword">when</span> (not full-buf-sel-p) (buffer-substring beg end)))
                         (quote-what (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> buf-quote (derived-mode-p 'prog-mode))
                                         (format <span class="org-string">"SOURCE %s"</span>
                                                 (s-chop-suffix <span class="org-string">"-mode"</span> (symbol-name major-mode)))
                                       <span class="org-string">"QUOTE"</span>)))
                    (<span class="org-keyword">with-temp-buffer</span>
                      (<span class="org-keyword">when</span> (file-exists-p buf-file)
                        (insert (format <span class="org-string">"- [[file:%s::%d][%s]]\n"</span> buf-file buf-linum buf-name)))
                      (<span class="org-keyword">when</span> buf-quote
                        (insert (format <span class="org-string">"#+BEGIN_%s\n"</span> quote-what))
                        (insert buf-quote)
                        (insert (format <span class="org-string">"#+END_%s\n"</span> quote-what)))
                      (buffer-string)))))
    (<span class="org-keyword">unless</span> (s-blank-str-p sel-text) sel-text)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 260: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture-projects-p</span> ()
  <span class="org-doc">"Retuns true when current buffer belongs to current open project."</span>
  (<span class="org-keyword">with-current-buffer</span> (<span class="org-keyword">or</span> (org-capture-get <span class="org-builtin">:original-buffer</span>) (current-buffer))
    (<span class="org-keyword">let*</span> ((proj-root (doom-project-root))
           (proj-root (<span class="org-keyword">when</span> proj-root (expand-file-name proj-root)))
           (buf-path (buffer-file-name))
           (buf-path (<span class="org-keyword">when</span> buf-path (expand-file-name buf-path))))
      (<span class="org-keyword">and</span> proj-root
           buf-path
           (string-prefix-p proj-root buf-path)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 261: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture-description</span> (<span class="org-type">&amp;rest</span> args)
  <span class="org-doc">"Returns a formatted capture description.</span>

<span class="org-doc">ARGS is a declarative builder for the new description:</span>

<span class="org-doc">`</span><span class="org-doc"><span class="org-constant">:text</span></span><span class="org-doc">' (required) - The string displayed on the capture item.</span>
<span class="org-doc">`</span><span class="org-doc"><span class="org-constant">:icon</span></span><span class="org-doc">' (optional) - A cons cell with the icon symbol (check</span>
<span class="org-doc">    `</span><span class="org-doc"><span class="org-constant">+org-capture-supported-icons</span></span><span class="org-doc">' for supported symbols).</span>

<span class="org-doc">Example:</span>

<span class="org-doc">  (my-capture-description :text \"Add journal entry\"</span>
<span class="org-doc">                            :icon '(journal . \"#ff00ff\"))"</span>
  (<span class="org-keyword">let</span> ((text (plist-get args <span class="org-builtin">:text</span>))
        (icon (plist-get args <span class="org-builtin">:icon</span>)))
    (<span class="org-keyword">when</span> (<span class="org-keyword">or</span> (null text)
                (string-blank-p text))
      (<span class="org-warning">error</span> <span class="org-string">"A capture description requires a text."</span>))
    (<span class="org-keyword">if</span> icon
        (<span class="org-keyword">progn</span>
          <span class="org-comment-delimiter">;; </span><span class="org-comment">(unless (and (consp icon)</span>
          <span class="org-comment-delimiter">;;              </span><span class="org-comment">(my-supported-icons-p (car-safe icon))</span>
          <span class="org-comment-delimiter">;;              </span><span class="org-comment">(stringp (cdr-safe icon)))</span>
          <span class="org-comment-delimiter">;;   </span><span class="org-comment">(error (concat "A capture description icon must be a cons cell with"</span>
          <span class="org-comment-delimiter">;;                  </span><span class="org-comment">" one of my-supported-icons symbol and a string color.")))</span>
          (format <span class="org-string">"%s %s"</span> (my-icon (car icon) (cdr icon)) text))
      text)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 262: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture-heading-template</span> (<span class="org-type">&amp;rest</span> args)
  <span class="org-doc">"Returns a formatted capture template for a heading.</span>

<span class="org-doc">ARGS should all be string that will get concatenated with no spaces between</span>
<span class="org-doc">them. Default to \"%?\"."</span>
  (<span class="org-keyword">let*</span> ((content (<span class="org-keyword">when</span> args (s-join <span class="org-string">""</span> args)))
         (content (<span class="org-keyword">if</span> (s-matches-p content <span class="org-string">"%|</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">|]*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">|"</span>)
                      (s-trim (s-replace-all '((<span class="org-string">" %? "</span> . <span class="org-string">" "</span>) (<span class="org-string">"%?"</span> . <span class="org-string">""</span>)) content))
                    (<span class="org-keyword">or</span> content <span class="org-string">"%?"</span>))))
    (concat (<span class="org-keyword">when</span> (not (s-starts-with-p <span class="org-string">"*"</span> content))
              <span class="org-string">"%(my-capture-heading-prefix) "</span>)
            (replace-regexp-in-string <span class="org-string">"%|</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">|]*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">|"</span>
                                      <span class="org-string">"%(my-capture-yasnippet 'capture-\\1)%?"</span>
                                      content)
            <span class="org-string">"\n%(my-capture-template-selection)"</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 263: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture-heading-prefix</span> ()
  <span class="org-doc">"Returns a string of `*` characters representing an org header level. The number</span>
<span class="org-doc">of characters is the one on the org-capture `</span><span class="org-doc"><span class="org-constant">:heading-level</span></span><span class="org-doc">' property or</span>
<span class="org-doc">calculated by the org-capture `</span><span class="org-doc"><span class="org-constant">:olp</span></span><span class="org-doc">' property size."</span>
  (<span class="org-keyword">let</span> ((level (org-capture-get <span class="org-builtin">:heading-level</span>))
        (olp-size (1+ (length (org-capture-get <span class="org-builtin">:olp</span>)))))
    (s-repeat (max 1 (<span class="org-keyword">or</span> level olp-size)) <span class="org-string">"*"</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 264: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture-position-cursor</span> ()
  <span class="org-doc">"Asks user for a timestamp and store it for template use. It also position the</span>
<span class="org-doc">cursor on the correct place for a new entry, and adjust the capture frame width</span>
<span class="org-doc">to `</span><span class="org-doc"><span class="org-constant">fill-column</span></span><span class="org-doc">' before start editing."</span>
  (my-capture--adjust-frame (org-capture-get <span class="org-builtin">:clock-in</span>))
  (<span class="org-keyword">let*</span> ((read-time (org-capture-get <span class="org-builtin">:read-time</span>))
         (read-time-labal (<span class="org-keyword">or</span> (org-capture-get <span class="org-builtin">:read-time-label</span>) <span class="org-string">"Timestamp"</span>))
         (olp (org-capture-get <span class="org-builtin">:olp</span>))
         (header-point (org-roam-capture-find-or-create-olp olp))
         existent-olp)
    (<span class="org-keyword">when</span> read-time
      (org-capture-put <span class="org-builtin">:time-read</span> (org-read-date t t nil read-time-labal)))
    (<span class="org-keyword">if</span> (not olp)
        (goto-char (point-max))
      (goto-char header-point)
      (org-end-of-subtree)
      (move-end-of-line nil))
    (newline)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 265: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture-file</span>()
  (<span class="org-keyword">let*</span> ((file-name-format (org-capture-get <span class="org-builtin">:file-name-format</span>))
         (file-name (s-trim (org-capture-fill-template file-name-format)))
         (file-path (expand-file-name file-name (<span class="org-keyword">when</span> (not (s-starts-with-p <span class="org-string">"/"</span> file-name)) org-directory)))
         (file-header (org-capture-get <span class="org-builtin">:file-header</span>)))
    (<span class="org-keyword">if</span> (file-exists-p file-path)
        (find-file file-path)
      (make-directory (file-name-directory file-path) t)
      (find-file file-path)
      (<span class="org-keyword">when</span> file-header
        (insert (org-capture-fill-template file-header)))
      (set-buffer-modified-p nil))
    (my-capture-position-cursor)
    (<span class="org-keyword">when</span> (eq 'visible (org-roam-buffer--visibility))
      (org-roam-buffer-deactivate))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 266: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture-time-read</span> ()
  <span class="org-doc">"Returns the last timestamp captured, formatted with the format specified on</span>
<span class="org-doc">`</span><span class="org-doc"><span class="org-constant">org-time-stamp-formats</span></span><span class="org-doc">'. If user didn't capture any date, returns current</span>
<span class="org-doc">time."</span>
  (format-time-string (cdr-safe org-time-stamp-formats) (org-capture-get <span class="org-builtin">:time-read</span>)))
</pre>
</div>
</div>

<ol class="org-ol">
<li><a id="org1343427"></a>Dailies<br>
<div class="outline-text-5" id="text-4-8-1-1">
<div class="org-src-container">
<pre class="src src-text">[s]     &#9679; Support
[m]     &#9679; Meeting
[c]     &#9679; Code review
[i]     &#9679; Idea
[l]     &#9679; Interesting link
--------------------------------------------------------------------------------
[q]     &#9679; Abort
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 267: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-roam-dailies-file-name-base</span> <span class="org-string">"daily/daily-notes-%&lt;%Y-%m-%d&gt;"</span>
  <span class="org-doc">"Filename format for the Daily Notes file."</span>)

(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-roam-dailies-file-name</span> (format <span class="org-string">"notes/%s.org"</span> my-roam-dailies-file-name-base)
  <span class="org-doc">"Filename format for the Daily Notes file."</span>)

(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-roam-dailies-header</span> (concat <span class="org-string">"#+TITLE: Daily notes for %&lt;%A, %B %-e, %Y&gt;\n"</span>
                                         <span class="org-string">"#+STARTUP: overview\n"</span>
                                         <span class="org-string">"#+CATEGORY: dailies\n"</span>
                                         <span class="org-string">"\n"</span>)
  <span class="org-doc">"Template used to create new Daily Notes files."</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 268: </span>autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-dailies-find</span> (tag)
  <span class="org-doc">"Open the right daily note based on the given TAG.</span>

<span class="org-doc">Accepted values for TAG are:</span>

<span class="org-doc">- \"yesterday\"</span>
<span class="org-doc">- \"today\"</span>
<span class="org-doc">- \"tomorrow\"</span>

<span class="org-doc">If TAG is not one of these values, this function will raise an error."</span>
  (<span class="org-keyword">pcase</span> tag
    (<span class="org-string">"yesterday"</span>
     (format <span class="org-string">"file:%s"</span>
             (string-trim
              (expand-file-name
               (<span class="org-keyword">let</span> ((org-capture-plist
                      `(<span class="org-builtin">:default-time</span> ,(org-time-string-to-time (org-read-date nil nil <span class="org-string">"-1"</span>)))))
                 (org-capture-fill-template my-roam-dailies-file-name))
               org-directory))))
    (<span class="org-string">"today"</span>
     (format <span class="org-string">"file:%s"</span>
             (string-trim
              (expand-file-name
               (org-capture-fill-template my-roam-dailies-file-name)
               org-directory))))
    (<span class="org-string">"tomorrow"</span>
     (format <span class="org-string">"file:%s"</span>
             (string-trim
              (expand-file-name
               (<span class="org-keyword">let</span> ((org-capture-plist
                      `(<span class="org-builtin">:default-time</span> ,(org-time-string-to-time (org-read-date nil nil <span class="org-string">"+1"</span>)))))
                 (org-capture-fill-template my-roam-dailies-file-name))
               org-directory))))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 269: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org
  (<span class="org-keyword">pushnew!</span> org-link-abbrev-alist '(<span class="org-string">"dailies"</span> . <span class="org-string">"%(my-dailies-find)"</span>))
  (org-add-link-type <span class="org-string">"info"</span> 'org-info-command))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 270: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org-roam
  (<span class="org-keyword">setq</span> org-roam-dailies-capture-templates
        `((<span class="org-string">"d"</span> <span class="org-string">"default"</span> entry #'org-roam-capture--get-point <span class="org-string">"* %?"</span>
           <span class="org-builtin">:file-name</span> ,my-roam-dailies-file-name-base
           <span class="org-builtin">:head</span> ,my-roam-dailies-header))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 271: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org-capture
  (<span class="org-keyword">appendq!</span> org-capture-templates
            `((<span class="org-string">"d"</span>  ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"Daily notes"</span> <span class="org-builtin">:icon</span> `(notes . ,(doom-color 'green)))))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 272: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org-capture
  (<span class="org-keyword">appendq!</span> org-capture-templates
            `((<span class="org-string">"dd"</span>  ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"Fleet note"</span> <span class="org-builtin">:icon</span> `(notes . ,(doom-color 'blue 256)))
               plain (<span class="org-keyword">function</span> my-capture-file)
               ,(my-capture-heading-template <span class="org-string">"%&lt;%H:%M%#p&gt; - %?"</span>)
               <span class="org-builtin">:file-name-format</span> ,my-roam-dailies-file-name
               <span class="org-builtin">:file-header</span> ,my-roam-dailies-header
               <span class="org-builtin">:kill-buffer</span> t
               <span class="org-builtin">:empty-lines-after</span> 2
               <span class="org-builtin">:olp</span> (<span class="org-string">"Fleet notes"</span>)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 273: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org-capture
  (<span class="org-keyword">appendq!</span> org-capture-templates
            `((<span class="org-string">"ds"</span> ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"Support"</span> <span class="org-builtin">:icon</span> `(help . ,(doom-color 'orange 256)))
               plain (<span class="org-keyword">function</span> my-capture-file)
               ,(my-capture-heading-template <span class="org-string">"%&lt;%H:%M%#p&gt; - %|support|"</span>)
               <span class="org-builtin">:file-name-format</span> ,my-roam-dailies-file-name
               <span class="org-builtin">:file-header</span> ,my-roam-dailies-header
               <span class="org-builtin">:clock-in</span> t
               <span class="org-builtin">:kill-buffer</span> t
               <span class="org-builtin">:empty-lines-after</span> 2
               <span class="org-builtin">:olp</span> (<span class="org-string">"Meeting notes"</span>)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 274: </span>$DOOMDIR/share/capture/org-mode/capture-support</label><pre class="src src-snippet"># name: Notes for new support request
# key: capture-support
# --
Support about ${1:Support topic}  `":support:"`
- Requested by ${2:Coworker Name}
- $0
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 275: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org-capture
  (<span class="org-keyword">appendq!</span> org-capture-templates
            `((<span class="org-string">"dm"</span> ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"Meeting"</span> <span class="org-builtin">:icon</span> `(meeting . ,(doom-color 'cyan 256)))
               plain (<span class="org-keyword">function</span> my-capture-file)
               ,(my-capture-heading-template <span class="org-string">"%&lt;%H:%M%#p&gt; - %|meeting|"</span>)
               <span class="org-builtin">:file-name-format</span> ,my-roam-dailies-file-name
               <span class="org-builtin">:file-header</span> ,my-roam-dailies-header
               <span class="org-builtin">:clock-in</span> t
               <span class="org-builtin">:kill-buffer</span> t
               <span class="org-builtin">:empty-lines-after</span> 2
               <span class="org-builtin">:olp</span> (<span class="org-string">"Meeting notes"</span>)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 276: </span>$DOOMDIR/share/capture/org-mode/capture-meeting</label><pre class="src src-snippet"># name: Notes from meetings
# key: capture-meeting
# --
${1:Meeting topic}  `":meeting:"`

*** Attendees
-`" "`

*** Notes
- $0
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 277: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org-capture
  (<span class="org-keyword">appendq!</span> org-capture-templates
            `((<span class="org-string">"dc"</span> ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"Code review"</span> <span class="org-builtin">:icon</span> `(review . ,(doom-color 'green 256)))
               plain (<span class="org-keyword">function</span> my-capture-file)
               ,(my-capture-heading-template <span class="org-string">"%&lt;%H:%M%#p&gt; - %|cr|"</span>)
               <span class="org-builtin">:file-name-format</span> ,my-roam-dailies-file-name
               <span class="org-builtin">:file-header</span> ,my-roam-dailies-header
               <span class="org-builtin">:clock-in</span> t
               <span class="org-builtin">:kill-buffer</span> t
               <span class="org-builtin">:empty-lines-after</span> 2
               <span class="org-builtin">:olp</span> (<span class="org-string">"Meeting notes"</span>)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 278: </span>$DOOMDIR/share/capture/org-mode/capture-cr</label><pre class="src src-snippet"># name: New code review started
# key: capture-cr
# --
Started code review for ${1:Coworker Name}  `":cr:"`
- Review link: [[${2:url}][${2:$$(file-name-base yas-text)}]]
- $0
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 279: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org-capture
  (<span class="org-keyword">appendq!</span> org-capture-templates
            `((<span class="org-string">"dv"</span> ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"Interview"</span> <span class="org-builtin">:icon</span> `(review . ,(doom-color 'green 256)))
               plain (<span class="org-keyword">function</span> my-capture-file)
               ,(my-capture-heading-template <span class="org-string">"%&lt;%H:%M%#p&gt; - %|interview|"</span>)
               <span class="org-builtin">:file-name-format</span> ,my-roam-dailies-file-name
               <span class="org-builtin">:file-header</span> ,my-roam-dailies-header
               <span class="org-builtin">:clock-in</span> t
               <span class="org-builtin">:kill-buffer</span> t
               <span class="org-builtin">:empty-lines-after</span> 2
               <span class="org-builtin">:olp</span> (<span class="org-string">"Meeting notes"</span>)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 280: </span>$DOOMDIR/share/capture/org-mode/capture-interview</label><pre class="src src-snippet"># name: Notes for interview
# key: capture-interview
# --
Interview with ${1:Candidate Name}  `":interview:"`
:PROPERTIES:
:INTERVIEW_ID: ${1:$(file-name-base (car (s-split "?" (url-filename (url-generic-parse-url yas-text)))))}
:URL: [[${1:$$(unless (or yas-moving-away-p yas-modified-p)
  (let ((links (my-links-in-kill-ring)))
    (if links
	(yas-auto-next
	  (completing-read "Choose the URL to link: " links))
      "url")))}][Interview page]]
:FEEDBACK_URL: [[https://hire.amazon.com/interviews/${1:$(file-name-base (car (s-split "?" (url-filename (url-generic-parse-url yas-text)))))}/feedback_vote][Feedback page]]
:END:

*** Notes
- $0

*** Evaluation
- Data points evaluated:
  | ☐ Customer Obsession              | ☐ Ownership            | ☐ Invent and Simplify       |
  | ☐ Are Right, A Lot                | ☐ Learn and Be Curious | ☐ Hire and Develop the Best |
  | ☐ Insist on the Highest Standards | ☐ Think Big            | ☐ Bias for Action           |
  | ☐ Frugality                       | ☐ Earn Trust           | ☐ Dive Deep                 |
  | ☐ Have Backbone                   | ☐ Disagree and Commit  | ☐ Deliver Results           |
- Inclined:
  + [ ] Yes
    + [ ] Strongly inclined
  + [ ] No
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 281: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org-capture
  (<span class="org-keyword">appendq!</span> org-capture-templates
            `((<span class="org-string">"di"</span> ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"Idea"</span> <span class="org-builtin">:icon</span> `(idea . ,(doom-color 'yellow 256)))
               plain (<span class="org-keyword">function</span> my-capture-file)
               ,(my-capture-heading-template <span class="org-string">"%&lt;%H:%M%#p&gt; - %|idea|"</span>)
               <span class="org-builtin">:file-name-format</span> ,my-roam-dailies-file-name
               <span class="org-builtin">:file-header</span> ,my-roam-dailies-header
               <span class="org-builtin">:kill-buffer</span> t
               <span class="org-builtin">:empty-lines-after</span> 1
               <span class="org-builtin">:olp</span> (<span class="org-string">"Ideas"</span>)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 282: </span>$DOOMDIR/share/capture/org-journal-mode/capture-idea</label><pre class="src src-snippet"># name: New Idea
# key: capture-idea
# --
${1:Idea!}  :idea:
$0
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 283: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org-capture
  (<span class="org-keyword">appendq!</span> org-capture-templates
            `((<span class="org-string">"dl"</span> ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"Interesting link"</span> <span class="org-builtin">:icon</span> `(globe . ,(doom-color 'blue 256)))
               plain (<span class="org-keyword">function</span> my-capture-file)
               ,(my-capture-heading-template <span class="org-string">"%&lt;%H:%M%#p&gt; - %|link|"</span>)
               <span class="org-builtin">:file-name-format</span> ,my-roam-dailies-file-name
               <span class="org-builtin">:file-header</span> ,my-roam-dailies-header
               <span class="org-builtin">:kill-buffer</span> t
               <span class="org-builtin">:empty-lines-after</span> 1
               <span class="org-builtin">:olp</span> (<span class="org-string">"Links"</span>)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 284: </span>$DOOMDIR/share/capture/org-journal-mode/capture-link</label><pre class="src src-snippet"># name: Interesting link
# key: capture-link
# --
Check out ${1:Title}
- Link: ${2:url}
${3:- ${4:note}}
$0
</pre>
</div>
</div>
</li>

<li><a id="org135304c"></a>Journal entries<br>
<div class="outline-text-5" id="text-4-8-1-2">
<div class="org-src-container">
<pre class="src src-text">[s]     &#9679; New entry
[p]     &#9679; Past entry
--------------------------------------------------------------------------------
[q]     &#9679; Abort
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 285: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org-capture
  (<span class="org-keyword">appendq!</span> org-capture-templates
            `((<span class="org-string">"j"</span>  ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"Journal"</span> <span class="org-builtin">:icon</span> `(journal . ,(doom-color 'blue 256))))
              (<span class="org-string">"jj"</span>  ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"New entry"</span> <span class="org-builtin">:icon</span> `(journal . ,(doom-color 'green)))
               plain (<span class="org-keyword">function</span> my-capture-journal-file)
               ,(my-capture-heading-template <span class="org-string">"%&lt;%H:%M%#p&gt; - %?"</span>)
               <span class="org-builtin">:empty-lines-after</span> 1
               <span class="org-builtin">:kill-buffer</span> t)
              (<span class="org-string">"jp"</span> ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"Past entry"</span> <span class="org-builtin">:icon</span> `(history . ,(doom-color 'violet 256)))
               plain (<span class="org-keyword">function</span> my-capture-journal-file-for-timestamp)
               ,(my-capture-heading-template <span class="org-string">"%&lt;%H:%M%#p&gt; - %?"</span>)
               <span class="org-builtin">:time</span>
               <span class="org-builtin">:empty-lines-after</span> 1
               <span class="org-builtin">:kill-buffer</span> t))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 286: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture-journal-file-for-timestamp</span> ()
  <span class="org-doc">"Asks user for a specific timestamp and returns the journal file for it. It also</span>
<span class="org-doc">position the cursor on the correct place for a new entry, and adjust the capture</span>
<span class="org-doc">frame width to `</span><span class="org-doc"><span class="org-constant">fill-column</span></span><span class="org-doc">' before start editing."</span>
  (my-capture--adjust-frame)
  (my-journal/new-entry t nil 'my-capture-timestamp))
</pre>
</div>
</div>
</li>

<li><a id="org4dac534"></a>Tasks<br>
<div class="outline-text-5" id="text-4-8-1-3">
<div class="org-src-container">
<pre class="src src-text">[t]     &#9679; General task
[d]     &#9679; Task with deadline
[s]     &#9679; Scheduled task
--------------------------------------------------------------------------------
[q]     &#9679; Abort
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 287: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org-capture
  (<span class="org-keyword">appendq!</span> org-capture-templates
            `((<span class="org-string">"t"</span>  ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"Tasks"</span> <span class="org-builtin">:icon</span> `(inbox . ,(doom-color 'orange 256))))
              (<span class="org-string">"tt"</span> ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"New task"</span> <span class="org-builtin">:icon</span> `(inbox . ,(doom-color 'green 256)))
               plain (file+function +org-tasks-file my-capture-position-cursor)
               ,(my-capture-heading-template <span class="org-string">"TODO %?"</span>)
               <span class="org-builtin">:olp</span> (<span class="org-string">"To do /this week/"</span>)
               <span class="org-builtin">:empty-lines-after</span> 1
               <span class="org-builtin">:kill-buffer</span> t)
              (<span class="org-string">"td"</span> ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"Task with deadline"</span> <span class="org-builtin">:icon</span> `(timer . ,(doom-color 'yellow 256)))
               plain (file+function +org-tasks-file my-capture-position-cursor)
               ,(my-capture-heading-template <span class="org-string">"TODO %?\nDEADLINE: %(my-capture-time-read)"</span>)
               <span class="org-builtin">:read-time</span> t
               <span class="org-builtin">:read-time-label</span> <span class="org-string">"Deadline"</span>
               <span class="org-builtin">:olp</span> (<span class="org-string">"Time bound tasks"</span>)
               <span class="org-builtin">:empty-lines-after</span> 1
               <span class="org-builtin">:kill-buffer</span> t)
              (<span class="org-string">"ts"</span> ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"Scheduled task"</span> <span class="org-builtin">:icon</span> `(calendar . ,(doom-color 'orange 256)))
               plain (file+function +org-tasks-file my-capture-position-cursor)
               ,(my-capture-heading-template <span class="org-string">"TODO %?\nSCHEDULED: %(my-capture-time-read)"</span>)
               <span class="org-builtin">:read-time</span> t
               <span class="org-builtin">:read-time-label</span> <span class="org-string">"Start time"</span>
               <span class="org-builtin">:olp</span> (<span class="org-string">"Time bound tasks"</span>)
               <span class="org-builtin">:empty-lines-after</span> 1
               <span class="org-builtin">:kill-buffer</span> t))))
</pre>
</div>
</div>
</li>

<li><a id="org6f4837f"></a>Contacts<br>
<div class="outline-text-5" id="text-4-8-1-4">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 288: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">(after! org-capture</span>
<span class="org-comment-delimiter">;;   </span><span class="org-comment">(appendq! org-capture-templates</span>
<span class="org-comment-delimiter">;;             </span><span class="org-comment">`(("c" ,(my-capture-description :text "Contact" :icon `(contact-add . ,(doom-color 'yellow 256)))</span>
<span class="org-comment-delimiter">;;                </span><span class="org-comment">plain (file+function +org-contacts-file my-capture-position-cursor)</span>
<span class="org-comment-delimiter">;;                </span><span class="org-comment">,(my-capture-heading-template "* %|contact|\n\n")</span>
<span class="org-comment-delimiter">;;                </span><span class="org-comment">:empty-lines-after 1</span>
<span class="org-comment-delimiter">;;                </span><span class="org-comment">:kill-buffer t))))</span>
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 289: </span>$DOOMDIR/share/capture/org-mode/capture-contact</label><pre class="src src-snippet"># name: New Contact
# key: capture-contact
# --
${1:Name}
:PROPERTIES:
:TYPE: ${2:$$(yas-auto-next (yas-choose-value '(" person" " company")))}
:${2:$(if (string= yas-text " company") "CONTACT" "COMPANY")}: ${3:Name}
${2:$(if (string= yas-text " company") ":TITLE: \n" "")}:PHONE: ${4:phone}
${2:$(if (string= yas-text " company") "" ":PHONE-W: \n")}:EMAIL: ${5:email}
:URL:
:ADDRESS:
:PICTURE:
:BIRTHDAY:
:LAST_READ_MAIL:
:END:

$0
</pre>
</div>
</div>
</li>

<li><a id="org7875af2"></a>Project notes<br>
<div class="outline-text-5" id="text-4-8-1-5">
<div class="org-src-container">
<pre class="src src-text">[t]     &#9679; New task
[d]     &#9679; Quick note
[s]     &#9679; New changelog
--------------------------------------------------------------------------------
[q]     &#9679; Abort
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 290: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org-capture
  (<span class="org-keyword">appendq!</span> org-capture-templates
            `((<span class="org-string">"p"</span>  ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"Projct"</span> <span class="org-builtin">:icon</span> `(project . ,(doom-color 'violet 256))))
              (<span class="org-string">"pt"</span> ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"New task"</span> <span class="org-builtin">:icon</span> `(checklist . ,(doom-color 'green 256)))
               entry (file+headline my-capture-project-notes-file-wrapper <span class="org-string">"Tasks"</span>)
               ,(concat <span class="org-string">"* TODO %?\n"</span>
                        <span class="org-string">"%(my-capture-template-selection)"</span>)
               <span class="org-builtin">:empty-lines-after</span> 1
               <span class="org-builtin">:kill-buffer</span> t)
              (<span class="org-string">"pn"</span> ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"Quick note"</span> <span class="org-builtin">:icon</span> `(postit . ,(doom-color 'yellow 256)))
               entry (file+headline my-capture-project-notes-file-wrapper <span class="org-string">"Notes"</span>)
               ,(concat <span class="org-string">"* %U %?\n"</span>
                        <span class="org-string">"%(my-capture-template-selection)"</span>)
               <span class="org-builtin">:empty-lines-after</span> 1
               <span class="org-builtin">:kill-buffer</span> t)
              (<span class="org-string">"pc"</span> ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"New changelog"</span> <span class="org-builtin">:icon</span> `(list . ,(doom-color 'violet 256)))
               item (<span class="org-keyword">function</span> my-capture-project-changelog-file-with-headings)
               <span class="org-string">"- %?"</span>
               <span class="org-builtin">:prepend</span> t
               <span class="org-builtin">:empty-lines-before</span> 1
               <span class="org-builtin">:kill-buffer</span> t))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 291: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture-project-notes-file-wrapper</span> ()
  <span class="org-doc">"Returns an org file to hold notes and tasks for the current</span>
<span class="org-doc">  project."</span>
  (my-capture--adjust-frame)
  (+org-capture-project-notes-file))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 292: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture-project-changelog-file-with-headings</span> ()
  (<span class="org-keyword">let</span> ((entry-path (+org-capture-project-changelog-file))
        (org-complex-heading-regexp-format <span class="org-string">"\\* %s"</span>))
    (<span class="org-keyword">unless</span> (file-exists-p entry-path)
      (make-empty-file entry-path t))
    (find-file entry-path)
    (goto-char (point-min))
    (my-capture--ensure-heading-prepend (my-capture-project-target-heading))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 293: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture-project-target-heading</span> ()
  `(<span class="org-string">"Unreleased"</span> ,(format-time-string <span class="org-string">"%A, %B %-e, %Y"</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 294: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture--ensure-heading-prepend</span> (headings <span class="org-type">&amp;optional</span> initial-level)
  (<span class="org-keyword">if</span> (not headings)
      (widen)
    (<span class="org-keyword">let</span> ((initial-level (<span class="org-keyword">or</span> initial-level 1)))
      (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> (re-search-forward (format org-complex-heading-regexp-format
                                          (regexp-quote (car headings)))
                                  nil t)
               (= (org-current-level) initial-level))
          (<span class="org-keyword">progn</span>
            (message <span class="org-string">"Found heading '%s'"</span> (car headings))
            (beginning-of-line)
            (org-narrow-to-subtree))
        (message <span class="org-string">"Could not find heading '%s'"</span> (car headings))
        (<span class="org-keyword">if</span> (= initial-level 1)
            (goto-char (point-max))
          (end-of-line))
        (<span class="org-keyword">unless</span> (<span class="org-keyword">and</span> (bolp) (eolp)) (insert <span class="org-string">"\n"</span>))
        (insert (make-string initial-level ?*) <span class="org-string">" "</span> (car headings) <span class="org-string">"\n"</span>))
      (my-capture--ensure-heading-prepend (cdr headings) (1+ initial-level)))))
</pre>
</div>
</div>
</li>

<li><a id="org27d3faf"></a>Finalize capture templates<br>
<div class="outline-text-5" id="text-4-8-1-6">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 295: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-org-capture-select-template-prettier-a (<span class="org-type">&amp;optional</span> keys)
  <span class="org-doc">"Select a capture template, in a prettier way than default Lisp programs can</span>
<span class="org-doc">force the template by setting KEYS to a string."</span>
  <span class="org-builtin">:override</span> 'org-capture-select-template
  (<span class="org-keyword">let</span> ((org-capture-templates
         (<span class="org-keyword">or</span> (org-contextualize-keys (org-capture-upgrade-templates org-capture-templates)
                                     org-capture-templates-contexts)
             '((<span class="org-string">"t"</span> <span class="org-string">"Task"</span>
                entry (file+headline <span class="org-string">""</span> <span class="org-string">"Tasks"</span>)
                <span class="org-string">"* TODO %?\n  %u\n  %a"</span>)))))
    (<span class="org-keyword">if</span> keys
        (<span class="org-keyword">or</span> (assoc keys org-capture-templates)
            (<span class="org-warning">error</span> <span class="org-string">"No capture template referred to by \"%s\" keys"</span> keys))
      (org-mks org-capture-templates
               (propertize (<span class="org-keyword">if</span> (+org-capture-frame-p)
                               (concat (s-center 50 <span class="org-string">"Doom Capture"</span>) <span class="org-string">"\n"</span>
                                       (s-center 50 <span class="org-string">"&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;"</span>))
                             (concat <span class="org-string">"Doom Capture\n"</span>
                                     <span class="org-string">"&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;"</span>))
                           'face 'font-lock-type-face)
               <span class="org-string">" "</span>
               `((<span class="org-string">"q"</span> ,(my-capture-description <span class="org-builtin">:text</span> <span class="org-string">"Abort"</span> <span class="org-builtin">:icon</span> `(stop . ,(doom-color 'red 256)))))))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 296: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-org-capture-mks-prettier-a (table title <span class="org-type">&amp;optional</span> prompt specials)
  <span class="org-doc">"Select a member of an alist with multiple keys. Prettified.</span>

<span class="org-doc">TABLE is the alist which should contain entries where the car is a string. There</span>
<span class="org-doc">should be two types of entries.</span>

<span class="org-doc">1. prefix descriptions like (\"a\" \"Description\") This indicates that `a' is a</span>
<span class="org-doc">   prefix key for multi-letter selection, and that there are entries following</span>
<span class="org-doc">   with keys like \"ab\", \"ax\"&#8230;</span>

<span class="org-doc">2. Select-able members must have more than two elements, with the first being</span>
<span class="org-doc">   the string of keys that lead to selecting it, and the second a short</span>
<span class="org-doc">   description string of the item.</span>

<span class="org-doc">The command will then make a temporary buffer listing all entries that can be</span>
<span class="org-doc">selected with a single key, and all the single key prefixes. When you press the</span>
<span class="org-doc">key for a single-letter entry, it is selected. When you press a prefix key, the</span>
<span class="org-doc">commands (and maybe further prefixes) under this key will be shown and offered</span>
<span class="org-doc">for selection.</span>

<span class="org-doc">TITLE will be placed over the selection in the temporary buffer, PROMPT will be</span>
<span class="org-doc">used when prompting for a key. SPECIALS is an alist with (\"key\"</span>
<span class="org-doc">\"description\") entries. When one of these is selected, only the bare key is</span>
<span class="org-doc">returned."</span>
  <span class="org-builtin">:override</span> 'org-mks
  (<span class="org-keyword">save-window-excursion</span>
    (<span class="org-keyword">let</span> ((inhibit-quit t)
          (buffer (org-switch-to-buffer-other-window <span class="org-string">"*Org Select*"</span>))
          (prompt (<span class="org-keyword">or</span> prompt <span class="org-string">"Select: "</span>))
          case-fold-search
          current)
      (<span class="org-keyword">unwind-protect</span>
          (<span class="org-keyword">catch</span> '<span class="org-constant">exit</span>
            (<span class="org-keyword">while</span> t
              (erase-buffer)
              (insert title <span class="org-string">"\n\n"</span>)
              (<span class="org-keyword">let</span> ((original-evil-normal-state-cursor evil-normal-state-cursor)
                    (des-keys nil)
                    (allowed-keys '(<span class="org-string">"\C-g"</span>))
                    (tab-alternatives '(<span class="org-string">"\s"</span> <span class="org-string">"\t"</span> <span class="org-string">"\r"</span>))
                    (cursor-type nil))
                (<span class="org-keyword">setq</span> evil-normal-state-cursor (list nil))
                <span class="org-comment-delimiter">;; </span><span class="org-comment">Populate allowed keys and descriptions keys</span>
                <span class="org-comment-delimiter">;; </span><span class="org-comment">available with CURRENT selector.</span>
                (<span class="org-keyword">let</span> ((re (format <span class="org-string">"\\`%s</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\\'"</span>
                                  (<span class="org-keyword">if</span> current (regexp-quote current) <span class="org-string">""</span>))))
                  (<span class="org-keyword">dolist</span> (entry table)
                    (<span class="org-keyword">pcase</span> entry
                      <span class="org-comment-delimiter">;; </span><span class="org-comment">Description.</span>
                      (`(,(<span class="org-keyword">and</span> key (pred (string-match re))) ,desc)
                       (<span class="org-keyword">let</span> ((k (match-string 1 key)))
                         (<span class="org-keyword">push</span> k des-keys)
                         <span class="org-comment-delimiter">;; </span><span class="org-comment">Keys ending in tab, space or RET are equivalent.</span>
                         (<span class="org-keyword">if</span> (member k tab-alternatives)
                             (<span class="org-keyword">push</span> <span class="org-string">"\t"</span> allowed-keys)
                           (<span class="org-keyword">push</span> k allowed-keys))
                         (insert (my-capture--item-entry k desc current t) <span class="org-string">"\n"</span>)))
                      <span class="org-comment-delimiter">;; </span><span class="org-comment">Usable entry.</span>
                      (`(,(<span class="org-keyword">and</span> key (pred (string-match re))) ,desc . ,_)
                       (<span class="org-keyword">let</span> ((k (match-string 1 key)))
                         (insert (my-capture--item-entry k desc current) <span class="org-string">"\n"</span>)
                         (<span class="org-keyword">push</span> k allowed-keys)))
                      (_ nil))))
                <span class="org-comment-delimiter">;; </span><span class="org-comment">Insert special entries, if any.</span>
                (<span class="org-keyword">when</span> specials
                  (insert <span class="org-string">"\n"</span>)
                  (<span class="org-keyword">pcase-dolist</span> (`(,key ,description) specials)
                    (insert (my-capture--item-entry key
                                                      description
                                                      (<span class="org-keyword">when</span> current
                                                        (s-repeat (length current) <span class="org-string">" "</span>))
                                                      nil
                                                      'all-the-icons-red))
                    (<span class="org-keyword">push</span> key allowed-keys)))
                <span class="org-comment-delimiter">;; </span><span class="org-comment">Display UI and let user select an entry or</span>
                <span class="org-comment-delimiter">;; </span><span class="org-comment">a sub-level prefix.</span>
                (goto-char (point-min))
                (my-capture--refresh-capture-frame)
                (<span class="org-keyword">let</span> ((pressed (org--mks-read-key
                                allowed-keys prompt
                                (not (pos-visible-in-window-p (1- (point-max)))))))
                  (set-frame-name (alist-get 'name +org-capture-frame-parameters))
                  (<span class="org-keyword">setq</span> evil-normal-state-cursor original-evil-normal-state-cursor)
                  (<span class="org-keyword">setq</span> current (concat current pressed))
                  (<span class="org-keyword">cond</span>
                   ((equal pressed <span class="org-string">"\C-g"</span>) (<span class="org-warning">user-error</span> <span class="org-string">"Abort"</span>))
                   <span class="org-comment-delimiter">;; </span><span class="org-comment">Selection is a prefix: open a new menu.</span>
                   ((member pressed des-keys))
                   <span class="org-comment-delimiter">;; </span><span class="org-comment">Selection matches an association: return it.</span>
                   ((<span class="org-keyword">let</span> ((entry (assoc current table)))
                      (<span class="org-keyword">and</span> entry (<span class="org-keyword">throw</span> '<span class="org-constant">exit</span> entry))))
                   <span class="org-comment-delimiter">;; </span><span class="org-comment">Selection matches a special entry: return the</span>
                   <span class="org-comment-delimiter">;; </span><span class="org-comment">selection prefix.</span>
                   ((assoc current specials) (<span class="org-keyword">throw</span> '<span class="org-constant">exit</span> current))
                   (t (<span class="org-warning">error</span> <span class="org-string">"No entry available"</span>)))))))
        (<span class="org-keyword">when</span> buffer
          (kill-buffer buffer))))))

</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 297: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture--item-entry</span> (key description <span class="org-type">&amp;optional</span> prefix parent-option-p key-face-extras)
  <span class="org-doc">"Returns a string representing an Org Capture item with the given KEY and</span>
<span class="org-doc">DESCRIPTION.</span>

<span class="org-doc">PREFIX is the character sequences already pressed during the capture process.</span>

<span class="org-doc">If PARENT-OPTION-P is non-nil, it means the this entry has sub-entries and some</span>
<span class="org-doc">sort of indication should be displayed</span>

<span class="org-doc">The KEY-FACE-EXTRAS is one or more simbols to be added to the KEY face on the</span>
<span class="org-doc">entry."</span>
  (<span class="org-keyword">let</span> ((parent-option-p (<span class="org-keyword">when</span> parent-option-p <span class="org-string">"&#8250;"</span>))
        (prefix (<span class="org-keyword">when</span> prefix (concat prefix <span class="org-string">" "</span>))))
    (concat
     (<span class="org-keyword">when</span> prefix (propertize prefix 'face 'font-lock-comment-face))
     (propertize key 'face (append '(bold) key-face-extras))
     (propertize (<span class="org-keyword">or</span> parent-option-p <span class="org-string">" "</span>) 'face 'font-lock-comment-face)
     <span class="org-string">"  "</span> description (<span class="org-keyword">when</span> parent-option-p <span class="org-string">"&#8230;"</span>))))

</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 298: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my-capture--refresh-capture-frame</span> ()
  <span class="org-doc">"This function is called right after all the capture options were written in the</span>
<span class="org-doc">capture buffer."</span>
  (<span class="org-keyword">when</span> (+org-capture-frame-p)
    (<span class="org-keyword">let</span> ((frame (selected-frame)))
    (set-frame-parameter frame 'left-fringe 30)
    (set-frame-parameter frame 'right-fringe 30)
    (set-frame-name <span class="org-string">" "</span>)
    (set-frame-size frame
                    my-capture--menu-width
                    (+ (line-number-at-pos (point-max)) 3))
    (my-capture--reposition-frame)
    (message <span class="org-string">""</span>))))
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-org1b17a83" class="outline-4">
<h4 id="org1b17a83"><span class="section-number-4">4.8.2</span> Journal</h4>
<div class="outline-text-4" id="text-4-8-2">
<p>
TBD
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 299: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> my-journal-file-format <span class="org-string">"journal-%Y.org"</span>)

(<span class="org-keyword">defconst</span> <span class="org-variable-name">my-journal-file</span> (expand-file-name (format-time-string my-journal-file-format)
                                              my-journal-directory))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 300: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> org-journal
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setq</span> org-journal-encrypt-journal nil
        org-journal-carryover-delete-empty-journal '(ask)
        org-journal-carryover-items <span class="org-string">"TODO=\"STRT\"|TODO=\"HOLD\"|TODO=\"WAIT\"|TODO=\"DELG\""</span>
        org-extend-today-until 4
        org-journal-file-type 'yearly
        org-journal-enable-agenda-integration nil
        org-journal-file-format my-journal-file-format
        org-journal-date-format <span class="org-string">"%A, %B %-e, %Y"</span>
        org-journal-time-format <span class="org-string">"%H:%M%#p - "</span>
        org-journal-time-format-post-midnight <span class="org-string">"+%H:%M%#p - "</span>
                            org-journal-file-header (concat <span class="org-string">"#+TITLE: Daily Journal for %Y (%Z)\n"</span>
                                        <span class="org-string">"#+STARTUP: overview\n"</span>
                                        <span class="org-string">"#+CATEGORY: journal\n"</span>
                                        <span class="org-string">"\n"</span>))

  (font-lock-add-keywords 'org-journal-mode my-org-font-lock-beautify-keywords)
  (set-window-buffer nil (current-buffer)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 301: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-journal/new-entry</span> (<span class="org-type">&amp;optional</span> prefix add-header-p variable make-local)
  <span class="org-doc">"Open a journal file and start a new entry. Without any arguments, this function</span>
<span class="org-doc">is equivalent to calling `(org-journal-new-entry t)'</span>

<span class="org-doc">With PREFIX argumant, request the journal timestamp to the user.</span>

<span class="org-doc">If ADD-HEADER-P is non-nil, fully create the new entry (this is equivalent</span>
<span class="org-doc">to `(not PREFIX)' on the `</span><span class="org-doc"><span class="org-constant">org-journal-new-entry</span></span><span class="org-doc">').</span>

<span class="org-doc">VARIABLE is a string that, when set, will store the timestamp value selected by</span>
<span class="org-doc">the user. This function ignores this argument if PREFIX is nil.</span>

<span class="org-doc">When MAKE-LOCAL is a non-nil value, this function uses VARIABLE to create a</span>
<span class="org-doc">local variable. If PREFIX or VARIABLE is nil, this argument has no effect."</span>
  (<span class="org-keyword">interactive</span> <span class="org-string">"P"</span>)
  (<span class="org-keyword">when</span> make-local
    (make-local-variable variable))
  (org-journal-new-entry (not add-header-p)
                         (<span class="org-keyword">when</span> variable
                           (set variable
                                (<span class="org-keyword">when</span> prefix
                                  (org-read-date t t nil <span class="org-string">"New entry"</span>))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7cc56c2" class="outline-4">
<h4 id="org7cc56c2"><span class="section-number-4">4.8.3</span> Zettelkasten</h4>
<div class="outline-text-4" id="text-4-8-3">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 302: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> org-roam
  <span class="org-builtin">:commands</span> (org-roam-capture)
  <span class="org-builtin">:custom</span>
  (org-roam-capture-templates
   '((<span class="org-string">"d"</span> <span class="org-string">"default"</span> plain (<span class="org-keyword">function</span> org-roam-capture--get-point)
      <span class="org-string">"%?"</span>
      <span class="org-builtin">:file-name</span> <span class="org-string">"%(s-trim-right (shell-command-to-string \"uuidgen\"))"</span>
      <span class="org-builtin">:head</span> <span class="org-string">"#+TITLE: ${title}\n#+ROAM_TAGS: \n\n"</span>
      <span class="org-builtin">:unnarrowed</span> t)))
  (org-roam-capture-ref-templates
   '((<span class="org-string">"r"</span> <span class="org-string">"ref"</span> plain (<span class="org-keyword">function</span> org-roam-capture--get-point)
      <span class="org-string">"\n#+BEGIN_QUOTE\n${selection}\n#+END_QUOTE\n\n%?\n\n* See Also\n\n- source :: ${ref}\n"</span>
      <span class="org-builtin">:file-name</span> <span class="org-string">"websites/%(s-trim-right (shell-command-to-string \"uuidgen\"))-${slug}"</span>
      <span class="org-builtin">:head</span> <span class="org-string">"#+TITLE: ${title}\n#+ROAM_TAGS: \n#+ROAM_KEY: ${ref}\n"</span>
      <span class="org-builtin">:unnarrowed</span> t))))

<span class="org-comment-delimiter">;; </span><span class="org-comment">(use-package! nroam</span>
<span class="org-comment-delimiter">;;   </span><span class="org-comment">:hook '(org-roam-mode . nroam-setup-maybe))</span>

(<span class="org-keyword">after!</span> org-roam
  (<span class="org-keyword">setq</span> org-roam-link-title-format <span class="org-string">"&#10001; %s"</span>
        org-roam-graph-extra-config '((<span class="org-string">"overlap"</span> . <span class="org-string">"false"</span>))
        org-roam-encrypt-files nil
        org-roam-directory my-notes-directory
        +org-roam-open-buffer-on-find-file nil))
</pre>
</div>
</div>
</div>

<div id="outline-container-org75d2af1" class="outline-4">
<h4 id="org75d2af1"><span class="section-number-4">4.8.4</span> Deft</h4>
<div class="outline-text-4" id="text-4-8-4">
<p>
TBD
</p>
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 303: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> deft-directory my-notes-directory
      deft-strip-summary-regexp (concat <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">"</span>
                                        <span class="org-string">"[\n\t]"</span>                    <span class="org-comment-delimiter">;; </span><span class="org-comment">blank</span>
                                        <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">^#\\+[[:upper:]_]+:.*$"</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">org-mode metadata</span>
                                        <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span>)
      deft-time-format <span class="org-string">"  %A, %B %e %Y (%H:%M)"</span>)

(<span class="org-keyword">add-hook!</span> 'deft-mode-hook
  (<span class="org-keyword">defun</span> <span class="org-function-name">my-deft-buffer-config-h</span> ()
    (hl-line-mode 1)
    (<span class="org-keyword">setq-local</span> evil-normal-state-cursor (list nil)
                evil-insert-state-cursor (list nil))))

(map! <span class="org-builtin">:after</span> deft
      (<span class="org-builtin">:map</span> deft-mode-map
       <span class="org-builtin">:i</span>   <span class="org-string">"&lt;escape&gt;"</span> #'kill-current-buffer
       <span class="org-builtin">:i</span>   <span class="org-string">"C-c C-q"</span>  #'kill-current-buffer
       <span class="org-builtin">:i</span>   <span class="org-string">"C-j"</span>      #'widget-forward
       <span class="org-builtin">:i</span>   <span class="org-string">"C-k"</span>      #'widget-backward))
</pre>
</div>
</div>
</div>

<div id="outline-container-org069e8ce" class="outline-4">
<h4 id="org069e8ce"><span class="section-number-4">4.8.5</span> Utilities</h4>
<div class="outline-text-4" id="text-4-8-5">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 304: </span>$DOOMDIR/autoload/writing.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-notes-add-action-item</span> ()
  (<span class="org-keyword">interactive</span>)
  (call-interactively '+org/insert-item-below)
  (insert <span class="org-string">"Action Items"</span>)
  (call-interactively 'org-insert-subheading)
  (insert <span class="org-string">"TODO "</span>))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 305: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:after</span> org
      (<span class="org-builtin">:map</span> org-mode-map
       <span class="org-builtin">:leader</span>
       (<span class="org-builtin">:prefix</span> (<span class="org-string">"n"</span> . <span class="org-string">"notes"</span>)
        (<span class="org-builtin">:prefix</span> (<span class="org-string">"i"</span> . <span class="org-string">"notes-insert"</span>)
         <span class="org-builtin">:desc</span> <span class="org-string">"Insert action items"</span>  <span class="org-string">"a"</span> #'my-notes-add-action-item))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 306: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> plantuml-mode
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> plantuml-jar-path <span class="org-string">"/usr/local/var/homebrew/linked/plantuml/libexec/plantuml.jar"</span>
        org-plantuml-jar-path plantuml-jar-path)
  (set-popup-rule! <span class="org-string">"^\\*PLANTUML"</span> <span class="org-builtin">:size</span> 0.4 <span class="org-builtin">:side</span> 'right <span class="org-builtin">:select</span> nil <span class="org-builtin">:ttl</span> 0))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1746aa7" class="outline-3">
<h3 id="org1746aa7"><span class="section-number-3">4.9</span> <span class="todo TODO">TODO</span> Other modes</h3>
<div class="outline-text-3" id="text-4-9">
<p>
Although my writing will be exclusive in <code>org-mode</code>, I'm still interaction with other writing modes, and I want the experience using those modes to get <i>as close as possible</i> to the experience with <code>org-mode</code>.
</p>
</div>

<div id="outline-container-org643c516" class="outline-4">
<h4 id="org643c516"><span class="section-number-4">4.9.1</span> Markdown</h4>
<div class="outline-text-4" id="text-4-9-1">
<p>
TBD
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 307: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> markdown-split-window-direction 'right
      markdown-list-item-bullets '(<span class="org-string">"&#8226;"</span> <span class="org-string">"&#8227;"</span> <span class="org-string">"&#8269;"</span>)
      markdown-blockquote-display-char `(,(propertize <span class="org-string">"&#9612;"</span> 'face '(<span class="org-builtin">:inherit</span> markdown-blockquote-face
                                                                  <span class="org-builtin">:slant</span> normal))
                                         ,(propertize <span class="org-string">"&#9475;"</span> 'face '(<span class="org-builtin">:inherit</span> markdown-blockquote-face
                                                                  <span class="org-builtin">:slant</span> normal))
                                         <span class="org-string">"&gt;"</span>)
      markdown-header-scaling t
      markdown-header-scaling-values (list (face-attribute 'my-headline-1 <span class="org-builtin">:height</span>)
                                           (face-attribute 'my-headline-2 <span class="org-builtin">:height</span>)
                                           (face-attribute 'my-headline-3 <span class="org-builtin">:height</span>)
                                           (face-attribute 'my-headline-4 <span class="org-builtin">:height</span>)
                                           (face-attribute 'my-headline-5 <span class="org-builtin">:height</span>)
                                           (face-attribute 'my-headline-6 <span class="org-builtin">:height</span>)))

(my-typography-reset (<span class="org-keyword">cl-loop</span> for i from 1 to 6 collect (intern (format <span class="org-string">"markdown-header-face-%d"</span> i))))
(my-typography-reset 'markdown-code-face)

(custom-set-faces!
  `(markdown-header-face-1 <span class="org-builtin">:inherit</span> outline-1 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  `(markdown-header-face-2 <span class="org-builtin">:inherit</span> outline-2 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  `(markdown-header-face-3 <span class="org-builtin">:inherit</span> outline-3 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  `(markdown-header-face-4 <span class="org-builtin">:inherit</span> outline-4 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  `(markdown-header-face-5 <span class="org-builtin">:inherit</span> outline-5 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  `(markdown-header-face-6 <span class="org-builtin">:inherit</span> outline-6 <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  '(markdown-code-face <span class="org-builtin">:inherit</span> my-default-mono <span class="org-builtin">:weight</span> unspecified <span class="org-builtin">:extend</span> unspecified)
  `(markdown-header-face <span class="org-builtin">:inherit</span> unspecified)
  `(markdown-list-face <span class="org-builtin">:foreground</span> unspecified <span class="org-builtin">:inherit</span> org-list-dt))

(<span class="org-keyword">add-hook!</span> (markdown-mode gfm-mode)
  (<span class="org-keyword">defun</span> <span class="org-function-name">my-markdown-buffer-config-h</span> ()
    (+zen/toggle 1)
    (variable-pitch-mode 1)
    (markdown-toggle-markup-hiding 1)))
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org4af6ec0" class="outline-2">
<h2 id="org4af6ec0"><span class="section-number-2">5</span> Development</h2>
<div class="outline-text-2" id="text-5">
<p>
TBD
</p>
</div>

<div id="outline-container-org1579374" class="outline-3">
<h3 id="org1579374"><span class="section-number-3">5.1</span> <span class="todo TODO">TODO</span> Requirements</h3>
<div class="outline-text-3" id="text-5-1">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 308: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> lsp-ui
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:custom</span>
  (lsp-ui-sideline-show-hover t)
  (lsp-ui-doc-enable t))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb92885a" class="outline-3">
<h3 id="orgb92885a"><span class="section-number-3">5.2</span> <span class="todo TODO">TODO</span> Common configuration</h3>
<div class="outline-text-3" id="text-5-2">
<p>
TBD
</p>
</div>

<div id="outline-container-orgd81a946" class="outline-4">
<h4 id="orgd81a946"><span class="section-number-4">5.2.1</span> Version control system</h4>
<div class="outline-text-4" id="text-5-2-1">
<ul class="org-ul">
<li><a href="https://github.com/Townk/gitmoji">https://github.com/Townk/gitmoji</a></li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 309: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">if</span> (getenv <span class="org-string">"GITHUB_WORKFLOW"</span>)
    (<span class="org-keyword">package!</span> gitmoji
      <span class="org-builtin">:recipe</span> (<span class="org-builtin">:host</span> github
               <span class="org-builtin">:repo</span> <span class="org-string">"Townk/gitmoji"</span>))
  (<span class="org-keyword">package!</span> gitmoji
    <span class="org-builtin">:recipe</span> (<span class="org-builtin">:local-repo</span> <span class="org-string">"~/workplace/personal/emacs/gitmoji"</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 310: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> gitmoji
  <span class="org-builtin">:commands</span> (gitmoji-insert gitmoji-select)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> gitmoji-insert-utf8-emoji t
        gitmoji-display-utf8-emoji t))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 311: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> magit
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(remove-hook 'server-switch-hook 'magit-commit-diff)</span>
  (add-hook 'git-commit-setup-hook 'my-git-commit-buffer-config-h))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 312: </span>$DOOMDIR/autoload/development.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-git-commit-buffer-config-h</span> ()
  <span class="org-doc">"Configure the Git Commit Message buffer."</span>
  (<span class="org-keyword">setq-local</span> display-fill-column-indicator-column 72)
  (display-fill-column-indicator-mode 1)
  (goto-char (point-min))
  (evil-append-line 1)
  (yas-expand-snippet (yas-lookup-snippet <span class="org-string">"commit-message"</span> 'git-commit-mode)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 313: </span>$DOOMDIR/snippets/git-commit-mode/commit-message</label><pre class="src src-snippet"># name: commit-message
# key: msg
# --
${1:$$(unless (or yas-moving-away-p yas-modified-p)
	      (yas-auto-next
		(condition-case nil
		    (or (gitmoji-select) "")
		  ('quit ""))))}${2:Subject}

;-------------------------------------------------|
;       Do not pass this column on the subject -&gt; |
;-------------------------------------------------|
${3:`"## Changes Description\n"`}$0
; 1. Separate subject from body with a blank line
; 2. Limit the subject line to 50 characters
; 3. Capitalize the subject line
; 4. Do not end the subject line with a period
; 5. Use the imperative mood in the subject line
; 6. Wrap the body at 72 characters
; 7. Use the body to explain what and why vs. how
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc705167" class="outline-4">
<h4 id="orgc705167"><span class="section-number-4">5.2.2</span> Comments</h4>
<div class="outline-text-4" id="text-5-2-2">
<p>
TBD
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 314: </span>$DOOMDIR/autoload/development.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-comment-and-next-line-a (func <span class="org-type">&amp;rest</span> args)
  <span class="org-builtin">:around</span> 'evilnc-comment-or-uncomment-lines
  (<span class="org-keyword">let</span> ((no-selection-p (not (region-active-p))))
    (apply func args)
    (<span class="org-keyword">when</span> no-selection-p
      (next-line)
      (goto-char (point-at-bol))
      (skip-chars-forward <span class="org-string">" \t\r"</span>))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4fa14c1" class="outline-3">
<h3 id="org4fa14c1"><span class="section-number-3">5.3</span> <span class="todo TODO">TODO</span> Lisp</h3>
<div class="outline-text-3" id="text-5-3">
<p>
TBD
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 315: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> emacs-lisp-docstring-fill-column 80)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb091443" class="outline-3">
<h3 id="orgb091443"><span class="section-number-3">5.4</span> <span class="todo TODO">TODO</span> Shell script</h3>
</div>
<div id="outline-container-org24f1a60" class="outline-3">
<h3 id="org24f1a60"><span class="section-number-3">5.5</span> <span class="todo TODO">TODO</span> Python</h3>
</div>
<div id="outline-container-orgd82645d" class="outline-3">
<h3 id="orgd82645d"><span class="section-number-3">5.6</span> <span class="todo TODO">TODO</span> Ansible</h3>
<div class="outline-text-3" id="text-5-6">
<p>
TBD
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 316: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(def-project-mode! +ansible-yaml-mode
  <span class="org-builtin">:modes</span> '(yaml-mode)
  <span class="org-builtin">:add-hooks</span> '(ansible ansible-auto-decrypt-encrypt ansible-doc-mode)
  <span class="org-builtin">:files</span> (<span class="org-keyword">and</span> <span class="org-string">"ansible.cfg"</span>
              (<span class="org-keyword">or</span> <span class="org-string">"main.yaml"</span>
                  <span class="org-string">"main.yml"</span>
                  <span class="org-string">"tasks/main.yaml"</span>
                  <span class="org-string">"tasks/main.yml"</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org1752227" class="outline-3">
<h3 id="org1752227"><span class="section-number-3">5.7</span> <span class="todo TODO">TODO</span> Javascript/TypeScript</h3>
</div>
<div id="outline-container-org6084756" class="outline-3">
<h3 id="org6084756"><span class="section-number-3">5.8</span> <span class="todo TODO">TODO</span> C/C++</h3>
</div>
<div id="outline-container-org970fa72" class="outline-3">
<h3 id="org970fa72"><span class="section-number-3">5.9</span> <span class="todo TODO">TODO</span> Swift</h3>
</div>
<div id="outline-container-orgade2f8f" class="outline-3">
<h3 id="orgade2f8f"><span class="section-number-3">5.10</span> <span class="todo TODO">TODO</span> Kotlin</h3>
</div>
<div id="outline-container-org80d8c40" class="outline-3">
<h3 id="org80d8c40"><span class="section-number-3">5.11</span> <span class="todo TODO">TODO</span> Java</h3>
</div>
</div>

<div id="outline-container-org4807e8c" class="outline-2">
<h2 id="org4807e8c"><span class="section-number-2">6</span> Non-editor features</h2>
<div class="outline-text-2" id="text-6">
<p>
TBD
</p>
</div>

<div id="outline-container-org27e5e93" class="outline-3">
<h3 id="org27e5e93"><span class="section-number-3">6.1</span> <span class="todo TODO">TODO</span> Requirements</h3>
</div>
<div id="outline-container-orgfdc9075" class="outline-3">
<h3 id="orgfdc9075"><span class="section-number-3">6.2</span> <span class="todo TODO">TODO</span> File management</h3>
<div class="outline-text-3" id="text-6-2">
<p>
Before we start configuring the target packages for this section (<code>dired</code> and <code>eshel</code>), I want to make some small adjustments to Treemacs. Although it is not a full blown file manager, it is a sort of a file manager for my projects, so it fits in this section.
</p>

<p>
The next change is to use our custom <code>my-default-ui</code> font face. I have to replace the entire <code>doom-themes-enable-treemacs-variable-pitch-labels</code> function with a version that uses my custom font instead. To do that, I'll use Emacs advices:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 317: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-themes-enable-treemacs-variable-pitch-labels-a (<span class="org-type">&amp;rest</span> _)
  <span class="org-doc">"This advice changes the treemacs variable pitch font to one without serif so</span>
<span class="org-doc">the UI looks more polished."</span>
  <span class="org-builtin">:override</span> #'doom-themes-enable-treemacs-variable-pitch-labels
  (<span class="org-keyword">when</span> doom-themes-treemacs-enable-variable-pitch
    (<span class="org-keyword">dolist</span> (face '(treemacs-root-face
                    treemacs-git-unmodified-face
                    treemacs-git-modified-face
                    treemacs-git-renamed-face
                    treemacs-git-ignored-face
                    treemacs-git-untracked-face
                    treemacs-git-added-face
                    treemacs-git-conflict-face
                    treemacs-directory-face
                    treemacs-directory-collapsed-face
                    treemacs-file-face
                    treemacs-tags-face))
      (<span class="org-keyword">let</span> ((faces (face-attribute face <span class="org-builtin">:inherit</span> nil)))
        (set-face-attribute
         face nil <span class="org-builtin">:inherit</span>
         `(my-default-ui ,@(delq 'unspecified (<span class="org-keyword">if</span> (listp faces) faces (list faces)))))))))
</pre>
</div>

<p>
By default, Treemacs will stay opened after you select a file to visit. Personally I don't like this, I rather have Treemacs closing when I select a file.
</p>

<p>
In order to help me achieve my desired behavior, I'll  create another <i>autoload</i> function that I'll call when I select a file:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 318: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-treemacs-visit-node-and-close-h</span> (<span class="org-type">&amp;optional</span> arg)
  <span class="org-doc">"Closes treemacs window after selecting a file to visit."</span>
  (treemacs-visit-node-default arg)
  (delete-window (treemacs-get-local-window)))
</pre>
</div>

<p>
We can now, configure Treemacs properly:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 319: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> treemacs
</pre>
</div>

<p>
First we need to tell Treemacs to use the new autoload function when I press <code>&lt;ENTER&gt;</code> on a file:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 320: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(treemacs-define-RET-action 'file-node-open #'my-treemacs-visit-node-and-close-h)
(treemacs-define-RET-action 'file-node-closed #'my-treemacs-visit-node-and-close-h)
</pre>
</div>

<p>
Then, I like Treemacs to collapse directory into one when possible:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 321: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> treemacs-collapse-dirs (<span class="org-keyword">if</span> (executable-find <span class="org-string">"python3"</span>) 3 0))
</pre>
</div>

<p>
<a href="https://andreyorst.gitlab.io/posts/2020-05-01-dynamic-title-for-treemacs-workspace/">https://andreyorst.gitlab.io/posts/2020-05-01-dynamic-title-for-treemacs-workspace/</a>
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 322: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-treemacs-buffer-config-h</span> ()
  (<span class="org-keyword">let</span> ((bg (face-attribute 'default <span class="org-builtin">:background</span>))
        (fg (face-attribute 'default <span class="org-builtin">:foreground</span>)))
    (face-remap-add-relative 'header-line
                             <span class="org-builtin">:background</span> bg <span class="org-builtin">:foreground</span> fg
                             <span class="org-builtin">:box</span> `(<span class="org-builtin">:line-width</span> ,(/ my-line-pixel-height 2) <span class="org-builtin">:color</span> ,bg)))
  (<span class="org-keyword">setq</span> header-line-format
        '((<span class="org-builtin">:eval</span>
           (concat
            <span class="org-string">" &#9776; "</span>
            (propertize (s-titleize (persp-current-name)) 'face 'my-ui-window-header))))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 323: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(add-hook 'treemacs-mode-hook #'my-treemacs-buffer-config-h)
</pre>
</div>

<p>
And finally, we can close our Treemacs configuration
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 324: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">)
</pre>
</div>

<p>
I also like to make sure it behaves as expected if I use the mouse:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 325: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map!
 (<span class="org-builtin">:after</span> treemacs
  (<span class="org-builtin">:map</span> treemacs-mode-map
   [mouse-1] #'treemacs-single-click-expand-action))

 (<span class="org-builtin">:after</span> treemacs-evil
  (<span class="org-builtin">:map</span> evil-treemacs-state-map
   <span class="org-string">"C-h"</span> #'evil-window-left
   <span class="org-string">"C-l"</span> #'evil-window-right))

 (<span class="org-builtin">:after</span> cfrs
  (<span class="org-builtin">:map</span> cfrs-input-mode-map
   <span class="org-builtin">:n</span> [escape] #'cfrs-cancel)))
</pre>
</div>

<p>
Treemacs offers a function that adds the current project if it is not on the workspace. That is a nice feature, but because I use workspaces heavily, the fact that this function does not <i>remove</i> projects that do not belong to this workspace bothers me, so I  wrote this advice to do the dirty work for me:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 326: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-treemacs-add-and-display-current-project-a ()
  <span class="org-doc">"Open treemacs with current project. This function removes any project that is</span>
<span class="org-doc">not the current one."</span>
  <span class="org-builtin">:override</span> #'treemacs-add-and-display-current-project
  (<span class="org-keyword">interactive</span>)

  (<span class="org-keyword">cl-dolist</span> (p (treemacs-workspace-&gt;projects (treemacs-current-workspace)))
    (<span class="org-keyword">unless</span> (string= (doom-project-name) (treemacs-project-&gt;name p))
      (treemacs-do-remove-project-from-workspace p t)))

  (<span class="org-keyword">when</span> (treemacs-workspace-&gt;is-empty?)
      (treemacs-do-add-project-to-workspace (doom-project-root) (doom-project-name)))

  (treemacs-select-window)
  (treemacs-pulse-on-success))
</pre>
</div>

<p>
And to finalize the Treemacs configuration, let's make it respect my window navigation keys:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 327: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-dired-toggle-git-mode</span> ()
  <span class="org-doc">"Toggle `</span><span class="org-doc"><span class="org-constant">dired-git-info-mode</span></span><span class="org-doc">' in git repos."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> (not (file-remote-p default-directory))
             (locate-dominating-file <span class="org-string">"."</span> <span class="org-string">".git"</span>))
    (call-interactively 'dired-git-info-mode)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 328: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-dired-open-directory</span> ()
  <span class="org-doc">"Enters in the directory at point. If the cursor is not on a directory, do</span>
<span class="org-doc">nothing."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((target-file (dired-get-file-for-visit)))
    (<span class="org-keyword">when</span> (<span class="org-keyword">or</span> (file-directory-p target-file)
              (dired-avfs--archive-p target-file))
      (dired-find-file))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 329: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-dired-mac-quick-view</span> ()
  <span class="org-doc">"Invoke the macOS Quiclview on the file under point."</span>
  (<span class="org-keyword">interactive</span>)
  (shell-command (concat <span class="org-string">"qlmanage -p \""</span>
                         (dired-get-file-for-visit)
                         <span class="org-string">"\" &gt; /dev/null 2&gt;&amp;1"</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 330: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-dired-widen-or-quit-all</span> ()
  <span class="org-doc">"If `</span><span class="org-doc"><span class="org-constant">dired-narow</span></span><span class="org-doc">' is on, revert to the normal view. If there is no active</span>
<span class="org-doc">narrow, quit Dired."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> dired-narrow-mode
      (revert-buffer)
    (mapc (<span class="org-keyword">lambda</span> (buf)
            (<span class="org-keyword">let</span> ((win (get-buffer-window buf)))
              (<span class="org-keyword">unless</span> (append (window-prev-buffers win) (window-prev-buffers win))
                (delete-window win))
              (kill-buffer buf)))
          (doom-buffers-in-mode 'dired-mode))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 331: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-dired-narrow</span> (narrow-func)
  <span class="org-doc">"Start a dynamic narrowing of files in current view."</span>
  (<span class="org-keyword">interactive</span>
   (list (<span class="org-keyword">if</span> current-prefix-arg
             'dired-narrow-fuzzy
           'dired-narrow-regexp)))
  (call-interactively narrow-func))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 332: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-dired-yank-absolute-path</span> ()
  <span class="org-doc">"Copy the absolute path of file on pointer to kill ring."</span>
  (<span class="org-keyword">interactive</span>)
  (dired-copy-filename-as-kill 0))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 333: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-dired-yank-relative-path</span> ()
  <span class="org-doc">"Copy the relative path of file on pointer to kill ring."</span>
  (<span class="org-keyword">interactive</span>)
  (dired-copy-filename-as-kill))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 334: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-dired-open-externally</span> ()
  <span class="org-doc">"Open file with application defined by OS."</span>
  (<span class="org-keyword">interactive</span>)
  (shell-command (concat <span class="org-string">"open \""</span>
                         (dired-get-file-for-visit)
                         <span class="org-string">"\" &gt; /dev/null 2&gt;&amp;1"</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 335: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-dired-reveal-on-finder</span> ()
  <span class="org-doc">"Show current file in Finder."</span>
  (<span class="org-keyword">interactive</span>)
  (shell-command (concat <span class="org-string">"open --reveal \""</span>
                         (dired-get-file-for-visit)
                         <span class="org-string">"\" &gt; /dev/null 2&gt;&amp;1"</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 336: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-dired-marked-file-p</span> ()
  <span class="org-doc">"Return non-nil if we have marked file at point."</span>
  (dired-file-marker (dired-get-file-for-visit)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 337: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-dired-toggle-mark</span> (<span class="org-type">&amp;optional</span> _)
  <span class="org-doc">"Toggle mark of file at point."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> (my-dired-marked-file-p)
      (dired-unmark 1)
    (dired-mark 1)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 338: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-dired-open-split-right</span> ()
  (<span class="org-keyword">interactive</span>)
  (select-window
   (window--display-buffer (find-file-noselect (dired-get-file-for-visit))
                           (split-window-right)
                           'window)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 339: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-dired-open-split-bellow</span> ()
  (<span class="org-keyword">interactive</span>)
  (select-window
   (window--display-buffer (find-file-noselect (dired-get-file-for-visit))
                           (split-window-below)
                           'window)))
</pre>
</div>

<ul class="org-ul">
<li><a href="https://github.com/Fuco1/dired-hacks">https://github.com/Fuco1/dired-hacks</a> for all packages</li>
<li><a href="https://blog.breadncup.com/2012/05/27/emacs-sunrise-commander-and-avfs-fuse-unionfs-fuse-in-mac-os-x-lion/">https://blog.breadncup.com/2012/05/27/emacs-sunrise-commander-and-avfs-fuse-unionfs-fuse-in-mac-os-x-lion/</a> for starting the avfsd service</li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 340: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> dired-collapse)
(<span class="org-keyword">package!</span> dired-narrow)
(<span class="org-keyword">package!</span> dired-ranger)
(<span class="org-keyword">package!</span> dired-quick-sort)
(<span class="org-keyword">package!</span> dired-avfs)
(<span class="org-keyword">package!</span> peep-dired)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 341: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> dired
  (<span class="org-keyword">setq</span>
        auto-revert-verbose nil
        dired-dwim-target t
        dired-listing-switches <span class="org-string">"-lAhvFoG --group-directories-first"</span>
        dired-omit-files <span class="org-string">"^\\.?#</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">^\\.$</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">^\\.\\.$</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">^\\..+$</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">^.DS_STORE$</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">^.projectile$"</span>
        dired-recursive-copies '(always)
        dired-recursive-deletes '(top)
        dired-use-ls-dired t
        global-auto-revert-non-file-buffers t
        insert-directory-program <span class="org-string">"gls"</span>
        wdired-allow-to-change-permissions t
        wdired-allow-to-redirect-links t
        wdired-confirm-overwrite t))

(<span class="org-keyword">use-package!</span> peep-dired
  <span class="org-builtin">:after</span> dired
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> peep-dired-cleanup-on-disable t
        peep-dired-cleanup-eagerly t
        peep-dired-enable-on-directories nil))
(<span class="org-keyword">use-package!</span> dired-collapse <span class="org-builtin">:after</span> dired)
(<span class="org-keyword">use-package!</span> dired-narrow <span class="org-builtin">:after</span> dired)
(<span class="org-keyword">use-package!</span> dired-quick-sort
  <span class="org-builtin">:hook</span> ((dired-mode . dired-quick-sort)))
(<span class="org-keyword">use-package!</span> dired-avfs
  <span class="org-builtin">:after</span> dired
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> dired-avfs-root <span class="org-string">"~/.local/var/avfs"</span>))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 342: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:after</span> dired
      (<span class="org-builtin">:map</span> dired-mode-map
       <span class="org-builtin">:ne</span> <span class="org-string">"t"</span>        nil
       <span class="org-builtin">:ne</span> <span class="org-string">"y"</span>        nil
       <span class="org-builtin">:ne</span> <span class="org-string">"c"</span>        nil
       <span class="org-builtin">:ne</span> <span class="org-string">"o"</span>        nil
       <span class="org-builtin">:ne</span> <span class="org-string">"m"</span>        nil
       <span class="org-builtin">:ne</span> <span class="org-string">"/"</span>        #'my-dired-narrow
       <span class="org-builtin">:ne</span> <span class="org-string">"&lt;escape&gt;"</span> #'my-dired-widen-or-quit-all
       <span class="org-builtin">:ne</span> <span class="org-string">"q"</span>        #'my-dired-widen-or-quit-all
       <span class="org-builtin">:ne</span> <span class="org-string">"RET"</span>      #'dired-find-file
       <span class="org-builtin">:ne</span> <span class="org-string">"TAB"</span>      #'my-dired-open-directory
       <span class="org-builtin">:ne</span> <span class="org-string">"&lt;tab&gt;"</span>    #'my-dired-open-directory
       <span class="org-builtin">:ne</span> <span class="org-string">"j"</span>        #'dired-next-line
       <span class="org-builtin">:ne</span> <span class="org-string">"k"</span>        #'dired-previous-line
       <span class="org-builtin">:ne</span> <span class="org-string">"l"</span>        #'my-dired-open-directory
       <span class="org-builtin">:ne</span> <span class="org-string">"h"</span>        #'dired-up-directory
       <span class="org-builtin">:ne</span> <span class="org-string">"U"</span>        #'dired-up-directory
       <span class="org-builtin">:ne</span> <span class="org-string">"R"</span>        #'dired-do-rename
       <span class="org-builtin">:ne</span> <span class="org-string">"d"</span>        #'dired-do-delete
       <span class="org-builtin">:ne</span> <span class="org-string">"x"</span>        #'my-dired-toggle-mark
       <span class="org-builtin">:ne</span> <span class="org-string">"p"</span>        #'dired-ranger-paste
       <span class="org-builtin">:ne</span> <span class="org-string">"M"</span>        #'dired-ranger-move
       <span class="org-builtin">:ne</span> <span class="org-string">"`"</span>        #'dired-ranger-bookmark
       <span class="org-builtin">:ne</span> <span class="org-string">"'"</span>        #'dired-ranger-bookmark-visit
       (<span class="org-builtin">:prefix</span> (<span class="org-string">"c"</span> . <span class="org-string">"create"</span>)
        <span class="org-builtin">:desc</span> <span class="org-string">"Create empty file"</span>     <span class="org-builtin">:ne</span> <span class="org-string">"f"</span> #'dired-create-empty-file
        <span class="org-builtin">:desc</span> <span class="org-string">"Create directory"</span>      <span class="org-builtin">:ne</span> <span class="org-string">"d"</span> #'dired-create-directory
        <span class="org-builtin">:desc</span> <span class="org-string">"Create project"</span>        <span class="org-builtin">:ne</span> <span class="org-string">"p"</span> #'xxx)
       (<span class="org-builtin">:prefix</span> (<span class="org-string">"m"</span> . <span class="org-string">"mark"</span>)
        <span class="org-builtin">:ne</span> <span class="org-string">"h"</span> nil
        <span class="org-builtin">:desc</span> <span class="org-string">"Mark directories"</span>  <span class="org-builtin">:ne</span> <span class="org-string">"d"</span> #'dired-mark-directories
        <span class="org-builtin">:desc</span> <span class="org-string">"Mark extension"</span>    <span class="org-builtin">:ne</span> <span class="org-string">"e"</span> #'dired-mark-extension
        <span class="org-builtin">:desc</span> <span class="org-string">"Mark hidden files"</span> <span class="org-builtin">:ne</span> <span class="org-string">"h"</span> #'dired-mark-omitted
        <span class="org-builtin">:desc</span> <span class="org-string">"Mark with regexp"</span>  <span class="org-builtin">:ne</span> <span class="org-string">"r"</span> #'dired-mark-files-regexp
        <span class="org-builtin">:desc</span> <span class="org-string">"Mark subdir files"</span> <span class="org-builtin">:ne</span> <span class="org-string">"s"</span> #'dired-mark-omitted
        <span class="org-builtin">:desc</span> <span class="org-string">"Unmark all files"</span>  <span class="org-builtin">:ne</span> <span class="org-string">"u"</span> #'dired-unmark-all-files
        <span class="org-builtin">:desc</span> <span class="org-string">"Remove all marks"</span>  <span class="org-builtin">:ne</span> <span class="org-string">"U"</span> #'dired-unmark-all-marks
        <span class="org-builtin">:desc</span> <span class="org-string">"Mark executables"</span>  <span class="org-builtin">:ne</span> <span class="org-string">"x"</span> #'dired-mark-executables)
       (<span class="org-builtin">:prefix</span> (<span class="org-string">"o"</span> . <span class="org-string">"open"</span>)
        <span class="org-builtin">:desc</span> <span class="org-string">"Open no split"</span>         <span class="org-builtin">:ne</span> <span class="org-string">"o"</span> #'dired-find-alternate-file
        <span class="org-builtin">:desc</span> <span class="org-string">"Quick view"</span>            <span class="org-builtin">:ne</span> <span class="org-string">"q"</span> #'my-dired-mac-quick-view
        <span class="org-builtin">:desc</span> <span class="org-string">"Reveal on Finder"</span>      <span class="org-builtin">:ne</span> <span class="org-string">"f"</span> #'my-dired-reveal-on-finder
        <span class="org-builtin">:desc</span> <span class="org-string">"Open vertically"</span>       <span class="org-builtin">:ne</span> <span class="org-string">"s"</span> #'my-dired-open-split-bellow
        <span class="org-builtin">:desc</span> <span class="org-string">"Open horizontally"</span>     <span class="org-builtin">:ne</span> <span class="org-string">"v"</span> #'my-dired-open-split-right
        <span class="org-builtin">:desc</span> <span class="org-string">"Open externally"</span>       <span class="org-builtin">:ne</span> <span class="org-string">"x"</span> #'my-dired-open-externally)
       (<span class="org-builtin">:prefix</span> (<span class="org-string">"t"</span> . <span class="org-string">"toggle"</span>)
        <span class="org-builtin">:desc</span> <span class="org-string">"Toggle collapsed dirs"</span> <span class="org-builtin">:ne</span> <span class="org-string">"c"</span> #'dired-collapse-mode
        <span class="org-builtin">:desc</span> <span class="org-string">"Toggle details"</span>        <span class="org-builtin">:ne</span> <span class="org-string">"d"</span> #'dired-hide-details-mode
        <span class="org-builtin">:desc</span> <span class="org-string">"Toggle git info"</span>       <span class="org-builtin">:ne</span> <span class="org-string">"g"</span> #'my-dired-toggle-git-mode
        <span class="org-builtin">:desc</span> <span class="org-string">"Toggle hidden files"</span>   <span class="org-builtin">:ne</span> <span class="org-string">"h"</span> #'dired-omit-mode
        <span class="org-builtin">:desc</span> <span class="org-string">"Toggle all marks"</span>      <span class="org-builtin">:ne</span> <span class="org-string">"m"</span> #'dired-toggle-marks
        <span class="org-builtin">:desc</span> <span class="org-string">"Toggle preview"</span>        <span class="org-builtin">:ne</span> <span class="org-string">"p"</span> #'peep-dired
        <span class="org-builtin">:desc</span> <span class="org-string">"Toggle sorting"</span>        <span class="org-builtin">:ne</span> <span class="org-string">"s"</span> #'hydra-dired-quick-sort/body
        <span class="org-builtin">:desc</span> <span class="org-string">"Toggle edit mode"</span>      <span class="org-builtin">:ne</span> <span class="org-string">"w"</span> #'wdired-change-to-wdired-mode)
       (<span class="org-builtin">:prefix</span> (<span class="org-string">"y"</span> . <span class="org-string">"yank"</span>)
        <span class="org-builtin">:desc</span> <span class="org-string">"Yank files"</span>            <span class="org-builtin">:ne</span> <span class="org-string">"y"</span> #'dired-ranger-copy
        <span class="org-builtin">:desc</span> <span class="org-string">"Copy absolut path"</span>     <span class="org-builtin">:ne</span> <span class="org-string">"a"</span> #'my-dired-yank-absolute-path
        <span class="org-builtin">:desc</span> <span class="org-string">"Copy file"</span>             <span class="org-builtin">:ne</span> <span class="org-string">"f"</span> #'dired-do-copy
        <span class="org-builtin">:desc</span> <span class="org-string">"Copy with regexp"</span>      <span class="org-builtin">:ne</span> <span class="org-string">"R"</span> #'dired-do-copy-regexp
        <span class="org-builtin">:desc</span> <span class="org-string">"Copy relative path"</span>    <span class="org-builtin">:ne</span> <span class="org-string">"r"</span> #'my-dired-yank-relative-path))
      (<span class="org-builtin">:map</span> wdired-mode-map
        <span class="org-builtin">:in</span> <span class="org-string">"s-RET"</span> #'wdired-finish-edit
        <span class="org-builtin">:in</span> [s-return] #'wdired-finish-edit
        <span class="org-builtin">:in</span> <span class="org-string">"s-ESC"</span> #'wdired-revert
        <span class="org-builtin">:in</span> [s-escape] #'wdired-revert))
</pre>
</div>
</div>
</div>

<div id="outline-container-org37f2477" class="outline-3">
<h3 id="org37f2477"><span class="section-number-3">6.3</span> <span class="todo TODO">TODO</span> Project management</h3>
<div class="outline-text-3" id="text-6-3">
<p>
Projectile is a great package. It usually provides more features that one particular user would need. But I still want to tweak it to make it behave more according my expectations.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 343: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> projectile
  (<span class="org-keyword">setq</span> projectile-ignored-projects `(<span class="org-string">"~/"</span>
                                      <span class="org-string">"/tmp"</span>
                                      ,(expand-file-name <span class="org-string">"straight/repos"</span> doom-local-dir))))
</pre>
</div>

<p>
Doom sets a function to run when we open a project with <code>projectile</code>, but that function is not calling any <i>open file</i> function for us. Let's create our own version of such function and help projectile to do the appropriate thing when we open a project.
</p>

<p>
The actions I expect are:
</p>

<ul class="org-ul">
<li>Check if the project has one of the recognized files and open it, in this order (we should look for four extensions on each one of the files, also in this order: <code>.org</code>, no extension, <code>.md</code>, and <code>.rst</code>):
<ul class="org-ul">
<li><code>CHANGELOG</code></li>
<li><code>NEWS</code></li>
<li><code>README</code></li>
</ul></li>
<li>If none of the recognizable files is present, run <code>project-find-file</code>;</li>
</ul>

<p>
Let's create such function as an <i>autoload</i> function:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 344: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-after-switch-project-action-h</span> (dir)
  <span class="org-doc">"A project first action to execute when we switch our current project."</span>
  (<span class="org-keyword">let</span> ((file (<span class="org-keyword">file-exists-p!</span> (<span class="org-keyword">ignore-errors</span> (expand-file-name (<span class="org-keyword">or</span> <span class="org-string">"README.org"</span>
                                                                   <span class="org-string">"README.md"</span>
                                                                   <span class="org-string">"README"</span>
                                                                   <span class="org-string">"README.rst"</span>
                                                                   <span class="org-string">"NEWS.org"</span>
                                                                   <span class="org-string">"NEWS.md"</span>
                                                                   <span class="org-string">"NEWS"</span>
                                                                   <span class="org-string">"NEWS.rst"</span>
                                                                   <span class="org-string">"CHANGELOG.org"</span>
                                                                   <span class="org-string">"CHANGELOG.md"</span>
                                                                   <span class="org-string">"CHANGELOG"</span>
                                                                   <span class="org-string">"CHANGELOG.rst"</span>) <span class="org-warning">dir)))))</span>
    (<span class="org-keyword">if</span> file
        (find-file file)
      (doom-project-find-file dir))))
</pre>
</div>

<p>
And attach it to the <code>projectile</code> hook:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 345: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> projectile
  (<span class="org-keyword">setq</span> +workspaces-switch-project-function #'my-after-switch-project-action-h))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc9a2865" class="outline-3">
<h3 id="orgc9a2865"><span class="section-number-3">6.4</span> <span class="todo TODO">TODO</span> Terminal</h3>
<div class="outline-text-3" id="text-6-4">
<p>
In general, I really like the setup Doom has for the terminal. There are 3 things I like to add there.
</p>

<p>
One are some aliases that I'm used to use when working on the terminal:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 346: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> eshell
  (set-eshell-alias!
   <span class="org-string">"d"</span>     <span class="org-string">"dired $1"</span>
   <span class="org-string">"edit"</span>  <span class="org-string">"find-file-other-window $1"</span>
   <span class="org-string">"em"</span>    <span class="org-string">"find-file-other-window $1"</span>
   <span class="org-string">"emacs"</span> <span class="org-string">"find-file-other-window $1"</span>
   <span class="org-string">"f"</span>     <span class="org-string">"find-file $1"</span>
   <span class="org-string">"gc"</span>    <span class="org-string">"magit-commit $1"</span>
   <span class="org-string">"gl"</span>    <span class="org-string">"(call-interactively 'magit-log-current)"</span>
   <span class="org-string">"gst"</span>   <span class="org-string">"magit-status $1"</span>
   <span class="org-string">"ls"</span>    <span class="org-string">"exa --group-directories-first --color always -F $1"</span>
   <span class="org-string">"la"</span>    <span class="org-string">"exa --group-directories-first --color always -F -a $1"</span>
   <span class="org-string">"ll"</span>    <span class="org-string">"exa --group-directories-first --color always -F -l -h --git $1"</span>
   <span class="org-string">"lla"</span>   <span class="org-string">"exa --group-directories-first --color always -F -a -l -h --git $1"</span>
   <span class="org-string">"rg"</span>    <span class="org-string">"rg --color=always $*"</span>
   <span class="org-string">"up"</span>    <span class="org-string">"eshell-up $1"</span>
   <span class="org-string">"pk"</span>    <span class="org-string">"eshell-up-peek $1"</span>
   <span class="org-string">"vi"</span>    <span class="org-string">"find-file-other-window $1"</span>
   <span class="org-string">"vim"</span>   <span class="org-string">"find-file-other-window $1"</span>))
</pre>
</div>

<p>
Two is the window navigation mapping:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 347: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(map! <span class="org-builtin">:after</span> eshell
      (<span class="org-builtin">:map</span> eshell-mode-map
       <span class="org-builtin">:in</span> <span class="org-string">"C-h"</span> #'evil-window-left
       <span class="org-builtin">:in</span> <span class="org-string">"C-j"</span> #'evil-window-down
       <span class="org-builtin">:in</span> <span class="org-string">"C-k"</span> #'evil-window-up
       <span class="org-builtin">:in</span> <span class="org-string">"C-l"</span> #'evil-window-right))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 348: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(set-popup-rule! <span class="org-string">"^\\*doom:</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">v?term</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">e?shell</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">-popup"</span>
  <span class="org-builtin">:slot</span> 2   <span class="org-builtin">:vslot</span> -1     <span class="org-builtin">:side</span> 'bottom  <span class="org-builtin">:width</span> 110 <span class="org-builtin">:height</span> 0.4
  <span class="org-builtin">:select</span> t <span class="org-builtin">:modeline</span> nil <span class="org-builtin">:autosave</span> nil  <span class="org-builtin">:ttl</span> nil   <span class="org-builtin">:quit</span> nil)
</pre>
</div>

<p>
And three is to fix <code>magit-status</code>. When I'm on the terminal, if I open <code>magit-status</code>, everything works as expected, but when I exit back to the terminal, Emacs switch the buffer on my terminal window to something else.
</p>

<p>
The ideal behavior would be to any app launch from the terminal to take over eshell's window until done. Then, revert back to the terminal.
</p>

<p>
I like to have a hint of the next possible completion while I'm working on shell. Zsh and Fish have great plugins for such feature, so I decided to add one for eshell as well:
</p>

<ul class="org-ul">
<li><a href="https://github.com/dieggsy/esh-autosuggest">https://github.com/dieggsy/esh-autosuggest</a></li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 349: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> esh-autosuggest)
</pre>
</div>

<p>
The only configuration we need to get this mode working, is to let Emacs enable it when <code>eshell-mode</code> is up.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 350: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> esh-autosuggest
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:hook</span> ((eshell-mode . esh-autosuggest-mode)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org40c2187" class="outline-3">
<h3 id="org40c2187"><span class="section-number-3">6.5</span> <span class="todo TODO">TODO</span> Emails</h3>
<div class="outline-text-3" id="text-6-5">
<p>
TBD
</p>
</div>
</div>

<div id="outline-container-org76718e4" class="outline-3">
<h3 id="org76718e4"><span class="section-number-3">6.6</span> <span class="todo TODO">TODO</span> Calendars</h3>
<div class="outline-text-3" id="text-6-6">
<p>
TBD
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 351: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defconst</span> <span class="org-variable-name">+work-calendar-personal</span> (expand-file-name <span class="org-string">"personal.org"</span> my-calendars-directory)
  <span class="org-doc">"File path for my personal calendar"</span>)

(<span class="org-keyword">defconst</span> <span class="org-variable-name">+work-calendar-family</span> (expand-file-name <span class="org-string">"family.org"</span> my-calendars-directory)
  <span class="org-doc">"File path for my personal calendar"</span>)

(<span class="org-keyword">defconst</span> <span class="org-variable-name">+work-calendar-work</span> (expand-file-name <span class="org-string">"work.org"</span> my-calendars-directory)
  <span class="org-doc">"File path for my personal calendar"</span>)

(<span class="org-keyword">defconst</span> <span class="org-variable-name">+org-calendars-files</span> (list +work-calendar-personal
                                     +work-calendar-family
                                     +work-calendar-work)
  <span class="org-doc">"List of directories to find files with appointment events (calendar)"</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 352: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defconst</span> <span class="org-variable-name">+doom-calendar-color-table</span> (make-hash-table <span class="org-builtin">:test</span> #'equal)
  <span class="org-doc">"A hash table to hold an association between a calendar name (in our org world,</span>
<span class="org-doc">this is the event's category), and its defined color."</span>)

(puthash <span class="org-string">"work"</span>     '(<span class="org-builtin">:color</span> <span class="org-string">"#a67a63"</span> <span class="org-builtin">:bg</span> <span class="org-string">"#4f3426"</span> <span class="org-builtin">:fg</span> <span class="org-string">"#ffc8a9"</span>) +doom-calendar-color-table)
(puthash <span class="org-string">"personal"</span> '(<span class="org-builtin">:color</span> <span class="org-string">"#19adf8"</span> <span class="org-builtin">:bg</span> <span class="org-string">"#17445d"</span> <span class="org-builtin">:fg</span> <span class="org-string">"#a9e3ff"</span>) +doom-calendar-color-table)
(puthash <span class="org-string">"family"</span>   '(<span class="org-builtin">:color</span> <span class="org-string">"#cd73e1"</span> <span class="org-builtin">:bg</span> <span class="org-string">"#45285c"</span> <span class="org-builtin">:fg</span> <span class="org-string">"#f1aeff"</span>) +doom-calendar-color-table)

<span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-work-calendar-color</span> (name <span class="org-type">&amp;optional</span> prop)
  <span class="org-doc">"Returns a string representing the color for PROP for the calendar with the</span>
<span class="org-doc">given NAME.</span>

<span class="org-doc">If color is nil, this function uses the property `</span><span class="org-doc"><span class="org-constant">:color</span></span><span class="org-doc">'"</span>
  (plist-get (gethash name +doom-calendar-color-table) (<span class="org-keyword">or</span> prop <span class="org-builtin">:color</span>)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 353: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> +calendar-open-function #'my-work/open-calendar)

(map! <span class="org-builtin">:leader</span> <span class="org-builtin">:prefix</span> (<span class="org-string">"o"</span> . <span class="org-string">"open"</span>)
      <span class="org-builtin">:desc</span> <span class="org-string">"Open calendar"</span> <span class="org-builtin">:nvm</span> <span class="org-string">"c"</span> #'=calendar)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 354: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-work/open-calendar</span> ()
  <span class="org-doc">"TODO"</span>
  (<span class="org-keyword">interactive</span>)
  (cfw:open-calendar-buffer
   <span class="org-builtin">:contents-sources</span>
   (list
    (cfw:org-create-file-source <span class="org-string">"Personal"</span> +work-calendar-personal (my-work-calendar-color <span class="org-string">"personal"</span>))
    (cfw:org-create-file-source <span class="org-string">"Family"</span> +work-calendar-family (my-work-calendar-color <span class="org-string">"family"</span>))
    (cfw:org-create-file-source <span class="org-string">"Work"</span> +work-calendar-work (my-work-calendar-color <span class="org-string">"work"</span>))
    )))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 355: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> calfw
  (custom-theme-set-faces! 'doom-one
    `(cfw:face-today-title <span class="org-builtin">:foreground</span> <span class="org-string">"#FFFFFF"</span>
                           <span class="org-builtin">:background</span> <span class="org-string">"#2E475E"</span>)
    `(cfw:face-today <span class="org-builtin">:foreground</span> ,(doom-color 'fg)
                     <span class="org-builtin">:background</span> <span class="org-string">"#1c2b39"</span>)
    `(cfw:face-grid <span class="org-builtin">:foreground</span> ,(doom-color 'base4 256))
    `(cfw:face-select <span class="org-builtin">:foreground</span> ,(doom-darken 'number 256)
                      <span class="org-builtin">:background</span> ,(doom-lighten 'number 256))
    `(cfw:face-holiday <span class="org-builtin">:foreground</span> ,(doom-color 'green 256))
    `(cfw:face-saturday <span class="org-builtin">:foreground</span> ,(doom-color 'red 256))
    `(cfw:face-sunday <span class="org-builtin">:foreground</span> ,(doom-color 'red 256)))

  (map! <span class="org-builtin">:map</span> cfw:calendar-mode-map
        <span class="org-builtin">:e</span> <span class="org-string">"q"</span> #'+calendar/quit))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 356: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-work-calendar-open-a ()
  <span class="org-doc">"Activate (or switch to) `</span><span class="org-doc"><span class="org-constant">calendar</span></span><span class="org-doc">' in its workspace."</span>
  <span class="org-builtin">:override</span> '=calendar
  (<span class="org-keyword">interactive</span>)
  (+workspace-switch <span class="org-string">"Calendar"</span> t)
  (doom/switch-to-scratch-buffer)
  (+calendar--init)
  (+workspace/display))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 357: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-work-calendar-quit-a ()
  <span class="org-doc">"Activate (or switch to) `</span><span class="org-doc"><span class="org-constant">calendar</span></span><span class="org-doc">' in its workspace."</span>
  <span class="org-builtin">:override</span> '+calendar/quit
  (<span class="org-keyword">interactive</span>)
  (+workspace/delete <span class="org-string">"Calendar"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org22be281" class="outline-3">
<h3 id="org22be281"><span class="section-number-3">6.7</span> <span class="todo TODO">TODO</span> Contacts</h3>
<div class="outline-text-3" id="text-6-7">
<p>
TBD
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 358: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defconst</span> <span class="org-variable-name">+org-contacts-file</span> (expand-file-name <span class="org-string">"contacts.org"</span> my-agenda-directory)
  <span class="org-doc">"Path to the org file that will store all contacts."</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 359: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">(use-package! org-contacts</span>
<span class="org-comment-delimiter">;;   </span><span class="org-comment">:after (org-capture)</span>
<span class="org-comment-delimiter">;;   </span><span class="org-comment">:init</span>
<span class="org-comment-delimiter">;;   </span><span class="org-comment">(setq org-contacts-icon-property "PICTURE"</span>
<span class="org-comment-delimiter">;;         </span><span class="org-comment">org-contacts-icon-use-gravatar t))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeb7efaa" class="outline-3">
<h3 id="orgeb7efaa"><span class="section-number-3">6.8</span> <span class="todo TODO">TODO</span> Time Management</h3>
<div class="outline-text-3" id="text-6-8">
<dl class="org-dl">
<dt>Triage</dt><dd>This process is to mark done tasks as done, and adjust any deadlines or other information on my tasks:
<dl class="org-dl">
<dt>Daily</dt><dd>Should be a quick 5 min check on the tasks done during the day. I will use this time to also add unexpected tasks on my list so I can have a more accurate record of my work day;</dd>
<dt>Weekly</dt><dd>Should be a more in-depth review, where I will evaluate if I need to change or amend any of the tasks I'm tracking. This process shouldn't take more than 30 minutes;</dd>
</dl></dd>
</dl>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 360: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defconst</span> <span class="org-variable-name">+org-tasks-file</span> (expand-file-name <span class="org-string">"todo.org"</span> my-tasks-directory)
  <span class="org-doc">"Path to the org file that will store all habits."</span>)


(<span class="org-keyword">defconst</span> <span class="org-variable-name">+org-habits-file</span> (expand-file-name <span class="org-string">"habits.org"</span> my-agenda-directory)
  <span class="org-doc">"Path to the org file that will store all habits."</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 361: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org
  (<span class="org-keyword">setq</span> org-archive-location (concat org-directory <span class="org-string">"/.archives/%s::datetree/* Archived From %s"</span>)
        org-archive-tag <span class="org-string">"ARCHIVED"</span>
        org-log-done t
        org-todo-keywords '((sequence
                             <span class="org-string">"TODO(t)"</span>  <span class="org-comment-delimiter">; </span><span class="org-comment">This task needs to be done.</span>

                             <span class="org-string">"NEXT(n)"</span>  <span class="org-comment-delimiter">; </span><span class="org-comment">I committed to work on this task next. This can be used to</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">plan my next day, or to indicate in a project the next</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">logical step.</span>

                             <span class="org-string">"STRT(s)"</span>  <span class="org-comment-delimiter">; </span><span class="org-comment">This task is actively in progress. Ideally you only have</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">one task marked as started, but in some cases you can</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">start a task, and while you wait for something to</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">complete, you can start another task.</span>

                             <span class="org-string">"WAIT(w)"</span>  <span class="org-comment-delimiter">; </span><span class="org-comment">This task is waiting some external condition to happen,</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">like waiting for an authorization, waiting for account to</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">be created, etc.</span>

                             <span class="org-string">"HOLD(h)"</span>  <span class="org-comment-delimiter">; </span><span class="org-comment">This task is paused. This state can mean many different</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">things. A task can be paused because I simply don't want</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">to continue doing it, or it is paused because I want to</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">make sure I understand I shouldn't be work on this task.</span>

                             <span class="org-string">"DELG(g)"</span>  <span class="org-comment-delimiter">; </span><span class="org-comment">This task is delegated to someone else. Usually, a</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">delegated task has a property indicating to whom it is</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">delegated and when is the tentative ETA. This state is not</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">considered final because I want to follow up with the</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">person about the outcome.</span>
                             <span class="org-string">"|"</span>
                             <span class="org-string">"DONE(d)"</span>  <span class="org-comment-delimiter">; </span><span class="org-comment">Task successfully completed</span>

                             <span class="org-string">"KILL(k)"</span>  <span class="org-comment-delimiter">; </span><span class="org-comment">Task was cancelled, aborted or is no longer applicable,</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">but I want to keep it as a record instead of simply</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">remove it from the file.</span>
                             ))
        org-todo-keyword-faces '((<span class="org-string">"STRT"</span> . +org-todo-active)
                                 (<span class="org-string">"DELG"</span> . +org-todo-active)
                                 (<span class="org-string">"WAIT"</span> . +org-todo-onhold)
                                 (<span class="org-string">"HOLD"</span> . +org-todo-onhold))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 362: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-org-agenda-buffer-config-h</span> ()
  (evil-window-set-width 100)
  (doom-themes-hide-modeline)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(variable-pitch-mode -1)</span>
  (<span class="org-keyword">setq-local</span> wrap-prefix (s-repeat +org-agenda--wrap-prefix <span class="org-string">" "</span>))
  (<span class="org-keyword">setq</span> writeroom-width 65)
  (+zen/toggle 1)
  (visual-line-mode 1)
  (tab-line-mode -1)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(hl-line-mode -1)</span>
  (<span class="org-keyword">when</span> (not (= text-scale-mode-amount 1))
    (<span class="org-keyword">setq-local</span> text-scale-mode-amount 1)
    (text-scale-mode 1)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 363: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-org-agenda-setup-time-grid-h</span> ()
  <span class="org-doc">"Set different line spacing based on clock time duration."</span>
  (<span class="org-keyword">let</span> (first-item)
    (<span class="org-keyword">save-excursion</span>
      (<span class="org-keyword">let</span> (pos duration curr-time blocked-time marker)
        (goto-char (point-min))

        (<span class="org-keyword">while</span> (<span class="org-keyword">setq</span> pos (next-single-property-change (point) 'time-of-day))
          (goto-char pos)
          (<span class="org-keyword">setq</span> curr-time (org-get-at-bol 'time-of-day))
          (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> (not (equal pos (point-at-eol)))
                     curr-time)
            (<span class="org-keyword">if</span> (<span class="org-keyword">setq</span> duration (org-get-at-bol 'duration))
                (<span class="org-keyword">progn</span>
                  (<span class="org-keyword">unless</span> first-item (<span class="org-keyword">setq</span> first-item pos))
                  (<span class="org-keyword">setq</span> blocked-time (max (+ curr-time (* (/ duration 60.0) 100.0))
                                          (<span class="org-keyword">or</span> blocked-time 0)))

                  (<span class="org-keyword">if</span> (&gt; (+ (point-at-bol) 71) (point-at-eol))
                      (<span class="org-keyword">progn</span>
                        (goto-char (point-at-eol))
                        (insert-char #x20 (- 71 (- (point-at-eol) (point-at-bol))) t))
                    (<span class="org-keyword">when</span> (&lt; (+ (point-at-bol) 69) (point-at-eol))
                      (goto-char (+ (point-at-bol) 69))
                      (delete-region (point) (point-at-eol))
                      (insert-char ?&#8230; 1 t)
                      (insert-char #x20 1 t)))

                  (remove-text-properties (point-at-bol) (point-at-eol) '(mouse-face nil))

                  (<span class="org-keyword">let*</span> ((line-height (<span class="org-keyword">if</span> (&lt; duration 15) 1.0 (+ 0.5 (/ duration 30))))
                         (block-start (+ (point-at-bol) (- +org-agenda--category-length 1)))
                         (block-end (+ block-start 59))
                         (ov (make-overlay (point-at-bol) (1+ (point-at-eol))))
                         (color-ov (make-overlay block-start block-end))
                         (mouse-ov (make-overlay block-start (point-at-eol)))
                         (cal (org-get-at-bol 'org-category)))
                    (<span class="org-keyword">when</span> (<span class="org-keyword">setq</span> marker (org-get-at-bol 'org-marker))
                      (add-text-properties (point-at-bol)
                                           (point-at-eol)
                                           `(org-target-file ,(cons
                                                               (buffer-file-name (marker-buffer marker))
                                                               (marker-position marker)))))

                    (overlay-put ov 'priority 1010)
                    (overlay-put ov 'line-height line-height)
                    (overlay-put ov 'line-spacing (1- line-height))
                    (overlay-put color-ov 'priority 1020)
                    (overlay-put color-ov 'face `(<span class="org-builtin">:background</span> ,(my-work-calendar-color cal <span class="org-builtin">:bg</span>)
                                                  <span class="org-builtin">:foreground</span> ,(my-work-calendar-color cal <span class="org-builtin">:fg</span>)
                                                  <span class="org-builtin">:box</span> (<span class="org-builtin">:line-width</span> -2 <span class="org-builtin">:color</span> ,(doom-color 'bg))))
                    (overlay-put mouse-ov 'priority 1030)
                    (overlay-put mouse-ov 'mouse-face `(<span class="org-builtin">:background</span> ,(my-work-calendar-color cal)
                                                        <span class="org-builtin">:foreground</span> <span class="org-string">"white"</span>
                                                        <span class="org-builtin">:box</span> (<span class="org-builtin">:line-width</span> -2 <span class="org-builtin">:color</span> ,(doom-color 'bg))))))
              (<span class="org-keyword">when</span> (&lt; curr-time (<span class="org-keyword">or</span> blocked-time -1))
                (kill-whole-line)
                (previous-line)))))))
    (<span class="org-keyword">when</span> first-item
      (goto-char first-item))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 364: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-org-agenda-reset-font-a (<span class="org-type">&amp;rest</span> _)
  <span class="org-doc">"Reset text scale before running `</span><span class="org-doc"><span class="org-constant">org-agenda-redo</span></span><span class="org-doc">' to prevent messing with</span>
<span class="org-doc">layout."</span>
  <span class="org-builtin">:before</span> 'org-agenda-redo
  (<span class="org-keyword">setq-local</span> text-scale-mode-amount 0)
  (text-scale-mode -1))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 365: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defconst</span> <span class="org-variable-name">+org-agenda--category-length</span> 14
  <span class="org-doc">"The length of the space categories occupy on org-agenda"</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 366: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">defconst</span> <span class="org-variable-name">+org-agenda--wrap-prefix</span> (+ +org-agenda--category-length 5)
  <span class="org-doc">"Length that a wrapped text should indent on org-agenda. This</span>
<span class="org-doc">length is the `</span><span class="org-doc"><span class="org-constant">+org-agenda--category-length</span></span><span class="org-doc">' plus 5 characters to</span>
<span class="org-doc">account for the TODO word plus one space."</span>)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 367: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> org
  (<span class="org-keyword">setq</span> org-agenda-block-separator <span class="org-string">" "</span>
        org-agenda-compact-blocks nil
        org-agenda-current-time-string <span class="org-string">"&#9664;- now - - - - - - - - - - - - - - - - - - -"</span>
        org-agenda-files  (append (list +org-tasks-file my-journal-file) +org-calendars-files)
        org-agenda-include-deadlines t
        org-agenda-skip-deadline-if-done t
        org-agenda-skip-scheduled-if-done t
        org-agenda-time-grid '((daily today require-timed remove-match)
                               (700 800 900 1000 1100 1200 1300 1400 1500 1600 1700 1800)
                               <span class="org-string">"&#183;&#183;&#183;&#183;&#183;&#183;"</span>
                               <span class="org-string">"&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;&#9548;"</span>)
        org-agenda-window-setup 'other-window))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 368: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-contain-buffer-p</span> (lst buf)
  <span class="org-doc">"Return t if th given BUF is in the given LST.</span>

<span class="org-doc">This function searches the buffer in all nested lists containd in LST."</span>
  (<span class="org-keyword">unless</span> (not lst)
    (<span class="org-keyword">if</span> (seqp lst)
        (seq-some (<span class="org-keyword">lambda</span> (elm) (my-contain-buffer-p elm buf)) lst)
      (eq lst buf))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 369: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-bring-buffer-to-front</span> (buffer-or-name)
  <span class="org-doc">"Make sure buffer is visible on its window.</span>

<span class="org-doc">BUFFER-OR-NAME is the buffer to look for.</span>

<span class="org-doc">Return t if the buffer moved to front."</span>
  (<span class="org-keyword">when-let</span> ((buf (<span class="org-keyword">when</span> buffer-or-name (get-buffer buffer-or-name)))
             (win (seq-find (<span class="org-keyword">lambda</span> (window)
                              (seq-some (<span class="org-keyword">lambda</span> (buf-list) (my-contain-buffer-p buf-list buf))
                                        (append (mapcar #'car (window-prev-buffers window))
                                                (list (window-buffer window))
                                                (window-next-buffers window))))
                            (window-list))))
    (set-window-buffer win buf t)
    t))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 370: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-bring-org-agenda-to-front-h</span> ()
  (<span class="org-keyword">when</span> (my-bring-buffer-to-front org-agenda-buffer)
    (my-org-agenda-buffer-config-h)))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 371: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(custom-set-faces!
  `(org-agenda-current-time <span class="org-builtin">:foreground</span> ,(doom-color 'red 256))
  `(org-agenda-date-today <span class="org-builtin">:foreground</span> ,(doom-color 'violet 256)
                          <span class="org-builtin">:height</span> 1.5
                          <span class="org-builtin">:weight</span> bold
                          <span class="org-builtin">:inherit</span> variable-pitch))

(<span class="org-keyword">after!</span> org-agenda
  (add-hook 'org-agenda-mode-hook #'my-org-agenda-buffer-config-h)
  (add-hook 'org-agenda-finalize-hook #'my-org-agenda-setup-time-grid-h)
  (add-hook 'window-state-change-hook #'my-bring-org-agenda-to-front-h)
  (remove-hook 'org-agenda-finalize-hook '+org-exclude-agenda-buffers-from-workspace-h)
  (remove-hook 'org-agenda-finalize-hook '+org-defer-mode-in-agenda-buffers-h))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 372: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">after!</span> evil-org-agenda
  (map! <span class="org-builtin">:map</span> evil-org-agenda-mode-map
        <span class="org-builtin">:nvm</span> [return] #'org-agenda-goto
        <span class="org-builtin">:nvm</span> <span class="org-string">"RET"</span> #'org-agenda-goto
        <span class="org-builtin">:nvm</span> <span class="org-string">"j"</span> #'org-agenda-next-item
        <span class="org-builtin">:nvm</span> <span class="org-string">"l"</span> #'org-agenda-next-item
        <span class="org-builtin">:nvm</span> <span class="org-string">"k"</span> #'org-agenda-previous-item
        <span class="org-builtin">:nvm</span> <span class="org-string">"h"</span> #'org-agenda-previous-item
        <span class="org-builtin">:nvm</span> <span class="org-string">"&lt;DOWN&gt;"</span> #'org-agenda-next-item
        <span class="org-builtin">:nvm</span> <span class="org-string">"&lt;RIGHT&gt;"</span> #'org-agenda-next-item
        <span class="org-builtin">:nvm</span> <span class="org-string">"&lt;UP&gt;"</span> #'org-agenda-previous-item
        <span class="org-builtin">:nvm</span> <span class="org-string">"&lt;LEFT&gt;"</span> #'org-agenda-previous-item
        <span class="org-builtin">:nvm</span> [down] #'org-agenda-next-item
        <span class="org-builtin">:nvm</span> [right] #'org-agenda-next-item
        <span class="org-builtin">:nvm</span> [up] #'org-agenda-previous-item
        <span class="org-builtin">:nvm</span> [left] #'org-agenda-previous-item
        <span class="org-builtin">:nvm</span> <span class="org-string">"C-h"</span> #'evil-window-left
        <span class="org-builtin">:nvm</span> <span class="org-string">"C-j"</span> #'evil-window-down
        <span class="org-builtin">:nvm</span> <span class="org-string">"C-k"</span> #'evil-window-up
        <span class="org-builtin">:nvm</span> <span class="org-string">"C-l"</span> #'evil-window-right
        <span class="org-builtin">:nvm</span> <span class="org-string">"G"</span> #'(lambda ()
                     (<span class="org-keyword">interactive</span>)
                     (goto-char (point-max)) (org-agenda-previous-item 1))
        (<span class="org-builtin">:prefix</span> (<span class="org-string">"g"</span> . <span class="org-string">"goto"</span>)
         <span class="org-builtin">:desc</span> <span class="org-string">"Go to first item"</span> <span class="org-builtin">:nvm</span> <span class="org-string">"g"</span> #'(lambda ()
                                               (<span class="org-keyword">interactive</span>)
                                               (goto-char (point-min))
                                               (org-agenda-next-item 1)))))
</pre>
</div>

<ul class="org-ul">
<li><a href="https://github.com/alphapapa/org-super-agenda">https://github.com/alphapapa/org-super-agenda</a></li>
<li><a href="https://github.com/alphapapa/org-ql">https://github.com/alphapapa/org-ql</a></li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 373: </span>$DOOMDIR/packages.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">package!</span> org-super-agenda)
(<span class="org-keyword">package!</span> org-ql)
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 374: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defadvice!</span> my-org-agenda-make-agenda-icon-header-a (func name)
  <span class="org-builtin">:around</span> 'org-super-agenda--make-agenda-header
  (<span class="org-keyword">let</span> ((icon (get-text-property 0 'icon name))
        (icon-color (get-text-property 0 'icon-color name))
        (header (s-trim (funcall func name))))
    (concat
     <span class="org-string">"\n"</span>
     (<span class="org-keyword">when</span> icon
       (format <span class="org-string">"%s "</span> (my-icon icon icon-color)))
     header
     <span class="org-string">"\n"</span>
     (<span class="org-keyword">if</span> icon
         (s-repeat (+ 3 (length header)) <span class="org-string">"&#9472;"</span>)
       (s-repeat (length header) <span class="org-string">"&#9472;"</span>)))))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 375: </span>$DOOMDIR/autoload/extras.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my-org-agenda-group-title</span> (text <span class="org-type">&amp;optional</span> icon icon-color)
  (propertize text 'icon icon 'icon-color icon-color))
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 376: </span>$DOOMDIR/config.el</label><pre class="src src-emacs-lisp">(<span class="org-keyword">use-package!</span> org-super-agenda
  <span class="org-builtin">:commands</span> (org-agenda)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> org-agenda-custom-commands
        '((<span class="org-string">"c"</span> <span class="org-string">"Super view"</span>
           ((agenda <span class="org-string">""</span> ((org-agenda-span 'day)
                        (org-agenda-start-day (format-time-string <span class="org-string">"%Y-%m-%d"</span>))
                        (org-agenda-skip-function '(org-agenda-skip-entry-if 'deadline))
                        (org-agenda-show-all-dates t)
                        (org-agenda-use-time-grid t)
                        (org-agenda-overriding-header <span class="org-string">""</span>)
                        (org-super-agenda-groups
                         `((<span class="org-builtin">:name</span> ,(my-org-agenda-group-title <span class="org-string">"Agenda"</span> 'calendar (doom-lighten 'blue 0.5))
                            <span class="org-builtin">:time-grid</span> t
                            <span class="org-builtin">:and</span> (<span class="org-builtin">:date</span> today
                                  <span class="org-builtin">:todo</span> nil))))))
            (alltodo <span class="org-string">""</span> ((org-agenda-overriding-header <span class="org-string">""</span>)
                         (org-super-agenda-groups
                          `(
                            (<span class="org-builtin">:name</span> ,(my-org-agenda-group-title <span class="org-string">"Inbox"</span> 'inbox (doom-color 'orange))
                             <span class="org-builtin">:category</span> <span class="org-string">"journal"</span>
                             <span class="org-builtin">:order</span> 15)
                            (<span class="org-builtin">:name</span> ,(my-org-agenda-group-title <span class="org-string">"Delegated"</span> 'assign (doom-color 'orange))
                             <span class="org-builtin">:todo</span> <span class="org-string">"DELG"</span>
                             <span class="org-builtin">:order</span> 45)
                            (<span class="org-builtin">:name</span> ,(my-org-agenda-group-title <span class="org-string">"Waiting"</span> 'wait  (doom-color 'yellow))
                             <span class="org-builtin">:todo</span> <span class="org-string">"WAIT"</span>
                             <span class="org-builtin">:order</span> 35)
                            (<span class="org-builtin">:name</span> ,(my-org-agenda-group-title <span class="org-string">"On Hold"</span> 'pause (doom-color 'yellow))
                             <span class="org-builtin">:todo</span> <span class="org-string">"HOLD"</span>
                             <span class="org-builtin">:order</span> 40)
                            (<span class="org-builtin">:name</span> ,(my-org-agenda-group-title <span class="org-string">"Issues"</span> 'bug (doom-color 'red))
                             <span class="org-builtin">:tag</span> <span class="org-string">"issue"</span>
                             <span class="org-builtin">:order</span> 30)
                            (<span class="org-builtin">:name</span> ,(my-org-agenda-group-title <span class="org-string">"Habits"</span> 'loop (doom-color 'blue))
                             <span class="org-builtin">:habit</span> t
                             <span class="org-builtin">:order</span> 1)
                            (<span class="org-builtin">:name</span> ,(my-org-agenda-group-title <span class="org-string">"Overdue"</span> 'busy (doom-color 'red))
                             <span class="org-builtin">:deadline</span> past
                             <span class="org-builtin">:face</span> 'all-the-icons-dpink
                             <span class="org-builtin">:order</span> 4)
                            (<span class="org-builtin">:name</span> ,(my-org-agenda-group-title <span class="org-string">"Due Today"</span> 'new (doom-color 'orange))
                             <span class="org-builtin">:deadline</span> today
                             <span class="org-builtin">:face</span> 'all-the-icons-orange
                             <span class="org-builtin">:order</span> 5)
                            (<span class="org-builtin">:name</span> ,(my-org-agenda-group-title <span class="org-string">"Actionable"</span> 'checked (doom-color 'green))
                             <span class="org-builtin">:and</span> (<span class="org-builtin">:todo</span> (<span class="org-string">"TODO"</span> <span class="org-string">"STRT"</span>)
                                   <span class="org-builtin">:scheduled</span> (past today)
                                   <span class="org-builtin">:deadline</span> nil)
                             <span class="org-builtin">:order</span> 21)
                            (<span class="org-builtin">:name</span> ,(my-org-agenda-group-title <span class="org-string">"Due Soon"</span> 'snooze (doom-color 'yellow))
                             <span class="org-builtin">:deadline</span> future
                             <span class="org-builtin">:face</span> 'all-the-icons-yellow
                             <span class="org-builtin">:order</span> 10)
                            (<span class="org-builtin">:name</span> ,(my-org-agenda-group-title <span class="org-string">"Important"</span> 'error (doom-color 'red))
                             <span class="org-builtin">:priority</span> <span class="org-string">"A"</span>
                             <span class="org-builtin">:order</span> 15)
                            (<span class="org-builtin">:name</span> ,(my-org-agenda-group-title <span class="org-string">"Next to do"</span> 'visibility (doom-color 'yellow))
                             <span class="org-builtin">:todo</span> <span class="org-string">"NEXT"</span>
                             <span class="org-builtin">:order</span> 20)
                            (<span class="org-builtin">:name</span> ,(my-org-agenda-group-title <span class="org-string">"To do"</span> 'checked (doom-color 'green))
                             <span class="org-builtin">:anything</span> t
                             <span class="org-builtin">:order</span> 23)
                            ))))))))
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setq</span> org-super-agenda-header-map nil)
  (org-super-agenda-mode))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge7377ad" class="outline-2">
<h2 id="orge7377ad"><span class="section-number-2">7</span> Appendix</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-orge309d46" class="outline-3">
<h3 id="orge309d46"><span class="section-number-3">7.1</span> The <code>init.el</code> file</h3>
<div class="outline-text-3" id="text-7-1">
<p>
We can't tangle the <code>init.el</code> on Doom because it is always loaded before <code>doom sync</code> starts tangling <code>config.org</code>.
</p>

<p>
I have two alternatives here:
</p>

<ol class="org-ol">
<li>Let <code>init.el</code> as a lisp package;</li>
<li>Create a <code>doom sync</code> extension to tangle a <code>init.org</code> file;</li>
</ol>

<p>
For now, I will keep it as a separated Lisp file that I'm reproducing in this appendix for sake of documentation:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 377: </span>$DOOMDIR/init.el</label><pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;; </span><span class="org-comment">init.el -*- lexical-binding: t; -*-</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">This file controls what Doom modules are enabled and what order they load</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">in. Remember to run 'doom sync' after modifying it!</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">NOTE Press 'SPC h d h' (or 'C-h d h' for non-vim users) to access Doom's</span>
<span class="org-comment-delimiter">;;      </span><span class="org-comment">documentation. There you'll find a "Module Index" link where you'll find</span>
<span class="org-comment-delimiter">;;      </span><span class="org-comment">a comprehensive list of Doom's modules and what flags they support.</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">NOTE Move your cursor over a module's name (or its flags) and press 'K' (or</span>
<span class="org-comment-delimiter">;;      </span><span class="org-comment">'C-c c k' for non-vim users) to view its documentation. This works on</span>
<span class="org-comment-delimiter">;;      </span><span class="org-comment">flags as well (those symbols that start with a plus).</span>
<span class="org-comment-delimiter">;;</span>
<span class="org-comment-delimiter">;;      </span><span class="org-comment">Alternatively, press 'gd' (or 'C-c c d') on a module to browse its</span>
<span class="org-comment-delimiter">;;      </span><span class="org-comment">directory (for easy access to its source code).</span>

(<span class="org-keyword">doom!</span> <span class="org-builtin">:input</span>
       <span class="org-comment-delimiter">;;</span><span class="org-comment">chinese</span>
       <span class="org-comment-delimiter">;;</span><span class="org-comment">japanese</span>
       <span class="org-comment-delimiter">;;</span><span class="org-comment">layout            ; auie,ctsrnm is the superior home row</span>

       <span class="org-builtin">:completion</span>
       (company          <span class="org-comment-delimiter">; </span><span class="org-comment">the ultimate code completion backend</span>
        +childframe
        )
       <span class="org-comment-delimiter">;; </span><span class="org-comment">helm              ; the *other* search engine for love and life</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">ido               ; the other *other* search engine...</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">ivy               ; a search engine for love and life</span>
       (vertico          <span class="org-comment-delimiter">; </span><span class="org-comment">the search engine of the future</span>
        +icons)

       <span class="org-builtin">:ui</span>
       deft              <span class="org-comment-delimiter">; </span><span class="org-comment">notational velocity for Emacs</span>
       doom              <span class="org-comment-delimiter">; </span><span class="org-comment">what makes DOOM look the way it does</span>
       doom-dashboard    <span class="org-comment-delimiter">; </span><span class="org-comment">a nifty splash screen for Emacs</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">doom-quit         ; DOOM quit-message prompts when you quit Emacs</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">(emoji +unicode)  ; &#128578;</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">fill-column       ; a `</span><span class="org-comment"><span class="org-constant">fill-column</span></span><span class="org-comment">' indicator</span>
       hl-todo           <span class="org-comment-delimiter">; </span><span class="org-comment">highlight TODO/FIXME/NOTE/DEPRECATED/HACK/REVIEW</span>
       hydra
       <span class="org-comment-delimiter">;; </span><span class="org-comment">indent-guides     ; highlighted indent columns</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">ligatures         ; ligatures and symbols to make your code pretty again</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">minimap           ; show a map of the code on the side</span>
       modeline          <span class="org-comment-delimiter">; </span><span class="org-comment">snazzy, Atom-inspired modeline, plus API</span>
       nav-flash         <span class="org-comment-delimiter">; </span><span class="org-comment">blink cursor line after big motions</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">neotree           ; a project drawer, like NERDTree for vim</span>
       ophints           <span class="org-comment-delimiter">; </span><span class="org-comment">highlight the region an operation acts on</span>
       (popup            <span class="org-comment-delimiter">; </span><span class="org-comment">tame sudden yet inevitable temporary windows</span>
        +all             <span class="org-comment-delimiter">;</span>
        +defaults
        )
       <span class="org-comment-delimiter">;; </span><span class="org-comment">tabs              ; a tab bar for Emacs</span>
       (treemacs         <span class="org-comment-delimiter">; </span><span class="org-comment">a project drawer, like neotree but cooler</span>
        +lsp
        )
       <span class="org-comment-delimiter">;; </span><span class="org-comment">unicode           ; extended unicode support for various languages</span>
       vc-gutter         <span class="org-comment-delimiter">; </span><span class="org-comment">vcs diff in the fringe</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">vi-tilde-fringe   ; fringe tildes to mark beyond EOB</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">window-select     ; visually switch windows</span>
       workspaces        <span class="org-comment-delimiter">; </span><span class="org-comment">tab emulation, persistence &amp; separate workspaces</span>
       zen               <span class="org-comment-delimiter">; </span><span class="org-comment">distraction-free coding or writing</span>

       <span class="org-builtin">:editor</span>
       (evil             <span class="org-comment-delimiter">; </span><span class="org-comment">come to the dark side, we have cookies</span>
        +everywhere
        )
       file-templates    <span class="org-comment-delimiter">; </span><span class="org-comment">auto-snippets for empty files</span>
       fold              <span class="org-comment-delimiter">; </span><span class="org-comment">(nigh) universal code folding</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">(format           ; automated prettiness</span>
       <span class="org-comment-delimiter">;;  </span><span class="org-comment">+onsave</span>
       <span class="org-comment-delimiter">;;  </span><span class="org-comment">)</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">god               ; run Emacs commands without modifier keys</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">lispy             ; vim for lisp, for people who don't like vim</span>
       multiple-cursors  <span class="org-comment-delimiter">; </span><span class="org-comment">editing in many places at once</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">objed             ; text object editing for the innocent</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">parinfer          ; turn lisp into python, sort of</span>
       rotate-text       <span class="org-comment-delimiter">; </span><span class="org-comment">cycle region at point between text candidates</span>
       snippets          <span class="org-comment-delimiter">; </span><span class="org-comment">my elves. They type so I don't have to</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">word-wrap         ; soft wrapping with language-aware indent</span>

       <span class="org-builtin">:emacs</span>
       (dired            <span class="org-comment-delimiter">; </span><span class="org-comment">making dired pretty [functional]</span>
        +icons
        )
       <span class="org-comment-delimiter">;; </span><span class="org-comment">electric          ; smarter, keyword-based electric-indent</span>
       (ibuffer          <span class="org-comment-delimiter">; </span><span class="org-comment">interactive buffer management</span>
        +icons
        )
       (undo             <span class="org-comment-delimiter">; </span><span class="org-comment">persistent, smarter undo for your inevitable mistakes</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">+tree</span>
        )
       vc                <span class="org-comment-delimiter">; </span><span class="org-comment">version-control and Emacs, sitting in a tree</span>

       <span class="org-builtin">:term</span>
       eshell            <span class="org-comment-delimiter">; </span><span class="org-comment">the elisp shell that works everywhere</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">shell             ; simple shell REPL for Emacs</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">term              ; basic terminal emulator for Emacs</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">vterm             ; the best terminal emulation in Emacs</span>

       <span class="org-builtin">:checkers</span>
       syntax            <span class="org-comment-delimiter">; </span><span class="org-comment">tasing you for every semicolon you forget</span>
       (spell            <span class="org-comment-delimiter">; </span><span class="org-comment">tasing you for misspelling mispelling</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">+flyspell</span>
        +aspell
        <span class="org-comment-delimiter">;; </span><span class="org-comment">+hunspell</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">+enchant</span>
        +everywhere
        )
       grammar           <span class="org-comment-delimiter">; </span><span class="org-comment">tasing grammar mistake every you make</span>

       <span class="org-builtin">:tools</span>
       ansible
       <span class="org-comment-delimiter">;; </span><span class="org-comment">debugger          ; FIXME stepping through code, to help you add bugs</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">direnv</span>
       docker
       editorconfig      <span class="org-comment-delimiter">; </span><span class="org-comment">let someone else argue about tabs vs spaces</span>
       <span class="org-comment-delimiter">;;</span><span class="org-comment">ein               ; tame Jupyter notebooks with emacs</span>
       (eval             <span class="org-comment-delimiter">; </span><span class="org-comment">run code, run (also, repls)</span>
        +overlay
        )
       <span class="org-comment-delimiter">;; </span><span class="org-comment">gist              ; interacting with github gists</span>
       (lookup           <span class="org-comment-delimiter">; </span><span class="org-comment">navigate your code and its documentation</span>
        +dictionary
        +offline
        +docsets
        <span class="org-comment-delimiter">;; </span><span class="org-comment">+xwidget</span>
        )
       (lsp
        +peek
        )
       (magit            <span class="org-comment-delimiter">; </span><span class="org-comment">a git porcelain for Emacs</span>
        +forge
        )
       make              <span class="org-comment-delimiter">; </span><span class="org-comment">run make tasks from Emacs</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">pass              ; password manager for nerds</span>
       pdf               <span class="org-comment-delimiter">; </span><span class="org-comment">pdf enhancements</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">prodigy           ; FIXME managing external services &amp; code builders</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">rgb               ; creating color strings</span>
       taskrunner        <span class="org-comment-delimiter">; </span><span class="org-comment">taskrunner for all your projects</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">terraform         ; infrastructure as code</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">tmux              ; an API for interacting with tmux</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">upload            ; map local to remote projects via ssh/ftp</span>

       <span class="org-builtin">:os</span>
       (<span class="org-builtin">:if</span> IS-MAC
        macos            <span class="org-comment-delimiter">; </span><span class="org-comment">improve compatibility with macOS</span>
        )
       <span class="org-comment-delimiter">;; </span><span class="org-comment">tty               ; improve the terminal Emacs experience</span>

       <span class="org-builtin">:lang</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">agda              ; types of types of types of types...</span>
       (cc               <span class="org-comment-delimiter">; </span><span class="org-comment">C/C++/Obj-C madness</span>
        +lsp)
       <span class="org-comment-delimiter">;; </span><span class="org-comment">clojure           ; java with a lisp</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">common-lisp       ; if you've seen one lisp, you've seen them all</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">coq               ; proofs-as-programs</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">crystal           ; ruby at the speed of c</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">csharp            ; unity, .NET, and mono shenanigans</span>
       data              <span class="org-comment-delimiter">; </span><span class="org-comment">config/data formats</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">(dart             ; paint ui and not much else</span>
       <span class="org-comment-delimiter">;;  </span><span class="org-comment">+flutter)</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">elixir            ; erlang done right</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">elm               ; care for a cup of TEA?</span>
       emacs-lisp        <span class="org-comment-delimiter">; </span><span class="org-comment">drown in parentheses</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">erlang            ; an elegant language for a more civilized age</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">ess               ; emacs speaks statistics</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">faust             ; dsp, but you get to keep your soul</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">fsharp            ; ML stands for Microsoft's Language</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">fstar             ; (dependent) types and (monadic) effects and Z3</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">gdscript          ; the language you waited for</span>
       (go               <span class="org-comment-delimiter">; </span><span class="org-comment">the hipster dialect</span>
        +lsp
        )
       <span class="org-comment-delimiter">;; </span><span class="org-comment">(haskell          ; a language that's lazier than I am</span>
       <span class="org-comment-delimiter">;;  </span><span class="org-comment">+dante)</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">hy                ; readability of scheme w/ speed of python</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">idris             ; a language you can depend on</span>
       (json             <span class="org-comment-delimiter">; </span><span class="org-comment">At least it ain't XML</span>
        +lsp
        )
       <span class="org-comment-delimiter">;; </span><span class="org-comment">(java             ; the poster child for carpal tunnel syndrome</span>
       <span class="org-comment-delimiter">;;  </span><span class="org-comment">+meghanada)</span>
       (javascript       <span class="org-comment-delimiter">; </span><span class="org-comment">all(hope(abandon(ye(who(enter(here))))))</span>
        +lsp
        )
       <span class="org-comment-delimiter">;; </span><span class="org-comment">julia             ; a better, faster MATLAB</span>
       kotlin            <span class="org-comment-delimiter">; </span><span class="org-comment">a better, slicker Java(Script)</span>
       latex             <span class="org-comment-delimiter">; </span><span class="org-comment">writing papers in Emacs has never been so fun</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">lean</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">factor</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">ledger            ; an accounting system in Emacs</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">lua               ; one-based indices? one-based indices</span>
       (markdown         <span class="org-comment-delimiter">; </span><span class="org-comment">writing docs for people to ignore</span>
        +grip
        )
       <span class="org-comment-delimiter">;; </span><span class="org-comment">nim               ; python + lisp at the speed of c</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">nix               ; I hereby declare "nix geht mehr!"</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">ocaml             ; an objective camel</span>
       (org              <span class="org-comment-delimiter">; </span><span class="org-comment">organize your plain life in plain text</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">+brain</span>
        +dragndrop
        <span class="org-comment-delimiter">;; </span><span class="org-comment">+gnuplot</span>
        +hugo
        +journal
        <span class="org-comment-delimiter">;; </span><span class="org-comment">+jupyter</span>
        +noter
        <span class="org-comment-delimiter">;; </span><span class="org-comment">+pandoc</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">+pomodoro</span>
        +present
        <span class="org-comment-delimiter">;; </span><span class="org-comment">+pretty</span>
        +roam
        )
       <span class="org-comment-delimiter">;; </span><span class="org-comment">php               ; perl's insecure younger brother</span>
       plantuml          <span class="org-comment-delimiter">; </span><span class="org-comment">diagrams for confusing people more</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">purescript        ; javascript, but functional</span>
       (python           <span class="org-comment-delimiter">; </span><span class="org-comment">beautiful is better than ugly</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">+conda</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">+cython</span>
        +lsp
        +poetry
        +pyenv
        +pyright
        )
       <span class="org-comment-delimiter">;; </span><span class="org-comment">qt                ; the 'cutest' gui framework ever</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">racket            ; a DSL for DSLs</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">raku              ; the artist formerly known as perl6</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">rest              ; Emacs as a REST client</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">rst               ; ReST in peace</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">(ruby             ; 1.step {|i| p "Ruby is #{i.even? ? 'love' : 'life'}"}</span>
       <span class="org-comment-delimiter">;;  </span><span class="org-comment">+rails</span>
       <span class="org-comment-delimiter">;;  </span><span class="org-comment">)</span>
       (rust             <span class="org-comment-delimiter">; </span><span class="org-comment">Fe2O3.unwrap().unwrap().unwrap().unwrap()</span>
        +lsp
        )
       <span class="org-comment-delimiter">;; </span><span class="org-comment">scala             ; java, but good</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">scheme            ; a fully conniving family of lisps</span>
       (sh               <span class="org-comment-delimiter">; </span><span class="org-comment">she sells {ba,z,fi}sh shells on the C xor</span>
        +lsp)
       <span class="org-comment-delimiter">;; </span><span class="org-comment">sml</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">solidity          ; do you need a blockchain? No.</span>
       swift             <span class="org-comment-delimiter">; </span><span class="org-comment">who asked for emoji variables?</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">terra             ; Earth and Moon in alignment for performance.</span>
       web               <span class="org-comment-delimiter">; </span><span class="org-comment">the tubes</span>
       (yaml             <span class="org-comment-delimiter">; </span><span class="org-comment">JSON, but readable</span>
        +lsp)

       <span class="org-builtin">:email</span>
       (mu4e
        <span class="org-comment-delimiter">;; </span><span class="org-comment">+gmail</span>
        )
       <span class="org-comment-delimiter">;; </span><span class="org-comment">notmuch</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">(wanderlust</span>
       <span class="org-comment-delimiter">;;  </span><span class="org-comment">+gmail</span>
       <span class="org-comment-delimiter">;;  </span><span class="org-comment">)</span>

       <span class="org-builtin">:app</span>
       calendar
       <span class="org-comment-delimiter">;; </span><span class="org-comment">irc               ; how neckbeards socialize</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">(rss              ; emacs as an RSS reader</span>
       <span class="org-comment-delimiter">;;  </span><span class="org-comment">+org</span>
       <span class="org-comment-delimiter">;;  </span><span class="org-comment">)</span>
       <span class="org-comment-delimiter">;; </span><span class="org-comment">twitter           ; twitter client https://twitter.com/vnought</span>

       <span class="org-builtin">:config</span>
       literate
       (default
         +bindings
         +smartparens))

(<span class="org-keyword">when</span> doom-debug-p
  (<span class="org-keyword">require</span> '<span class="org-constant">benchmark-init</span>)
  (add-hook 'doom-first-input-hook #'benchmark-init/deactivate))

<span class="org-comment-delimiter">;; </span><span class="org-comment">I need this hook here to make sure my tangle runs this autoloaded function.</span>
(add-hook 'org-babel-post-tangle-hook
          #'(lambda ()
              (<span class="org-keyword">let</span> ((make-backup-files nil)
                    (last))
                (<span class="org-keyword">when</span> (string-match-p <span class="org-string">"\\/</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">share\\/</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">templates</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">capture</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">snippets</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\\/"</span>
                                      (buffer-file-name))
                  (goto-char (point-min))
                  (insert <span class="org-string">"# -*- mode: snippet -*-\n"</span>))
                (goto-char (point-max))
                (<span class="org-keyword">when</span> (equal (char-before) ?\n)
                  (delete-char -1)
                  (save-buffer)))))

<span class="org-comment-delimiter">;; </span><span class="org-comment">When I'm using soft-wraps to write prose, I like to have Emacs (Evil in</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">particular) to respect my visual lines. In order to do that, I must set</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">the `</span><span class="org-comment"><span class="org-constant">evil-respect-visual-line-mode</span></span><span class="org-comment">' variable before Evil is loaded.</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">Unfortunately, by the time the 'config.el' file is loaded, it is too late,</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">and that is why I have to set this variable here.</span>
(<span class="org-keyword">setq</span> evil-respect-visual-line-mode t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbad6ff6" class="outline-3">
<h3 id="orgbad6ff6"><span class="section-number-3">7.2</span> List of tables</h3>
<div class="outline-text-3" id="text-7-2">
<div id="list-of-tables">
<h2>List of Tables</h2>
<div id="text-list-of-tables">
<ul>
<li><a href="#orga5e2505"><span class="table-number">Table 1:</span> macOS key mappings</a></li>
<li><a href="#org5c1a0f8"><span class="table-number">Table 2:</span> Headline sizes and multipliers</a></li>
<li><a href="#org7155d89"><span class="table-number">Table 3:</span> Org elements to unicode characters</a></li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-org0710833" class="outline-3">
<h3 id="org0710833"><span class="section-number-3">7.3</span> List of figures</h3>
<div class="outline-text-3" id="text-7-3">
<ul class="org-ul">
<li><a href="#org649263f">Figure 1: My favorite contender for a Doom Emacs logo</a></li>
<li><a href="#orgcd43abb">Figure 2: My org directory structure</a></li>
</ul>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Thiago Alves</p>
<p class="date">Created: 2021-07-29 Thu 15:27</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
